<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.7 plugin-docs plugin-id-default docs-doc-id-user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Crossplane KCL Function | KCL programming language.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kcl-lang.github.io/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="0.7"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.7"><meta data-rh="true" name="docsearch:version" content="0.7"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.7"><meta data-rh="true" property="og:title" content="Crossplane KCL Function | KCL programming language."><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/zh-CN/favicon.ico"><link data-rh="true" rel="canonical" href="https://kcl-lang.github.io/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function"><link data-rh="true" rel="alternate" href="https://kcl-lang.github.io/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function" hreflang="en"><link data-rh="true" rel="alternate" href="https://kcl-lang.github.io/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://kcl-lang.github.io/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://I3BKOKGSD5-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="KCL programming language. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="KCL programming language. Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="KCL programming language." href="/zh-CN/opensearch.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MZD1X1PB2Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MZD1X1PB2Q",{anonymize_ip:!0})</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/zh-CN/assets/css/styles.cb3bdb25.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.290b6733.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.cc84c7a2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Give us a star ⭐️ - If you are using KCL or think it is an interesting project, we would love a star and record on <a target="_blank" rel="noopener noreferrer" href="https://github.com/kcl-lang/kcl">Github</a> and <a target="_blank" rel="noopener noreferrer" href="https://github.com/kcl-lang/kcl/issues/578">Record Issue</a></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/img/kcl-logo.png" alt="KCL Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-CN/img/kcl-logo.png" alt="KCL Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" docid="intro/kcl-intro" href="/zh-CN/docs/0.7/user_docs/getting-started/">使用文档</a><a class="navbar__item navbar__link" href="/zh-CN/docs/0.7/reference/lang/tour">参考手册</a><a class="navbar__item navbar__link" href="/zh-CN/docs/0.7/tools/cli/">工具</a><a href="https://artifacthub.io/packages/search?org=kcl&amp;sort=relevance&amp;page=1" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" sidebarid="modules">模型库<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="http://101.42.3.224/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" sidebarid="playground">游乐场<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/kcl-lang/examples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" sidebarid="examples">样例<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/zh-CN/docs/0.7/community/intro/">社区</a><a class="navbar__item navbar__link" href="/zh-CN/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs/0.7/tools/cli/">0.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/docs/next/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function">Next</a></li><li><a class="dropdown__link" href="/zh-CN/docs/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function">0.8</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function">0.7</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.6/tools/cli/">0.6</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.5/tools/cli/">0.5</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.4.6/tools/cli/">0.4.6</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.4.5/events/2022/kcl_paper">0.4.5</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.4.4/events/2022/kcl_paper">0.4.4</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.4.3/events/2022/kcl_paper">0.4.3</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">简体中文</a></li><li><a href="https://github.com/kcl-lang/kcl-lang.io/issues/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently 浅色模式)" aria-label="Switch between dark and light mode (currently 浅色模式)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="滚动回顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-CN/docs/0.7/user_docs/getting-started/">快速开始</a><button aria-label="Toggle the collapsible sidebar category &#x27;快速开始&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh-CN/docs/0.7/user_docs/guides/">用户手册</a><button aria-label="Toggle the collapsible sidebar category &#x27;用户手册&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/configuration">配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/validation">校验</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/abstraction">抽象</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/schema-definition">模型定义</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/data-integration">数据集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/automation">自动化</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/package-management/quick-start">包管理工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/">Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/overview">概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/adopt-from-kubernetes">从 Kubernetes 迁移或集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/generate-k8s-manifests">使用 KCL 生成并管理 Kubernetes 资源配置</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/kubectl-kcl-plugin">编辑或验证 Kubernetes 资源</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/kubectl-kcl-plugin">Kubectl KCL 插件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/helm-kcl-plugin">Helm KCL 插件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/kustomize-kcl-plugin">Kustomize KCL 插件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/kpt-kcl-sdk">KPT KCL SDK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/helmfile-kcl-plugin">Helmfile KCL Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/kcl-operator">KCL Operator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function">Crossplane KCL Function</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-konfig/overview">Konfig</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/gitops/gitops-quick-start">GitOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/ci-integration/github-actions">CI 集成</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/secret-management/vault">敏感信息管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-terraform/validation">Terraform</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-kusion/">KusionStack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/0.7/user_docs/guides/working-with-kubevela/">KubeVela</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-CN/docs/0.7/user_docs/concepts/">核心概念</a><button aria-label="Toggle the collapsible sidebar category &#x27;核心概念&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-CN/docs/0.7/user_docs/support/">常见问答</a><button aria-label="Toggle the collapsible sidebar category &#x27;常见问答&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->KCL programming language.<!-- --> <b>0.7</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/zh-CN/docs/user_docs/guides/working-with-k8s/mutate-manifests/crossplane-kcl-function">最新版本</a></b> (<!-- -->0.8<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh-CN/docs/0.7/user_docs/guides/"><span itemprop="name">用户手册</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">编辑或验证 Kubernetes 资源</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Crossplane KCL Function</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本: 0.7</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Crossplane KCL Function</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Crossplane and Crossplane Composite Functions are used to decouple XR and Composite resource definitions. XRs allow developers to create higher-level abstractions that can encapsulate and compose multiple types of cloud resources across different providers and services. Using Crossplane Composite Functions to render these abstractions can effectively enhance template capabilities for various provider resources while reducing the amount of YAML code needed.</p><p>Combining KCL with Crossplane composite functions offers several benefits:</p><ul><li><strong>Simplification of Complex Configurations</strong>: KCL provides a more concise syntax and structure as a DSL, reducing the complexity of configurations. When combined with Crossplane’s composite resources, you can create more intuitive and easy-to-understand configuration templates with loop and condition features, simplifying the definition and maintenance of resources instead of duplicate YAML and Go code snippets.</li><li><strong>Reusability and Modularity</strong>: KCL supports modularity and code reuse through OCI Registry, which means you can create reusable configuration components. Combined with Crossplane, this promotes the modularity of composite resources, increases the reuse of configurations, and reduces errors.</li><li><strong>Automation and Policy-Driven</strong>: You can use KCL’s powerful features to write policies and constraints that, combined with Crossplane’s declarative resource management, can be automatically enforced, ensuring compliance within the cloud environment.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>Prepare a Kubernetes cluster</li><li>Install Kubectl</li><li>Install <a href="https://docs.crossplane.io/" target="_blank" rel="noopener noreferrer">Crossplane and Crossplane CLI 1.14+</a></li><li>Install Go 1.21+</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-start">Quick Start<a href="#quick-start" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Let’s write a KCL function abstraction which generates managed resources <code>VPC</code> and <code>InternetGateway</code> with an input resource <code>Network</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-install-the-crossplane-kcl-function">1. Install the Crossplane KCL Function<a href="#1-install-the-crossplane-kcl-function" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Installing a Function creates a function pod. Crossplane sends requests to this pod to ask it what resources to create when you create a composite resource.</p><p>Install a Function with a Crossplane Function object setting the <code>spec.package</code> value to the location of the function package.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: pkg.crossplane.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  package: docker.io/kcllang/crossplane-kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-apply-the-composition-resource">2. Apply the Composition Resource<a href="#2-apply-the-composition-resource" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Just like a render function, you can apply the composition resource using KCL into cluster.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: apiextensions.crossplane.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Composition</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: xlabels.fn-demo.crossplane.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    provider: aws</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  writeConnectionSecretsToNamespace: crossplane-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  compositeTypeRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    apiVersion: fn-demo.crossplane.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kind: XNetwork</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  mode: Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  pipeline:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - step: normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    functionRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      name: kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    input:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      apiVersion: krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      kind: KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        name: basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # Generate new resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        target: Resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # OCI, Git or inline source</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # source: oci://ghcr.io/kcl-lang/crossplane-xnetwork-kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # source: github.com/kcl-lang/modules/crossplane-xnetwork-kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        source: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          # Get the XR spec fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          id = option(&quot;params&quot;)?.oxr?.spec.id or &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          # Render XR to crossplane managed resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          network_id_labels = {&quot;networks.meta.fn.crossplane.io/network-id&quot; = id} if id else {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          vpc = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              apiVersion = &quot;ec2.aws.upbound.io/v1beta1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              kind = &quot;VPC&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.name = &quot;vpc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.labels = network_id_labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              spec.forProvider = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  region = &quot;eu-west-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  cidrBlock = &quot;192.168.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  enableDnsSupport = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  enableDnsHostnames = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          gateway = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              apiVersion = &quot;ec2.aws.upbound.io/v1beta1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              kind = &quot;InternetGateway&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.name = &quot;gateway&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.labels = network_id_labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              spec.forProvider = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  region = &quot;eu-west-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  vpcIdSelector.matchControllerRef = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          items = [vpc, gateway]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-create-crossplane-xrd">3. Create Crossplane XRD<a href="#3-create-crossplane-xrd" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>We define a schema using the crossplane XRD for the input resource <code>Network</code>, it has a field named <code>id</code> which denotes the network id.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: apiextensions.crossplane.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: CompositeResourceDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: xnetworks.fn-demo.crossplane.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  group: fn-demo.crossplane.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kind: XNetwork</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    plural: xnetworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  claimNames:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kind: Network</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    plural: networks</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  versions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      served: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      referenceable: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        openAPIV3Schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          type: object</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              type: object</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                id:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  description: ID of this Network that other objects will use to refer to it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              required:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                - id</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-apply-the-crossplane-xr">4. Apply the Crossplane XR<a href="#4-apply-the-crossplane-xr" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: fn-demo.crossplane.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Network</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: network-test-functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  id: network-test-functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-verify-the-generated-managed-resources">5. Verify the Generated Managed Resources<a href="#5-verify-the-generated-managed-resources" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>VPC</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get VPC -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> network-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      networks.meta.fn.crossplane.io/network-id: network-test-functions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>InternetGateway</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get InternetGateway -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> network-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      networks.meta.fn.crossplane.io/network-id: network-test-functions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It can be seen that we have indeed successfully generated <code>VPC</code> and <code>InternetGateway</code> resources, and their fields meet expectations.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-debugging-kcl-functions-locally">6. Debugging KCL Functions Locally<a href="#6-debugging-kcl-functions-locally" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>See <a href="https://github.com/crossplane-contrib/function-kcl" target="_blank" rel="noopener noreferrer">here</a> for more information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-enhancements">Client Enhancements<a href="#client-enhancements" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>It can be seen that the above abstract code often requires a crossplane as a control plane intermediary, and you can still complete the abstraction in a fully client-side manner and directly generate crossplane managed resources to reduce the burden on the cluster.</p><p>For example</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run oci://ghcr.io/kcl-lang/crossplane-xnetwork-kcl-function -S items -D </span><span class="token assign-left variable" style="color:#36acaa">params</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{&quot;oxr&quot;: {&quot;spec&quot;: {&quot;id&quot;: &quot;network-test-functions&quot;}}}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output is</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ec2.aws.upbound.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> VPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks.meta.fn.crossplane.io/network-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> network</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">forProvider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cidrBlock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enableDnsSupport</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enableDnsHostnames</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ec2.aws.upbound.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InternetGateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks.meta.fn.crossplane.io/network-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> network</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">forProvider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">vpcIdSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">matchControllerRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guides-for-developing-kcl">Guides for Developing KCL<a href="#guides-for-developing-kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Here&#x27;s what you can do in the KCL script:</p><ul><li>Return an error using <code>assert {condition}, {error_message}</code>.</li><li>Read the <code>ObservedCompositeResource</code> from <code>option(&quot;params&quot;).oxr</code>.</li><li>Read the <code>ObservedComposedResources</code> from <code>option(&quot;params&quot;).ocds</code>.</li><li>Read the <code>DesiredCompositeResource</code> from <code>option(&quot;params&quot;).dxr</code>.</li><li>Read the <code>DesiredComposedResources</code> from <code>option(&quot;params&quot;).dcds</code>.</li><li>Read the environment variables. e.g. <code>option(&quot;PATH&quot;)</code> (<strong>Not yet implemented</strong>).</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="library">Library<a href="#library" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>You can directly use <a href="https://kcl-lang.io/docs/reference/model/overview" target="_blank" rel="noopener noreferrer">KCL standard libraries</a> such as <code>regex.match</code>, <code>math.log</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-documents-and-examples">More Documents and Examples<a href="#more-documents-and-examples" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li><a href="https://github.com/kcl-lang/krm-kcl" target="_blank" rel="noopener noreferrer">KRM KCL Spec</a></li><li><a href="https://github.com/crossplane-contrib/function-kcl/examples" target="_blank" rel="noopener noreferrer">Crossplane KCL</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kcl-lang/kcl-lang.io/tree/main/versioned_docs/version-0.7/user_docs/guides/working-with-k8s/3-mutate-manifests/7-crossplane-kcl-function.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页面</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">上次更新<!-- --> on <b><time datetime="2024-03-22T05:23:08.000Z">2024年3月22日</time></b> by <b>Peefy</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-CN/docs/0.7/user_docs/guides/working-with-k8s/mutate-manifests/kcl-operator"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">KCL Operator</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-CN/docs/0.7/user_docs/guides/working-with-konfig/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">概述</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#quick-start" class="table-of-contents__link toc-highlight">Quick Start</a><ul><li><a href="#1-install-the-crossplane-kcl-function" class="table-of-contents__link toc-highlight">1. Install the Crossplane KCL Function</a></li><li><a href="#2-apply-the-composition-resource" class="table-of-contents__link toc-highlight">2. Apply the Composition Resource</a></li><li><a href="#3-create-crossplane-xrd" class="table-of-contents__link toc-highlight">3. Create Crossplane XRD</a></li><li><a href="#4-apply-the-crossplane-xr" class="table-of-contents__link toc-highlight">4. Apply the Crossplane XR</a></li><li><a href="#5-verify-the-generated-managed-resources" class="table-of-contents__link toc-highlight">5. Verify the Generated Managed Resources</a></li><li><a href="#6-debugging-kcl-functions-locally" class="table-of-contents__link toc-highlight">6. Debugging KCL Functions Locally</a></li></ul></li><li><a href="#client-enhancements" class="table-of-contents__link toc-highlight">Client Enhancements</a></li><li><a href="#guides-for-developing-kcl" class="table-of-contents__link toc-highlight">Guides for Developing KCL</a></li><li><a href="#library" class="table-of-contents__link toc-highlight">Library</a></li><li><a href="#more-documents-and-examples" class="table-of-contents__link toc-highlight">More Documents and Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/user_docs/getting-started/intro">简介</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/user_docs/guides">用户手册</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/reference/lang/tour">教程</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/user_docs/support">常见问答</a></li></ul></div><div class="col footer__col"><div class="footer__title">资源</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/kusionstack/kcl" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">博客</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/community/intro">社区</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kusionstack.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">KusionStack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权 © 2023 KCL Authors</div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.290b6733.js"></script>
<script src="/zh-CN/assets/js/main.cc84c7a2.js"></script>
</body>
</html>