<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>KCL programming language. Blog</title>
        <link>https://kcl-lang.github.io/zh-CN/blog</link>
        <description>KCL programming language. Blog</description>
        <lastBuildDate>Wed, 17 Apr 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-CN</language>
        <item>
            <title><![CDATA[KCL 最新动态速递 (2024.04.04 - 2024.04.17)]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-04-17-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-04-17-newsletter</guid>
            <pubDate>Wed, 17 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去一段时间 (2024.04.04 - 2024.04.17) 的杰出工作，以下是重点内容概述</p><p><strong>🏄 语言更新</strong></p><ul><li>Schema 的 <code>instances()</code> 方法新增关键字参数 <code>full_pkg</code> 参数用于读取所有代码中对应 Schema 的实例</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Person</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alice </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Person </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Alice"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all_persons </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Person</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">instances</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>新增 <code>template</code> 系统库用于在 KCL 中操作模版</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token triple-quoted-string string" style="color:#e3116c">"""\</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&lt;div class="entry"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">{{#if author}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&lt;h1&gt;{{firstName}} {{lastName}}&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">{{/if}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  firstName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Yehuda"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lastName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Katz"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>⛵️ API 更新</strong></p><ul><li>OverrideFile API 支持修改/删除非 schema 类型的字段</li><li>新增 ListVariable API 用于读取 KCL 文件中变量的值</li></ul><p><strong>🔥 SDK 更新</strong></p><ul><li>KCL Go SDK 发布 0.8.4 版本。</li><li>KCL Rust SDK 新增 <code>llvm</code> feature 选项，可以选择是否采用 LLVM 编译，默认为关闭。当关闭 LLVM 特性时，可以降低构建二进制体积 90%。通过以下方式添加依赖</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> --git https://github.com/kcl-lang/lib</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>KCL Node.js SDK 初版发布，仓库地址 <a href="https://github.com/kcl-lang/lib/tree/main/nodejs" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/lib/tree/main/nodejs</a>, 欢迎共建</li></ul><ul><li><code>__test__/test_data/schema.k</code></li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema AppConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AppConfig </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>execProgram</code></li></ul><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> execProgram</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ExecProgramArgs </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl-lib"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">execProgram</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">ExecProgramArgs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"__test__/test_data/schema.k"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yamlResult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 'app:\n  replicas: 2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>listVariables</code></li></ul><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> listVariables</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ListVariablesArgs </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl-lib"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">listVariables</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">ListVariablesArgs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'__test__/test_data/schema.k'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">variables</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'app'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 'AppConfig {replicas: 2}'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>loadPackage</code></li></ul><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> loadPackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LoadPackageArgs </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl-lib"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadPackage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">LoadPackageArgs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'__test__/test_data/schema.k'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">symbols</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>💻 IDE 更新</strong></p><ul><li>新增编译单元缓存提升 IDE 性能</li></ul><p><strong>🌼 集成更新</strong></p><ul><li>Crossplane KCL Function 发布 v0.5.1 版本<ul><li>支持读取 Function Context 参数用于不同的函数进行参数传递</li><li>支持读写 Function Details 字段用于处理与 Secret 资源相关的敏感信息</li><li>支持设置 XR 资源的 status 字段用于输出用户提示信息</li><li>修复多个 XR 资源下发集群时并发请求的错误</li></ul></li><li>KCL 发布 Nix 包，可以通过 <code>nix-shell</code> 或者 <code>devbox shell</code> 工具一键安装 KCL 命令行工具，详情查看 <a href="https://search.nixos.org/packages?channel=unstable&amp;show=kcl-cli&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=kcl-cli" target="_blank" rel="noopener noreferrer">https://search.nixos.org/packages?channel=unstable&amp;show=kcl-cli&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=kcl-cli</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢过去两周所有的社区参与者，以下排名不分先后</p><ul><li>感谢 @bozaro 对 KCL Go SDK 的贡献 🙌</li><li>感谢 @jheyduk 对 Kubectl KCL 插件的贡献 🙌</li><li>感谢 @shashank-iitbhu 对 KCL IDE 语法快速修复功能的贡献 🙌</li><li>感谢 @d4v1d03 对 KCL 官网 FAQ 文档的贡献 🙌</li><li>感谢 @octonawish-akcodes 对 KCL IDE 根据 kcl.mod 自动更新依赖功能的贡献 🙌</li><li>感谢 @utnim2 对 KCL IDE 重启 kcl-language-server 命令的贡献 🙌</li><li>感谢 @AkashKumar7902 对 KCL 包管理工具最小版本选择 MVS 算法的贡献 🙌</li><li>感谢 @steeling, @bozaro, @vtomilov, @sanzoghenzo, @folliehiyuki, @markphillips100, @wilsonwang371, @zargor, @aleeriz, @reckless-huang, @zhuxw, @jheyduk ,@Vitaly Tomilov, @Sergey Ryabin, @Stephen C, @ytsarev 等在近段时间使用 KCL 过程中提供的宝贵建议与反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/9" target="_blank" rel="noopener noreferrer">KCL v0.9.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL 最新动态速递 (2024.03.20 - 2024.04.03)]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-04-03-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-04-03-newsletter</guid>
            <pubDate>Wed, 03 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去一段时间 (2024.03.06 - 2024.03.20) 的杰出工作，以下是重点内容概述</p><p><strong>🏄 语言更新</strong></p><p><strong>KCL 发布 0.8.3 和 0.8.4 版本</strong>，主要包含如下更新</p><ul><li>增加了文件系统 built-in 方法 <code>file.abs</code> 计算文件绝对路径和 <code>file.exists</code> 判断文件是否存在。</li></ul><p><strong>🔧 工具链更新</strong></p><ul><li>KCL 包管理工具: <code>kcl.mod</code> 文件中增加对 oci url 的支持。</li><li>KCL 包管理工具: <code>kcl.mod</code> 中移除了间接依赖的更新。</li><li>KCL 包管理工具: 移除了本地依赖的 checksum 检查。</li><li>KCL 包管理工具: 修复了本地依赖版本号缺失的问题。</li><li>KCL 包管理工具: 修复了本地依赖缺失的问题。</li><li>KCL 包管理工具: 修复了符号链接创建失败的内部 bug。</li></ul><p><strong>🔥 SDK 更新</strong></p><ul><li>KCL Go SDK 发布 0.8.3 版本。</li><li>KCL Go SDK 修复了 ParseFile 过程中的 panic 问题。</li><li>KCL Go SDK 支持通过环境变量设置 kcl 编译器自动下载。</li></ul><p><strong>💻 IDE 更新</strong></p><ul><li>修复了 IDE 对于未保存代码的 format 功能。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢过去两周所有的社区参与者，以下排名不分先后</p><ul><li>感谢 @bozaro 对 KCL Go SDK 的贡献 🙌</li><li>感谢 @reckless-huang 对于 KCL Go SDK 的贡献 🙌</li><li>感谢 @vemoo 对 KCL IDE 的贡献 🙌</li><li>感谢 @wilsonwang371 对 KCL docker 镜像和 KCL 官网的贡献 🙌</li><li>感谢 @d4v1d03 对 KCL 官网的贡献 🙌</li><li>感谢 @liangyuanpeng 对 KCL github action 的贡献 🙌</li><li>感谢 @octonawish-akcodes 对 KCL IDE 的贡献 🙌</li><li>感谢 @AkashKumar7902 对 KCL 包管理工具的贡献 🙌</li><li>感谢 @empath-nirvana 对 crossplane function-kcl 的贡献 🙌</li><li>感谢 @markphillips100, @reckless-huang, @steeling, @vfarcic, @wilsonwang371, @M Slane, @Tertium, @Abhishek, @Akash Kumar, @Kim Sondrup, @rodrigoalvamat, @riven-blade, @userxiaosi 等在近段时间使用 KCL 过程中提供的宝贵建议与反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/9" target="_blank" rel="noopener noreferrer">KCL v0.9.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Newsletter</category>
        </item>
        <item>
            <title><![CDATA[Pkl 和 KCL 的异同]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-03-22-pkl-kcl-comparison</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-03-22-pkl-kcl-comparison</guid>
            <pubDate>Fri, 22 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Pkl 是什么]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pkl-是什么">Pkl 是什么<a href="#pkl-是什么" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Pkl 是一门面向配置的新型领域编程语言，致力于解决<strong>配置复杂化</strong>比如配置重复和错误验证等问题，主要面向云原生和应用配置等场景，其技术产品整体的主要目标可以概括为:</p><ul><li><strong>安全性</strong>：通过在部署之前捕获验证错误来提供安全性。</li><li><strong>可扩展</strong>：语言整体既可以用在简单场景也可以用在复杂的场景中。</li><li><strong>可编程</strong>：借助一流的 IDE 支持，提升配置代码编写体验。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-是什么">KCL 是什么<a href="#kcl-是什么" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 是一个开源的基于约束的记录及函数语言，作为沙盒项目托管在 CNCF 基金会。KCL 通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pkl-和-kcl-的区别">Pkl 和 KCL 的区别<a href="#pkl-和-kcl-的区别" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="设计理念">设计理念<a href="#设计理念" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>两个语言的设计理念可以从各自官网的 Slogan 窥见一二，Pkl 的 Slogan 是 Programmable, Scalable 和 Safe，KCL 的 Slogan 是 Mutation, Validation 和 Abstraction。可以简单理解为 KCL 相比于 Pkl 更聚焦在云原生领域中的具体场景问题比如复杂性和安全等问题，并更加贴近云原生的描述方式 (Mutation 和 Validation 取自 Kubernetes 中的 MutationWebhook 和 ValidationWebhook, 使用抽象 Abstraction 来对抗复杂性问题)，对于非领域内的问题尽可能收敛语言自身的设计，减少一些不必要的设计并针对特定领域进行增强，以在满足功能以及开发者使用简单的基础上，尽可能参考一些使用起来比较简单的语言如 Python, Go 等语法语义风格，排除非预期的特性和副作用，比如从语言技术和 GitOps 结合两个方面加强对稳定性和一致性的保证，通过语言的自动化 API 来提升效率，通过强不可变性、冲突监测保证配置的确定性，通过代码复用和抽象结合默认值填充的方式屏蔽用户侧细节感知，通过自定义的校验表达式支持对配置数据的业务校验等，通过与更多的云原生工具或者项目集成比如 Kustomize, Helm 和 Crossplane 等来完成更多的场景功能支持。</p><p>而 Pkl 比在设计层面相比 KCL 更加 “通用” 和 “现代”，这不仅体现在语言设计元素上，还体现在具体的语言特性上。因为 Pkl 首先被设计为是图灵完备的，整体语言设计更像 Swift 和 Kotlin，这意味着 Pkl 不仅可以被用于主业 "配置" 场景，它还可以做的更多，比如你可以用它来写 Leetcode 算法题，编写快速排序。甚至你可以在 Pkl 中看到像 Java 那样的面向对象特性的一系列关键字以及在其他常用通用编程语言中不常见到的管道运算符 <code>|&gt;</code>。此外，Pkl 的很多特性和工具也都是 Pkl 自身实现的，这一定程度上体现了 Pkl 的能力。当然这样的用例有很多，无法在这里详尽一一列举。</p><p>我本人是十分喜欢 Pkl 这样的具有更多现代特性的语言的，这意味的它功能很强大，几乎不会出现满足不了的业务场景，对写库的开发者来说会比较容易接受。但是从反面的角度来说，这无疑为一门领域语言带来了额外的复杂性和推广学习门槛。而 KCL 会从配置数据和强大的通用语言特性之间把握一个平衡，比如 KCL 没有像 Pkl 那样的过程式 for 循环，KCL 虽然提供了偏面向对象的语言特性，但并不会引入像 Pkl 那样复杂的继承链和多态，并且 KCL 又参考了一些函数式语言，它的函数被设计为 "纯" 的，不会带来额外的副作用，这使得 KCL 可以在完成复杂功能的同时又可以像 JSON, YAML 等数据那样被上层业务系统集成实现以更多的自动化。这意味着 KCL 会舍弃最复杂的极端场景而选择比较场景的场景，并针对常用的场景提供了许多内置库函数可以使用。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="语言特性">语言特性<a href="#语言特性" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>综合来看，KCL 和 Pkl 都支持变量定义、引用、类型定义，但支持程度和语法语义有差异；基本都支持支持常用的算术、逻辑、循环推导式、条件、函数、标准库和导入第三方模块等编程语言特性，支持方式及语法也各不相同，但都有从通用编程语言借鉴吸收；在用户自定义类型、面向对象的特性上部分支持或混合支持，在数据文件集成方面，KCL 和 Pkl 可以直接导入 JSON/YAML 数据类型和 JSON Schema 和 Kubernetes CRD 等类型定义。</p><p>此外，KCL 和 Pkl 都在配置操作 Patch, 数据验证和安全合规层面内置了许多语言特性满足配置的场景需求，比如支持配置的自动合并特性以及字段范围，类型，正则表达式等检查特性，不同是 KCL 采用了偏面向对象的特性，将数据的类型检查和约束检查分离，可以使得 KCL 提供更多的静态分析能力满足 IDE 或者其他工具链需要并或者组合约束检查的能力，而 Pkl 需要将约束定义与其类型定义书写在一起并统一在运行时完成类型检查和约束校验。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="开发者工具">开发者工具<a href="#开发者工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在开发者工具方面，Pkl 和 KCL 都是重视 Developer Productivity 的项目，提供了非常多的语言工具和 IDE 插件支持。除了基本的语言工具，Pkl 官网主要提供了三种 IDE 插件支持，分别是 IntelliJ, NeoVim 和 VS Code。巧合的是，KCL 目前也是提供了这三种 IDE 插件支持，不过它们的功能和侧重点略有不同。</p><p>Pkl 由于项目本身是 Java 和 Kotlin 开发，因此非常容易适配到 JetBrain 系列 IDE 插件体系中，因此 IntelliJ 插件支持最为完善，而 Pkl 本身并没有提供 Language Server，因此 NeoVim 和 VS Code 插件仅基于 Tree Sitter 解析器生成器提供了最基本的高亮和代码折叠，并无更高级的定义跳转、代码重构和补全等功能。另外 Pkl 虽然作为苹果的项目，但是没有使用 Swift 开发 Pkl 也没有为 XCode 开发 Pkl IDE 插件。</p><p>而 KCL 的情况正好相反，KCL 项目是 Rust 开发，并提供了 Language Server 支持，因此可以比较容易扩展集成到除 VS Code 的 IDE 插件支持包括 NeoVim 以及一些其他新兴的支持 LSP 的 IDE 或者编辑器。并且 KCL 基于 Language Server 提供了完整的代码高亮、补全、跳转、重构、补全和快速修复等功能。由于 IntelliJ 仅在在其专业版中提供了阉割的 LSP 支持，因此我们针对 IntelliJ 插件也补充了相应的功能 Java 实现支持，但是相比于 VS Code KCL 插件功能上目前没有那么完善，还有较多的提升空间。</p><p>总之，Pkl 和 KCL 在 Developer Productivity 方面也都有提升和完善的空间，由于不同 IDE 插件实现上的差异，这块需要更多从开源社区借力不断完善 IDE 体验和场景工作流程。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="多语言-sdk">多语言 SDK<a href="#多语言-sdk" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>为了将配置语言更好地集成到用户的应用中，Pkl 提供了 Java, Kotlin, Swift 和 Go 四种多语言的绑定。又比较巧合的是 KCL 也提供了四种 SDK 💦， 分别是 Go, Python, Java 和 Rust。</p><p>是在 Pkl 开源之前，KCL 是为数不多甚至是唯一官方提供了多种 IDE 插件和多语言绑定，并且是在社区用户和研发者的共同敦促和努力一点一点积累做出来的。Pkl 在核心维护者这么少的情况下一开源就提供了许多可以和 KCL 对标的特性，可以想到在背后也迭代了相当久的时间，付出了相当多的努力，值得点赞。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>受限于篇幅，以上内容不足以描述全部的设计细节和功能对比，下面仅列出一个表格对比用于读者参考。</p><table><thead><tr><th>特性</th><th>Pkl</th><th>KCL</th></tr></thead><tbody><tr><td>开源协议</td><td>Apache-2.0</td><td>Apache-2.0</td></tr><tr><td>开发语言</td><td>Java, Kotlin</td><td>Rust</td></tr><tr><td>语言风格</td><td>类 Swift, Kotlin</td><td>类 Python, Go</td></tr><tr><td>语言功能</td><td>强</td><td>中等</td></tr><tr><td>编译执行方式</td><td>JIT</td><td>AOT</td></tr><tr><td>运行性能</td><td>中等</td><td>中等</td></tr><tr><td>增量编译</td><td>✅</td><td>✅</td></tr><tr><td>标准库</td><td>✅</td><td>✅</td></tr><tr><td>包管理工具</td><td>✅</td><td>✅</td></tr><tr><td>格式化工具</td><td>❌</td><td>✅</td></tr><tr><td>文档工具</td><td>❌</td><td>✅</td></tr><tr><td>测试工具</td><td>✅</td><td>✅</td></tr><tr><td>调试工具</td><td>❌</td><td>❌</td></tr><tr><td>IDE 插件</td><td>IntelliJ, NeoVim, VS Code</td><td>IntelliJ, NeoVim, VS Code</td></tr><tr><td>多语言 SDK</td><td>Java, Kotlin, Swift, Go</td><td>Go, Python, Java, Rust</td></tr><tr><td>多语言插件</td><td>❌</td><td>Go, Python</td></tr><tr><td>Language Server</td><td>❌</td><td>✅</td></tr><tr><td>Spring 框架支持</td><td>✅</td><td>❌</td></tr><tr><td>OCI Registry 支持</td><td>❌</td><td>✅</td></tr><tr><td>社区模型库</td><td>✅</td><td>✅</td></tr><tr><td>REST Server 支持</td><td>✅</td><td>✅</td></tr><tr><td>导出配置数据</td><td>JSON, YAML, TOML, plist 等</td><td>JSON, YAML</td></tr><tr><td>从其他数据或 Schema 导入</td><td>✅</td><td>✅</td></tr><tr><td>Kubernetes 配置支持</td><td>✅</td><td>✅</td></tr><tr><td>云原生工具集成支持</td><td>❌</td><td>✅</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>KCL 主页：<a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/</a></li><li>KCL GitHub 仓库：<a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl</a></li><li>Pkl 主页：<a href="https://pkl-lang.org/" target="_blank" rel="noopener noreferrer">https://pkl-lang.org/</a></li><li>Pkl GitHub 仓库：<a href="https://github.com/apple/pkl" target="_blank" rel="noopener noreferrer">https://github.com/apple/pkl</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Pkl</category>
            <category>Comparison</category>
        </item>
        <item>
            <title><![CDATA[KCL 最新动态速递 (2024.03.06 - 2024.03.20)]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-03-20-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-03-20-newsletter</guid>
            <pubDate>Wed, 20 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去一段时间 (2024.03.06 - 2024.03.20) 的杰出工作，以下是重点内容概述</p><p><strong>📦 模型更新</strong></p><ul><li>新增 kubeadm 配置模型</li><li>更新 Knative Operator 模型，对齐上游 Knative CRD 定义</li></ul><p><strong>🏄 语言更新</strong></p><p><strong>KCL 发布 0.8.1 和 0.8.2 版本</strong>，主要包含如下更新</p><ul><li>体验简化增强二元表达式类型不匹配时的错误信息提示</li><li>修复高阶 lambda 函数对局部作用域闭包变量捕获不正常的错误</li><li>去除不常用的列表数据类型的不等式比较操作</li></ul><p><strong>🔧 工具链更新</strong></p><ul><li><code>kcl import</code> 工具修复当输入的 Kubernetes CRD 存在 regex 属性与 KCL regex 系统库冲突的错误</li><li><code>kcl import</code> 工具修复当输入的 Kubernetes CRD 属性存在复杂的默认值时输出的 KCL 文件语法错误</li><li><code>kcl mod init</code> 支持 <code>--version</code> 标签设置 KCL 新建模块的版本</li><li><code>kcl run</code>, <code>kcl mod add</code> 和 <code>kcl mod pull</code> 等命令支持对私有 Git 仓库的访问</li><li>修复在 Windows 上执行对本地 OCI Registry 执行 <code>kcl run</code> 命令时遇到的路径错误</li></ul><p><strong>🔥 SDK 更新</strong></p><ul><li>KCL Rust, Go 和 Java SDK 发布 0.8 主要版本，同步 KCL 语法语义更新</li><li>KCL Python SDK 发布 0.8.0.2 和 0.7.6 版本，修复 <code>protobuf</code>, <code>pyyaml</code> 等依赖版本过于低的问题</li></ul><p><strong>💻 IDE 更新</strong></p><ul><li>支持多个 Quick Fix 修复选项</li></ul><p><img loading="lazy" alt="multiple-quick-fix" src="/zh-CN/assets/images/multiple-quick-fix-671571e92fd0bf529c126fa653bb9c20.png" width="1076" height="362" class="img_ev3q"></p><p><strong>🎁 API 更新</strong></p><ul><li>新增 <code>ListOptions</code> API，可以读取 KCL 工程中所有 <code>option</code> 函数调用信息。</li></ul><p><strong>🚢 集成更新</strong></p><ul><li>Crossplane KCL Function 发布 v0.3.2 版本，支持非 https 协议 OCI Registry 访问和本地调试</li></ul><p><strong>🌐 网站更新</strong></p><ul><li>启用 <code>kcl-lang.dev</code> 域名，现在可以同时通过 <code>kcl-lang.io</code> 和 <code>kcl-lang.dev</code> 访问 KCL 网站</li><li>KCL 网站加载速度优化，提升文档体验</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢过去两周所有的社区参与者，以下排名不分先后</p><ul><li>感谢 @bozaro 对 KCL Go SDK 带 Go 语言插件的 API 的贡献 🙌</li><li>感谢 @shashank-iitbhu 对 KCL IDE 快速修复功能的增强，支持多个修复选项 🙌</li><li>感谢 @octonawish-akcodes 对 KCL IDE 自动监听 kcl.mod 依赖变更并自动更新依赖功能的持续贡献 🙌</li><li>感谢 @liangyuanpeng 对 CLA Bot CI 自动锁定 PR 的修正，kubeadm 模型的贡献以及 kcl mod init 支持版本设置功能的支持 🙌</li><li>感谢 @Stefano Borrelli, @sfshumaker, @eshepelyuk, @vtomilov, @ricochet1k, @yjsnly, @markphillips100, @userxiaosi, @wilsonwang371, @steeling, @bozaro, @nizq, @reckless-huang, @folliehiyuki, @samuel-deal-tisseo, @MrGuoRanDuo, 和 @MattHodge 等在近段时间使用 KCL 过程中提供的宝贵建议与反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/9" target="_blank" rel="noopener noreferrer">KCL v0.9.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.8.0 重磅发布 - 融汇社区生态，助力配置体验!]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-03-06-kcl-0.8.0-release</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-03-06-kcl-0.8.0-release</guid>
            <pubDate>Wed, 06 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 <strong>KCL v0.8.0 新版本现在已经可用</strong>！本次发布为大家带来了三方面的重点更新：<strong>语言</strong>、<strong>工具链</strong>、<strong>社区集成 &amp; 扩展支持</strong>。</p><ul><li><em>使用功能更完善错误更少的 KCL 语言、工具链和 IDE 提升代码编写体验和效率</em></li><li><em>更加全面丰富的社区生态集成，改善运维体验</em></li><li><em>更加丰富的 KCL 三方库模型，更加轻松的与云原生生态集成</em></li></ul><p>进一步您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.8.0" target="_blank" rel="noopener noreferrer">KCL v0.8.0 发布页面</a> 或者 <a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">KCL 官方网站</a> 获得下载安装指南和详细发布信息。</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的面向云原生领域开源的基于约束的记录及函数编程语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于围绕配置的模块化、扩展性和稳定性，打造更简单的逻辑编写体验，构建更简单的自动化和生态集成路径。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="语言更新">语言更新<a href="#语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-语法语义更新">🚗 语法语义更新<a href="#-语法语义更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持-show-hidden">支持 <code>show-hidden</code><a href="#支持-show-hidden" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>通过 <code>--show-hidden</code> 参数显示私有变量。</p><p>KCL 程序如下</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">a = {_b = 1}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过命令 <code>kcl run main.k --show-hidden</code> 编译结果如下</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">_b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持参数和关键字参数的合并">支持参数和关键字参数的合并<a href="#支持参数和关键字参数的合并" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL v0.8.0 版本中新增了参数和关键字参数的合并功能。带参数的 schema 实例在合并操作时参数也会合并。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Person[separator]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstName: str = "John"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastName: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fullName: str = firstName + separator + lastName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x = Person(" ") {lastName = "Doe"}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y = Person("-") {lastName = "Doe1"}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">z = x | y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对应编译结果</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">firstName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">lastName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Doe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fullName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John Doe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">firstName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">lastName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Doe1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fullName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Doe1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">z</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">firstName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">lastName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Doe1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fullName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Doe1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持字面值的-yaml-stream-格式输出">支持字面值的 yaml stream 格式输出.<a href="#支持字面值的-yaml-stream-格式输出" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>通过 <code>yaml_stream</code> 方法，可以支持输出 yaml 字面值的结果。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x0 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x1 = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">manifests.yaml_stream([x0, x1])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对应编译结果</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="修复了在循环表达式中的类型检查错误">修复了在循环表达式中的类型检查错误<a href="#修复了在循环表达式中的类型检查错误" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name = "volume"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMapVolumes1: {str:{str:}} = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } for _ in range(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMapVolumes2: [{str:}] = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } for _ in range(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 v0.8.0 之前，上述程序编译会出现类型错误。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">E2G22</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: TypeError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> main.k:4:9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         ^ expected </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">str:any</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, got str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> main.k:2:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> configMapVolumes1: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">str:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">str:</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ^ variable is defined here, its </span><span class="token builtin class-name">type</span><span class="token plain"> is </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">str:any</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, but got str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 v0.8.0 版本中, 将会成功编译出如下结果：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">configMapVolumes1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> volume</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="修复了-schema-对象必选属性递归检查错误">修复了 Schema 对象必选属性递归检查错误<a href="#修复了-schema-对象必选属性递归检查错误" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在 Schema 内部定义了一个对象，对象内部的属性是必选的，但是在实例化时使用不存在的属性。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n: {str:Name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        n.n = "n"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 v0.8.0 之后，上述程序编译会出现类型错误。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">E2L23</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: CompileError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> main.k:9:11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         n.n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">           ^ Cannot </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> member </span><span class="token string" style="color:#e3116c">'n'</span><span class="token plain"> to schema </span><span class="token string" style="color:#e3116c">'Name'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="在编译输出结果中去掉-__settings__-属性">在编译输出结果中去掉 <code>__settings__</code> 属性<a href="#在编译输出结果中去掉-__settings__-属性" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在 v0.8.0 版本中，编译输出结果中去掉了 <code>__settings__</code> 属性。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Person:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __settings__: {str:str} = {"output_type": "STANDALONE"}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name?: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age?: int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    school?: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a = Person{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: "a",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在编译结果中去掉了 <code>__settings__</code> 属性。</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持在-config-表达式中计算-key-和-value-的值">支持在 config 表达式中计算 key 和 value 的值<a href="#支持在-config-表达式中计算-key-和-value-的值" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在 v0.8.0 版本中，支持在 config 表达式中计算 key 和 value 的值。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "a": 'foo'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "b": 'bar'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r0 = [{v = k} for k, v in _data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r1 = [{k = v} for k, v in _data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r2 = [{k.foo = v} for k, v in _data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r3 = [[k] for k, v in _data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r4 = [[k, v] for k, v in _data]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编译结果如下：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">r0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">bar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">r1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">r2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">r3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">r4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> bar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-诊断信息的优化">🔧 诊断信息的优化<a href="#-诊断信息的优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 语法在 if 块中使用的是 <code>elif</code> 关键字，而不是 <code>else if</code>。</p><p>编译以下 KCL 程序：</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if True: a = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if False: b = 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>KCL 在诊断信息中增加了错误修正的建议：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">E1001</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: InvalidSyntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> main.k:2:6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> False: b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">      ^ </span><span class="token string" style="color:#e3116c">'else if'</span><span class="token plain"> here is invalid </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> KCL, consider using the </span><span class="token string" style="color:#e3116c">'elif'</span><span class="token plain"> keyword</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-语言编写体验优化">🚀 语言编写体验优化<a href="#-语言编写体验优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-标准库新增文件系统访问方法">KCL 标准库新增文件系统访问方法<a href="#kcl-标准库新增文件系统访问方法" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL 增加了访问文件系统的方法。在 v0.8.0 版本中支持了包括 <code>read</code>, <code>glob</code> 等访问文件系统的方法。</p><p>通过 <code>read</code> 方法，可以读取一个文件内容为字符串。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a = file.read("hello.txt")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在文件 <code>hello.txt</code> 中添加如下内容：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Hello World </span><span class="token operator" style="color:#393A34">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编译结果</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">a: Hello World </span><span class="token operator" style="color:#393A34">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过结合 <code>json.decode</code> 方法，可以轻松的实现将 json 文件反序列化。</p><p>在 <code>hello.json</code> 文件中增加如下内容</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"John"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"age"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>KCL 程序如下所示：</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_a = json.decode(file.read("hello.json"))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = _a.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">age = _a.age</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编译结果如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">age</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多内容 - <a href="https://kcl-lang.io/zh-CN/docs/reference/model/file/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/zh-CN/docs/reference/model/file/</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-编译缓存路径支持使用环境变量-kcl_cache_path-指定">KCL 编译缓存路径支持使用环境变量 KCL_CACHE_PATH 指定<a href="#kcl-编译缓存路径支持使用环境变量-kcl_cache_path-指定" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL 编译器会将缓存生成到环境变量<code>KCL_CACHE_PATH</code>指定的目录当中，如果没指定，将会生成到项目根目录中。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件系统支持使用-golang-编写-kcl-插件">插件系统支持使用 golang 编写 KCL 插件<a href="#插件系统支持使用-golang-编写-kcl-插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>使用 golang 定义 hello 插件。</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package hello_plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "kcl-lang.io/kcl-go/pkg/plugin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plugin.RegisterPlugin(plugin.Plugin{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Name: "hello",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MethodMap: map[string]plugin.MethodSpec{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "add": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Body: func(args *plugin.MethodArgs) (*plugin.MethodResult, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    v := args.IntArg(0) + args.IntArg(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return &amp;plugin.MethodResult{V: v}, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>借助 kcl-go 开发，扩展 KCL 编译器使用插件。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "fmt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "kcl-lang.io/kcl-go/pkg/kcl"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "kcl-lang.io/kcl-go/pkg/native"                // Import the native API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ "kcl-lang.io/kcl-go/pkg/plugin/hello_plugin" // Import the hello plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Note we use `native.MustRun` here instead of `kcl.MustRun`, because it needs the cgo feature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yaml := native.MustRun("main.k", kcl.WithCode(code)).GetRawYamlResult()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt.Println(yaml)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const code = `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import kcl_plugin.hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = "kcl"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">three = hello.add(1,2) # 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-新增-linux-arm64-版本">😸 新增 Linux arm64 版本<a href="#-新增-linux-arm64-版本" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 的 Release 产物中新增了对 Linux arm64 平台的支持。</p><p>可以在 <a href="https://github.com/kcl-lang/kcl/releases" target="_blank" rel="noopener noreferrer">KCL Release Page</a> 中找到后缀为 <code>linux-arm64</code> 的压缩包。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-sdk--api-更新">🏄 SDK &amp; API 更新<a href="#-sdk--api-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="rust-sdk">Rust SDK<a href="#rust-sdk" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL Rust SDK 提供了一系列的 API，可以用于 KCL 文件的编译、校验、测试和格式化代码等操作。</p><p><a href="https://github.com/kcl-lang/lib" target="_blank" rel="noopener noreferrer">KCL Rust SDK: https://github.com/kcl-lang/lib</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="java-sdk">Java SDK<a href="#java-sdk" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL Java SDK 新增语法树、作用域、符号等语法语义结构定义及相关查询 API。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="go-sdk-更新">Go SDK 更新<a href="#go-sdk-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>KCL Doc 工具支持输出为 OpenAPI 格式。</li><li>增加 Parse 过程相关 API。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-更新">API 更新<a href="#api-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>新增 json/yaml 验证 API 用来验证 json 和 yaml 文件。</li><li>新增语法和语义分析 API 用于对 KCL 代码进行分析。</li><li>新增构建二进制产物 API 用于缓存编译结果。</li><li>新增运行二进制产物 API 用于直接运行编译结果，避免重复编译并提升性能。</li><li>新增代码生成 API 以编程方式实现 KCL 代码生成而不是编写复杂的模版。</li></ul><p>更多的更新可以查看 <a href="https://kcl-lang.io/docs/reference/xlang-api/go-api" target="_blank" rel="noopener noreferrer">KCL v0.8 API 文档</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-其他更新及错误修复">🐞 其他更新及错误修复<a href="#-其他更新及错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>修复了 KCL CLI 使用编译参数 -S 可能会导致的编译错误</li><li>修复了 kcl fmt 工具对 lambda 表达式进行格式化时，结尾增加一个空行的错误。</li><li>修复 Schema Doc 补全代码片段错误</li><li>修复 Schema 对象必选属性递归检查错误</li><li>提升 Schema 索引签名类型检查健壮性</li><li>修复 Schema 内部诸如 "$if" 的字符串标识符定义找不到的错误</li><li>优化非预期 token 的语法错误提示</li><li>修复非预期的字典生成表达式中的 key 与循环变量相同时的变量计算</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ide--工具链更新">IDE &amp; 工具链更新<a href="#ide--工具链更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ide-更新">IDE 更新<a href="#ide-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ide-语义级别的高亮增强">IDE 语义级别的高亮增强<a href="#ide-语义级别的高亮增强" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL IDE 高亮之前仅支持 KCL 语法高亮，如下图所示：</p><p><img loading="lazy" alt="old-ide" src="/zh-CN/assets/images/old-ide-835ff47b36b5e23f304f8092c3afd989.png" width="435" height="151" class="img_ev3q"></p><p>我们今年逐步启用了新的 KCL 语义架构模型，在新语义架构的支撑下，KCL IDE 支持语义级别的高亮，在语义上有关联的代码会显示相同的高亮。</p><p><img loading="lazy" alt="new-ide" src="/zh-CN/assets/images/new-ide-a62fcf4ef6b9d078f77a7e15af161e17.png" width="287" height="145" class="img_ev3q"></p><p>更多关于 KCL 语义架构模型的内容，参考：
<a href="https://kcl-lang.io/zh-CN/blog/2023-12-09-kcl-new-semantic-model" target="_blank" rel="noopener noreferrer">KCL 高效语义模型技术揭秘：实现快速编译与增强 IDE 支持</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="新增-builtin-方法的补全">新增 builtin 方法的补全<a href="#新增-builtin-方法的补全" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL IDE 支持 builtin 方法的补全，如下图所示：</p><p><img loading="lazy" alt="builtin-completion" src="/zh-CN/assets/images/builtin-ide-0e090b72218a4258d2a1831527920d08.gif" width="1218" height="456" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="增加变量引用错误时的快速修复功能">增加变量引用错误时的快速修复功能<a href="#增加变量引用错误时的快速修复功能" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL IDE 支持变量引用错误时的快速修复功能，如下图所示：</p><p><img loading="lazy" alt="quick-fix" src="/zh-CN/assets/images/quick-fix-960989191f14be672e644c4fa97c4522.gif" width="1218" height="496" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ide-支持增量解析和异步编译功能">IDE 支持增量解析和异步编译功能<a href="#ide-支持增量解析和异步编译功能" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>IDE 通过 KCL 新语义模型支持增量解析和异步编译功能，提升了编译速度和编写体验。</p><p>更多内容详见 <a href="https://kcl-lang.io/zh-CN/blog/2023-12-09-kcl-new-semantic-model" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/zh-CN/blog/2023-12-09-kcl-new-semantic-model</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ide-lsp-问题修复">IDE LSP 问题修复<a href="#ide-lsp-问题修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>修复 assert 语句中字符串插值变量不能跳转的异常</li><li>修复了字符串中异常触发函数补全的异常</li><li>修复了字符串后跟注释中补全错误的问题</li><li>修复了 schema 内部属性符号不能跳转的问题</li><li>修复 import 语句别名语义检查和补全的异常</li><li>修复了 schema 中 check 表达式补全的异常</li><li>修复了嵌套 schema 定义中补全错误的问题</li><li>修复了部分悬停信息缺失的问题</li><li>修复不同语法补全符号类型不统一的问题</li><li>区分 Schema 类型和实例补全符号</li><li>统一 Schema 注释文档补全的格式</li><li>修复了配置块内部 if 语句符号不能跳转和补全的问题</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="验证工具更新">验证工具更新<a href="#验证工具更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>本次更新中，我们对 KCL 验证工具的报错信息进行了优化，在使用 KCL 验证工具对 json/yaml 文件进行验证的工作中，将会准确定位到 json 文件的异常位置。</p><p>以 json 文件为例，我们将要对以下 hello.json 文件进行验证</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"age"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"message"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"This is Alice"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>定义如下 main.k 文件来对 json 文件中的内容进行验证</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema User:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age: int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message?: str</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过以下命令对 json 文件内容进行验证</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl vet hello.json main.k</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到在 json 文件中的错误位置：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">E2G22</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: TypeError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> test.json:2:5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     </span><span class="token string" style="color:#e3116c">"name"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     ^ expected str, got int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> main.k:2:5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     name: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     ^ variable is defined here, its </span><span class="token builtin class-name">type</span><span class="token plain"> is str, but got int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-cli-新增-git-仓库作为编译入口">KCL cli 新增 git 仓库作为编译入口<a href="#kcl-cli-新增-git-仓库作为编译入口" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>通过以下命令，可以将 KCL 的 git 仓库作为编译入口</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">git url</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-mod-graph-支持输出-kcl-包依赖图">kcl mod graph 支持输出 KCL 包依赖图<a href="#kcl-mod-graph-支持输出-kcl-包依赖图" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>通过命令 <code>kcl mod graph</code> 输出 KCL 包的依赖图。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理工具">KCL 包管理工具<a href="#kcl-包管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理支持通过-commit-添加-git-依赖">KCL 包管理支持通过 commit 添加 git 依赖<a href="#kcl-包管理支持通过-commit-添加-git-依赖" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL 包管理工具增加了通过 commit 来添加 git 三方库依赖的功能。以 <a href="https://github.com/KusionStack/catalog" target="_blank" rel="noopener noreferrer">https://github.com/KusionStack/catalog</a> 为例，添加 commit 为 a29e3db 的版本作为依赖。可以通过编辑 kcl.mod 文件中的依赖或者命令行直接添加。</p><p>编辑 kcl.mod 文件内容如下：</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog = { git = "https://github.com/KusionStack/catalog.git", commit = "a29e3db" }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者通过命令行添加：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> --git https://github.com/KusionStack/catalog.git --commit a29e3db</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理工具支持三方库名称带有-">KCL 包管理工具支持三方库名称带有“-”<a href="#kcl-包管理工具支持三方库名称带有-" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL 包管理工具支持三方库名称中带有“-”，KCL 包管理工具会自动将 “-” 替换为 “<!-- -->_<!-- -->”。</p><p>以三方库 <code>set-annotation</code> 为例，通过以下命令添加 <code>set-annotation</code> 为依赖：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> set-annotation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 KCL 程序中，通过 <code>set_annotation</code> 引用：</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import set_annotation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-导入工具更新支持更多特性">KCL 导入工具更新，支持更多特性<a href="#kcl-导入工具更新支持更多特性" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>支持 OpenAPI multiplyOf 规范映射到 KCL multiplyof 函数进行校验</li><li>支持 YAML Stream 格式的 Kubernetes CRD 文件输出为多个 KCL 文件</li><li>支持 OpenAPI allOf 关键字校验表达式生成</li><li>支持 KCL 数组和字典类型的 all/any 校验表达式生成</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区集成--扩展更新">社区集成 &amp; 扩展更新<a href="#社区集成--扩展更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flux-kcl-controller-发布">Flux KCL Controller 发布<a href="#flux-kcl-controller-发布" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>我们开发了 <a href="https://github.com/kcl-lang/flux-kcl-controller" target="_blank" rel="noopener noreferrer">Flux KCL Controller</a> 支持 KCL 与 Flux 集成。在集群中安装 Flux KCL Controller 后，通过以下资源就可以实现 KCL git 仓库通过 FluxCD 进行持续集成。</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> source.toolkit.fluxcd.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GitRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 需要持续集成的 github 仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//github.com/awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kusion/kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> krm.kcl.dev.fluxcd/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sourceRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GitRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多内容详见: <a href="https://kcl-lang.io/zh-CN/blog/2024-02-01-biweekly-newsletter/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/zh-CN/blog/2024-02-01-biweekly-newsletter/</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="codeql-kcl-工具">CodeQL KCL 工具<a href="#codeql-kcl-工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>初步支持 CodeQL KCL dbschema 定义以及对 KCL 语法语义进行数据提取，并可通过 CodeQL 进行数据查询对 KCL 代码进行静态分析和扫描，提升代码安全。</p><p>更多内容详见: <a href="https://github.com/kcl-lang/codeql-kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/codeql-kcl</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="模型更新">模型更新<a href="#模型更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 模型数量新增至 303 个，主要新增与 Crossplane Provider 相关的模型和与 JSON 合并操作相关的库</p><ul><li><p>KCL JSON Patch 库：<a href="https://artifacthub.io/packages/kcl/kcl-module/jsonpatch" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/jsonpatch</a></p></li><li><p>KCL JSON Merge Patch 库：<a href="https://artifacthub.io/packages/kcl/kcl-module/json_merge_patch" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/json_merge_patch</a></p></li><li><p>KCL Kubernetes Strategy Merge Patch 库：<a href="https://artifacthub.io/packages/kcl/kcl-module/strategic_merge_patch" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/strategic_merge_patch</a></p></li><li><p>KCL Crossplane 及 Crossplane Provider 系列模型：<a href="https://artifacthub.io/packages/search?org=kcl&amp;sort=relevance&amp;page=1&amp;ts_query_web=crossplane" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/search?org=kcl&amp;sort=relevance&amp;page=1&amp;ts_query_web=crossplane</a></p></li><li><p>Kubenetes 1.29 版本: <a href="https://artifacthub.io/packages/kcl/kcl-module/k8s/1.29.0" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/k8s/1.29.0</a></p></li><li><p>新增 Podinfo 应用配置模型，支持设置外部动态参数如 replicas 等，可以直接通过一条命令渲染 Kubernetes 资源配置，并且可以在此模型的基础上修改并自定义资源模版</p></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run oci://ghcr.io/kcl-lang/podinfo -D </span><span class="token assign-left variable" style="color:#36acaa">replicas</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>JSON Schema 库发布 0.0.4 版本，修复类型定义错误, 可以执行如下命令更新或添加依赖</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> jsonschema:0.0.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他更新">其他更新<a href="#其他更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>完整更新和错误修复列表详见: <a href="https://github.com/kcl-lang/kcl/compare/v0.7.0...v0.8.0" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/compare/v0.7.0...v0.8.0</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档更新">文档更新<a href="#文档更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 网站新增 KCL v0.7.0 文档内容并支持版本化语义选项，目前支持 v0.4.x, v0.5.x, v0.6.x, v0.7.0 和 v0.8.0 版本选择，同时欢迎社区同学进行文档共建。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-lfx-项目启动">KCL LFX 项目启动<a href="#kcl-lfx-项目启动" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>恭喜 @AkashKumar7902, @octonawish-akcodes, @shashank-iitbhu 入选 CNCF KCL LFX 项目，同时感谢 @Vanshikav123, @Amit Pandey 的积极参与。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-登陆-crossplane-官方函数市场">KCL 登陆 Crossplane 官方函数市场<a href="#kcl-登陆-crossplane-官方函数市场" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>自 Crossplane v1.14 中的组合函数 Beta 版发布以来，使用 Crossplane 构建云原生平台的可能体验范围一直在迅速扩大。KCL 团队在第一时间进行跟进并主动构建了一个可重用的函数，整个 Crossplane 生态系统现在可以利用 KCL 提供的高水平经验和能力来构建自己的云原生平台。</p><p>更多内容详见: <a href="https://blog.crossplane.io/function-kcl/" target="_blank" rel="noopener noreferrer">https://blog.crossplane.io/function-kcl/</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>感谢社区的小伙伴在 KCL v0.8.0 版本中的贡献，以下排名不分先后</p><ul><li>感谢 @jakezhu9 同学对 kcl import 工具的持续贡献 🤝</li><li>感谢 @octonawish-akcodes 对 KCL 代码清理和 FAQ 文档的持续贡献 🙌</li><li>感谢 @satyazzz123 对 KRM KCL 支持读取环境变量功能的贡献 🙌</li><li>感谢 @AkashKumar7902 对 KCL 包管理工具功能的贡献 🙌</li><li>感谢 @UtkarshUmre 对 KCL linux-arm64 构建 CI 的贡献 🙌</li><li>感谢 @octonawish-akcodes 和 @d4v1d03 对 KCL FAQ 文档和 KCL IDE 功能的持续贡献 🙌</li><li>感谢 @octonawish-akcodes 对 Ansible KCL Module 的贡献</li><li>感谢 @AkashKumar7902 和 @Vanshikav123 对 KCL 包管理工具功能的贡献 🙌</li><li>感谢 @StevenLeiZhang 对 KCL 文档和 KCL 插件的贡献 🙌</li><li>感谢 @patrycju, @Callum Lyall, @Matt Gowie, @ShiroDN, @FLAGLORD, @YiuTerran, @flyinox, @steeling, @Anoop, @Even Solberg，@Phillip Neumann，@Naxe, @rozaliev, @CloudZero357, @martingreber, @az, @Art3mK, @Erick, @TheChinBot, @Evgeny Shepelyuk, @yonas, @vtomilov, @Fdall, @bozaro, @starkers, 和 @MrGuoRanDuo 等在 KCL v0.8 版本迭代过程中使用 KCL 提供的宝贵建议与反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户和社区小伙伴在此次版本更新过程中提出的宝贵反馈与建议。预计 2024 年 5 月，我们将发布 KCL v0.9.0 版本，更多详情请参考 KCL 2024 路线规划 和 KCL v0.9.0 Milestone，如果您有更多的想法和需求，欢迎在 KCL Github 仓库发起 Issues 或讨论，也欢迎加入我们的社区进行交流 🙌 🙌 🙌</p><p>更多其他资源请参考：</p><ul><li><p>KCL 网站: <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/</a></p></li><li><p>KusionStack 网站: <a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">https://kusionstack.io/</a></p></li><li><p>KCL GitHub 仓库: <a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang</a></p></li><li><p>KusionStack GitHub 仓库: <a href="https://github.com/KusionStack" target="_blank" rel="noopener noreferrer">https://github.com/KusionStack</a></p></li><li><p>KCL v0.9.0 Milestone: <a href="https://github.com/kcl-lang/kcl/milestone/9" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/milestone/9</a></p></li><li><p>KCL 2024 路线规划: <a href="https://github.com/kcl-lang/kcl/issues/882" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/882</a></p></li><li><p>KCL 社区: <a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p></li></ul>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[官宣！知名 IaC 工具 Crossplane 宣布 KCL 登陆其官方函数市场！]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-03-04-crossplane-marketplace-kcl</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-03-04-crossplane-marketplace-kcl</guid>
            <pubDate>Mon, 04 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[内容转载整理自 Crossplane 官网博客原文：https://blog.crossplane.io/function-kcl]]></description>
            <content:encoded><![CDATA[<blockquote><p><em>内容转载整理自 Crossplane 官网博客原文：<a href="https://blog.crossplane.io/function-kcl" target="_blank" rel="noopener noreferrer">https://blog.crossplane.io/function-kcl</a></em></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容简介">内容简介<a href="#内容简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p><strong>自 Crossplane v1.14 中的组合函数 Beta 版发布以来</strong>，使用 Crossplane 构建云原生平台的可能体验范围一直在迅速扩大。KCL 团队在第一时间进行跟进并主动构建了一个可重用的函数，<strong>整个 Crossplane 生态系统现在可以利用 KCL 提供的高水平经验和能力来构建自己的云原生平台</strong>。</p><p>同时 Crossplane 宣布 KCL 函数成为<strong>第一个发布到 Upbound 市场的第三方函数组件</strong>，地址为&nbsp;<em><a href="https://marketplace.upbound.io/providers/crossplane-contrib/function-kcl" target="_blank" rel="noopener noreferrer">https://marketplace.upbound.io/providers/crossplane-contrib/function-kcl</a></em> 。源代码可以在&nbsp;<em><a href="https://github.com/crossplane-contrib/function-kcl" target="_blank" rel="noopener noreferrer">https://github.com/crossplane-contrib/function-kcl</a></em>&nbsp;找到，欢迎贡献和反馈。</p><p>您可以通过使用以下一行命令安装 function-kcl 并开始在整个 Crossplane 控制平面中使用：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crossplane&nbsp;xpkg&nbsp;</span><span class="token function" style="color:#d73a49">install</span><span class="token plain">&nbsp;</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain">&nbsp;xpkg.upbound.io/crossplane-contrib/function-kcl:v0.2.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Crossplane 团队和社区感谢 KCL 团队的这笔巨大捐赠，以及对不断发展的 Functions for Crossplane 生态系统的巨大补充</strong>！</p><p><img loading="lazy" alt="crossplane-announcing" src="/zh-CN/assets/images/crossplane-announcing-c179962aa966b848c6fa8edb319cbd19.png" width="982" height="312" class="img_ev3q"></p><p>Crossplane 及其组合模型允许开发人员创建更高级别的抽象，这些抽象可以封装和组合跨不同提供商和服务的多种类型的云资源。使用组合函数来渲染这些抽象可以有效增强各种提供者资源的模板功能，同时减少所需的 YAML 代码量。</p><p>将 KCL 与 Crossplane 组合函数结合起来有几个好处：</p><ul><li><strong>简化复杂配置</strong>：KCL 提供了比一般 DSL 更简洁的语法和结构，降低了配置的复杂性。与 Crossplane 的复合资源结合时，您可以创建更直观且易于理解的具有循环和条件功能的配置模板对接到不同的云平台，从而简化资源的定义和维护，而不是编写重复的 YAML 模版。</li><li><strong>可重用性和模块化</strong>：KCL 通过 OCI Registry 支持模块化和代码重用，这意味着您可以创建可重用的配置组件。与 Crossplane 结合，可以促进复合资源的模块化，提高配置的重用性，并减少错误。</li><li><strong>自动化和策略支持</strong>：您可以使用 KCL 的强大功能来编写策略和约束，这些策略和约束与 Crossplane 的声明性资源管理相结合，且可以自动实施，从而确保云环境中的合规性，进一步提升效率和稳定性。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="快速开始">快速开始<a href="#快速开始" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>有两种将 KCL 和 Crossplane 结合使用的方式</p><ul><li>一种是使用 KCL 编写 Crossplane 组合函数并安装到集群使用，仍然采用 YAML 来定义 App Team 所需的 Schema 和输入，使用 KCL&nbsp;撰写渲染逻辑到 Crossplane Managed Resource 的逻辑以对接不同的云平台或者 Kubernetes 集群。<strong>需要注意的是：这种方式既可以将 KCL 函数安装到集群中使用，也可以使用 crossplane beta render 命令直接在客户端完成&nbsp;Managed Resource 的渲染。</strong></li></ul><p><img loading="lazy" alt="crossplane-kcl-func" src="/zh-CN/assets/images/crossplane-kcl-func-a14565483cfe0ca637e854df10f69dec.png" width="1548" height="1116" class="img_ev3q"></p><ul><li>另外一种是使用 KCL 完全在客户端提供面向应用开发者的抽象并生成 Crossplane 托管资源下发到集群，提供 Kubernetes 的统一可编程接入层，具体使用 KCL Schema 规定&nbsp;App Team 所需的&nbsp;Schema&nbsp;输入，并撰写渲染到 Crossplane Managed Resource 的逻辑以对接不同的云平台或者 Kubernetes 集群</li></ul><p><img loading="lazy" alt="kcl-on-crossplane" src="/zh-CN/assets/images/kcl-on-crossplane-61f5204ee8b003e99a5f1246c8d72bd5.png" width="1546" height="1116" class="img_ev3q"></p><p><strong>两种方法的具体操作方式可以查看 Crossplane 官方博客内容：<em><a href="https://blog.crossplane.io/function-kcl" target="_blank" rel="noopener noreferrer">https://blog.crossplane.io/function-kcl</a></em></strong></p><p><img loading="lazy" alt="crossplane-kcl-blog" src="/zh-CN/assets/images/crossplane-kcl-blog-c153cc8069d7edf95509a93112e87926.png" width="1158" height="1038" class="img_ev3q"></p><p>此外，这两种方式都需要 Registry 来协助完成工作。它们之间的最终选择可能取决于您的操作习惯和环境成本。无论选择哪种方法，<strong>我们都建议在 Git 中维护 KCL 代码，以便更好地实施 GitOps 并获得更好的 IDE 体验和可重用模块</strong>，例如使用 Crossplane AWS Module:&nbsp;<em><a href="https://github.com/kcl-lang/modules/tree/main/crossplane-provider-aws" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/modules/tree/main/crossplane-provider-aws</a></em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>现在 function-kcl 项目已捐赠给 Crossplane 社区，我们鼓励整个社区对其进行测试，并尝试使用 KCL（Crossplane Functions 提供的最新高级语言体验）构建云原生控制平面。我们非常欢迎社区在GitHub 上的存储库中提供贡献和反馈。让我们知道您的想法！<em><a href="https://github.com/crossplane-contrib/function-kcl" target="_blank" rel="noopener noreferrer">https://github.com/crossplane-contrib/function-kcl</a></em></p><p>更多其他资源请参考：</p><ul><li><em>KCL 网站:&nbsp;<a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/</a></em></li><li><em>KusionStack 网站:&nbsp;<a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">https://kusionstack.io/</a></em></li><li><em>KCL v0.9.0 Milestone:&nbsp;<a href="https://github.com/kcl-lang/kcl/milestone/9" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/milestone/9</a></em></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Crossplane</category>
        </item>
        <item>
            <title><![CDATA[KCL 最新动态速递 (2024.02.02 - 2024.02.22)]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-02-22-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-02-22-newsletter</guid>
            <pubDate>Thu, 22 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去一段时间 (2024.02.02 - 2024.02.22) 的杰出工作，以下是重点内容概述</p><p><strong>📦 模型更新</strong></p><ul><li>JSON Schema 库发布 0.0.4 版本，修复类型定义错误, 可以执行如下命令更新或添加依赖</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> jsonschema:0.0.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>🏄 语言更新</strong></p><p><strong>KCL 发布 0.8.0 预览版本</strong>，主要包含如下更新</p><ul><li>新增 file 系统库用于读取 KCL 模块信息和系统文件，包含 <code>read</code>, <code>glob</code>, <code>workdir</code> 和 <code>modpath</code> 函数，详见 Issue: <a href="https://github.com/kcl-lang/kcl/issues/1049" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/1049</a></li><li>优化非预期 token 的语法错误提示</li><li>去除 Schema 对象内部非预期的内置类型属性通过 print 输出</li><li>修复非预期的字典生成表达式中的 key 与循环变量相同时的变量计算</li><li>修复 schema 内部诸如 "$if" 的字符串标识符定义找不到的错误</li></ul><p><strong>🔧 工具链更新</strong></p><ul><li>kcl run 支持使用 <code>-H</code> 参数输出以 <code>_</code> 开头的隐藏字段</li><li>kcl run 支持直接运行远端 Git 仓库代码</li><li>kcl mod 新增 kcl mod graph 子命令输出模块依赖图</li><li>kcl fmt 修复 else 块中存在 if 语句时的格式化错误</li></ul><p><strong>💻 IDE 更新</strong></p><ul><li>优化了内置函数和系统库的补全以及悬停文档提升</li><li>修复了配置块内部 if 语句符号不能跳转和补全的问题</li><li>增加变量引用错误时的快速修复功能</li></ul><p><strong>🎁 API 更新</strong></p><ul><li>OverrideFile API 新增诸如 <code>a["b"].c</code> 的 path 对配置进行查询和修改</li></ul><p><strong>🚀 插件系统更新</strong></p><p>除了使用 Python 为 KCL 插件函数，现在支持使用 Go 为 KCL 编写插件函数，使用方式非常简单。</p><ul><li>定义插件 (以一个包含 add 函数的 hello 插件作为示例)</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> hello_plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"kcl-lang.io/kcl-go/pkg/plugin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RegisterPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Plugin</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hello"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MethodMap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MethodSpec</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"add"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MethodArgs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MethodResult</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    v </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IntArg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IntArg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MethodResult</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">V</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>使用插件</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"kcl-lang.io/kcl-go/pkg/kcl"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"kcl-lang.io/kcl-go/pkg/native"</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Import the native API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl-lang.io/kcl-go/pkg/plugin/hello_plugin"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Import the hello plugin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Note we use `native.MustRun` here instead of `kcl.MustRun`, because it needs the cgo feature.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yaml </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> native</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MustRun</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"main.k"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetRawYamlResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">yaml</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">import kcl_plugin.hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name = "kcl"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">three = hello.add(1,2) # 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>🚢 集成更新</strong></p><ul><li>发布 Ansible KCL 模块初始版本，支持基本的运行 KCL 代码功能，其他功能完善中</li><li>KCL FluxCD Controller 优化 Git Source 功能，OCI Source 功能支持中</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @octonawish-akcodes 和 @d4v1d03
对 KCL FAQ 文档和 KCL IDE 功能的持续贡献 🙌</li><li>感谢 @octonawish-akcodes 对 Ansible KCL Module 的贡献</li><li>感谢 @AkashKumar7902 和 @Vanshikav123 对 KCL 包管理工具功能的贡献 🙌</li><li>感谢 @StevenLeiZhang 对 KCL 文档和 KCL 插件的贡献</li><li>感谢 @TheChinBot, @Evgeny Shepelyuk, @yonas, @steeling, @vtomilov, @Fdall, @CloudZero357, @bozaro, @starkers, @MrGuoRanDuo 和 @FLAGLORD 等在近段时间使用 KCL 过程中提供的宝贵建议与反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>预计 2024 年 2 月底会发布 0.8 正式版本，感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会发布更多 KCL 技术和案例文章，敬请期待! 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">KCL v0.8.0 Milestone</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/9" target="_blank" rel="noopener noreferrer">KCL v0.9.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Newsletter</category>
        </item>
        <item>
            <title><![CDATA[2024 LFX Mentorship 实习开启：KCL 开源社区欢迎你的参与 ！！！]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-02-05-lfs-guide</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-02-05-lfs-guide</guid>
            <pubDate>Mon, 05 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><ul><li><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></li><li><strong><em>KCL Github 仓库：<a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang</a></em></strong></li></ul><p>对云原生、平台工程、语言编译器、语言包管理工具和语言 IDE 感兴趣的小伙伴，我们邀请你申请 KCL 的 2024 春季 Linux 基金会 LFX Mentorship 项目，完成项目有最低 3000 美金的奖励哦！快来申请吧！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lfx-mentorship-项目">LFX Mentorship 项目<a href="#lfx-mentorship-项目" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>我们有三个 Mentorship 项目，内容涵盖包管理工具，语言编译器和语言 IDE 三个方面。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-为-kcl-包管理工具添加版本管理支持">1. 为 KCL 包管理工具添加版本管理支持<a href="#1-为-kcl-包管理工具添加版本管理支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 目前的包管理工具（kpm）目前支持上传，下载等分发 KCL 包的功能，不支持 KCL 包的版本管理。在使用 kpm 为 KCL 添加三方库依赖的过程中，kpm 会根据依赖关系自动下载全部的三方库依赖，如果在下载的过程中出现相同包的不同版本，应该根据包版本管理策略提供对应的选择策略，选择合适的版本下载。</p><p>在此项目中，你需要为 kpm 增加包版本管理部分的功能，使 kpm 在管理三方库的过程中能够根据依赖情况，选择合适的三方库进行下载，确保编译过程的正常进行。</p><ul><li>查看详情：<a href="https://github.com/kcl-lang/kpm/issues/246" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/issues/246</a></li><li>Pretest：<a href="https://github.com/kcl-lang/kpm/issues/263" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/issues/263</a></li><li>申请链接：<a href="https://mentorship.lfx.linuxfoundation.org/project/06b5baee-bdcd-4f5e-9a1a-454191445a01" target="_blank" rel="noopener noreferrer">https://mentorship.lfx.linuxfoundation.org/project/06b5baee-bdcd-4f5e-9a1a-454191445a01</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-kcl-ide-的快速修复">2. KCL IDE 的快速修复<a href="#2-kcl-ide-的快速修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>为 KCL IDE 开发快速修复功能，当 KCL 程序在 IDE 中出现编译错误时，Quick Fix 功能能够根据用户的错误类型，在 KCL 程序错误的位置提供快速的问题修复。</p><p>在此项目中，你需要根据 KCL 程序的错误类型，为用户 IDE 开发不同的 Quick Fix 功能，降低用户开发门槛。</p><ul><li>查看详情：<a href="https://github.com/kcl-lang/kcl/issues/997" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/997</a></li><li>Pretest：<a href="https://github.com/kcl-lang/kcl/issues/1020" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/1020</a></li><li>申请链接：<a href="https://mentorship.lfx.linuxfoundation.org/project/391edda7-239d-4471-a36a-c03c24e024cb" target="_blank" rel="noopener noreferrer">https://mentorship.lfx.linuxfoundation.org/project/391edda7-239d-4471-a36a-c03c24e024cb</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-kcl-ide-自动加载-kcl-三方库">3. KCL IDE 自动加载 KCL 三方库。<a href="#3-kcl-ide-自动加载-kcl-三方库" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL IDE 作为 KCL 用户最直接的开发界面，要想提供良好的用户体验，除了提供语言的高亮，跳转，补全等基本功能外，还需要保证编译过程的稳定。但是目前 KCL 的 IDE 经常会因为三方库找不到而导致编译错误，目前 KCL 的包管理工具 kpm 已经提供了自动下载和更新三方库的能力，但是仍然需要用户通过命令行的方式更新三方库，这使得用户的开发体验受到影响，因此 KCL IDE 需要与 KCL 的包管理工具 kpm 进行集成，通过 kpm 为 IDE 提供三方库的自动下载更新的能力。</p><p>在此项目中，你需要借助 kpm 的能力，实现 IDE 中常见的如：加载 KCL 包自动下载三方库，kcl.mod 变更时自动更新三方库和 Quick Fix 触发三方库自动下载等功能，保证 KCL IDE 在包管理工具的支持下能够提供更加完整流畅的开发体验。</p><ul><li>查看详情：<a href="https://github.com/kcl-lang/kcl/issues/998" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/998</a></li><li>Pretest：<a href="https://github.com/kcl-lang/kcl/issues/1031" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/1031</a></li><li>申请链接：<a href="https://mentorship.lfx.linuxfoundation.org/project/59d5fb6c-153d-4e46-9d1f-2948641b0471" target="_blank" rel="noopener noreferrer">https://mentorship.lfx.linuxfoundation.org/project/59d5fb6c-153d-4e46-9d1f-2948641b0471</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-如何申请">4. 如何申请<a href="#4-如何申请" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 LFX mentorship 平台上申请你钟意的项目，你可以通过以下链接访问 LFX mentorship 平台。申请从2024年1月29日开始，到2月13日结束。</p><ul><li><a href="https://mentorship.lfx.linuxfoundation.org/" target="_blank" rel="noopener noreferrer">https://mentorship.lfx.linuxfoundation.org/</a></li></ul><p>有任何的问题，欢迎直接到对应的 issue 中获取更多内容或者与我们讨论：</p><ul><li><p>KCL 包版本管理 <a href="https://github.com/kcl-lang/kpm/issues/246" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/issues/246</a></p></li><li><p>KCL 快速修复 <a href="https://github.com/kcl-lang/kcl/issues/997" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/997</a></p></li><li><p>KCL IDE 依赖更新 <a href="https://github.com/kcl-lang/kcl/issues/998" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/998</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-项目时间节点">5. 项目时间节点<a href="#5-项目时间节点" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><table><thead><tr><th>事件</th><th>开始日期</th><th>结束日期</th></tr></thead><tbody><tr><td>学员申请开放</td><td>January 29</td><td>February 13, 5:00 PM PDT</td></tr><tr><td>申请审查/录取决定/人力资源文书工作</td><td>February 13</td><td>February 27, 5:00 PM PDT</td></tr><tr><td>导师计划开始并分配初始工作</td><td>March 4 (Week 1)</td><td></td></tr><tr><td>中期学员评估 / 第一笔津贴支付</td><td>April 10 (Week 6)</td><td></td></tr><tr><td>最终学员评估到期 / 学员反馈提交到期 / 批准第二笔和最后一笔津贴支付</td><td>May 22, 5:00 PM PST (Week 12)</td><td></td></tr><tr><td>学期最后一天</td><td>May 31</td><td></td></tr></tbody></table>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2024.01.19 - 2024.02.21) | KCL v0.7.5 版本和 Flux KCL 集成更新速递]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-02-01-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-02-01-biweekly-newsletter</guid>
            <pubDate>Thu, 01 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2024.01.19 - 2024.02.01) 的杰出工作，以下是重点内容概述</p><p><strong>📦 模型更新</strong></p><ul><li>新增 Podinfo 应用配置模型，支持设置外部动态参数如 <code>replicas</code> 等，可以直接通过一条命令渲染 Kubernetes 资源配置，并且可以在此模型的基础上修改并自定义资源模版</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run oci://ghcr.io/kcl-lang/podinfo -D </span><span class="token assign-left variable" style="color:#36acaa">replicas</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>🏄 语言更新</strong></p><ul><li>改善编译时对象属性找不到的报错信息</li><li>修复 Schema 对象必选属性递归检查错误</li><li>提升 Schema 索引签名类型检查健壮性</li></ul><p><strong>🔧 工具链更新</strong></p><ul><li><p><strong>文档工具更新</strong></p><ul><li>支持在生成的 Markdown 格式文档对多行字符使用 HTML 转义</li></ul></li><li><p><strong>CodeQL KCL 工具</strong></p><ul><li>初步支持 CodeQL KCL dbschema 定义以及对 KCL 语法语义进行数据提取，并可通过 CodeQL 进行数据查询对 KCL 代码进行静态分析和扫描，提升代码安全</li></ul></li></ul><p><strong>💻 IDE 更新</strong></p><ul><li><strong>语义高亮</strong><ul><li>KCL IDE 优化了语义高亮。</li></ul></li><li><strong>错误修复</strong><ul><li>修复了字符串后跟注释中补全错误的问题</li><li>修复了 Schema 内部属性符号不能跳转的问题</li></ul></li></ul><p><strong>🎁 API 更新</strong></p><ul><li>新增语法和语义分析 API 用于对 KCL 代码进行分析</li><li>新增构建二进制产物 API 用于缓存编译结果</li><li>新增运行二进制产物 API 用于直接运行编译结果，避免重复编译并提升性能</li><li>新增代码生成 API 以编程方式实现 KCL 代码生成而不是编写复杂的模版</li></ul><p><strong>🚀 SDK 更新</strong></p><ul><li>KCL Go SDK 更新至 0.7.5 版本</li><li>KCL Python SDK 更新至 0.7.5 版本</li><li>KCL Rust SDK 更新至 0.7.5 版本</li><li>KCL Java SDK 新增语法树、作用域、符号等语法语义结构定义及相关查询 API</li></ul><p>更多内容详见: <a href="https://github.com/kcl-lang/lib" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/lib</a></p><p><strong>🚢 集成更新</strong></p><ul><li>除了使用 ArgoCD KCL 插件，KCL 现在支持使用 KCL Flux Controller 对存储在 Git 仓库的 KCL 配置进行 GitOps，详见 <a href="https://github.com/kcl-lang/flux-kcl-controller" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/flux-kcl-controller</a>，欢迎共建 👏</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @octonawish-akcodes 对 KCL 代码清理和 FAQ 文档的持续贡献 🙌</li><li>感谢 @satyazzz123 对 KRM KCL 支持读取环境变量功能的贡献 🙌</li><li>感谢 @AkashKumar7902 对 KCL 包管理工具功能的贡献 🙌</li><li>感谢 @UtkarshUmre 对 KCL linux-arm64 构建 CI 的贡献 🙌</li><li>感谢 @steeling, @rozaliev, @CloudZero357, @martingreber, @az, @Art3mK,@AdmiralNemo 和 @Erick 等在近两周使用 KCL 过程中提供的宝贵建议与反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flux-kcl-集成">Flux KCL 集成<a href="#flux-kcl-集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>将 KCL 与 Flux 等 GitOps 工具一起使用具有如下好处:</p><ul><li>通过 KCL 语言的抽象能力和可编程能力可以帮助我们<strong>简化复杂的 Kubernetes 部署配置文件</strong>，降低手动编写 YAML 文件的错误率，将配置约束检查控制在编译时，编写即感知错误；同时可以消除多余的配置模版，提升多环境多租户的配置扩展能力，提高配置的可读性和可维护性。</li><li>KCL 允许开发人员以声明式的方式定义应用程序所需的资源，通过将 KCL 和 Flux 相结合可以帮助我们更好地实现<strong>基础设施即代码（IaC）</strong>，提高部署效率，简化应用程序的配置管理。</li><li>使用 Flux，开发人员和运维团队可以通过分别修改应用和配置代码来管理应用程序的部署，Flux Controller 将自动同步对配置的更改，从而实现持续部署并确保一致性。如果出现问题，可以实现快速回滚。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="工作流程">工作流程<a href="#工作流程" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在此示例中，我们使用一个 Python Flask 应用和 Github Actions 作为 CI 示例，使用部署在集群中 Flux KCL Controller 作为 CD 示例，使用 KCL 定义需要部署的 Kubernetes 资源</p><blockquote><p>注意：你可以在此方案中使用任何容器化应用以及不同的 CI 和 CD 系统如 Gitlab CI，Jenkins CI，ArgoCD 等</p></blockquote><p>我们将 Python Flask 应用代码和配置代码分成两个仓库，<em>以实现不同角色如开发人员和运维团队的关注点分离</em></p><ul><li>业务代码仓库: <a href="https://github.com/kcl-lang/flask-demo" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/flask-demo</a></li><li>配置清单仓库: <a href="https://github.com/kcl-lang/flask-demo-kcl-manifests" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/flask-demo-kcl-manifests</a></li></ul><p>整体工作流程如下：</p><ol><li>从 Github 拉取应用代码</li><li>应用代码开发并提交到提交到 GitHub 存储库</li><li>触发 GitHub Actions 对应用代码进行编译，生成容器镜像，并将容器镜像推送到 Docker Hub 容器注册表</li><li>触发 GitHub Actions 根据 docker.io 容器注册表中容器镜像的版本号并同步更新 KCL 定义的 Kubernetes 清单部署文件</li><li>Flux KCL Controller 获取 KCL 定义的 Kubernetes 清单更改并更新部署至 Kubernetes 集群</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="具体步骤">具体步骤<a href="#具体步骤" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1-配置-kubernetes">1. 配置 Kubernetes<a href="#1-配置-kubernetes" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><ul><li>安装 <a href="https://github.com/k3d-io/k3d" target="_blank" rel="noopener noreferrer">K3d</a> 并创建一个集群</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">k3d cluster create</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：你可以在此方案中使用其他方式创建您自己的 Kubernetes 集群，如 kind, minikube 等。</p></blockquote><ul><li>安装 Kubectl</li><li>安装 Kustomize</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2-安装-flux-kcl-controller">2. 安装 Flux KCL Controller<a href="#2-安装-flux-kcl-controller" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><p><img loading="lazy" alt="flux-kcl-workflow" src="/zh-CN/assets/images/flux-kcl-workflow-2034d3f8dd5679d0a74f94d8067e8110.png" width="1498" height="454" class="img_ev3q"></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/flux-kcl-controller.git </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> flux-kcl-controller </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3-配置需要持续交付的-git-仓库">3. 配置需要持续交付的 Git 仓库<a href="#3-配置需要持续交付的-git-仓库" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><p>通过 <code>gitrepo.yaml</code> 文件，定义 <code>GitRepository</code> 和 <code>KCLRun</code> 对象，用来配置监控需要持续交付的 Git 仓库以及运行 KCL 配置所需的额外参数</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> source.toolkit.fluxcd.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GitRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s </span><span class="token comment" style="color:#999988;font-style:italic"># 每隔 10s 检查一次仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//github.com/kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lang/flask</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">manifests.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main </span><span class="token comment" style="color:#999988;font-style:italic"># 监控 main 分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> krm.kcl.dev.fluxcd/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">git</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sourceRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GitRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用命令 <code>kubectl apply -f gitrepo.yaml</code> 将该对象部署到集群中。</p><blockquote><p>如果您使用的是私有存储库，需要使用私钥凭据配置专用私有存储库访问权限。请参阅<a href="https://fluxcd.io/flux/components/source/gitrepositories/" target="_blank" rel="noopener noreferrer">这里</a>以获取更多详细信息。</p></blockquote><blockquote><p>注意：你也可以在此方案中使用 <a href="https://fluxcd.io/flux/components/source/ocirepositories/" target="_blank" rel="noopener noreferrer">OCIRepository</a>，对文章开头提到的 <code>oci://ghcr.io/kcl-lang/podinfo</code> 配置包进行持续交付，比如下面的配置</p></blockquote><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> source.toolkit.fluxcd.io/v1beta2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OCIRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> podinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 5m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> oci</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//ghcr.io/kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lang/podinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> krm.kcl.dev.fluxcd/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">git</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sourceRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OCIRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> podinfo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="4-提交业务代码">4. 提交业务代码<a href="#4-提交业务代码" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><ul><li>获取代码</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/flask-demo.git/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flask-demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>flask-demo 仓库提交代码后，Github 会自动构建容器镜像，并将制品推送到 Docker hub 中，会再触发 flask-demo-kcl-manifests 仓库的 Action，<a href="/zh-CN/docs/user_docs/guides/automation">通过 KCL 自动化 API</a> 修改部署清单仓库中的镜像地址。现在让我们为 flask-demo 仓库创建一个提交，我们可以看到代码提交后触发业务仓库 Github CI 流程</p><p><img loading="lazy" src="/zh-CN/assets/images/app-ci-8be610b01c177f72ff2f2f617b7305bd.png" width="2252" height="1038" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="5-配置自动更新">5. 配置自动更新<a href="#5-配置自动更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><p>当业务仓库 Github CI 流程执行完成后，会自动在存放 KCL 资源配置的仓库触发一个 CI 自动更新配置并提交到 flask-demo-kcl-manifests main 分支，commit 信息如下</p><p><img loading="lazy" src="/zh-CN/assets/images/image-auto-update-514f27b74172b114a5dc877e98fd88f4.png" width="2240" height="1090" class="img_ev3q"></p><ul><li>我们可以获得部署清单源码进行编译验证</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/flask-demo-kcl-manifests.git/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flask-demo-kcl-manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout main </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> pull </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kcl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出 YAML 为</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcllang/flask_demo:6428cff4309afc8c1c40ad180bb9cfd82546be3e"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从上述配置可以看出资源的镜像确实自动更新为了新构建的镜像内容。同时 Flux KCL Controller 会自动拉取配置并更新到集群，这样就实现了业务代码提交并部署 Kubernetes 的 e2e 完整自动化流程，每次只需提交业务代码即可，当然可以进一步搭配 Flagger 实现多种部署策略如金丝雀发布、蓝绿发布等。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会发布更多 KCL 云原生模型和工具集成文章，敬请期待! 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">KCL v0.8.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2024.01.04 - 2024.01.18) | KCL v0.7.4 版本发布！]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-01-18-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-01-18-biweekly-newsletter</guid>
            <pubDate>Thu, 18 Jan 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2024.01.04 - 2024.01.18) 的杰出工作，以下是重点内容概述</p><p><strong>🌞 KCL 更新</strong></p><ul><li>v0.7.4 发布，新增 Linux arm64 平台支持。</li></ul><p><strong>🎁 API 更新</strong></p><ul><li>KCL 新增语法和语义分析 API。</li></ul><p><strong>🔧 工具链更新</strong></p><ul><li><p><strong>kcl-go sdk 更新</strong></p><ul><li>KCL Doc 工具支持输出为 OpenAPI 格式。</li><li>增加 Parse 过程相关 API。</li></ul></li><li><p><strong>Import 工具更新</strong></p><ul><li>优化了 import 工具生成 KCL 配置用户体验，增加了对关键字 oneOf, allOf 的支持。</li></ul></li><li><p><strong>KCL 包管理工具</strong></p><ul><li>发布了 v0.6.0 版本，支持通过 git commit 添加三方库依赖。</li></ul></li></ul><p><strong>💻 IDE 更新</strong></p><ul><li><strong>语义高亮</strong><ul><li>KCL IDE 优化了语义高亮。</li></ul></li><li><strong>补全功能增强</strong><ul><li>修复了嵌套 schema 定义中补全错误的问题</li><li>修复了部分悬停信息缺失的问题</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @jakezhu9 同学对 kcl import 工具的持续贡献 🤝</li><li>感谢 @AdmiralNemo，@Phillip Neumann，@Naxe，@steeling 等在使用 KCL 过程中提供的宝贵建议与反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-ide-语义级别的高亮增强">KCL IDE 语义级别的高亮增强<a href="#kcl-ide-语义级别的高亮增强" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL IDE 高亮之前仅支持 KCL 语法高亮，如下图所示：</p><p><img loading="lazy" src="/zh-CN/assets/images/old-ide-835ff47b36b5e23f304f8092c3afd989.png" width="435" height="151" class="img_ev3q"></p><p>我们今年逐步启用了新的 KCL 语义架构模型，在新语义架构的支撑下，KCL IDE 支持语义级别的高亮，在语义上有关联的代码会显示相同的高亮。</p><p><img loading="lazy" src="/zh-CN/assets/images/new-ide-a62fcf4ef6b9d078f77a7e15af161e17.png" width="287" height="145" class="img_ev3q"></p><p>更多关于 KCL 语义架构模型的内容，参考：
<a href="https://kcl-lang.io/zh-CN/blog/2023-12-09-kcl-new-semantic-model" target="_blank" rel="noopener noreferrer">KCL 高效语义模型技术揭秘：实现快速编译与增强 IDE 支持</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理支持通过-commit-添加-git-依赖">KCL 包管理支持通过 commit 添加 git 依赖<a href="#kcl-包管理支持通过-commit-添加-git-依赖" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 包管理工具增加了通过 commit 来添加 git 三方库依赖的功能。以 <a href="https://github.com/KusionStack/catalog" target="_blank" rel="noopener noreferrer">https://github.com/KusionStack/catalog</a> 为例，添加 commit 为 a29e3db 的版本作为依赖。可以通过编辑 kcl.mod 文件中的依赖或者命令行直接添加。</p><p>编辑 kcl.mod 文件内容如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalog = { git = "https://github.com/KusionStack/catalog.git", commit = "a29e3db" }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者通过命令行添加：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod add --git https://github.com/KusionStack/catalog.git --commit a29e3db</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-import-工具增强">KCL Import 工具增强<a href="#kcl-import-工具增强" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>支持 oneOf 关键字的生成，以 oneOf 关键字为例，将以下内容保存在文件 oneof.json 中。</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://json-schema.org/draft-07/schema#"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"$id"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://example.com/schemas/book.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"properties"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"title"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"author"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"$comment"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"oneOf for types"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"oneOf"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"array"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"items"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"integer"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"category"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"$comment"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"oneOf for objects"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"oneOf"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"properties"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"properties"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"title"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 import 命令生成对应的 KCL 文件。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl import oneof.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到生成的 oneof.k 文件内容如下。</p><div class="language-kcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This file was generated by the KCL auto-gen tool. DO NOT EDIT.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Editing this file might prove futile when you re-run the KCL auto-gen generate command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Book:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Book</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title : str, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author : str | [str] | int, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    category : BookCategoryOneOf0 | BookCategoryOneOf1, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title?: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author?: str | [str] | int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    category?: BookCategoryOneOf0 | BookCategoryOneOf1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema BookCategoryOneOf0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BookCategoryOneOf0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name : str, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name?: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema BookCategoryOneOf1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BookCategoryOneOf1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title : str, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title?: str</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会发布更多 KCL 云原生模型和工具集成文章，敬请期待! 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">KCL v0.8.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 12.22 - 2024.01.04) | Crossplane KCL 集成简化云资源配置与抽象]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2024-01-04-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2024-01-04-biweekly-newsletter</guid>
            <pubDate>Thu, 04 Jan 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 12.22 - 2024.01.04) 的杰出工作，以下是重点内容概述</p><p><strong>🔧 工具链更新</strong></p><ul><li><strong>包管理工具更新</strong><ul><li>支持带 <code>-</code> 符号的外部包自动转义为 KCL 可以识别的 <code>_</code> 符号如 <code>set-annotation</code> -&gt; <code>set_annotation</code></li><li>修复 <code>kcl mod add</code> 在 Registry 包版本和本地已有包版本不同时引起的空指针错误</li></ul></li></ul><p><strong>💻 IDE 更新</strong></p><ul><li><strong>语义高亮</strong><ul><li>KCL IDE 目前支持语义级别的高亮，避免不同 IDE 插件高亮差异</li></ul></li><li><strong>补全功能增强</strong><ul><li>区分 Schema 类型和实例补全符号</li><li>统一 Schema 注释文档补全的格式</li><li>修复不同语法补全符号类型不统一的问题</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @FLAGLORD, @YiuTerran, @flyinox, @steeling, @Anoop, @Phillip Neumann 和 @Even Solberg 在使用 KCL 过程中的交流与宝贵反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-kcl-编写-crossplane-函数">使用 KCL 编写 Crossplane 函数<a href="#使用-kcl-编写-crossplane-函数" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Crossplane 及其 Composite Function 功能被用于解耦 XR（CompositeResource）和复合资源定义。XR 允许开发者创建更高级别的抽象，这些抽象能够封装和组合来自不同提供商和服务的多种类型云资源。</p><p>使用 Crossplane 的 Composite Function 功能来渲染这些抽象能够有效增强各种提供商资源的模板能力，同时减少所需的 YAML 代码量。</p><p>将 KCL 与 Crossplane Composite Function 功能结合可以获得如下能力</p><ul><li><strong>简化复杂配置</strong>：KCL 作为 DSL 提供了更简洁的语法和结构，可以减少配置的复杂性。当与 Crossplane 的复合资源结合时，可以创建更直观、易于理解的配置模板，比如编写循环和条件语句降低模版，编写 Schema 和 Rule 进行模型抽象和校验，使用 KCL 简化资源的定义和维护，而不是编写重复的 YAML 或者使用 Go 代码编写并部署 Crossplane Function，降低配置和策略的开发及维护成本。此外，因为 Crosssplane Composition 资源本身缺乏强大的模版能力且云 API 丰富且复杂，因此有些 Composition 资源可能需要上千行 YAML 才能完成渲染资源编写，维护成本较高，使用 KCL 可以平替 YAML 提升动态配置能力。</li><li><strong>可重用和模块化</strong>：KCL 通过 OCI Registry 支持模块化和代码复用，这意味着可以创建可重用的配置模型，为 Crossplane Composition 资源带来模块化能力，且可同时在运行时和客户端使用，方便不同的平台团队之间进行协作。</li><li><strong>自动化和策略</strong>：可以使用 KCL 的强大功能来编写策略和约束，与 Crossplane 的声明式资源管理结合使用，并且在集群中自动执行，确保云资源或者 Kubernetes 资源的合规性，而无需引入额外的策略引擎。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="前置工作">前置工作<a href="#前置工作" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>准备一个 Kubernetes 集群</li><li>安装 Kubectl</li><li>安装 <a href="https://docs.crossplane.io/" target="_blank" rel="noopener noreferrer">Crossplane 及 Crossplane CLI 1.14+</a></li><li>安装 KCL</li><li>安装 Go 1.21+ (可选，需要本地调试函数时才用到)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="快速开始">快速开始<a href="#快速开始" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>我们编写一个 <code>Network</code> 抽象模型，并使用 KCL 代码对其进行渲染得到托管资源 <code>VPC</code> 和 <code>InternetGateway</code></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1-安装-crossplane-kcl-函数">1. 安装 Crossplane KCL 函数<a href="#1-安装-crossplane-kcl-函数" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><p><code>Function</code> 资源会创建一个函数 Pod，当您创建一个 Crossplane Composition Resource 时，Crossplane 会向这个 Pod 发送请求，询问它要创建什么资源。</p><p>通过设置 <code>spec.package</code> 值为 <code>kcllang/crossplane-kcl</code> 表示我们这里使用 KCL 函数</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: pkg.crossplane.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  package: xpkg.upbound.io/crossplane-contrib/function-kcl:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2-下发-composition-resource">2. 下发 Composition Resource<a href="#2-下发-composition-resource" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><p>就像渲染函数一样，在这里我们指定 KCL 如何接受输入 <code>Network</code> 资源并生成 <code>VPC</code> 资源和 <code>InternetGateway</code> 资源。KCL 函数可以引用自 OCI Registry 或者 GitHub 上面的代码，当然也可以直接书写在 <code>Composition</code> 资源中。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: apiextensions.crossplane.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Composition</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: xlabels.fn-demo.crossplane.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    provider: aws</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  writeConnectionSecretsToNamespace: crossplane-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  compositeTypeRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    apiVersion: fn-demo.crossplane.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kind: XNetwork</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  mode: Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  pipeline:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - step: normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    functionRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      name: kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    input:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      apiVersion: krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      kind: KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        name: basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # Generate new resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        target: Resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # OCI, Git or inline source</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # source: oci://ghcr.io/kcl-lang/crossplane-xnetwork-kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # source: github.com/kcl-lang/modules/crossplane-xnetwork-kcl-function</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        source: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          # Get the XR spec fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          id = option("params")?.oxr?.spec.id or ""</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          # Render XR to crossplane managed resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          network_id_labels = {"networks.meta.fn.crossplane.io/network-id" = id} if id else {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          vpc = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              apiVersion = "ec2.aws.upbound.io/v1beta1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              kind = "VPC"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.name = "vpc"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.labels = network_id_labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              spec.forProvider = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  region = "eu-west-1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  cidrBlock = "192.168.0.0/16"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  enableDnsSupport = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  enableDnsHostnames = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          gateway = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              apiVersion = "ec2.aws.upbound.io/v1beta1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              kind = "InternetGateway"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.name = "gateway"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              metadata.labels = network_id_labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              spec.forProvider = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  region = "eu-west-1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  vpcIdSelector.matchControllerRef = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          items = [vpc, gateway]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3-创建输入资源类型-crossplane-xrd">3. 创建输入资源类型 (Crossplane XRD)<a href="#3-创建输入资源类型-crossplane-xrd" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><p>我们使用 Crossplane XRD 为输入资源 Network 定义了一个 Schema，它有一个名为 id 的字段，表示网络 id。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: apiextensions.crossplane.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: CompositeResourceDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: xnetworks.fn-demo.crossplane.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  group: fn-demo.crossplane.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kind: XNetwork</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    plural: xnetworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  claimNames:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    kind: Network</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    plural: networks</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  versions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      served: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      referenceable: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        openAPIV3Schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          type: object</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              type: object</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                id:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  description: ID of this Network that other objects will use to refer to it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              required:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                - id</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="4-下发输入资源-crossplane-xr">4. 下发输入资源 (Crossplane XR)<a href="#4-下发输入资源-crossplane-xr" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: fn-demo.crossplane.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Network</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: network-test-functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  id: network-test-functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="5-检查生成的托管资源">5. 检查生成的托管资源<a href="#5-检查生成的托管资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h5><ul><li>VPC</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get VPC -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> network-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      networks.meta.fn.crossplane.io/network-id: network-test-functions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>InternetGateway</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get InternetGateway -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> network-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      networks.meta.fn.crossplane.io/network-id: network-test-functions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到我们确实成功生成了 <code>VPC</code> 和 <code>InternetGateway</code> 资源，并且它们的字段符合预期 (接受 XR 输入的 id 字段并转换为 <code>VPC</code> 资源和 <code>InternetGateway</code> 资源的标签)。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="客户端渲染">客户端渲染<a href="#客户端渲染" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>可以看到，上述 KCL 抽象代码常常需要 Crossplane 作为控制平面中介，但是我们仍然可以完全摆脱 Crossplane 控制平面在客户端完成抽象，并直接生成 Crossplane 管理的资源，以减轻集群负担和操作成本的同时并获得更好的配置编写体验。</p><p>因为 KCL 模型并不局限于在客户端还是运行时进行使用，因此我们在客户端仅通过一条命令就可以完成上述所有功能:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run oci://ghcr.io/kcl-lang/crossplane-xnetwork-kcl-function -S items -D </span><span class="token assign-left variable" style="color:#36acaa">params</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'{"oxr": {"spec": {"id": "network-test-functions"}}}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出为:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ec2.aws.upbound.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> VPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks.meta.fn.crossplane.io/network-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> network</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">forProvider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cidrBlock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enableDnsSupport</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enableDnsHostnames</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ec2.aws.upbound.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InternetGateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks.meta.fn.crossplane.io/network-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> network</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">forProvider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">vpcIdSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">matchControllerRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，后续我们会结合 <code>crossplane-provider-aws</code> 等模型库进一步详细介绍如何获得一个更好的客户端抽象，尽情期待!</p><p>此外，可以在这里查看到更多 Crossplane 和 KCL 结合的用例：<a href="https://github.com/crossplane-contrib/function-kcl" target="_blank" rel="noopener noreferrer">https://github.com/crossplane-contrib/function-kcl</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会发布更多 KCL 云原生模型和工具集成文章，敬请期待! 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">KCL v0.8.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[10 种 Kubernetes 声明式配置管理的方式]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-25-ten-ways-for-kubernetes-config-management</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-25-ten-ways-for-kubernetes-config-management</guid>
            <pubDate>Mon, 25 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Kubernetes 已经成为管理容器化应用程序的事实标准，但随着其普及，管理其配置的复杂性也随之增加。为了应对这种复杂性，Kubernetes 声明式配置管理模型应运而生，以简化这一流程。在本文中，我们将探讨什么是 Kubernetes 声明式配置，为什么它是必需的，以及可以通过哪些不同的方式来管理它。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/cover-26257c2a7dc6503e03b9fc420808b984.png" width="644" height="424" class="img_ev3q"></p><p>Kubernetes 已经成为管理容器化应用程序的事实标准，但随着其普及，管理其配置的复杂性也随之增加。为了应对这种复杂性，Kubernetes 声明式配置管理模型应运而生，以简化这一流程。在本文中，我们将探讨什么是 Kubernetes 声明式配置，为什么它是必需的，以及可以通过哪些不同的方式来管理它。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-kubernetes-声明式配置">什么是 Kubernetes 声明式配置<a href="#什么是-kubernetes-声明式配置" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Kubernetes 声明式配置是指在 Kubernetes 清单文件中声明应用程序及其资源所期望的状态的做法，与其发布命令式指令来改变集群的状态，不如简单地描述预期的状态，让 Kubernetes 去努力使实际状态与声明的状态相匹配。具体来说，在声明式 API 中，你描述你想要的“什么”（例如，我想要一个运行特定镜像的 Pod），而不是你想要进行的一系列操作来实现某个目标状态（即“如何”实现）。这种模型简化了系统交互，因为用户只需关注最终目标，而不必处理达到该目标的具体步骤。</p><p>Kubernetes 的声明式 API 通常是通过 YAML 或 JSON 格式的清单（Manifests）文件来使用的。这些文件定义了 Kubernetes 资源（如 Pods, Services, Deployments, ConfigMaps 等）的期望状态。用户将这些清单文件提交给 Kubernetes API 服务器，然后 Kubernetes 的控制平面组件（如控制器和调度器）负责实施这些规范，并确保集群的实际状态与这些规范相匹配。</p><p>声明式 API 支持版本控制、自动化部署、回滚、扩展和自我修复等特性，这大大提升了管理大规模、分布式系统的能力。例如，如果你想要部署一个应用程序，你不必告诉 Kubernetes 如何创建每一个 Pod、如何调度它们到节点上，或者如何管理它们的生命周期。相反，你只需要创建一个如 Deployment 这样的资源对象，定义你想要的副本数（replicas）和应用程序容器的其他属性，然后交给 Kubernetes 来处理。Kubernetes 会监控这个 Deployment 的状态，并采取必要的措施来维护或恢复期望的状态。</p><p>这种声明式模型提高了系统的抽象层次，使开发者和运维人员能够专注于应用程序本身的行为和需求，而不是底层的运维命令和过程。随着组织采用 Kubernetes 来大规模部署应用程序，管理复杂的配置和清单变得至关重要。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-声明式配置管理的方式有哪些">Kubernetes 声明式配置管理的方式有哪些<a href="#kubernetes-声明式配置管理的方式有哪些" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="结构化-structured-的-kv">结构化 (Structured) 的 KV<a href="#结构化-structured-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>结构化的 KV 可以满足最小化数据声明需求，比如数字、字符串、列表和字典等数据类型，并且随着云原生技术快速发展应用，声明式 API 可以满足 X as Data 发展的诉求，并且面向机器可读可写，面向人类可读。其优劣如下:</p><ul><li>优势<ul><li>语法简单，易于编写和阅读</li><li>多语言 API 丰富</li><li>有各种 Path 工具方便数据查询，如 XPath, JsonPath 等</li></ul></li><li>痛点<ul><li>冗余信息多：当配置规模较大时，维护和阅读配置很困难，因为重要的配置信息被淹没在了大量不相关的重复细节中</li><li>功能性不足<ul><li>约束校验能力</li><li>复杂逻辑编写能力</li><li>测试、调试能力</li><li>不易抽象和复用</li><li>Kustomize 的 Patch 比较定制，基本是通过固定几种 Patch Merge 策略</li></ul></li></ul></li></ul><p>结构化 KV 的代表技术有</p><ul><li>JSON/YAML：非常方便阅读，以及自动化处理，不同的语言均具有丰富的 API 支持。</li><li><a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">Kustomize</a>：提供了一种无需<strong>模板</strong>和 <strong>DSL</strong> 即可自定义 Kubernetes 资源基础配置和差异化配置的解决方案，本身不解决约束的问题，需要配合大量的额外工具进行约束检查如 <a href="https://github.com/stackrox/kube-linter" target="_blank" rel="noopener noreferrer">Kube-linter</a>、<a href="https://github.com/bridgecrewio/checkov" target="_blank" rel="noopener noreferrer">Checkov</a> 和 <a href="https://github.com/kubescape/kubescape" target="_blank" rel="noopener noreferrer">kubescape</a> 等检查工具。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模版化-templated-的-kv">模版化 (Templated) 的 KV<a href="#模版化-templated-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>模版化 (Templated) 的 KV 赋予静态配置数据动态参数的能力，可以做到一份模版+动态参数输出不同的静态配置数据。其优劣如下:</p><ul><li>优势<ul><li>简单的配置逻辑，循环支持</li><li>支持外部动态参数输入模版</li></ul></li><li>痛点<ul><li>容易落入所有配置参数都是模版参数的陷阱</li><li>当配置规模变大时，开发者和工具都难以维护和分析它们</li></ul></li></ul><p>模版化代表技术有:</p><ul><li><a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a>：Kubernetes 资源的包管理工具，通过配置模版管理 Kubernetes 资源配置。</li><li><a href="https://github.com/helmfile/helmfile" target="_blank" rel="noopener noreferrer">Helmfile</a>：Helmfile 是一个声明式的工具，用于帮助用户配置和管理在 Kubernetes 集群中运行的 Helm 图表（charts）。此外，Helmfile 扩展了 Helm 的功能，使得管理多个 Helm 图表变得更加容易。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码化-programmable-的-kv">代码化 (Programmable) 的 KV<a href="#代码化-programmable-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Configuration as Code (CaC), 使用代码产生配置，就像工程师们只需要写高级 GPL 代码，而不是手工编写容易出错而且难以理解的服务器二进制代码一样。配置变更同代码变更同样严肃地对待，同样可以执行单元测试、集成测试等。代码模块化和重用是维护配置代码比手动编辑 JSON/YAML 等配置文件更容易的一个关键原因。其优劣如下:</p><ul><li>优势<ul><li>必要的编程能力（变量定义、逻辑判断、循环、断言等）</li><li>代码模块化与抽象（支持定义数据模版，并用模版得到新的配置数据）</li><li>可以抽象配置模版+并使用配置覆盖</li></ul></li><li>痛点<ul><li>类型检查不足</li><li>运行时错误</li><li>约束能力不足</li></ul></li></ul><p>代码化 KV 的代表技术有:</p><ul><li><a href="https://github.com/rix0rrr/gcl" target="_blank" rel="noopener noreferrer">GCL</a>：一种 Python 实现的声明式配置编程语言，提供了必要的言能力支持模版抽象，但编译器本身是 Python 编写，且语言本身是解释执行，对于大的模版实例 (比如 K8s 型) 性能较差。</li><li><a href="https://github.com/hashicorp/hcl" target="_blank" rel="noopener noreferrer">HCL</a>：一种 Go 实现结构化配置语言，原生语法受到 libuclnginx 配置等的启发，用于创建对人类和机器都友好的结构化配置语言，主要针对 devops 工具、服务器配置及 Terraform 中定义资源配置等。除此之外，可以使用 Terraform 以及 Terraform Kubernetes Provider 等来管理 Kubernetes 资源。</li><li><a href="https://github.com/google/jsonnet" target="_blank" rel="noopener noreferrer">Jsonnet</a>：一种 C++ 实现的数据模板语言，适用于应用程序工具开发人员，可以生成配置数据并且无副作用组织、简化、统一管理庞大的配置。</li><li><a href="https://github.com/open-policy-agent/opa" target="_blank" rel="noopener noreferrer">OPA</a>：虽然是一种开源通用策略引擎，可在整个堆栈中实现统一的、上下文感知的策略实施。但是 OPA 可以接受 JSON 等数据进行输入并输出 JSON 等数据格式，实际上也可以作为配置生成或者配置修改工具使用，但是本身没有提供开箱的 Schema 定义支持，但是可以引入 JsonSchema 定义。</li><li><a href="https://github.com/bazelbuild/starlark" target="_blank" rel="noopener noreferrer">Starlark</a>：Starlark 是一种受 Python 启发的构建转换描述语言，但具有适合嵌入到如 Bazel 这样的软件中的特性。它可以用于配置生成，因为它具有确定性评估和表达复杂构建转换的能力。</li><li><a href="https://kubernetes.io/docs/reference/using-api/cel/" target="_blank" rel="noopener noreferrer">CEL</a>：CEL 是一种旨在简单、快速、可移植和安全的表达式语言。虽然它并不直接是一种配置语言，但 Kubernetes 使用 CEL 作为其 API 中复杂字段选择和过滤操作的基础。CEL 可以作为一种基于特定表达式验证和约束配置的工具。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="类型化-typed-的-kv">类型化 (Typed) 的 KV<a href="#类型化-typed-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>类型化的 KV，基于代码化 KV，多了类型检查和约束的能力，其优劣如下:</p><ul><li>优势<ul><li>配置合并完全幂等，天然防止配置冲突</li><li>丰富的配置约束语法用于编写约束</li><li>将类型和值约束编写抽象为同一种形式，编写简单</li><li>配置顺序无关</li></ul></li><li>痛点<ul><li>图合并和幂等合并等概念复杂，用户理解成本较高</li><li>类型和值混合定义提高抽象程度的同时提升了用户的理解成本，并且所有约束在运行时进行检查，大规模配置代码下有性能瓶颈</li><li>对于想要配置覆盖、修改的多租户、多环境场景难以实现</li><li>对于带条件的约束场景，定义和校验混合定义编写用户界面不友好</li></ul></li></ul><p>类型化 KV 的代表技术有:</p><ul><li><a href="https://github.com/cue-lang/cue" target="_blank" rel="noopener noreferrer">CUE</a>：CUE 解决的核心问题是“类型检查”，主要应用于配置约束校验场景及简单的云原生配置场景</li><li><a href="https://github.com/dhall-lang/dhall-lang" target="_blank" rel="noopener noreferrer">Dhall</a>：Dhall 是一种可编程配置语言，它组合了 JSON、函数、类型和 imports 导入等功能, 本身风格偏向函数式，如果您学过 haskell 等函数式风格语言，可能会对它感到熟悉的。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型化-modeled-的-kv">模型化 (Modeled) 的 KV<a href="#模型化-modeled-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>模型化的 KV 在代码化和类型化 KV 的基础上以高级语言建模能力为核心描述，期望做到模型的快速编写与分发，其优劣如下:</p><ul><li>优势<ul><li>引入可分块、可扩展的 KV 配置块编写方式</li><li>类高级编程语言的编写、测试方式</li><li>语言内置的强校验、强约束支持</li><li>面向人类可读可写，面向机器部分可读可写</li></ul></li><li>不足<ul><li>扩展新模型及生态构建需要一定的研发成本，或者使用工具对社区中已有的 JsonSchema 和 OpenAPI 模型进行模型转换、迁移和集成，通过包管理工具和 Registry 等。</li></ul></li></ul><p>模型化 KV 的代表技术有:</p><ul><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a>：一种 Rust 实现的声明式配置策略编程语言，把运维类研发统一为一种声明式的代码编写，可以针对差异化应用交付场景抽象出用户模型并添加相应的约束能力，期望借助可编程 DevOps 理念解决规模化运维场景中的配置策略编写的效率和可扩展性等问题。</li><li><a href="https://github.com/tweag/nickel" target="_blank" rel="noopener noreferrer">Nickel</a>：Nickel 是一种简单的配置语言。它的目的是自动生成静态配置文件，本质上是带有函数和类型的 JSON。</li></ul><p>此外，KCL 和 Nickel 都有类似的渐进式类型系统（静态+动态）、合并策略、函数和约束定义。不同之处在于 KCL 是一种类似 Python 的语言，而 Nickel 是一种类似 JSON 的语言。此外，KCL 提供了 schema 关键字来区分配置定义和配置数据，以避免混合使用。此外使用 KCL 和 KCL 的模型库还可以与 <a href="https://www.kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack</a>, <a href="https://kubevela.net/" target="_blank" rel="noopener noreferrer">KubeVela</a> 等引擎更好地集成。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="通用语言和-cdks">通用语言和 CDKs<a href="#通用语言和-cdks" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>除了使用 DSL 来定义 Kubernetes 资源，我们还可以使用通用语言来定义。不过通用语言一般是 Overkill 的，即远远超过了需要解决的问题，通用语言存在各式各样的安全问题，比如能力边界问题 (启动本地线程、访问 IO, 网络，代码死循环等不安全隐患)，比如像音乐领域就有专门的音符去表示音乐，方便学习与交流，不是一般文字语言可以表述清楚的。</p><p>此外，通用语言因为本身就样式繁多，存在统一维护、管理和自动化的成本，通用语言一般用来编写客户端运行时，是服务端运行时的一个延续，不适合编写与运行时无关的配置，最终被编译为二进制从进程启动，稳定性和扩展性不好控制，而配置语言往往编写的是数据，再搭配以简单的逻辑，描述的是期望的最终结果，然后由编译器或者引擎来消费这个期望结果。</p><p>通用语言和 CDK 的代表技术有:</p><ul><li><a href="https://www.pulumi.com/docs/" target="_blank" rel="noopener noreferrer">Pulumi</a>：Pulumi 允许使用常见的编程语言（如 TypeScript, Python, Go, 和 .NET 等）来编写代码，定义和部署云基础设施以及应用服务。当然 Pulumi 也支持使用 YAML 或者可以编译为 YAML 的 DSL 如 KCL 等。</li><li><a href="https://cdk8s.io/" target="_blank" rel="noopener noreferrer">CDK8s</a>：CDK8s 可以用于定义Kubernetes资源和应用程序。CDK8s 使用一种称为构造（constructs）的高级抽象概念来表示Kubernetes的各种资源，例如部署、服务和配置。开发人员可以使用 TypeScript、Python和Java等编程语言来编写代码，CDK8s 会将这些代码转换为标准的Kubernetes YAML清单，这些清单可以直接应用到Kubernetes集群上。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="结构化和代码化混合型-kv">结构化和代码化混合型 KV<a href="#结构化和代码化混合型-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>有些工具虽然常用方式是定义结构化 KV 来实现配置管理，但是仍然提供了额外的扩展方式来应对复杂的场景，消除更多 YAML 模版。比如一些云原生工具提供了函数扩展方式，这些函数可以使用 Go, Typescript 等通用语言或者 KCL 等 DSL 来实现。</p><ul><li><a href="https://github.com/carvel-dev/ytt" target="_blank" rel="noopener noreferrer">YTT</a> - YTT 是一个理解 YAML 结构的模板工具，它通过使用 Starlark 语言帮助您通过可重复使用的模板和用户提供的值轻松配置复杂的软件。</li><li><a href="https://kpt.dev/" target="_blank" rel="noopener noreferrer">KPT</a>：使用 KPT 和 KPT Function 可以解耦数据和逻辑定义，以 Git 仓库作为配置源的真实来源，通过声明式方式管理 Kubernetes 配置的同时不失扩展性。</li><li><a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">Kustomize</a>：类似 KPT，使用 Kustomize 和 Kustomize Function 也可以解耦数据和逻辑定义。</li><li><a href="https://www.crossplane.io/" target="_blank" rel="noopener noreferrer">Crossplane</a>：使用 Crossplane 和 Crossplane Composite Function 解耦 XR 和 Composite 资源定义。XR 复合资源允许开发人员创建更高级别的抽象，这些抽象可以封装和组合多个不同类型的云资源（可能跨越不同的云提供商和服务）。使用 Crossplane Composite Function 渲染这些抽象能够很好为不同的供应商资源提供循环或者条件等功能提升模版能力的同时地减少 YAML 代码编写量。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端或者运行时工具-包括-operators-和-kubernetes-crds">客户端或者运行时工具 (包括 Operators 和 Kubernetes CRDs)<a href="#客户端或者运行时工具-包括-operators-和-kubernetes-crds" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Kubernetes 提供了 Mutation Webhook 和 Validation Webhook 可以在运行时修改或验证 Kubernetes 资源对象在被持久化之前的请求。</p><p>Operators 和 Kubernetes CRDs 的代表技术有</p><ul><li><a href="https://kusionstack" target="_blank" rel="noopener noreferrer">KusionStack</a> - KusionStack 是一个现代的应用程序交付和管理工具链，使开发人员能够以声明的方式指定所需的意图，然后使用一致的工作流来推动应用程序生命周期中的连续部署。此外，KusionStack 通过 <code>Operation</code> 和 <code>ControllerMesh</code> 等子项目提供满足 K8s 标准的云原生运维、链路可观测、资源可洞察、灰度发布、熔断限流等能力，支持对 Pod 进行增量配置和无损变更，以帮助开发者更好地搭建自己的平台。</li><li><a href="https://kubevela.io/docs/" target="_blank" rel="noopener noreferrer">KubeVela</a>：KubeVela 是一个现代化的应用交付系统，它基于 Open Application Model（OAM）规范构建，为开发者和运维团队提供了一套简化和统一的方式来部署、管理和运维应用。</li><li><a href="https://www.crossplane.io/" target="_blank" rel="noopener noreferrer">Crossplane</a>：Crossplane 是一个开源的多云控制平面，它在 Kubernetes 上提供了基础设施即代码的能力。Crossplane 允许你定义 XRD 和 XR 来管理和组合云资源（如数据库、存储和计算资源）直接从 Kubernetes API。</li><li><a href="https://github.com/radius-project/radius" target="_blank" rel="noopener noreferrer">Radius</a> - Radius 是一个云原生、可移植的应用程序平台，使构建云原生应用程序的团队更容易进行应用程序开发。</li><li><a href="https://github.com/kcl-lang/kcl-operator" target="_blank" rel="noopener noreferrer">KCL Operator</a>：KCL Operator 基于 KCL 语言在运行时为 Kubernetes 资源配置带来编程能力，使用 DSL 的灵活性来避免繁琐的 Webhook 的开发并接入 KCL 已有的<a href="https://github.com/kcl-lang/modules" target="_blank" rel="noopener noreferrer">生态模型</a>。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gitops-工具">GitOps 工具<a href="#gitops-工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>GitOps 是一种使用 Git 作为真实来源的系统管理方法，它将应用程序部署和基础设施配置的声明性描述存储在 Git 仓库中。GitOps 工具通常提供了自动化的连续部署能力，并确保 Kubernetes 集群的实时状态匹配 Git 仓库中的配置。通常 GitOps 工具都原生提供或者通过插件支持与各种 Kubernetes 配置定义方式进行集成 (结构化，模版化，代码化 KV 等如 Kustomize, Helm, Jsonnet, KCL 等)</p><p>GitOps 的代表技术有</p><ul><li><a href="https://argo-cd.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">ArgoCD</a>：ArgoCD 是一个声明性的、GitOps 持续交付工具，用于自动化 Kubernetes 配置、监控和管理。它通过追踪配置信息在 Git 仓库中的变化来自动部署和更新应用程序和配置。ArgoCD 提供了可视化的界面以及详尽的控制和安全性特性，它支持多种配置管理工具，如 Helm、Kustomize、Jsonnet 等。</li><li><a href="https://fluxcd.io/" target="_blank" rel="noopener noreferrer">FluxCD</a>：FluxCD 是另一款流行的 GitOps 工具，它也允许开发人员以 Git 仓库作为单一的配置源。Flux 自动确保 Kubernetes 集群的状态与 Git 仓库中的配置同步。它支持自动更新，这意味着 Flux 可以监控 Docker 镜像仓库的新镜像，并将更新推送到集群中。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="infra-from-code-ifc-工具">Infra from Code (IfC) 工具<a href="#infra-from-code-ifc-工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Infra from Code (IfC) 是一种管理基础设施的方法，类似于 IaC (Infrastructure as Code)，它通过代码来定义和管理底层基础设施，通常通过代码意图推导的形式而不是显式定义基础设施代码。</p><ul><li><a href="https://github.com/winglang/wing" target="_blank" rel="noopener noreferrer">Winglang</a>：Winglang 是面向云的新的编程语言，将基础设施和运行时代码结合在一种语言中，并同时支持 AWS, Kubernetes 多种构建目标。此外，Winglang 还提供了直接操作容器和 Helm Chart 配置的内置库。</li><li><a href="https://github.com/pluto-lang/pluto" target="_blank" rel="noopener noreferrer">Plutolang</a>：Pluto 是一种新型开源编程语言，旨在帮助开发者编写云应用程序，降低云服务的使用难度。开发者可以根据业务需求，在代码中直接使用所需资源，例如 KV 数据库、消息队列等。Pluto 通过<strong>静态分析代码</strong>获取应用依赖的基础设施资源拓扑，并在指定的云平台或者 Kubernetes 上部署相应的资源实例和应用程序。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>每种管理方式都有其特定的优势和用途。对于简单的项目，可能只需要使用原生的 Kubernetes YAML 文件和 ConfigMaps。对于需要更强大的模板功能和包管理的复杂项目，可以选择 Helm 或 Kustomize。如果你需要以编程方式处理配置或需要将 Kubernetes 集成到更广泛的云基础设施管理中，那么像 Terraform 和 Pulumi 这样的 IaC 工具或者 KCL 和 CUE 等 DSL 来描述可能更加适合。</p><p>GitOps 工具提供了一种以 Git 为核心的持续部署方法。而 Operators 和 CRDs 则允许用户定制扩展 Kubernetes 本身的功能，以适应特定应用的需求。这些管理方式不是相互排斥的，实际上，在实际的配置管理工作中，它们往往是互补的，团队可以根据具体需求选择和组合最适合自己的工具和方法。</p><p>除此之外，您还知道怎样的方式? 欢迎补充。❤️</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>Terraform Language: <a href="https://www.terraform.io/language" target="_blank" rel="noopener noreferrer">https://www.terraform.io/language</a></li><li>Terraform Kubernetes Provider: <a href="https://github.com/hashicorp/terraform-provider-kubernetes" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/terraform-provider-kubernetes</a></li><li>Terraform Provider AWS: <a href="https://github.com/hashicorp/terraform-provider-aws" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/terraform-provider-aws</a></li><li>Pulumi: <a href="https://www.pulumi.com/docs/" target="_blank" rel="noopener noreferrer">https://www.pulumi.com/docs/</a></li><li>Pulumi vs. Terraform: <a href="https://www.pulumi.com/docs/intro/vs/terraform/" target="_blank" rel="noopener noreferrer">https://www.pulumi.com/docs/intro/vs/terraform/</a></li><li>Google SRE Work Book Configuration Design: <a href="https://sre.google/workbook/configuration-design/" target="_blank" rel="noopener noreferrer">https://sre.google/workbook/configuration-design/</a></li><li>Google Borg Paper: <a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/43438.pdf" target="_blank" rel="noopener noreferrer">https://storage.googleapis.com/pub-tools-public-publication-data/pdf/43438.pdf</a></li><li>Holistic Configuration Management at Facebook: <a href="https://sigops.org/s/conferences/sosp/2015/current/2015-Monterey/printable/008-tang.pdf" target="_blank" rel="noopener noreferrer">https://sigops.org/s/conferences/sosp/2015/current/2015-Monterey/printable/008-tang.pdf</a></li><li>JSON Spec: <a href="https://www.json.org/json-en.html" target="_blank" rel="noopener noreferrer">https://www.json.org/json-en.html</a></li><li>YAML Spec: <a href="https://yaml.org/spec/" target="_blank" rel="noopener noreferrer">https://yaml.org/spec/</a></li><li>GCL: <a href="https://github.com/rix0rrr/gcl" target="_blank" rel="noopener noreferrer">https://github.com/rix0rrr/gcl</a></li><li>HCL: <a href="https://github.com/hashicorp/hcl" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/hcl</a></li><li>CUE: <a href="https://github.com/cue-lang/cue" target="_blank" rel="noopener noreferrer">https://github.com/cue-lang/cue</a></li><li>KCL: <a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl</a></li><li>Nickel: <a href="https://github.com/tweag/nickel" target="_blank" rel="noopener noreferrer">https://github.com/tweag/nickel</a></li><li>Jsonnet: <a href="https://github.com/google/jsonnet" target="_blank" rel="noopener noreferrer">https://github.com/google/jsonnet</a></li><li>Dhall: <a href="https://github.com/dhall-lang/dhall-lang" target="_blank" rel="noopener noreferrer">https://github.com/dhall-lang/dhall-lang</a></li><li>Starlark: <a href="https://github.com/bazelbuild/starlark" target="_blank" rel="noopener noreferrer">https://github.com/bazelbuild/starlark</a></li><li>CEL: <a href="https://kubernetes.io/docs/reference/using-api/cel/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/using-api/cel/</a></li><li>Thrift: <a href="https://github.com/Thriftpy/thriftpy2" target="_blank" rel="noopener noreferrer">https://github.com/Thriftpy/thriftpy2</a></li><li>Kustomize: <a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">https://kustomize.io/</a></li><li>YTT: <a href="https://github.com/carvel-dev/ytt" target="_blank" rel="noopener noreferrer">https://github.com/carvel-dev/ytt</a></li><li>KPT: <a href="https://kpt.dev/" target="_blank" rel="noopener noreferrer">https://kpt.dev/</a></li><li>Kube-linter: <a href="https://github.com/stackrox/kube-linter" target="_blank" rel="noopener noreferrer">https://github.com/stackrox/kube-linter</a></li><li>Checkov: <a href="https://github.com/bridgecrewio/checkov" target="_blank" rel="noopener noreferrer">https://github.com/bridgecrewio/checkov</a></li><li>How Terraform Works: A Visual Intro: <a href="https://betterprogramming.pub/how-terraform-works-a-visual-intro-6328cddbe067" target="_blank" rel="noopener noreferrer">https://betterprogramming.pub/how-terraform-works-a-visual-intro-6328cddbe067</a></li><li>How Terraform Works: Modules Illustrated: <a href="https://awstip.com/terraform-modules-illustrate-26cbc48be83a" target="_blank" rel="noopener noreferrer">https://awstip.com/terraform-modules-illustrate-26cbc48be83a</a></li><li>TFLint: <a href="https://github.com/terraform-linters/tflint" target="_blank" rel="noopener noreferrer">https://github.com/terraform-linters/tflint</a></li><li>Helm: <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">https://helm.sh/</a></li><li>Helm vs. Kustomize: <a href="https://harness.io/blog/helm-vs-kustomize" target="_blank" rel="noopener noreferrer">https://harness.io/blog/helm-vs-kustomize</a></li><li>KubeVela: <a href="https://kubevela.io/docs/" target="_blank" rel="noopener noreferrer">https://kubevela.io/docs/</a></li><li>Radius: <a href="https://github.com/radius-project/radius" target="_blank" rel="noopener noreferrer">https://github.com/radius-project/radius</a></li><li>KusionStack: <a href="https://kusionstack.io" target="_blank" rel="noopener noreferrer">https://kusionstack.io</a></li><li>Crossplane: <a href="https://www.crossplane.io/" target="_blank" rel="noopener noreferrer">https://www.crossplane.io/</a></li><li>ArgoCD: <a href="https://argo-cd.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">https://argo-cd.readthedocs.io/en/stable/</a></li><li>FluxCD: <a href="https://fluxcd.io/" target="_blank" rel="noopener noreferrer">https://fluxcd.io/</a></li><li>Helmfile: <a href="https://helmfile.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">https://helmfile.readthedocs.io/en/latest/</a></li><li>CDK8s: <a href="https://cdk8s.io/" target="_blank" rel="noopener noreferrer">https://cdk8s.io/</a></li><li><a href="https://medium.com/@sushantkapare1717/helm-vs-kustomize-in-kubernetes-cc063bbb4b0e" target="_blank" rel="noopener noreferrer">Helm vs. Kustomize in Kubernetes</a></li><li>Winglang: <a href="https://github.com/winglang/wing" target="_blank" rel="noopener noreferrer">https://github.com/winglang/wing</a></li><li>Plutolang: <a href="https://github.com/pluto-lang/pluto" target="_blank" rel="noopener noreferrer">https://github.com/pluto-lang/pluto</a></li><li><a href="https://blog.terramate.io/infrastructure-as-code-landscape-in-2023-e2dad4fb87d3" target="_blank" rel="noopener noreferrer">Infrastructure as Code Landscape in 2023</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
            <category>Landscape</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 12.07 - 12.21) | KCL v0.7.2 发布和 KubeVela/OAM 集成]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-21-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-21-biweekly-newsletter</guid>
            <pubDate>Thu, 21 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 12.07 - 12.21) 的杰出工作，以下是重点内容概述</p><p><strong>📦 模型更新</strong></p><p>KCL 模型数量新增至 <strong>300 个</strong>，增加了 k8s 1.29 版本的 KCL 模型。</p><p><strong>🔧 工具链更新</strong></p><ul><li><p><strong>导入工具更新</strong></p><ul><li>导入工具支持 OpenAPI allOf 关键字校验表达式生成</li><li>导入工具支持 KCL 数组和字典类型的 all/any 校验表达式生成</li><li>导入工具修复 JSON Schema 数组生成 KCL 代码片段错误及字符串转义错误</li></ul></li><li><p><strong>🏄 包管理工具更新</strong></p><ul><li>增加对名称中包含横线的三方库的支持。</li><li>修复了 update 功能无法自动通过 kcl.mod 和 kcl.mod.lock 的问题。</li></ul></li></ul><p><strong>💻 KCL 更新</strong></p><ul><li>KCL 编译缓存路径支持使用环境变量 KCL_CACHE_PATH 指定</li><li>修复了 KCL CLI 使用编译参数 -S 可能会导致的编译错误</li><li>修复了 kcl fmt 工具对 lambda 表达式进行格式化时，结尾增加一个空行的错误。</li><li>修复 Schema Doc 补全代码片段错误</li></ul><p><strong>📒 IDE 更新</strong></p><ul><li>修复了 check 语句中变量补全失效的问题</li><li>VSCode Extension 更新至 0.1.3 版本，更新了部分关键字的高亮和补全</li><li>新增了 builtin 函数的补全</li><li>优化了函数补全的样式</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实现高效云原生应用部署运维---kcl-与-kubevela-快速集成指南">实现高效云原生应用部署运维 - KCL 与 KubeVela 快速集成指南<a href="#实现高效云原生应用部署运维---kcl-与-kubevela-快速集成指南" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 建立在一个完全开放的云原生世界当中，不与任何编排/引擎工具或者 Kubernetes 控制器绑定，可以同时为 Kubernetes 客户端和运行时提供 API 抽象、组合和校验的能力。用户可以根据场景选择合适的云原生工具比如 Kubectl, Helm, Kustomize, KPT, KusionStack, KubeVela, Helmfile, Crossplane 或 ArgoCD 等来和 KCL 结合将配置生效到集群。</p><p>KubeVela 是一个 CNCF 基金会托管的现代的应用交付系统，它基于 Open Application Model（OAM）规范构建，旨在屏蔽 Kubernetes 的复杂性，提供一套简单易用的命令行工具和 APIs，让开发者无需关心底层细节即可部署和运维云原生应用。</p><p>通过结合 KCL 与 KubeVela，可以为 KubeVela OAM 配置提供更强的模版化能力如条件，循环等，减少样板 YAML 书写，同时复用 KCL 模型库和工具链生态，提升配置及策略编写的体验和管理效率。</p><p>并且，相较于围绕 YAML 进行配置，通过 KCL 可以提供更有利于版本控制和团队协作的配置文件结构，搭配 KCL 编写的 OAM 应用模型，可以使得应用配置更易于维护和迭代。</p><p>结合 KCL 的配置简洁性和 KubeVela 的易用性，还可以简化日常的操作任务，比如部署更新、扩展或回滚应用。可以使开发者可以更加专注于应用本身，而不是部署过程中的繁琐细节。</p><p>通过 KCL 配置分块编写以及包管理能力与 KubeVela 结合使用，可以定义更清晰的界限，使得不同的团队（如开发、测试和运维团队）可以有条理地协作。每个团队可以专注于其职责范围内的任务，分别交付、分享和复用各自的配置，而不用担心其他方面的细节。</p><p>以 KCL Playground 应用为例（这是使用 Go 和 HTML5 编写的应用）展示如何使用 KCL 定义需要部署的 OAM 配置，并通过 KubeVela 发布应用配置。</p><ul><li><p>准备工作</p><ul><li>配置 Kubernetes 集群</li><li>安装 KubeVela</li><li>安装 KCL</li></ul></li><li><p>新建工程并添加 OAM 库依赖</p></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod init kcl-play-svc &amp;&amp; cd kcl-play-svc &amp;&amp; kcl mod add oam</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在 main.k 中编写代码</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import oam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oam.Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata.name = "kcl-play-svc"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec.components = [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = metadata.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type = "webservice"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        properties = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image = "kcllang/kcl"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ports = [{port = 80, expose = True}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cmd = ["kcl", "play"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>运行命令下发配置</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run | vela up -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>端口转发</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vela port-forward kcl-play-svc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后我们可以在浏览器中看到 KCL Playground 应用成功运行</p><p><img loading="lazy" alt="kcl-play-svc" src="/zh-CN/assets/images/kcl-play-svc-17cdd017ee58347075be64904d62e73f.png" width="2326" height="858" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ide-优化了函数补全的样式">IDE 优化了函数补全的样式<a href="#ide-优化了函数补全的样式" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><img loading="lazy" alt="ide-func" src="/zh-CN/assets/images/ide-func-96160828de7f06d68aa5c50f372008c2.gif" width="870" height="427" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会发布更多 KCL 云原生模型和工具集成文章，敬请期待! 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">KCL v0.8.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[如何将 KCL 代码部署到集群?]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-19-how-to-apply-kcl-config-to-cluster</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-19-how-to-apply-kcl-config-to-cluster</guid>
            <pubDate>Tue, 19 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[什么是 KCL]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-kcl">什么是 KCL<a href="#什么是-kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的面向云原生场景的配置及策略语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="将-kcl-配置部署到集群的几种方式">将 KCL 配置部署到集群的几种方式<a href="#将-kcl-配置部署到集群的几种方式" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="cloud-native-tool-integration" src="/zh-CN/assets/images/cloud-native-tool-integration-b2157c3d2b3210c16f145176928e2cfc.png" width="1386" height="608" class="img_ev3q"></p><p>因为 KCL 本身可以输出为 YAML/JSON 文件，因此理论上支持将 YAML/JSON 配置部署到集群的方式，都可以将 KCL 配置部署到集群，通常我们将 KCL 文件放在 Git 或者 Module Registry 中保存方便与不同的角色和团队之间共享配置，但是 KCL 可以做到的远不止这些，这里将可以将 KCL 配置部署到的集群主要分为如下几种情况。</p><ul><li><strong>使用 kubectl</strong>: 访问 Kubernetes 集群最基本的方式就是使用 Kubectl，我们可以通过 kubectl apply 命令直接将 KCL 生成的 Kubernetes YAML 配置文件部署到集群中。这种方式简单快捷，适用于单个或少量资源的部署</li><li><strong>使用 CI/CD 工具</strong>: 可以使用 CI/CD 工具（例如 Jenkins、GitLab CI、CircleCI、ArgoCD、FluxCD 等）来实现 GitOps 自动化部署 Kubernetes YAML 配置文件到集群中。通过定义 CI/CD 流程和配置文件，可以实现自动化构建和部署到集群中</li><li><strong>使用支持 KRM Function 规范的工具</strong>: KRM Function 允许用户使用其他语言包括 KCL 来提升 YAML 模版和逻辑编写能力比如编写条件、循环等，这类工具主要包括 Kustomize, KPT, Crossplane 等，虽然 Helm 并没有原生支持，但是我们可以将 Helm 和 Kustomize 结合使用来实现</li><li><strong>使用客户端/运行时自定义抽象配置工具进行部署</strong>: 如 KusionStack, KubeVela 等，当然 KCL 允许您自定义您喜欢的应用配置模型。</li><li><strong>使用 KCL Operator</strong>: 结合 Kubernetes Mutation Webhook 和 Validation Webhook 支持运行时编写配置或策略。+<strong>使用配置管理工具</strong>: 结合配置管理工具（例如 Puppet、Chef、Ansible 等）来自动化部署 Kubernetes YAML 配置到集群中。这些工具可以通过定义 KCL 模板和变量来实现动态配置部署</li></ul><p>KCL 支持多种部署方式和云原生工具集成有以下几个原因：</p><ul><li><strong>灵活性</strong>：不同的部署方式适用于不同的场景和需求，因此提供多种选择可以使用户根据其特定的情况选择最合适的方式来部署应用程序或配置。</li><li><strong>工具生态系统</strong>：Kubernetes 是一个生态系统庞大的平台，有许多工具和技术被广泛应用。支持多种部署方式可以为用户提供更多选择，满足其使用习惯和技术偏好。</li><li><strong>规范和标准</strong>：Kubernetes 社区努力推动标准和规范，例如 OAM, KRM Function 规范和 Helm Charts 等。通过统一的 KRM KCL 规范和 KCL Module 提供多种支持方式，可以满足不同规范和标准的需求。</li><li><strong>自动化和集成</strong>：一些部署方式可以通过自动化工具和 CI/CD 管道进行集成，以实现自动化的部署流程。因此，提供多种方式可以满足不同自动化和集成的需求。</li></ul><p>综上所述，支持多种部署方式可以为用户提供更大的灵活性和选择权，用户可以根据自己的需求和偏好来部署应用程序或配置。</p><p>下面是各个部署方式的具体使用方式</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-kubectl-工具">使用 Kubectl 工具<a href="#使用-kubectl-工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><a href="https://kcl-lang.io/blog/2023-11-20-search-k8s-module-on-artifacthub" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/blog/2023-11-20-search-k8s-module-on-artifacthub</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-cicd-工具">使用 CI/CD 工具<a href="#使用-cicd-工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><a href="https://kcl-lang.io/blog/2023-07-31-kcl-github-argocd-gitops" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/blog/2023-07-31-kcl-github-argocd-gitops</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-krm-function">使用 KRM Function<a href="#使用-krm-function" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><a href="https://kcl-lang.io/blog/2023-10-23-cloud-native-supply-chain-krm-kcl-spec" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/blog/2023-10-23-cloud-native-supply-chain-krm-kcl-spec</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用自定义抽象配置工具">使用自定义抽象配置工具<a href="#使用自定义抽象配置工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><a href="https://kcl-lang.io/blog/2023-12-15-kubevela-integration" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/blog/2023-12-15-kubevela-integration</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-kcl-operator">使用 KCL Operator<a href="#使用-kcl-operator" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/mutate-manifests/kcl-operator" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/mutate-manifests/kcl-operator</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用配置管理工具">使用配置管理工具<a href="#使用配置管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><a href="https://github.com/kcl-lang/kcl/issues/952" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/952</a></p>]]></content:encoded>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[KCD 社区会议回顾 | 云原生策略配置语言 KCL]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-18-cloud-native-configuration-language-kcl</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-18-cloud-native-configuration-language-kcl</guid>
            <pubDate>Mon, 18 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KusionStack 负责人李大元和云原生策略配置语言 KCL 项目的 Maintainer 宗喆在 2023 年 CNCF KCD 深圳会议的内容回顾，本文章主要是 KCL 语言部分演讲的内容回顾，活动链接//community.cncf.io/events/details/cncf-kcd-hangzhou-presents-kcd-shenzhen-2023/]]></description>
            <content:encoded><![CDATA[<blockquote><p>KusionStack 负责人李大元和云原生策略配置语言 KCL 项目的 Maintainer 宗喆在 2023 年 CNCF KCD 深圳会议的内容回顾，本文章主要是 KCL 语言部分演讲的内容回顾，活动链接: <a href="https://community.cncf.io/events/details/cncf-kcd-shenzhen-presents-kcd-shenzhen-2023/" target="_blank" rel="noopener noreferrer">https://community.cncf.io/events/details/cncf-kcd-hangzhou-presents-kcd-shenzhen-2023/</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="云原生时代基础设施代码化是开发者体验的核心">云原生时代，基础设施代码化是开发者体验的核心<a href="#云原生时代基础设施代码化是开发者体验的核心" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在当今快速发展的技术世界中，基础设施代码化（IaC）已成为自动化和管理云资源的关键，IaC 也成为了开发者体验的核心部分，带来了便利和效率的同时，但它也带来了一系列挑战。</p><p><img loading="lazy" alt="intro-iac.png" src="/zh-CN/assets/images/intro-iac-db1079efa6f8bfde940c536ee89ee031.png" width="1488" height="834" class="img_ev3q"></p><p>首先，普通的应用开发者需要面对k8s提供的复杂的基础设施和平台概念，这造成了较高的认知负担，影响了更上层应用开发者的软件交付体验。
同时，对于一些不同的动态环境下的配置管理，目前工业界缺少一套成熟标准的管理办法，往往依赖于一线人员的专业素养，采用非标准化的方法比如脚本和胶水代码的方式进行配置管理，会导致项目变得越来越复杂，难于维护并且引入了配置漂移的风险。
因此，我们迫切需要一种能够减轻开发者认知负担、提供高效动态配置管理，并且通过标准的配置测试与验证手段来保证可靠性的配置管理方式，来确保基础设施既的高效与安全。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-云原生策略配置语言">KCL 云原生策略配置语言<a href="#kcl-云原生策略配置语言" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>于是，我们尝试设计了一种新的配置语言 KCL ，通过在语言语法的设计和周边工具的增强来解决上文中提到诸多问题。</p><p><img loading="lazy" alt="intro-kcl.png" src="/zh-CN/assets/images/intro-kcl-7d30de9980c288d9dda280a5ae38bbdc.png" width="1488" height="834" class="img_ev3q"></p><p>KCL 语言针对前面提到的<strong>动态配置管理</strong>， <strong>配置可靠性的验证与测试</strong>和<strong>降低开发者认知负担</strong>的三个方面出发。提出三个主要的设计理念，<strong>Mutation</strong>， <strong>Validation</strong> 和 <strong>Abstraction</strong> ，我们也将这三个设计理念作为了 KCL 核心的 slogan 展示在 KCL 官网的首页。</p><p>围绕着三个设计理念，KCL 在语言语法上做了一些设计：</p><ul><li>要使用 KCL 做动态的配置管理，语言侧就需要提供诸如流程控制，lambda表达式等能够描述程序行为的语法。</li><li>要做配置可靠性相关的验证与测试：就要通过强类型系统，assert，check 等语法，赋予这个语言能够检查配置内容的能力，来支持测试和验证过程。</li><li>降低开发者认知负担和开发成本：KCL 提供了 Schema 模型对数据结构进行抽象，对于开发者来说屏蔽非必要字段，并且通过包管理机制提供丰富的三方库资源，降低开发者直接编写模型的编写成本。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-语言特性">KCL 语言特性<a href="#kcl-语言特性" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>这个提到的一些语言特性的展示，我在 ppt 中列了一些小的能够反映语言特性的代码片段：</p><p><img loading="lazy" alt="kcl-feature.png" src="/zh-CN/assets/images/kcl-feature-8dfe448683fc7881d1f898b6847d7f5c.png" width="1488" height="834" class="img_ev3q"></p><p>首先，最左面的图中展示的是与通用编程语言相近的流程控制，lambda 表达式的，python 风格的循环表达式。然后，中间的图中展示的是针对验证和测试过程提供的 assert 语句，schema 的 check 块，通过check 中的编写的策略可以对 Schema 中的字段进行检查。最后最右面的图是使用 Schema 定义数据结构，并且实例化配置。并且大家可以看到，在这个例子中，也已经展示出 KCL 的强类型系统对于配置类型的校验功能，如果在使用 Schema 实例化配置的过程中，某个字段类型写错了，在编译阶段，就会排查出错误。最后一张图是使用了k8s 的三方库，创建了一个 nginx 的 pod，一些不必要的字段已经被屏蔽掉了，应用开发人员只需要填充少数字段就可以完成配置的编写。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl--krm--动态配置管理">KCL &amp; KRM &amp; 动态配置管理<a href="#kcl--krm--动态配置管理" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>为了解决前面提到的三个问题，KCL 提供了提到的一些动态行为，check，assert语句，类型系统，Schema 抽象等等特性。但是，当我们尝试利用上述特性进行配置管理的时候，我们发现，KCL 的语言特性仅仅作用于 KCL 语言本身是不够的。想要解决 IaC 领域的问题，就必须要考虑到存量配置，将存量配置全部推倒用 KCL 重新很明显不是一个合适的方式，也无法实现。
因此，<strong>对于存量的一些配置，我们除了在语言机制上下功夫之外，还需要具备与社区生态集成的能力，能够将 KCL 语言特性的作用也发挥在其他的配置语言上, 使得 KCL 能够真正的解决 IaC 领域的问题</strong>，在尽可能减少对存量配置的改动下，充分发挥 KCL 语言特性的作用，解决前面提到的动态配置，可靠性校验和降低开发者心智负担的问题。</p><p><img loading="lazy" alt="kcl-krm.png" src="/zh-CN/assets/images/kcl-krm-09bacf4842aa097a4f7f34e2b5846809.png" width="1488" height="834" class="img_ev3q"></p><p>于是，我们提出了 <a href="https://github.com/kcl-lang/krm-kcl" target="_blank" rel="noopener noreferrer">KCL KRM 规范</a>，基于这个规范，我们可以借助 KCL 语言的能力，对 KRM 中的资源进行动态配置，模型校验和抽象。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-生态集成">KCL 生态集成<a href="#kcl-生态集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>基于 KCL &amp; KRM 规范我们开发了一些周边工具来使 KCL 能够更好的与周边工具生态进行集成。</p><p><img loading="lazy" alt="kcl-integration.png" src="/zh-CN/assets/images/kcl-integration-3baeaf75e9ee71364d270a33c945b44a.png" width="1488" height="834" class="img_ev3q"></p><ul><li>数据结构的导入导出：KCL 提供了如 import/export 工具，支持使用 KCL 从 JsonSchema，Terraform 等导入/导出数据结构，以减少在开发过程中对于数据重复建模的过程，使 KCL 的特性能够更加直接的作用于存量配置。</li><li>提供了如 kubectl, kustomize, helm/helmfile 等工具的 KCL 插件，用户可以针对不同的场景选择合适场景的引擎比如 Kubectl, KusionStack, KubeVela 或 Helmfile 等来和 KCL 结合将配置生效到集群。</li><li>开发了 <a href="https://github.com/kcl-lang/kcl-operator" target="_blank" rel="noopener noreferrer">KCL Operator</a> 与Kubernetes 集成，在运行时实现配置自动修改，无需重复开发Kubernetes Webhook 编写大量的配置处理逻辑。</li></ul><p>KCL 建立在一个完全开放的云原生世界当中，KCL 几乎不与任何编排/引擎工具强绑定在一起，可同时为客户端或者运行时提供 API 抽象、组合和校验的能力。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-周边工具">KCL 周边工具<a href="#kcl-周边工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>虽然 KCL 是一个领域语言。KCL 也提供了与通用编程语言语言能力基本等同的的工具链，如格式化，测试、文档、包管理等工具帮助更好地编写、理解和检查编写的配置或策略；通过 VS Code 等 IDE 插件和 Playground 降低配置编写、分享的成本；通过 Rust, Go, 和 Python 多语言 SDK 自动化地管理和执行配置。
对于 IDE 插件，KCL 目前主要提供了 VS Code，IntelliJ 和 NeoVim三种 IDE 插件基于同样的 KCL Language Server 实现了同样的补全、跳转、悬停、代码重构和格式化等能力。</p><p><img loading="lazy" alt="kcl-tools.png" src="/zh-CN/assets/images/kcl-tools-3e634040d9a87055947caf49773be40e.png" width="1488" height="834" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="artifacthub--kcl"><strong>Artifacthub &amp; KCL</strong><a href="#artifacthub--kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>我们与 ArtifactHub 进行了集成，将 Artifacthub 作为 KCL 的模型市场，提供了超过 200 + 的 KCL 模型，涵盖配置编辑，校验和模型抽象等多个方面。大家如果有兴趣的话，可以来看看是否有你感兴趣的模型，或者如果您有好的想法想要与大家分享，您也可以将您的 KCL 包贡献在 ArtifactHub 中。</p><p><img loading="lazy" alt="kcl-ah.png" src="/zh-CN/assets/images/kcl-ah-d46f23bce4a711737384ff8ba3501774.png" width="1488" height="834" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实践案例">实践案例<a href="#实践案例" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>接下来一些简单的案例，展示一些 KCL 的使用过程。</p><p><img loading="lazy" alt="kcl-mut.png" src="/zh-CN/assets/images/kcl-mut-821049e1ebc127e91396e13610a306c3.png" width="1488" height="834" class="img_ev3q"></p><p>首先，如果在集群中安装了 KCL Operator，那么就可以通过左面的配置文件对右面的配置进行 mutation 操作，通过在 source 字段中用 KCL 编写行为代码，动态的为右面的配置文件中增加了 annotation。</p><p><img loading="lazy" alt="kcl-vet.png" src="/zh-CN/assets/images/kcl-vet-4978717671fb07a13b57fef6dd68b9b6.png" width="1488" height="834" class="img_ev3q"></p><p>然后，这个案例中展示了使用 KCL 提供的配置验证工具 kcl-vet 对 terraform plan 生成的配置内容进行验证。</p><p><img loading="lazy" alt="kcl-abs.png" src="/zh-CN/assets/images/kcl-abs-623404b7130148f361e13cd1accb8b21.png" width="1488" height="834" class="img_ev3q"></p><p>最后这个案例中，展示了 abstraction 的内容，可以通过直接编写 KCL 程序，或者使用 KCL &amp; KRM 的方式编写配置，然后编译成对应的 Kubernetes manifests。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 语言是一个专注于云原生配置管理的领域语言，它提供了一系列的语言特性，如强类型系统，Schema 抽象，流程控制，lambda 表达式，assert 语句，check 语句等等，来解决云原生配置管理领域的问题，如动态配置管理，配置可靠性的验证与测试，降低开发者认知负担等等。同时，KCL 也提供了一系列的周边工具，如 IDE 插件，ArtifactHub 集成，KCL Operator 等等，来提升开发者的开发体验，降低开发成本。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://github.com/kcl-lang/" target="_blank" rel="noopener noreferrer">KCL GitHub 仓库</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/KusionStack/" target="_blank" rel="noopener noreferrer">KusionStack GitHub 仓库</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Meeting</category>
        </item>
        <item>
            <title><![CDATA[2023 CNCF KCD 深圳社区会议 KCL & KusionStack 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-18-kcl-kcd-shenzhen-meeting</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-18-kcl-kcd-shenzhen-meeting</guid>
            <pubDate>Mon, 18 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[PDF 下载]]></description>
            <content:encoded><![CDATA[<p><a href="https://kcl-lang.io/talks/kcl-cncf-kcd-shenzhen2023.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p><p><img loading="lazy" alt="Talk Cover" src="/zh-CN/assets/images/talk-cover-43bb207d2e2feea61c1884a6dd39f90c.png" width="2108" height="1188" class="img_ev3q"></p>]]></content:encoded>
            <category>KCL</category>
            <category>Meeting</category>
        </item>
        <item>
            <title><![CDATA[实现高效云原生应用部署运维 - KCL 与 KubeVela 快速集成指南]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-15-kubevela-integration</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-15-kubevela-integration</guid>
            <pubDate>Fri, 15 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[cover]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="cover" src="/zh-CN/assets/images/cover-c640e1eb03f64663e0c2a8902a36a702.png" width="712" height="350" class="img_ev3q"></p><h1>前言</h1><p><a href="https://kubevela.net/" target="_blank" rel="noopener noreferrer">KubeVela</a> 是一个 CNCF 基金会托管的现代的应用交付系统，它基于 Open Application Model（OAM）规范构建，旨在屏蔽 Kubernetes 的复杂性，提供一套简单易用的命令行工具和 APIs，让开发者无需关心底层细节即可部署和运维云原生应用。</p><p><a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的面向云原生场景的配置及策略语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>KCL 建立在一个完全开放的云原生世界当中，不与任何编排/引擎工具或者 Kubernetes 控制器绑定，可以同时为 Kubernetes 客户端和运行时提供 API 抽象、组合和校验的能力。</p><p>用户可以根据场景选择合适的云原生工具比如 Kubectl, Helm, Kustomize, KPT, KusionStack, KubeVela, Helmfile, Crossplane 或 ArgoCD 等来和 KCL 结合将配置生效到集群。</p><p><img loading="lazy" alt="integration" src="/zh-CN/assets/images/integration-c0c6e40b3644da0976464727ec78cfdd.png" width="2606" height="672" class="img_ev3q"></p><p>本篇文章是将 KCL 与 KubeVela 一起使用实现高效云原生应用部署运维的系列文章第一篇，后续我们会分享更多高级用法，尽情期待。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="将-kcl-与-kubevela-一起使用">将 KCL 与 KubeVela 一起使用<a href="#将-kcl-与-kubevela-一起使用" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>将 KCL 与 KubeVela 一起使用具有如下好处:</p><ul><li><strong>更简单的配置</strong>：在客户端层面为 KubeVela OAM 配置提供更强的模版化能力如条件，循环等，减少样板 YAML 书写，同时复用 KCL 模型库和工具链生态，提升配置及策略编写的体验和管理效率。</li><li><strong>更好的可维护性</strong>：通过 KCL 可以提供更有利于版本控制和团队协作的配置文件结构，而不是围绕 YAML 进行配置，同时搭配 KCL 编写的 OAM 应用模型，可以使得应用配置更易于维护和迭代。</li><li><strong>更简化的操作</strong>：结合 KCL 的配置简洁性和 KubeVela 的易用性，可以简化日常的操作任务，比如部署更新、扩展或回滚应用。开发者可以更加专注于应用本身，而不是部署过程中的繁琐细节。</li><li><strong>更好的跨团队协作</strong>：通过 KCL 配置分块编写以及包管理能力与 KubeVela 结合使用，可以定义更清晰的界限，使得不同的团队（如开发、测试和运维团队）可以有条理地协作。每个团队可以专注于其职责范围内的任务，分别交付、分享和复用各自的配置，而不用担心其他方面的细节。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="工作流程">工作流程<a href="#工作流程" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="workflow" src="/zh-CN/assets/images/workflow-65f3b48f48ffc200fd831743c0738a81.png" width="1058" height="340" class="img_ev3q"></p><p>在此示例中，我们使用 KCL Playground 应用为例（这是使用 Go 和 HTML5 编写的应用），同时使用 KCL 定义需要部署的 OAM 配置</p><p>整体工作流程如下</p><ol><li>应用代码开发产出 Docker 镜像</li><li>使用 KCL 编写 OAM 配置</li><li>使用 KubeVela 发布配置</li><li>验证应用运行情况</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="具体步骤">具体步骤<a href="#具体步骤" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-先决条件">0. 先决条件<a href="#0-先决条件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>熟悉 Unix/Linux 的基本命令</li><li>熟悉 Git 使用</li><li>了解 Kubernetes 基本知识</li><li>了解 KubeVela</li><li>了解 KCL 基本知识</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-配置-kubernetes-集群">1. 配置 Kubernetes 集群<a href="#1-配置-kubernetes-集群" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>安装 <a href="https://github.com/k3d-io/k3d" target="_blank" rel="noopener noreferrer">K3d</a> 并创建一个集群</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">k3d cluster create</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：你可以在此方案中使用其他方式创建您自己的 Kubernetes 集群，如 kind, minikube 等。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-安装-kubevela">2. 安装 KubeVela<a href="#2-安装-kubevela" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>安装 KubeVela CLI</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSl https://kubevela.net/script/install.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>安装 KubeVela Core</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vela </span><span class="token function" style="color:#d73a49">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-安装-kcl-并编写配置">3. 安装 KCL 并编写配置<a href="#3-安装-kcl-并编写配置" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>安装 KCL</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://kcl-lang.io/script/install-cli.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> /bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>新建工程并添加 OAM 依赖</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod init kcl-play-svc </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> kcl-play-svc </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kcl mod </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> oam</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在 main.k 中编写如下代码</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> oam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oam</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Application </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl-play-svc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">components </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"webservice"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        properties </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcllang/kcl"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">port </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> expose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cmd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"kcl"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"play"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意，你可以在 ArtifactHub 上查阅到相应的 OAM 模型文档或者直接在 IDE 中查看 <a href="https://artifacthub.io/packages/kcl/kcl-module/oam" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/oam</a> or in the IDE extension.</p></blockquote><p><img loading="lazy" alt="oam-definition-hover" src="/zh-CN/assets/images/oam-definition-hover-bf557b943b8e7abe7c4d13e91d1c48d9.png" width="1048" height="630" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-部署应用并验证">4. 部署应用并验证<a href="#4-部署应用并验证" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>下发配置</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> vela up -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>端口转发</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vela port-forward kcl-play-svc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后我们可以在浏览器中看到 KCL Playground 应用成功运行</p><p><img loading="lazy" alt="kcl-play-svc" src="/zh-CN/assets/images/kcl-play-svc-17cdd017ee58347075be64904d62e73f.png" width="2326" height="858" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结论">结论<a href="#结论" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>通过本篇文章的教程，我们可以使用 KubeVela 和 KCL 等初步部署云原生应用，后续我们将通过更多文章讲解如何在客户端使用 KCL 进一步扩展 KubeVela 的能力</p><ul><li>使用 KCL 的继承、组合和校验手段扩展 OAM 模型，比如根据您的基础设施或者组织基于 OAM 定义更适合的应用抽象模型</li><li>使用 KCL 配置分块编写，条件，逻辑，循环和模块化能力更好地组织 OAM 多环境配置，提升模版化能力，比如将较长的 App Definition 分散到不同的文件进行组织，减少样板配置</li><li>与 KusionStack 和 ArgoCD 等项目进一步集成实现更好的 GitOps</li><li>将更多的云原生能力或 Kubernetes Operator 如 KubeBlocks 和 Crossplane 等实现更好的数据库运维以及统一的云 API 和 Kubernetes API 可编程接入</li><li>其他更多使用场景...</li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>KubeVela</category>
        </item>
        <item>
            <title><![CDATA[KCL 在工程化配置策略场景的探索和落地使用]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-09-engineering-config-policy-with-kcl-meeting</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-09-engineering-config-policy-with-kcl-meeting</guid>
            <pubDate>Sat, 09 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[PDF 下载(中文版)]]></description>
            <content:encoded><![CDATA[<p><a href="https://kcl-lang.io/talks/engineering-config-policy-with-kcl.pdf" target="_blank" rel="noopener noreferrer">PDF 下载(中文版)</a></p>]]></content:encoded>
            <category>KCL</category>
            <category>Meeting</category>
        </item>
        <item>
            <title><![CDATA[KCL 高效语义模型技术揭秘：实现快速编译与增强 IDE 支持]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-09-kcl-new-semantic-model</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-09-kcl-new-semantic-model</guid>
            <pubDate>Sat, 09 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[什么是 KCL 语义模型？]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-kcl-语义模型">什么是 KCL 语义模型？<a href="#什么是-kcl-语义模型" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="image.png" src="/zh-CN/assets/images/01-a4f6cb66bb886db68b7fb33069e7d7bc.png" width="1480" height="1238" class="img_ev3q"></p><ul><li>“语义模型”指的是源代码中出现的模块、函数和类型的内存表示。这种表示是完全“解析”的：所有表达式都有类型（注意，可能存在无法在 KCL 中推导的表达式类型，它们将被定义为 any <strong>类型</strong>），并且所有引用都绑定到声明等。</li><li>客户端可以提交少量的输入数据（通常是对单个文件的更改）并获得新的代码模型来解释更改。</li><li>底层引擎确保模型是<strong>惰性的（按需）和增量</strong>计算的，并且可以针对小的变化快速更新。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么-kcl-需要新的语义模型">为什么 KCL 需要新的语义模型？<a href="#为什么-kcl-需要新的语义模型" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>我们可以先简略地看一下旧语义模型的设计：
<img loading="lazy" alt="image.png" src="/zh-CN/assets/images/02-40975ad67009f082400bce523d31386c.png" width="1216" height="812" class="img_ev3q">
旧语义模型可以简单地看作一个大量作用域的集合，其中不同的作用域内存储了作用域之间的父子节点以及内部包含的符号字符串及对应类型，它可以简单地满足编译器对类型检查和代码生成的需求。但涉及到高级工具链（例如 IDE）这种简单的结构就不足以满足需求了。
举几个典型的 IDE 查询为例：</p><ul><li>对应位置下的 ast 节点的类型是什么？</li><li>所有对当前 ast 节点的引用在哪？（find reference）</li><li>当前 ast 节点引用了哪个节点？（find definition）</li><li>当前位置可访问的所有符号？</li></ul><p>仅利用旧语义模型，这就要求 IDE 多次遍历 AST 以及进行多次重复计算，可以简单地分析一下旧语义模型的问题，我们可以发现：</p><ul><li>旧语义模型信息查询较为困难，仅存储了字符串到符号的映射</li><li>符号之间的关联，符号与作用域之间的关联较弱，导致需要查询相关信息时往往需要遍历所有作用域</li><li>大量的中间信息在分析过程中被丢弃，未进行缓存，导致多次查询进行重复运算</li></ul><p>简而言之，旧语义模型无法满足高级工具链的查询需求，大量信息缺失，另一方面，旧语义模型不支持增量编译，这也降低了工具链的用户体验。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新语义模型的主要思路map-reduce">新语义模型的主要思路：Map Reduce<a href="#新语义模型的主要思路map-reduce" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Map Reduce 架构的想法是将分析分为相对简单的索引阶段和单独的完整分析阶段。
索引的核心约束是它基于每个文件运行，索引器获取单个文件的文本，对其进行解析，并吐出有关该文件的一些数据。索引器无法触及其他文件。
完整分析可以读取其他文件，并利用索引中的信息来节省工作量。
这听起来太抽象了，所以让我们看一个具体的例子——Java。在 Java 中，每个文件都以包声明开头。索引器将包的名称与类名连接起来以获得全限定名。它还收集类中声明的方法集、超类和接口的列表等。
每个文件的数据被合并到一个索引中，该索引将全限定名（FQN）映射到类。索引的更新成本很低，当文件修改请求到达时，索引中该文件的贡献将被删除，文件的文本将被更改，索引器将在新文本上运行并添加新的贡献。要做的工作量与更改的文件数量成正比，并且与文件总数无关。
让我们看看如何使用 FQN 索引来快速提供补全。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// File ./mypackage/Foo.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package mypackage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static Bar f() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new Bar();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// File ./mypackage/Bar.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package mypackage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Bar {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void g() {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// File ./Main.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import mypackage.Foo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Main {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Foo.f().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>用户刚刚输入了 <code>Foo.f().</code>，我们需要弄清楚接收者表达式的类型是 <code>Bar</code>，并建议 <code>g</code> 作为补全。
首先，当文件 <code>Main.java</code> 被修改时，我们在这个单个文件上运行索引器：没有任何变化（文件仍然包含具有静态 <code>main</code> 方法的类 <code>Main</code>），因此我们不需要更新 FQN 索引。
接下来，我们需要解析名称 <code>Foo</code>。我们解析文件 <code>Main.java</code>，注意到了 <code>import mypackage.Foo</code>，并且在 FQN 索引中查找 <code>mypackage.Foo</code> 。在索引当中，我们发现 <code>Foo</code> 有一个静态方法 <code>f</code>, 于是我们也成功解析了调用 <code>f()</code>。索引还存储了 <code>f</code> 的返回类型, 但是请注意，索引中存储的是字符串 <code>"Bar"</code>，而不是对类 <code>Bar</code> 的直接引用。
这样做的原因在于，<code>Foo.java</code> 中的 <code>import java.util.*</code> 会导致 <code>Bar</code> 可以被推测为 <code>java.util.Bar</code> 或 <code>mypackage.Bar</code>, 索引器并不知道具体是哪一个，因为它只能“看到”文件 <code>Foo.java</code> 的文本。换句话说，虽然索引确实存储了方法的返回类型，但它以未解析的形式存储它们。
下一步是在 <code>Foo.java</code> 的上下文中解析标识符 <code>Bar</code>。这会继续使用 FQN 索引，并且定位到类 <code>mypackage.Bar</code>。于是最后的最后，想要的补全：方法 <code>g</code> 就被我们找到了
完成过程中总共只触及了三个文件。FQN 索引使我们能够完全忽略项目中的所有其他文件。
到目前为止所描述的方法的一个问题是从索引解析类型需要大量的工作。例如，如果 <code>Foo.f</code> 被多次调用，这项工作可能会重复。解决办法是添加缓存。名称解析结果会被记忆，因此只需要进行一次解析。任何更改都会导致缓存完全消失——使用索引，重建缓存的成本并不那么高。
总结一下，第一种方法的工作原理如下：</p><ol><li>每个文件都被独立且并行地索引，生成一个“存根”—— 指一组可见的顶级声明，具有未解析的类型。</li><li>所有存根都合并到一个索引数据结构中。</li><li>名称解析和类型推断主要是在存根基础上进行的。</li><li>名称解析是惰性的（我们仅在需要时从存根解析类型）并且是记忆的（每种类型仅解析一次）。</li><li>每次更改时缓存都会完全失效</li><li>索引是增量更新的：<ul><li>如果编辑没有更改文件的存根，则不需要更改索引。</li><li>否则，旧索引将被删除，新索引被重新添加</li></ul></li></ol><p>这种方法足够简单并具有出色的性能。大部分工作主要在索引阶段，而这些工作我们可以并行地执行。此架构的两个示例是 <a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener noreferrer">IntelliJ</a> 和 <a href="https://sorbet.org/" target="_blank" rel="noopener noreferrer">Sorbet</a>。
这种方法的主要缺点是它只有在有效时才有效—— 具体而言，并非每种语言都有明确定义的 FQN 概念。但总的来说，设计好模块和名称解析对于语言来说总是好的，具体到目前的情况上，KCL 正好满足这个条件。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新语义模型-pipeline">新语义模型 Pipeline<a href="#新语义模型-pipeline" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>新语义模型总体 pipeline 如下：
<img loading="lazy" alt="image.png" src="/zh-CN/assets/images/03-c2c78dc8d47dd97ac1ae13c114b6c30d.png" width="954" height="772" class="img_ev3q"></p><p><img loading="lazy" alt="image.png" src="/zh-CN/assets/images/04-f50a1ff5aa06ed172217d6176fafdb14.png" width="960" height="778" class="img_ev3q"></p><p><img loading="lazy" alt="image.png" src="/zh-CN/assets/images/05-1a4d9bc6eb1226873d9264609ddff30b.png" width="1316" height="1296" class="img_ev3q">
相较于原语义模型分析流程，新语义模型新增了 namer 和 advanced_resolve 两轮 pass，从而在不影响原有编译器流程的情况下增强对高级工具链的支持。</p><ul><li><code>resolver</code> 基于文件级别工作，主要涉及 <code>GlobalState</code> 的初始化，把源代码解析为 AST，并建立 AST 节点到类型的映射以供后面的阶段使用，因此，我们可以缓存单个文件索引的输出，以便在文件内容未更改时完全跳过对该文件的解析。</li><li><code>namer</code> 的前期阶段也将基于文件级别工作，该阶段收集文件中定义的全局符号，之后将符号基于 FQN 合并，得到唯一一个 <code>GlobalState</code><ul><li>基于文件级别意味着我们可以很方便地在前两个阶段进行增量编译</li></ul></li><li><code>advanced_resolver</code> 将遍历 AST 解析局部符号并将符号的引用指向它的定义,同时设置局部作用域的 owner 符号，例如 <code>Schema</code> 与 <code>Package</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新语义模型语义数据库globalstate">新语义模型语义数据库：GlobalState<a href="#新语义模型语义数据库globalstate" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>新语义模型的核心结构是 <code>core::GlobalState</code>，工具链主要通过它来完成与编译器的交互及查询。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// GlobalState is used to store semantic information of KCL source code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Default, Debug, Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct GlobalState {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // store all allocated symbols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbols: KCLSymbolData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // store all allocated scopes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scopes: ScopeData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // store package infomation for name mapping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages: PackageDB,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // store semantic information after analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) sema_db: SemanticDB,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>GlobalState</code> 作为新语义模型的语义数据库被使用，是语义分析后的最终产物，主要包含四个方面的信息：</p><ul><li><code>SymbolData</code>：存储 AST 中的所有符号以及它们对应的语义信息，并维护引用关系</li><li><code>ScopeData</code>：存储 AST 中涉及的所有作用域，同时分隔符号，维护符号可见性与作用域嵌套关系</li><li><code>PackageDB</code>: 存储包信息，例如包的文件集合，导入信息等</li><li><code>SemanticDB</code>: 存储辅助信息，加速查询，如符号的排序和位置缓存等</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="symboldata">SymbolData<a href="#symboldata" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><code>SymbolData</code> 负责管理符号的分配，存储分配的符号以及相关的语义信息, 在这里我们借用 rust 的 arena 设计来访问相关符号。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Default, Debug, Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct KCLSymbolData {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) values: Arena&lt;ValueSymbol&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) packages: Arena&lt;PackageSymbol&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) attributes: Arena&lt;AttributeSymbol&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) schemas: Arena&lt;SchemaSymbol&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) type_aliases: Arena&lt;TypeAliasSymbol&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) unresolved: Arena&lt;UnresolvedSymbol&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) rules: Arena&lt;RuleSymbol&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) symbols_info: SymbolDB,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在新语义模型中，我们使用 <code>core::SymbolRef</code> 来表示对一个符号的引用，同时也利用 <code>SymbolRef</code> 来访问 <code>SymbolData</code> 中具体的符号信息。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct SymbolRef {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) id: generational_arena::Index,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) kind: SymbolKind,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体而言，<code>SymbolData</code> 会根据 <code>SymbolRef</code> 的 <code>kind</code>，取出不同类型的 Symbol，并转化为抽象的 <code>trait Symbol</code>。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub type KCLSymbol = dyn Symbol&lt;SymbolData = KCLSymbolData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SemanticInfo = KCLSymbolSemanticInfo&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn get_symbol(&amp;self, id: SymbolRef) -&gt; Option&lt;&amp;KCLSymbol&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match id.get_kind() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SymbolKind::Schema =&gt; self</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .get(id.get_id())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .map(|symbol| symbol as &amp;KCLSymbol),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Symbol {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type SymbolData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type SemanticInfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_sema_info(&amp;self) -&gt; &amp;Self::SemanticInfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn is_global(&amp;self) -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_range(&amp;self) -&gt; Range;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_owner(&amp;self) -&gt; Option&lt;SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_definition(&amp;self) -&gt; Option&lt;SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_name(&amp;self) -&gt; String;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_id(&amp;self) -&gt; Option&lt;SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_attribute(&amp;self, ...) -&gt; Option&lt;SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn has_attribute(&amp;self, ...) -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_all_attributes(&amp;self, ...) -&gt; Vec&lt;SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn simple_dump(&amp;self) -&gt; String;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn full_dump(&amp;self, data: &amp;Self::SymbolData) -&gt; Option&lt;String&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过这个 trait，工具链可以轻松地完成符号语义信息以及引用关系的查询。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scopedata">ScopeData<a href="#scopedata" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><code>ScopeData</code> 的设计思路实际上和 <code>SymbolData</code> 类似，存储了不同类型的 <code>Scope</code> 并使用 <code>ScopeRef</code> 访问。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Default, Debug, Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct ScopeData {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// map pkgpath to root_scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) root_map: IndexMap&lt;String, ScopeRef&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) locals: generational_arena::Arena&lt;LocalSymbolScope&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) roots: generational_arena::Arena&lt;RootSymbolScope&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Scope {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type SymbolData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_filename(&amp;self) -&gt; &amp;str;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_parent(&amp;self) -&gt; Option&lt;ScopeRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_children(&amp;self) -&gt; Vec&lt;ScopeRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn contains_pos(&amp;self, pos: &amp;Position) -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_owner(&amp;self) -&gt; Option&lt;SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn look_up_def(&amp;self, ...) -&gt; Option&lt;SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn get_all_defs(&amp;self, ...) -&gt; HashMap&lt;String, SymbolRef&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn dump(&amp;self, scope_data: &amp;ScopeData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol_data: &amp;Self::SymbolData) -&gt; Option&lt;String&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="semanticdb">SemanticDB<a href="#semanticdb" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><code>SemanticDB</code> 本质上是语义对象部分语义信息的缓存和整合，它的作用主要是用于加速 <code>GlobalState</code> 内部信息的维护以及查询。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Debug, Default, Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct SemanticDB {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) file_sema_map: IndexMap&lt;String, FileSemanticInfo&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Debug, Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct FileSemanticInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) filename: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) symbols: Vec&lt;SymbolRef&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) scopes: Vec&lt;ScopeRef&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) symbol_locs: IndexMap&lt;SymbolRef, CachedLocation&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub(crate) local_scope_locs: IndexMap&lt;ScopeRef, CachedRange&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 新语义模型实质上只做了两件事，一是将工具链在应用层做的重复计算下沉至语义层，并设计对应机制简化信息查询，二是将语义分析过程中丢失的信息重新分析并缓存。
这么做主要有几个目的：</p><ul><li>收拢了计算过程，防止了应用层对编译器语义核心的侵入</li><li>完善了缓存机制，简化了增量编译的实现，从而加速查询速度</li><li>简化应用层工具链的开发，同时减少工具链对 Corner Case 的处理，从而提高可维护性</li></ul><p>从实践上也基本达到了上述目的，迁移后的 LSP 相关功能的代码量约下降 60%，增量编译后编译速度约提升 500%。</p>]]></content:encoded>
            <category>KCL</category>
            <category>Semantic</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 11.24 - 12.07) | 如何在 KCL 中使用不同 Kubernetes 配置合并策略?]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-12-07-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-12-07-biweekly-newsletter</guid>
            <pubDate>Thu, 07 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 11.24 - 12.07) 的杰出工作，以下是重点内容概述</p><p><strong>📦 模型更新</strong></p><p>KCL 模型数量新增至 <strong>240 个</strong>，主要新增与 Crossplane Provider 相关的模型和与 JSON 合并操作相关的库</p><ul><li>KCL JSON Patch 库：<em><a href="https://artifacthub.io/packages/kcl/kcl-module/jsonpatch" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/jsonpatch</a></em></li><li>KCL JSON Merge Patch 库：<em><a href="https://artifacthub.io/packages/kcl/kcl-module/json_merge_patch" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/json_merge_patch</a></em></li><li>KCL Kubernetes Strategy Merge Patch 库：<em><a href="https://artifacthub.io/packages/kcl/kcl-module/strategic_merge_patch" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/strategic_merge_patch</a></em></li><li>KCL Crossplane 及 Crossplane Provider 系列模型：<em><a href="https://artifacthub.io/packages/search?org=kcl&amp;sort=relevance&amp;page=1&amp;ts_query_web=crossplane" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/search?org=kcl&amp;sort=relevance&amp;page=1&amp;ts_query_web=crossplane</a></em></li></ul><p><strong>🔧 工具链更新</strong></p><ul><li><strong>文档工具更新</strong><ul><li>支持模型依赖的三方库的文档生成，比如 <code>k8s</code> 模型</li></ul></li><li><strong>验证工具更新</strong><ul><li>支持验证结果和错误定位到 YAML/JSON 文件，输出错误行列号信息</li></ul></li><li><strong>导入工具更新</strong><ul><li>支持 OpenAPI <code>multiplyOf</code> 规范映射到 KCL <code>multiplyof</code> 函数进行校验</li><li>支持 YAML Stream 格式的 Kubernetes CRD 文件输出为多个 KCL 文件</li><li>优化 KCL 代码生成，去除空的 check 语句</li></ul></li></ul><p><strong>🏄 SDK 更新</strong></p><ul><li>在 KCL 已有 Go 和 Python SDK 的基础上新增 Rust SDK (不需要 LLVM 依赖), 初步包含 KCL 文件编译、校验、测试和格式化代码等 API</li></ul><p><strong>💻 IDE 更新</strong></p><ul><li><strong>体验改进</strong><ul><li>支持增量解析和异步编译功能，提升性能</li></ul></li><li><strong>错误修复</strong><ul><li>修复 assert 语句中字符串插值变量不能跳转的异常</li><li>修复了字符串中异常触发函数补全的异常</li><li>修复 import 语句别名语义检查和补全的异常</li><li>修复了 schema 中 check 表达式补全的异常</li></ul></li></ul><p><strong>📒 文档更新</strong></p><ul><li>KCL 系统库文档添加索引卡片，一键导航: <em><a href="https://kcl-lang.io/docs/reference/model/overview" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/reference/model/overview</a></em></li><li>KCL CLI 参考文档更新: <em><a href="https://kcl-lang.io/docs/tools/cli/kcl/overview" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/tools/cli/kcl/overview</a></em></li><li>KCL API 参考文档更新: <em><a href="https://kcl-lang.io/docs/reference/xlang-api/overview" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/reference/xlang-api/overview</a></em></li><li>KCL 2023 &amp; 2024 Roadmap 文档: <em><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/community/release-policy/roadmap</a></em></li><li>Intellij KCL 仓库补充项目结构介绍和 FAQ: <em><a href="https://github.com/kcl-lang/intellij-kcl/pull/18" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/intellij-kcl/pull/18</a></em></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @professorabhay 支持 KCL 测试 Diff 功能 🙌<ul><li><em><a href="https://github.com/kcl-lang/kcl/issues/940" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/940</a></em></li></ul></li><li>感谢 @patrycju, @Callum Lyall, @Even Solberg, @Matt Gowie, @ShiroDN 在使用 KCL 过程中的交流与宝贵反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="在-kcl-中使用-kubernetes-strategy-merge-patch-更新配置">在 KCL 中使用 Kubernetes Strategy Merge Patch 更新配置<a href="#在-kcl-中使用-kubernetes-strategy-merge-patch-更新配置" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在目前的 KCL 版本中支持使用各种<strong>属性运算符</strong>对配置进行更新和覆盖操作，但是能力还比较原子，无法很好地覆盖云原生常规的配置策略场景，对于 Kubernetes 配置，会频繁地使用到 Kubernetes 原生支持的 Json Merge Patch 和 Strategy Merge Patch 能力，比如使用 <code>kubectl patch</code>, <code>kustomize</code> 和大部分与云原生配置/策略工具开箱支持的 Patch 能力。</p><p>因此，为了避免在 KCL 中处理 Kubernetes 配置时反复使用 KCL 属性运算符编写配置 Patch 的模版代码，我们提供了 Kubernetes Strategy Merge Patch 库用于 Kubernetes 配置更新，并且支持所有 Kubernetes 原生对象定义的合并策略，比如列表对象的覆盖，修改和添加等。下面是使用方式</p><ul><li>新建工程并添加 <code>Strategy Merge Patch</code> 库依赖</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod init </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kcl mod </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> strategic_merge_patch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在 <code>main.k</code> 中编写配置 Patch 代码 (以 <code>Deployment</code> 模版的 <code>labels</code>, <code>replicas</code> 和 <code>container</code> 字段为例)</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> strategic_merge_patch </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">original </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apps/v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-app"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-container-1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-image-1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-container-2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-image-2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">patch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apps/v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-container-1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-new-image-1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-container-3"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-image-3"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">got </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">merge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">original</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> patch</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>运行命令获得输出</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出为</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">original</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">patch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">new</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">got</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">new</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到 <code>Deployment</code> 模版的 <code>labels</code>, <code>replicas</code> 和 <code>container</code> 字段都被更新为了正确的值，更多文档和使用方式请查阅 <em><a href="https://artifacthub.io/packages/kcl/kcl-module/strategic_merge_patch" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/kcl/kcl-module/strategic_merge_patch</a></em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会发布更多 KCL 云原生模型和工具集成文章，敬请期待! 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">KCL v0.8.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.7.0 重磅发布 - 面向云原生场景更完善的生态模型、语言和工具链]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-11-30-kcl-0.7.0-release</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-11-30-kcl-0.7.0-release</guid>
            <pubDate>Thu, 30 Nov 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 <strong>KCL v0.7.0 新版本现在已经可用</strong>！本次发布为大家带来了三方面的重点更新：<strong>语言</strong>、<strong>工具链</strong>、<strong>社区集成 &amp; 扩展支持</strong>。</p><ul><li><em>使用功能更完善错误更少的 KCL 语言、工具链和 IDE 提升代码编写体验和效率</em></li><li><em>全新的 KCL 命令行工具，集成 KCL 包管理，doc, test 周边工具链生态，包罗万象，一键直达</em></li><li><em>丰富的 KCL 三方库市场 artifacthub.io, 提供了超过 200 种 KCL 三方库，尽情挑选，无限可能</em></li></ul><p>进一步您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.7.0" target="_blank" rel="noopener noreferrer">KCL v0.7.0 发布页面</a> 或者 <a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">KCL 官方网站</a> 获得下载安装指南和详细发布信息。</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的面向云原生领域开源的基于约束的记录及函数编程语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于围绕配置的模块化、扩展性和稳定性，打造更简单的逻辑编写体验，构建更简单的自动化和生态集成路径。</p><p>本文重点介绍 KCL v0.7.0 版本的更新内容以及 KCL 社区的近期动态。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="语言更新">语言更新<a href="#语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="️-全新的-kcl-命令行工具">⭐️ 全新的 KCL 命令行工具<a href="#️-全新的-kcl-命令行工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在新版本中提供了全新的 KCL 命令行工具, 目标是将 KCL 周边生态囊括在一起，为您提供统一简明的操作页面，包罗万象，一键直达。</p><p>新的 KCL 命令行工具将会以继续 kcl 作为命令前缀，目前提供包含编译，包管理，格式化工具等多个子命令。</p><p><img loading="lazy" alt="cli-help" src="/zh-CN/assets/images/cli-help-ac296258bd181406f51407cb459d3aed.png" width="1454" height="1266" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-诊断信息的优化">🔧 诊断信息的优化<a href="#-诊断信息的优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 KCL 新版本中，在部分代码错误信息中增加了修复建议，比如变量名称写错或者查找不到 import 的代码包</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> sub </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> s1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The_first_kcl_program </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">The_first_kcl_program</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="did you mean" src="/zh-CN/assets/images/did-you-mean-c2cb0ea05c662fa22633d564216676b5.png" width="1134" height="186" class="img_ev3q"></p><p><img loading="lazy" alt="try-kcl-mod-add" src="/zh-CN/assets/images/try-kcl-mod-add-465bb8082896a1c61c1ec9e698bf9222.png" width="1048" height="284" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-语言编写体验优化">🚀 语言编写体验优化<a href="#-语言编写体验优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="去掉了部分代码块中的缩进检查">去掉了部分代码块中的缩进检查<a href="#去掉了部分代码块中的缩进检查" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在 KCL 新版本中，我们取消了配置代码块的严格缩进检查，如果 KCL 代码写成这样</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema TestIndent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_indent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TestIndent </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"test"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"test"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 kcl fmt 命令会可以一键格式化</p><p><img loading="lazy" alt="kcl-fmt" src="/zh-CN/assets/images/kclfmt-d4f2588cc56651010ca6444150529d55.gif" width="942" height="834" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="函数类型注解">函数类型注解<a href="#函数类型注解" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在 KCL 新版本中，新增了函数类型注解，您可以在新版本的 KCL 中编写如下带有类型注解的 lambda。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">identity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hello"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> identity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Test </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hello"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-api-更新">🏄 API 更新<a href="#-api-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>新增 KCL 单元测试 API: <em><a href="https://github.com/kcl-lang/kcl/pull/904" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/904</a></em></li><li>KCL Schema 模型解析 API 增强版 GetFullSchemaType支持获取带有三方库的 KCL 包相关信息和 Schema 属性默认值 <em><a href="https://github.com/kcl-lang/kcl/pull/906" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/906</a></em></li><li>新增 KCL 符号重命名 API: <em><a href="https://github.com/kcl-lang/kcl/pull/890" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/890</a></em></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-其他更新及错误修复">🐞 其他更新及错误修复<a href="#-其他更新及错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>KCL 命令行工具支持输入文件通配符进行编译 <code>kcl path/to/*.k</code></li><li>修复部分场景字典类型的类型推导错误 <a href="https://github.com/kcl-lang/kcl/pull/900" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/900</a></li><li>修复 Schema 参数的检查 <a href="https://github.com/kcl-lang/kcl/pull/877/files" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/877/files</a></li><li>修复了带有三方库的KCL程序编译缓存失效的问题 <a href="https://github.com/kcl-lang/kcl/pull/841" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/841</a></li><li>错误信息中补全缺失的 lambda 的类型信息 <a href="https://github.com/kcl-lang/kcl/pull/771" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/771</a></li><li>修复了诊断信息中单数和复数的问题 <a href="https://github.com/kcl-lang/kcl/pull/769" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/769</a></li><li>修复了带有类型注解赋值语句中类型检查失效的问题 <a href="https://github.com/kcl-lang/kcl/pull/757" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/757</a></li><li>增加了检查，禁止同名的 import 语句 <a href="https://github.com/kcl-lang/kcl/pull/727" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/727</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ide--工具链更新">IDE &amp; 工具链更新<a href="#ide--工具链更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ide-更新">IDE 更新<a href="#ide-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-ide-插件支持了对符号的引用跳转及重命名功能">KCL IDE 插件支持了对符号的引用跳转及重命名功能<a href="#kcl-ide-插件支持了对符号的引用跳转及重命名功能" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>IDE 增加了对符号的引用跳转支持，使用<code>转到引用</code>或<code>查找所有引用</code>：</p><p><img loading="lazy" alt="find-ref" src="/zh-CN/assets/images/FindRefs-8770a657ab949aae7dd82f9e52fc5090.png" width="1682" height="880" class="img_ev3q"></p><p>对符号进行<code>重命名</code>：</p><p><img loading="lazy" alt="rename" src="/zh-CN/assets/images/Rename-82061ac2cb03a77c542d5a4474797228.gif" width="832" height="513" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ide-支持对引用语句和联合类型的格式化">IDE 支持对引用语句和联合类型的格式化<a href="#ide-支持对引用语句和联合类型的格式化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>优化了引用语句与其他代码块之间的空行行为（格式化为一个空行）和联合类型的空格行为（多个类型之间格式化为以 <code>|</code> 间隔）：</p><p><img loading="lazy" alt="fmt" src="/zh-CN/assets/images/Format-bacf4e759fcb2a5a29f0f219b4dfa8ec.gif" width="590" height="269" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-ide-插件基于新增了大量补全提示">KCL IDE 插件基于新增了大量补全提示<a href="#kcl-ide-插件基于新增了大量补全提示" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>针对<strong>配置定义</strong>这一核心环节，简化用户基于模型编写配置的心智、提升配置编辑的效率。此外，增强了调用内置函数时参数补全。talk is cheap，我们直接来看效果：</p><p><img loading="lazy" alt="func-completion" src="/zh-CN/assets/images/module-function-completion-bee0f3843b5a931de523f25776bbb7a6.gif" width="850" height="401" class="img_ev3q"></p><p><img loading="lazy" alt="conf-completion" src="/zh-CN/assets/images/config-completion-99e49bbda5b33f7ff7fb3ecb54050d82.gif" width="640" height="302" class="img_ev3q"></p><p>而对于<strong>模型设计</strong>环节，也新增了对 docstring 的快速生成，减少手敲 boilerplate：</p><p><img loading="lazy" alt="gen-docstring" src="/zh-CN/assets/images/docstring-gen-882f1ecbd5845a659b1f0623b58ccb13.gif" width="1023" height="728" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="性能提升">性能提升<a href="#性能提升" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>KCL 设计并重构了新的语义模型以及支持最近符号查找和符号语义信息查询 API</li><li>IDE 补全，跳转和悬停等功能实现迁移至新语义模型，显著降低 IDE 功能开发难度和代码量</li><li>KCL 编译器支持语法增量解析以及语义增量检查，大部分场景提升 KCL 编译构建和 IDE 插件使用性能 <strong>5-10 倍</strong></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="其他更新和错误修复">其他更新和错误修复<a href="#其他更新和错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>KCL IntelliJ 插件适配 2023.2+ 版本</li><li>支持对标准库和内置函数的悬停提示，支持对 KCL 代码错误的快速修复</li><li>优化了对引用语句和 union 类型的格式化输出。</li><li>修复了语言服务虚拟文件系统相关的bug：文件维度的变更引发会语言服务崩溃，必须重启 IDE 恢复，现已修复。</li><li>支持包管理工具引入的外部包依赖 import 语句补全</li><li>修复函数参数未定义类型错误显示位置</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试工具更新">测试工具更新<a href="#测试工具更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>担心您的 KCL 程序写错了，要不来测测 ？本次更新提供了全新的 KCL 测试工具，代码好坏，一测便知 ！新的 KCL 测试工具支持使用 KCL 函数编写单元测试并使用工具执行测试。</p><p>您可以在后缀名为 “<!-- -->_<!-- -->test.k” 文件中通过 lambda 表达式来编写您的测试用例。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Convert the `App` model into Kubernetes Deployment and Service Manifests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_kubernetesRender </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">App </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"app"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        containers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ngnix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ngnix"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> port </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deployment_got </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> kubernetesRender</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> deployment_got</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kind </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> deployment_got</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kind </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Service"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 kcl test 命令可以运行这个测试用例并查看测试结果。</p><p>测试通过会将得到如下结果：</p><p><img loading="lazy" alt="test-pass" src="/zh-CN/assets/images/test-pass-6a4552ce41be999dfcc5ce13207545c5.png" width="1138" height="132" class="img_ev3q"></p><p>如果测试失败了，kcl test 会将输出错误信息进行输出。</p><p><img loading="lazy" alt="test-failed" src="/zh-CN/assets/images/test-failed-c371087c0b1b18b877fd3b38fa98ab8f.png" width="1152" height="180" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理工具">KCL 包管理工具<a href="#kcl-包管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>新增 update 命令用于自动更新本地依赖，使用 <code>kcl mod update</code> 将会自动下载本地缺失的三方库。具体参考: <a href="https://github.com/kcl-lang/kpm/pull/212" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/pull/212</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-导入工具发布">KCL 导入工具发布<a href="#kcl-导入工具发布" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>支持从 YAML/JSON/CRD/Terraform Schema 一键生成 KCL 配置/模型，实现自动化迁移。</p><p>如果您有如下 yaml 文件：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.14.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过命令 <code>kcl import test.yaml</code> 您可以将其转换为 KCL 程序。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">This file was generated by the KCL auto-gen tool. DO NOT EDIT.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Editing this file might prove futile when you re-run the KCL auto-gen generate command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apps/v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx-deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selector </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        matchLabels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx:1.14.2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多详细内容请参考<a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/adopt-from-kubernetes" target="_blank" rel="noopener noreferrer">一键从 Kubernetes 生态迁移到 KCL</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区集成--扩展更新">社区集成 &amp; 扩展更新<a href="#社区集成--扩展更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-三方库市场-artifacthub">KCL 三方库市场 ArtifactHub<a href="#kcl-三方库市场-artifacthub" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>通过集成 artifacthub.io 我们构建了一个 KCL 三方库市场，在这里您尽可以大展您的才华，与我们一同分享您对 KCL 程序的独特理解，您也可以尽情挑选，找到适合您自己的 KCL 三方库 ！</p><p>打开首页，直接搜索您需要的关键字，就能看到关于 KCL 三方库的相关内容 ！</p><p><img loading="lazy" alt="artifachub-index" src="/zh-CN/assets/images/artifachub-index-aa5f2faa8ee5f265e3ff0b10531408ff.png" width="1114" height="694" class="img_ev3q"></p><p>在三方库首页，可以查看关于三方库的详细内容和相关文档。</p><p><img loading="lazy" alt="pkg-page" src="/zh-CN/assets/images/pkg-page-7cb869241bab5d297ba22d1aa9b9d3de.png" width="1084" height="694" class="img_ev3q"></p><p>如果您不知道该如何使用这些三方库，右侧的按钮可以为您唤起安装页面。</p><p><img loading="lazy" alt="install-pkg" src="/zh-CN/assets/images/install-pkg-80641923d4cf4b6972f6fb1857846446.png" width="1102" height="664" class="img_ev3q"></p><p>欢迎大家来 artifacthub.io 为 KCL 社区贡献您的三方库，让 KCL 社区变得更加丰富多彩！</p><p>贡献指南：<a href="https://kcl-lang.io/docs/user_docs/guides/package-management/how-to/publish_pkg_to_ah" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/package-management/how-to/publish_pkg_to_ah</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他更新">其他更新<a href="#其他更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>完整更新和错误修复列表详见: <a href="https://github.com/kcl-lang/kcl/compare/v0.6.0...v0.7.0" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/compare/v0.6.0...v0.7.0</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档更新">文档更新<a href="#文档更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 网站新增 KCL v0.7.0 文档内容并支持版本化语义选项，目前支持 v0.4.x, v0.5.x, v0.6.x 和 v0.7.0 版本选择，同时欢迎社区同学进行文档共建。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-正式成为-cncf-沙箱项目">KCL 正式成为 CNCF 沙箱项目<a href="#kcl-正式成为-cncf-沙箱项目" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>🎉 🎉 🎉 2023 年 9 月 20 日，KCL 项目通过了全球顶级开源基金会云原生计算基金会（CNCF）技术监督委员会评定，正式成为 CNCF 沙箱项目。</p><p>更多详情详见: <a href="https://kcl-lang.io/blog/2023-09-19-kcl-joining-cncf-sandbox/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/blog/2023-09-19-kcl-joining-cncf-sandbox/</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>感谢社区的小伙伴在 KCL v0.7.0 版本中的贡献，以下排名不分先后</p><ul><li>感谢 @jakezhu9 对 KCL Import 工具 Terraform Schema 到 KCL Schema 转换的贡献 🙌 <em><a href="https://github.com/kcl-lang/kcl-go/pull/152" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/152</a></em></li><li>感谢 @jakezhu9 对 kpm 集成 Import 工具的贡献 🙌 <em><a href="https://github.com/kcl-lang/kpm/pull/194" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/pull/194</a></em></li><li>感谢 @zwpaper 对 KCL 文档和 Tree Sitter Grammar 做出的贡献 🙌 <em><a href="https://github.com/kcl-lang/tree-sitter-kcl/pull/1" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/tree-sitter-kcl/pull/1</a></em> 等</li><li>感谢 @jakezhu9 对 KCL 语法解析单元测试的改进，将部分测试用例统一迁移到使用 snaptest 框架 🙌 <em><a href="https://github.com/kcl-lang/kcl/pull/794" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/794</a></em> 等</li><li>感谢 @opsnull 对 KCL 官网文档中代码示例的纠错和贡献 🙌 <em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/182" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/182</a></em></li><li>感谢 @prahaladramji 对 KCL IntelliJ 插件格式化功能的纠错和优化 🙌 <em><a href="https://github.com/kcl-lang/intellij-kcl/pull/15" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/intellij-kcl/pull/15</a></em></li><li>感谢 @jakezhu9 对 KCL benchmark 由单线程 Rc 到 Arc 的改进，对 KCL 导入工具中关于引用路径的 bug修复 🙌 <em><a href="https://github.com/kcl-lang/kcl-go/pull/170" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/170</a></em> 等</li><li>感谢 @liangyuanpeng 为 KCL 模型贡献 karmada 模型包，欢迎！🙌 <em><a href="https://github.com/kcl-lang/artifacthub/pull/48/files" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/artifacthub/pull/48/files</a></em></li><li>感谢 @cr7258 对 KCL 模型库以及 KCL 文档的贡献 🙌<ul><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/203" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/203</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/209" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/209</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/210" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/210</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/211" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/211</a></em></li><li><em><a href="https://github.com/kcl-lang/modules/pull/67" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/modules/pull/67</a></em></li></ul></li><li>感谢 @XiaoK29 为 KCL IDE 的悬停和引用查找功能代码架构重构以及 KCL 文档的贡献 🙌<ul><li><em><a href="https://github.com/kcl-lang/kcl/pull/887" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/887</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl/pull/899" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/899</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/205" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/205</a></em></li></ul></li><li>感谢 @MeenuyD, @negz 对 Crossplane KCL Composition Functions 集成的讨论与支持 🙌<ul><li><em><a href="https://github.com/kcl-lang/kcl/issues/885" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/885</a></em></li></ul></li><li>感谢 @kolloch 对 Bazel KCL 构建规则脚本的宝贵反馈 🙌<ul><li><em><a href="https://github.com/kcl-lang/rules_kcl/pull/2" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/rules_kcl/pull/2</a></em></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户和社区小伙伴在此次版本更新过程中提出的宝贵反馈与建议。预计 2024 年 2 月，我们将发布 KCL v0.8.0 版本，更多详情请参考 KCL 2024 路线规划 和 KCL v0.8.0 Milestone，如果您有更多的想法和需求，欢迎在 KCL Github 仓库发起 Issues 或讨论，也欢迎加入我们的社区进行交流 🙌 🙌 🙌</p><p>更多其他资源请参考：</p><ul><li><p>KCL 网站: <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/</a></p></li><li><p>Kusion 网站: <a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">https://kusionstack.io/</a></p></li><li><p>KCL GitHub 仓库: <a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl</a></p></li><li><p>Kusion GitHub 仓库: <a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">https://github.com/KusionStack/kusion</a></p></li><li><p>KCL v0.8.0 Milestone: <a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/milestone/8</a></p></li><li><p>KCL 2024 路线规划: <a href="https://github.com/kcl-lang/kcl/issues/882" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/882</a></p></li><li><p>KCL 社区: <a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p></li></ul>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 11.09 - 11.23) | 云原生模型、语言和工具链更新速递!]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-11-23-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-11-23-biweekly-newsletter</guid>
            <pubDate>Thu, 23 Nov 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 11.09 - 11.23) 的杰出工作，以下是重点内容概述</p><p><strong>📦 模型更新</strong></p><ul><li>KCL 模型数量新增至 <strong>200 个</strong>，主要新增与 <code>Pod</code>, <code>RBAC</code> 相关的校验模型及 Kubernetes 1.14-1.28 版本的模型参考文档</li><li>可以在 <code>Artifact Hub</code> 中搜索浏览到所有模型的文档及使用方式: <em><a href="https://artifacthub.io/packages/search?org=kcl&amp;sort=relevance&amp;page=1" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/search?org=kcl&amp;sort=relevance&amp;page=1</a></em></li></ul><p><strong>💬 语言更新</strong></p><ul><li><strong>体验改进</strong><ul><li>优化配置代码块的语法缩进检查，不再强制报错</li><li>支持通过文件路径通配符作为编译入口</li></ul></li><li><strong>错误修复</strong><ul><li>修复部分场景字典类型的类型推导错误</li><li>修复 Schema 参数数量的检查</li></ul></li></ul><p><strong>🔧 工具链更新</strong></p><ul><li><strong>测试工具发布</strong><ul><li>支持使用 KCL 函数编写单元测试并使用工具执行测试</li><li>支持使用正则表达式过滤待测试用例</li><li>支持单元测试快速失败功能</li></ul></li><li><strong>导入工具更新</strong><ul><li>修复 patterns 到正则匹配表达式的生成: <em><a href="https://github.com/kcl-lang/kcl-openapi/pull/70" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-openapi/pull/70</a></em></li><li>修复 minItems/maxItems 到字段长度校验规则的生成: <em><a href="https://github.com/kcl-lang/kcl-openapi/pull/69" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-openapi/pull/69</a></em></li><li>修复 0 或空字符串为默认值的生成: <em><a href="https://github.com/kcl-lang/kcl-openapi/pull/69" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-openapi/pull/69</a></em></li><li>修复 Kubernetes CRD 到 KCL Package 转换中包名的生成为：<code>${apiVersion}_${kind}</code>: <em><a href="https://github.com/kcl-lang/kcl-openapi/pull/68" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-openapi/pull/68</a></em></li></ul></li><li><strong>包管理工具更新</strong><ul><li>新增 update 命令用于自动更新本地依赖: <em><a href="https://github.com/kcl-lang/kpm/pull/212" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/pull/212</a></em></li></ul></li></ul><p><strong>💻 IDE 更新</strong></p><ul><li><strong>体验改进</strong><ul><li>支持包管理工具引入的外部包依赖 import 语句补全</li></ul></li><li><strong>错误修复</strong><ul><li>修复函数参数未定义类型错误显示位置</li></ul></li></ul><p><strong>🏄 API 更新</strong></p><ul><li>新增 KCL 单元测试 API: <em><a href="https://github.com/kcl-lang/kcl/pull/904" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/904</a></em></li><li>新增 KCL 符号重命名 API: <em><a href="https://github.com/kcl-lang/kcl/pull/890" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/890</a></em></li></ul><p><strong>🔥 架构升级</strong></p><ul><li>KCL 设计并重构了新的语义模型以及支持最近符号查找和符号语义信息查询 API</li><li>IDE 补全，跳转和悬停等功能实现迁移至新语义模型，显著降低 IDE 功能开发难度和代码量</li></ul><p><strong>🚀 性能提升</strong></p><ul><li>KCL 编译器支持语法增量解析以及语义增量检查，大部分场景提升 KCL 编译构建和 IDE 插件使用性能 <strong>5-10 倍</strong></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @cr7258 对 KCL 模型库以及 KCL 文档的贡献 🙌<ul><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/203" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/203</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/209" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/209</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/210" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/210</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/211" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/211</a></em></li><li><em><a href="https://github.com/kcl-lang/modules/pull/67" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/modules/pull/67</a></em></li></ul></li><li>感谢 @XiaoK29 为 KCL IDE 的悬停和引用查找功能代码架构重构以及 KCL 文档的贡献 🙌<ul><li><em><a href="https://github.com/kcl-lang/kcl/pull/887" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/887</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl/pull/899" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/899</a></em></li><li><em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/205" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/205</a></em></li></ul></li><li>感谢 @MeenuyD, @negz 对 Crossplane KCL Composition Functions 集成的讨论与支持 🙌<ul><li><em><a href="https://github.com/kcl-lang/kcl/issues/885" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/885</a></em></li></ul></li><li>感谢 @kolloch 对 Bazel KCL 构建规则脚本的宝贵反馈 🙌<ul><li><em><a href="https://github.com/kcl-lang/rules_kcl/pull/2" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/rules_kcl/pull/2</a></em></li></ul></li><li>感谢 @陆云, @Even Solberg, @Prahalad Ramji @Matt Gowie, @ddh 和 @mouuii 在使用推广 KCL 过程中的交流与宝贵反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="在-artifact-hub-上检索-kcl-代码包及云原生模型">在 Artifact Hub 上检索 KCL 代码包及云原生模型<a href="#在-artifact-hub-上检索-kcl-代码包及云原生模型" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>通过 k8s 模型编写或者校验 Kubernetes 配置</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/k8s-module-912b38ba6f9f47e59a536ba9212fffbf.png" width="2180" height="834" class="img_ev3q"></p><ul><li>通过 Open Application Model (OAM) 开放应用模型配合 KubeVela 控制器进行应用发布与运维</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/oam-module-bc32f420836145889ab5b02afb3a530b.png" width="1964" height="796" class="img_ev3q"></p><ul><li>查找 KCL 代码库如 <code>jsonpatch</code> 进行配置操作</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/jsonpatch-module-2f9f35483b0d57221644c6788f13f1d8.png" width="1998" height="714" class="img_ev3q"></p><ul><li>通过引入 <a href="https://github.com/KusionStack/catalog" target="_blank" rel="noopener noreferrer">KusionStack Modules 模型生态</a>并配合 KusionStack 增强客户端的应用交付体验</li></ul><p>后续我们会通过一系列文章讲解各个模型更具体使用场景以及工作流程，敬请期待! 200+ 模型的源代码位于 <em><a href="https://github.com/kcl-lang/modules" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/modules</a></em>，欢迎社区的小伙伴进行共建。❤️</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。预计 11 月底我们会正式发布 KCL v0.7 新版本，敬请期待! 查看 <em><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a></em> 加入我们。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/7" target="_blank" rel="noopener noreferrer">KCL v0.7.0 Milestone</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/8" target="_blank" rel="noopener noreferrer">KCL v0.8.0 Milestone</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[快来看看，这里有你需要的 Kubernetes 模型！]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-11-20-search-k8s-module-on-artifacthub</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-11-20-search-k8s-module-on-artifacthub</guid>
            <pubDate>Mon, 20 Nov 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在之前的几次更新中，我们为 <a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL 语言</a>增加了包管理的能力，解决了如何获取和发布三方库的问题。随之而来的新问题是，在开发程序的过程中，小伙伴们往往不确定该使用哪个库解决自己的问题。在通过包管理工具使用三方库之前，需要结合具体云原生运维场景的需求和各种三方库的能力去挑选合适的库使用。</p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>因此，我们借助同为 CNCF 的 <a href="https://artifacthub.io/" target="_blank" rel="noopener noreferrer">ArtifactHub</a> 项目构建了一个 KCL 三方库的市场，在这个市场中，有需求的朋友们能够根据自己的需求自由选择自己需要的三方库，有想法愿意分享的朋友们，也可以在这个市场中与大家分享。接下来，我们将通过一个简单的发布应用的案例来近距离感受一下如何在 ArtifactHub&nbsp;上检索 KCL 三方库，并结合库文档的内容进行 KCL 程序开发。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前置工作">前置工作<a href="#前置工作" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>安装环境</p><ul><li>安装&nbsp;KCL&nbsp;<em><a href="https://kcl-lang.io/docs/user_docs/getting-started/install/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/getting-started/install/</a></em></li><li>安装 kubectl&nbsp;<em><a href="https://kubernetes.io/zh-cn/docs/tasks/tools/#kubectl" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/tasks/tools/#kubectl</a></em></li><li>安装 minikube <em><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener noreferrer">https://minikube.sigs.k8s.io/docs/start/</a></em></li></ul><p>使用以下命令启动 minikube</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">minikube start --cache-images</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果您的 minikube 中没有安装 Ingress 控制器，您可以使用如下命令安装：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">minikube addons </span><span class="token builtin class-name">enable</span><span class="token plain"> ingress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="helloworld-案例">HelloWorld 案例<a href="#helloworld-案例" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>首先，我们可以准备一个简单的 js 应用。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"express"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> port </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 定义一个响应 GET 请求的路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"欢迎来到我的Web应用程序！"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 启动服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Web app listening http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>并且为这个应用准备一个镜像，并将镜像上传到镜像中心。</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY package*.json ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY . .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [ "node", "app.js" ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>本文的案例中我们将使用镜像地址 <code>ghcr.io/test/my-web-app:1.0</code> 来展示具体的内容。完成了准备工作，我们就可以使用 KCL 编写对应的发布代码了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-artifacthub搜索您需要的包">使用 ArtifactHub&nbsp;搜索您需要的包<a href="#使用-artifacthub搜索您需要的包" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>首先，我想要将我的 my-web-app 应用发布，我需要借助 <code>k8s</code> 的三方库完成我的工作。直接在 <a href="https://artifacthub.io/" target="_blank" rel="noopener noreferrer">ArtifactHub</a> 中搜索 <code>k8s</code>关键字，可以看到目前提供的 k8s 的三方库。</p><p><img loading="lazy" alt="index-page" src="/zh-CN/assets/images/index-page-5be59bc5c5d26caa4dd532a2ab88e4ab.png" width="1060" height="601" class="img_ev3q"></p><p>在 <code>k8s</code> 模型的主页中，您可以找到关于 <code>k8s</code> 包的文档，不同版本等更加详细的内容。</p><p><img loading="lazy" alt="k8s-page" src="/zh-CN/assets/images/k8s-page-ef5ac237c942bb5b7168b48dcf52b7a7.png" width="1068" height="758" class="img_ev3q"></p><p>右侧的 <code>INSTALL</code> 按钮为您提供了安装 <code>k8s</code> 三方库的方式。</p><p><img loading="lazy" alt="k8s-install-page" src="/zh-CN/assets/images/k8s-install-page-2f6bcea900e6aa1d4927c2a071407d07.png" width="1080" height="613" class="img_ev3q"></p><p>我们这里是使用 <code>k8s</code> 作为包的依赖，因此如下命令进行安装：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl mod init my-kubernetes-config </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> my-kubernetes-config </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kcl mod </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> k8s:1.28</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来，我们需要编写发布应用对应的 <code>deployment</code>, <code>service</code>&nbsp;和 <code>ingress</code>&nbsp;三个部分。这里需要使用到我们刚才添加的 <code>k8s</code> 包中的 <code>Deployment</code>, <code>Service</code>和 <code>Ingress</code> 三个 <code>schema</code>。&nbsp;
更多关于 schema&nbsp;的内容可以查阅: <em><a href="https://kcl-lang.io/docs/next/reference/lang/tour#schema" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/next/reference/lang/tour#schema</a></em></p><p>如果您对这三个内容不太了解，您可以直接在模型的详情页进行搜索。以 <code>Deployment</code> 为例，您可以在文档中看到更加详细的信息。</p><p><img loading="lazy" alt="deployment" src="/zh-CN/assets/images/deployment-4c48cb0322567b7a9bb6fa72add27fe3.png" width="1080" height="490" class="img_ev3q"></p><p>根据文档的内容，我们可以在 <code>main.k</code> 文件中编写如下 <code>deployment</code></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> k8s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">apps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Deployment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app-deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ghcr.io/test/my-web-app:1.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>关于 <code>Service</code>, 可以查到相关文档：</p><p><img loading="lazy" alt="service" src="/zh-CN/assets/images/service-c9a8a508ff5a293adcaa6c222e3de5d4.png" width="1080" height="540" class="img_ev3q"></p><p>对应的 <code>service</code>内容如下：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">import</span><span class="token plain"> k8s.api.core.v1 as s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s.Service </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata.name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app-service"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec.selector </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"app"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec.ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetPort: </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>关于 <code>Ingress</code>, 可以查到相关文档</p><p><img loading="lazy" alt="ingress" src="/zh-CN/assets/images/ingress-033c971c9a89d43c2dab5a2e533acedb.png" width="1080" height="579" class="img_ev3q"></p><p>对应的 <code>ingress</code>内容如下：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> k8s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">networking</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ingress </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app-ingress"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rules </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app.example.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">paths </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    pathType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Prefix"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    backend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app-service"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    backend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后，在 main.k 文件中增加如下内容，将 deployment, service 和 ingress 渲染为 yaml 格式。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">manifests.yaml_stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>您可以使用如下命令编译对应的 KCL 程序，并且 apply。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl run main.k </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>进行到这里，我们已经在 ArtifactHub&nbsp;的帮助下成功发布了应用 my-web-app。</p><p>最后，我们通过 kubectl 端口转发，来看一下发布的效果。使用以下命令进行转发。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward service/web-app-service </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">:80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后通过如下命令或者直接通过浏览器访问 http://localhost:8080 来访问我们发布的应用。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://localhost:8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果您通过 curl 命令行访问，您将会获得输出：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">欢迎来到我的 Web 应用程序！</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果您通过浏览器访问，您将会看到：</p><p><img loading="lazy" alt="browser" src="/zh-CN/assets/images/browser-4607db02d09e9204da6505fdd7b92693.png" width="532" height="184" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>本文通过一个简单的应用发布，为大家展示了如何在 ArtifactHub&nbsp;上选择合适的 KCL 三方库，目前 ArtifactHub&nbsp;上已经提供超过 150 个 KCL 三方库供大家选择，快来看看有没有你需要的 KCL 模型吧 ！</p><p>在本文提供的案例中，我们用 KCL 编写了发布应用的程序。在后续的更新中，我们将进一步通过动态参数等特性对本文中的 KCL 程序进行抽象以及使用更多的应用模型介绍如 Open Application Model (OAM) 等，并且打包成一个单独的模块发布到&nbsp;ArtifactHub&nbsp;中，如果您也有想要与他人分享的 KCL 模块，我们将继续更新详细的步骤和指南，帮助您成功发布您的包。敬请期待！</p>]]></content:encoded>
            <category>KCL</category>
            <category>Kubernetes</category>
            <category>Modules</category>
            <category>ArtifactHub</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 10.26 - 11.08) | 超多 IDE 体验提升和开箱即用的模型]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-11-08-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-11-08-biweekly-newsletter</guid>
            <pubDate>Wed, 08 Nov 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 10.26 - 11.08) 的杰出工作，以下是重点合并内容概述</p><p><strong>🔧 语言及工具链更新</strong></p><ul><li>KCL IDE 更新 - 更智能的配置值补全、属性列表补全、函数参数补全、内置包引用补全和 docstring 补全等</li><li>KCL 包管理工具 KPM 更新 - 更流畅的创建、发布 KCL 包的工作流：支持基于版本系统的包更新和发布的自动化流程；此外，现已允许对KCL包的元信息自定义配置</li><li>KCL 模型更新 - 开箱即用的 KCL 模型新增至 120+</li><li>KCL 语言更新 - 优化了 schema 字段类型不匹配的报错信息，支持 lambda 类型注解，以及个别编译问题修复；系统库支持对 JSON/YAML 字符串的验证、序列化和反序列化</li><li>KCL 导入工具发布：支持从 YAML/JSON/CRD/Terraform Schema 一键生成 KCL 配置/模型，实现自动化迁移</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @jakezhu9 对 KCL benchmark 由单线程 Rc 到 Arc 的改进，对 KCL 导入工具中关于引用路径的 bug修复 🙌 <em><a href="https://github.com/kcl-lang/kcl-go/pull/170" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/170</a></em> 等</li><li>感谢 @liangyuanpeng 为 KCL 模型贡献 karmada 模型包，欢迎！🙌 <em><a href="https://github.com/kcl-lang/artifacthub/pull/48/files" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/artifacthub/pull/48/files</a></em></li><li>此外，感谢 @Matt Gowie, @ddh 对 KCL 的关注和宝贵反馈 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-ide-插件更新">KCL IDE 插件更新<a href="#kcl-ide-插件更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL IDE 插件基于新增了大量补全提示，重点针对<strong>配置定义</strong>这一核心环节，简化用户基于模型编写配置的心智、提升配置编辑的效率。此外，增强了调用内置函数时参数补全。talk is cheap，我们直接来看效果：</p><p><img loading="lazy" src="/zh-CN/assets/images/module-function-completion-bee0f3843b5a931de523f25776bbb7a6.gif" width="850" height="401" class="img_ev3q"></p><p><img loading="lazy" src="/zh-CN/assets/images/config-completion-99e49bbda5b33f7ff7fb3ecb54050d82.gif" width="640" height="302" class="img_ev3q"></p><p>而对于<strong>模型设计</strong>环节，也新增了对 docstring 的快速生成，减少手敲 boilerplate：</p><p><img loading="lazy" src="/zh-CN/assets/images/docstring-gen-882f1ecbd5845a659b1f0623b58ccb13.gif" width="1023" height="728" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理工具">KCL 包管理工具<a href="#kcl-包管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>包管理工具现已串联起 KCL 包创建-更新-代码审查-发布的核心工作流，并基于此新增开箱即用的 KCL 模型包至 120+，用户可参照<a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/publish-modules/" target="_blank" rel="noopener noreferrer">编写并发布 Kubernetes KCL 代码包</a> 即刻使用。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-语言更新">KCL 语言更新<a href="#kcl-语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 的编译命令对错误信息的输出优化继续推进，致力于提供清晰易懂的指引，帮助开发者快速定位和修复问题，编写出正确的代码。近期，KCL 优化了 schema 字段类型不匹配的报错信息：</p><ul><li><p>before:
<img loading="lazy" src="/zh-CN/assets/images/schema-expr-type-error-before-fbb3b4d4a2222f4cb1418a1075f2582f.png" width="1080" height="185" class="img_ev3q"></p></li><li><p>after:
<img loading="lazy" src="/zh-CN/assets/images/schema-expr-type-error-after-5c78dffcaec4e93ed2770080dd198e64.png" width="1080" height="320" class="img_ev3q"></p></li></ul><p>此外，还支持了 <code>-—recursive</code> 选项允许 kcl 递归编译子目录，支持在 lambda 表达式中添加类型注解，系统库支持了对 JSON/YAML 字符串的验证、序列化和反序列化；修复了带有三方库的 KCL 程序缓存失效的问题；修复了编译入库文件跨 kcl.mod 情况下的路径冲突错误；修复 KCL 函数默认值语义检查错误等。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-导入工具">KCL 导入工具<a href="#kcl-导入工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>支持从 YAML/JSON/CRD/Terraform Schema 一键生成 KCL 配置/模型，实现自动化迁移，相关指南请参照<a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/adopt-from-kubernetes" target="_blank" rel="noopener noreferrer">一键从 Kubernetes 生态迁移到 KCL</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。预计 11 月底我们会正式发布 KCL v0.7 新版本，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p></li><li><p><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></p></li><li><p><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/milestone/7" target="_blank" rel="noopener noreferrer">KCL v0.7.0 Milestone</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></p></li><li><p><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></p></li><li><p><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 10.12 - 10.25) | IDE 插件支持引用查找、包管理集成 ArtifactHub]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-10-25-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-10-25-biweekly-newsletter</guid>
            <pubDate>Wed, 25 Oct 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个 CNCF 基金会托管的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个 CNCF 基金会托管的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 10.12 - 10.25) 的杰出工作，以下是重点合并内容概述</p><p><strong>🔧 语言及工具链更新</strong></p><ul><li>KCL IDE 更新 - 支持对符号的引用跳转和重命名；优化了引用语句和 union 类型的格式化输出；修复了文件变更引发语言服务崩溃的问题</li><li>KCL 包管理工具 KPM 更新 - kpm 正在集成 AritifactHub，支持将 KCL 包发布到 ArtifactHub</li><li>KCL 语言更新 - 优化了方法的参数类型不匹配等报错信息，明确指出了不匹配的类型</li><li>KCL 命令行统一界面 - 重新设计了 KCL 相关工具的命令行统一界面和工作流，进入实现阶段</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @jakezhu9 对 KCL 语法解析单元测试的改进，将部分测试用例统一迁移到使用 snaptest 框架 🙌 <em><a href="https://github.com/kcl-lang/kcl/pull/794" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/pull/794</a></em> 等</li><li>感谢 @opsnull 对 KCL 官网文档中代码示例的纠错和贡献 🙌 <em><a href="https://github.com/kcl-lang/kcl-lang.io/pull/182" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-lang.io/pull/182</a></em></li><li>感谢 @prahaladramji 对 KCL IntelliJ 插件格式化功能的纠错和优化 🙌 <em><a href="https://github.com/kcl-lang/intellij-kcl/pull/15" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/intellij-kcl/pull/15</a></em></li><li>感谢 @steeling, @prahaladramji, @liangyuanpen, @Kory Taborn 等在使用 KCL 及工具链过程中提出的宝贵反馈和讨论 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-ide-插件更新">KCL IDE 插件更新<a href="#kcl-ide-插件更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在待发布的版本中，KCL IDE 插件支持了对符号的引用跳转及重命名功能；优化了对引用语句和union类型的格式化输出。同时修复了语言服务虚拟文件系统相关的bug：文件维度的变更引发会语言服务崩溃，必须重启 IDE 恢复，现已修复。</p><p>使用<code>转到引用</code>或<code>查找所有引用</code>：
<img loading="lazy" src="/zh-CN/assets/images/FindRefs-8770a657ab949aae7dd82f9e52fc5090.png" width="1682" height="880" class="img_ev3q"></p><p>对符号进行<code>重命名</code>：
<img loading="lazy" src="/zh-CN/assets/images/Rename-82061ac2cb03a77c542d5a4474797228.gif" width="832" height="513" class="img_ev3q"></p><p>对引用语句和 union 类型的格式化：优化了引用语句与其他代码块之间的空行行为（格式化为一个空行）、union 类型的空格行为（多个类型之间格式化为以 <code>|</code> 间隔）：
<img loading="lazy" src="/zh-CN/assets/images/Format-bacf4e759fcb2a5a29f0f219b4dfa8ec.gif" width="590" height="269" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理工具">KCL 包管理工具<a href="#kcl-包管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在待发布的版本中，kpm 支持与 <a href="https://artifacthub.io/" target="_blank" rel="noopener noreferrer">ArtifactHub</a> 的集成，您可以通过向<a href="https://github.com/kcl-lang/artifacthub" target="_blank" rel="noopener noreferrer">kcl-lang Registry 仓库</a> 提交 PR 的方式将您的 KCL 包发布到 ArtifactHub. 目前我们可以在 <a href="https://staging.artifacthub.io/packages/search?ts_query_web=kcl&amp;sort=relevance&amp;page=1" target="_blank" rel="noopener noreferrer">ArtifactHub staging 页面</a>看到预上传的 KCL k8s 包的效果，该功能将在 v0.6.1 版本发布：</p><p><img loading="lazy" src="/zh-CN/assets/images/artifacthubStaging-ae8bdb088c72f1d8828d074553c283fe.png" width="2204" height="1536" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-语言更新">KCL 语言更新<a href="#kcl-语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 的编译命令正在持续地优化错误信息的输出，致力于提供清晰易懂的指引，帮助开发者快速定位和修复问题，编写出正确的代码。近期，KCL 对方法类型和参数方面的错误信息进行了优化，例如：明确指出了方法的参数类型不匹配的报错：</p><p><img loading="lazy" src="/zh-CN/assets/images/error-msg-b9f86d8cb2dc9273d4a6ab951c562c96.png" width="1254" height="968" class="img_ev3q"></p><p>此外，还修复了属性赋值的惰性求值问题，将属性赋值的计算和约束校验延迟到配置合并完成后，避免不必要的编译报错。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-命令行统一界面">KCL 命令行统一界面<a href="#kcl-命令行统一界面" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>为向 KCL 用户提供一致和标准化的体验，我们正在对 KCL 的命令行界面进行设计改进，以达到统一的用户工作流、相关工具和多语言 API 的无缝集成、命令行工具的可扩展性。目前完成了初步设计进入实现阶段，欢迎感兴趣的小伙伴一起讨论：<a href="https://github.com/kcl-lang/kcl/issues/756" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/756</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>随着加入 CNCF sandbox，CNCF KCL Slack 频道已经开通，与 KCL 语言相关的交流将逐步迁移到新的频道，欢迎大家加入交流：</p><ol><li>加入 CNCF 工作空间，填写个人邮箱即可: <a href="https://communityinviter.com/apps/cloud-native/cncf" target="_blank" rel="noopener noreferrer">https://communityinviter.com/apps/cloud-native/cncf</a></li><li>加入 CNCF KCL 频道: <a href="https://cloud-native.slack.com/archives/C05TC96NWN8" target="_blank" rel="noopener noreferrer">https://cloud-native.slack.com/archives/C05TC96NWN8</a></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。预计 11 月底我们会正式发布 KCL v0.7 新版本，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p></li><li><p><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></p></li><li><p><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/milestone/7" target="_blank" rel="noopener noreferrer">KCL v0.7.0 Milestone</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></p></li><li><p><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></p></li><li><p><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCD 社区会议回顾 | 基于云原生供应链的配置策略管理新范式 - KRM KCL 规范]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-10-23-cloud-native-supply-chain-krm-kcl-spec</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-10-23-cloud-native-supply-chain-krm-kcl-spec</guid>
            <pubDate>Mon, 23 Oct 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[本篇文章是 2023 年 CNCF KCD 杭州会议 KCL 演讲部分内容回顾，活动链接//community.cncf.io/events/details/cncf-kcd-hangzhou-presents-kcd-hangzhou-2023/]]></description>
            <content:encoded><![CDATA[<blockquote><p>本篇文章是 2023 年 CNCF KCD 杭州会议 KCL 演讲部分内容回顾，活动链接: <a href="https://community.cncf.io/events/details/cncf-kcd-hangzhou-presents-kcd-hangzhou-2023/" target="_blank" rel="noopener noreferrer">https://community.cncf.io/events/details/cncf-kcd-hangzhou-presents-kcd-hangzhou-2023/</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="背景">背景<a href="#背景" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><blockquote><p>随着云原生技术的发展，我们更多地转向云基础设施，Kubernetes 和 Terraform 等基础设施即代码 (IaC) 工具已成为越来越流行的管理和部署基于云 API 的应用程序的工具。但是随之而来衍生出的复杂性问题和认知负担问题在近几年达到了高峰。</p></blockquote><p><img loading="lazy" alt="cognitive-loading" src="/zh-CN/assets/images/cognitive-loading-618f5d417a2cbef1c7e8b0c0396f4d1d.png" width="2064" height="1200" class="img_ev3q"></p><p>对于 Kubernetes，作为使用最广泛的容器编排系统，Gartner 预测，到 2022 年，全球超过 75% 的组织将在生产中运行容器化应用程序。如今，容器管理市场估计约为 3 亿美元，预计到 2025 年将突破 10 亿美元，并且 Kubernetes 正稳步走出麻烦的低谷，走向成熟和更广泛的采用<sup>[1]</sup>。</p><p>对于 Terraform，作为使用最广泛的 IaC 工具，截止本文撰写时，Terraform VS Code 插件安装量有 3.2M 左右，相当于 Go VS Code 插件安装量的三分之一 (10M 左右)，甚至超过很多通用编程语言的安装量，比如 Rust VS Code 插件在 2.3M 左右, 并且 HCL 是 GitHub 2022 年度增长最快的编程语言，超过了其他所有通用编程语言和领域编程语言，形成了广泛的研发者生态<sup>[2]</sup>。</p><p>由此可以看出，Kubernetes 和 Terraform 正在成为云原生领域中不可或缺的基础设施项目并且在未来几年将会持续增长，虽然它们两者的项目性质并不完全相同，但是殊途同归，它们正在变得越来越复杂。</p><p><img loading="lazy" alt="issues" src="/zh-CN/assets/images/issues-7a98051ab7155088ba8dba3d5701562a.png" width="2474" height="1064" class="img_ev3q"></p><p>Kubernetes 和 Terraform 背后所代表的云 API 越来越复杂的原因主要有以下几点<sup>[3]</sup><sup>[4]</sup><sup>[5]</sup>：</p><ul><li><strong>不断增加的功能和能力</strong>：Kubernetes 和云 API 都是为了应对不断增长的应用需求和云计算的发展而不断演进。为了满足用户的需求，它们不断引入新的功能和能力，如自动扩展、服务发现、负载均衡、权限管理等。这些新功能的引入增加了系统的复杂性。虽然我们已经有了各式各样的自动化手段，随着时间的推移，因为不同资源类型的数量、这些资源类型的潜在设置数量以及这些资源类型之间的复杂关系呈指数级增长。</li><li><strong>复杂的配置和管理需求</strong>：随着应用规模的增长，配置和管理 Kubernetes 和云 API 变得越来越复杂。例如，需要管理大量的容器实例和资源、配置复杂的网络和存储、实现高可用性和负载均衡，需要针对不同的环境和拓扑重复地进行配置等。这些复杂的配置和管理需求增加了 Kubernetes 和云 API 的复杂性，开玩笑的说甚至在 Kubernetes 领域常常伴随催生了一批 YAML 工程师或标记语言人肉编辑工程师。</li></ul><p>对于云 API, 我们借助 Terraform 等 IaC 工具可以获得大量的已经编写好的 Module 配置和 Provider 等，但是对于 Kubernetes 仍然缺乏客户端的轻量级的配置组合和抽象解决方案，现有的方案或者规范难以在抽象能力和扩展性获得平衡，甚至对于一些极端场景，开发者往往编写许多胶水代码和脚本对配置进行处理逻辑，稳定性和效率都受到一定桎梏。</p><p>于是我们思考需要有一个统一规范描述来同时承载配置语言能力，并且可以尽可能无副作用地同时满足云原生供应链和规模化配置等场景下的稳定性、扩展性和效率等特性，减轻基础设施对开发人员的认知负担，提高配置管理效率。</p><p>因此，我们提出了 KCL 项目以及 KRM KCL 规范期望通过更现代化的声明式配置语言和工具，在轻量级客户端云原生动态配置领域填补配置语言及工具的空白并解决如下问题：</p><ul><li><strong>维度爆炸</strong>: 大多数静态配置如云原生领域的 Kubernetes YAML 配置需要为每个环境单独进行配置；在最糟糕的情况下，它可能引入涉及环境交叉链接的难以调试的错误，稳定性和扩展性都较差。</li><li><strong>配置漂移</strong>: 对于不同环境的静态管理应用程序和基础设施配置的方式，往往没有标准的方式去管理这些动态的不同环境的配置，采用非标准化的方法比如脚本和胶水代码的拼盘，会导致复杂度呈指数增长，并导致配置漂移。</li><li><strong>认知负担</strong>: Kubernetes 等作为构建平台的平台技术手段在底层统一基础架构细节方面出色，但是缺乏更上层的应用软件交付抽象，对于普通开发者认知负担较高，影响了更上层应用开发者的软件交付体验。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a href="#概念" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="kcl-intro" src="/zh-CN/assets/images/kcl-intro-4ed4ff272fd5928fe67b529267316451.png" width="2310" height="1166" class="img_ev3q"></p><p>KCL 是一款面向云原生领域的专用配置策略语言，2022 年 6 月 开源，2023 年 9 月成为 CNCF 基金会托管的 Sandbox 项目，致力于改进编写云原生配置策略和 Kubernetes API 层可编程性编写的用户体验。KCL 项目目前位于 CNCF 基金会全景图 Automation &amp; Configuration Landscape 中，KCL 中的 C 是 Configuration 的缩写，L 是 Language 的缩写，K 取自 Kubernetes 的首字母 K <sup>[6]</sup>。</p><p>与通用编程语言不同，KCL 作为一款领域特定的编程语言，是以收敛有限的语法、语义集合解决近乎无限变化的业务场景和复杂性 (比如仅 Kubernetes 领域中就有成千上万种资源以及社区中多到数不清且碎片化的 Operator 生态)，将复杂配置和策略编写思路和方式沉淀到语言特性中，避免使用通用语言等配置带来安全隐患等副作用。</p><p>作为一种配置语言，KCL 为应用程序和平台开发人员/SRE 提供的最重要的功能是动态配置管理。通过代码抽象，我们可以构建以应用为中心的模型屏蔽复杂的基础设施和平台概念，为开发人员提供一个以应用程序为中心且易于理解的界面。此外，KCL 还允许平台人员快速扩展和定义自己的模型，并且提供丰富的可管理能力包括开箱即用的 KCL 代码库、语义版本化管理、OCI Registry，语言工具链和自动化支持。</p><p>此外，KCL 建立在一个完全开放的云原生世界当中，几乎不与任何编排/引擎工具或者 Kubernetes 控制器绑定，在云原生供应链场景和规模化运维场景中，可同时为客户端和运行时提供 API 抽象、组合和校验的能力，用户可以选择合适场景的引擎比如 Kubectl<sup>[7]</sup>, KusionStack<sup>[8]</sup>, KubeVela<sup>[9]</sup> 或 Helmfile<sup>[10]</sup> 等来和 KCL 结合将配置生效到集群。</p><p><img loading="lazy" alt="kcl-concept" src="/zh-CN/assets/images/kcl-concept-ac32b491a34b905a5d04fdf4e2748cd0.png" width="2352" height="1190" class="img_ev3q"></p><p>此外，KCL 语言本身是一种现代化的高级领域编程语言，它是一种编译静态的强类型语言。KCL 为开发人员提供了通过记录和函数语言设计将<strong>配置（config）</strong>、<strong>建模抽象（schema）</strong>、<strong>逻辑（lambda）</strong>和<strong>策略（rule）</strong>作为核心能力。</p><p>KCL 试图提供独立于运行时的可编程性，不在本地提供线程和 IO 等系统功能，并试图为解决领域问题并提供稳定、安全、低噪声、低副作用、高性能、易于自动化和易于管理的编程支持。</p><p><img loading="lazy" alt="krm-kcl" src="/zh-CN/assets/images/krm-kcl-6342250ce5edccc7fd140b03bbf145e6.png" width="2354" height="1144" class="img_ev3q"></p><p>KRM KCL 规范是基于 Kubernetes Resource Model（KRM）的一种配置规范。KRM 是一个通用的配置模型，用于描述和管理各种云原生资源，如容器、Pod、服务等。KRM 提供了一种统一的方式来定义和管理这些资源，使得它们可以在不同的环境中进行移植和复用<sup>[11]</sup>。</p><p>KRM 规范作为 Kubernetes 官方的规范之一，其核心概念是 KRM 函数，KRM 函数的输入是一系列 Kubernetes 资源以及 KRM 函数的配置，输出也是一系列 Kubernetes 资源加上函数运行的结果比如报错、调试信息等。而 KRM KCL 是将 KRM Function 使用 KCL 代码实现，并在其基础上扩展了多种代码源支持比如 OCI Registry, Git 和 Https 等。</p><p>在 KRM KCL 规范中，我们将 KCL 配置模型的行为主要分成三类</p><ul><li><strong>Mutation</strong>: 输入 KCL 参数 <code>params</code> 和 KRM 列表并输出修改后 KRM 列表。</li><li><strong>Validation</strong>: 输入 KCL 参数 <code>params</code> 和 KRM 列表并输出 KRM 列表和资源验证结果。</li><li><strong>Abstraction</strong>: 输入 KCL 参数 <code>params</code> 并输出 KRM 列表。</li></ul><p>我们可以使用 KCL 以可编程的方式实现如下能力:</p><ul><li>使用 KCL 对资源进行修改，如根据某个条件添加/修改 label 标签或 annotation 注释或在包含 PodTemplate 的所有 Kubernetes Resource Model (KRM) 资源中注入 Sidecar 容器配置等。</li><li>使用 KCL Schema 验证所有 KRM 资源，如约束只能以 Root 方式启动容器等。</li><li>使用抽象模型生成 KRM 资源或者对不同的 Kubernetes API 进行抽象/组合并使用，比如使用 <code>web-service</code> 模型实例化一个 Web 应用配置。</li></ul><p>我们可以借助 KCL IDE 和 KCL 包管理工具编写模型并上传到 OCI Registry 以实现模型复用，对 KRM KCL 规范进行可编程扩展支持，并且这些模型可以根据场景需求分别用在客户端或者运行时。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="用户体验">用户体验<a href="#用户体验" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>针对上述提到到领域中的问题以及 KCL 相关概念，我们主要为用户提供了三方面的支持：语言、工具链、云原生集成。</p><p><img loading="lazy" alt="workspace" src="/zh-CN/assets/images/workspace-4b43fe7e7bdf1bebdbdde2e63f01ea9a.png" width="1974" height="1164" class="img_ev3q"></p><p>虽然 KCL 是一个领域语言，但是麻雀虽小，五脏俱全。KCL 提供了与通用语言能力基本等同的的工具链如格式化，测试、文档、包管理等工具帮助更好地编写、理解和检查编写的配置或策略；通过 VS Code 等 IDE 插件和 Playground 降低配置编写、分享的成本；通过 Rust, Go, 和 Python 多语言 SDK 自动化地管理和执行配置。</p><p><img loading="lazy" alt="ide" src="/zh-CN/assets/images/ide-5fe2523decb4b8e9e2a2f5843dd7efee.png" width="2432" height="1190" class="img_ev3q"></p><p>对于 IDE 插件，KCL 目前主要提供了 VS Code，IntelliJ 和 NeoVim 三种 IDE 插件基于同样的 KCL Language Server 实现了同样的补全、跳转、悬停、代码重构和格式化等能力<sup>[12]</sup>。</p><p><img loading="lazy" alt="integration" src="/zh-CN/assets/images/integration-64afd19bc906c3502da1088cb1d9da03.png" width="2512" height="1196" class="img_ev3q"></p><p>作为 CNCF 的项目，KCL 还与 CNCF 其他众多生态项目进行了集成，比如为现有的 CNCF 生态配置管理工具项目如 Kubectl, Helm、Kustomize、kpt、helmfile 等提供 KCL 插件，在运行时提供 KCL Kubernetes Operator，以满足不同场景的配置管理需求等。此外我们还提供如下集成支持：</p><ul><li><strong>多语言支持</strong>：我们提供了多语言 SDK，帮助用户以不同的语言操作 KCL，并将其集成到自己的应用程序中。</li><li><strong>包管理支持</strong>：我们提供了 KCL 包管理工具可以将配置和策略代码通过 Harbor, Docker Hub, GitHub Packages 等标准的 OCI 供应链方式进行分发和复用。</li><li><strong>Schema 和数据迁移支持</strong>：我们支持其他生态系统的 Schema 和数据一键迁移到 KCL Schema，如 Go/Rust 结构定义、JsonSchema、Protobuf、OpenAPI、Terraform Provider Schema、JSON 和 YAML 等。</li></ul><p><img loading="lazy" alt="artifact-hub" src="/zh-CN/assets/images/artifact-hub-e25e5aa9b3e59e2b6ad2674084a0f15f.png" width="1806" height="1250" class="img_ev3q"></p><p><img loading="lazy" alt="artifact-hub-k8s" src="/zh-CN/assets/images/artifact-hub-k8s-6ec143b33c6a33b239efa57bfa5cdffe.png" width="1080" height="753" class="img_ev3q"></p><p>此外，KCL 还支持与 ArtifactHub 的集成，您可以通过向 <code>kcl-lang/artifacthub</code> 仓库提交 PR 的方式将您的 KCL 包发布到 ArtifactHub，然后可以在 ArtifactHub 页面看到上传的 KCL 包的效果比如 k8s 包<sup>[13]</sup>。</p><p><img loading="lazy" alt="registry" src="/zh-CN/assets/images/registry-c2090b6bd1dd474fec06e54a41c4f806.png" width="2314" height="1216" class="img_ev3q"></p><p>在此基础上，KCL 提供了许多开箱即用的云原生模型主要涵盖 Kubernetes 和 Terraform 模型，可以通过一行 KCL 命令添加相应的配置模型依赖或者查看 KCL 源代码。</p><p><img loading="lazy" alt="performance" src="/zh-CN/assets/images/performance-a8764d525c4656280132e1c7c175ea75.png" width="1992" height="1070" class="img_ev3q"></p><p>除了与用户直接相关的语言、工具链和云原生集成的外表工作，我们还在 KCL 的稳定性、性能等内在方面做了许多工作。在代码规模较大或者计算量较高的场景情况下 KCL 比 CUE/Jsonnet/HCL 等语言性能更好，且由于 KCL 的渐进式静态类型系统、不可变性、Schema、校验规则等特性，能够进一步保障配置的稳定性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实践">实践<a href="#实践" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes">Kubernetes<a href="#kubernetes" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 目前聚焦在云原生领域特别是 Kubernetes 场景模型。</p><p><img loading="lazy" alt="k8s-mutation" src="/zh-CN/assets/images/k8s-mutation-7ad4300b90e29c0368a68e4f10822d5e.png" width="2194" height="1156" class="img_ev3q"></p><p>作为云原生领域内的一个小语言，KCL 可以直接被用于解决场景中简单的小问题，如通过 <code>append-env</code> 模型直接为 Kubernetes 资源注入环境变量等配置而不是编写脚本，并且这些模型是可以分享复用并且经过了代码测试，在工程性、稳定性和扩展性上均有保障。</p><p><img loading="lazy" alt="k8s-validation" src="/zh-CN/assets/images/k8s-validation-eb9e40a2530d2891ea770198bb04b264.png" width="2072" height="1232" class="img_ev3q"></p><p>除了 Kubernetes 配置原地编辑，KCL 还在 Kubernetes 配置校验方面提供了许多开箱即用的模型比如容器服务校验模型、镜像准入模型、Pod Container Policy (PSP) 模型等来解决云原生供应链当中的安全和合规问题。比如可以通过 <code>disallow-svc-lb</code> 模型来验证 <code>Service</code> 资源中是否错误地设置了 <code>LoadBalancer</code> 类型；通过 <code>https-only</code> 模型来验证 <code>Ingress</code> 资源中是否包含了显示设置为 https 的 label 注解。</p><p>相比于其他策略工具或引擎，使用 KCL 的好处是一份校验模型可以同时在客户端和运行时使用，并且可以同时在编程语言界面同时定义 Schema 和约束条件，无需额外配合 OpenAPI Schema 或者 JSON Schema 使用。</p><p><img loading="lazy" alt="kcl-operator" src="/zh-CN/assets/images/kcl-operator-b29922286e08e6a0f1cffdff710ed483.png" width="2036" height="1194" class="img_ev3q"></p><p>除了在客户端完成配置的抽象、编辑和校验，KCL 还提供了运行时支持。KCL Operator 提供了 Kubernetes 集群集成，允许在将 Kubernetes 资源应用到集群时使用 Access Webhook 根据 KCL 配置生成、变异或验证资源。Webhook 将捕获创建、应用和编辑操作，并 <code>KCLRun</code> 在与每个操作关联的配置上执行资源<sup>[14]</sup>。</p><p>使用 KCL Operator, 通过几个步骤就可以在 Kubernetes 集群内部以很轻量的方式地通过 KCL 代码自动化地完成资源配置的管理和安全验证，无需重复开发 Webhook Server 在运行时动态修改和验证配置。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="terraform">Terraform<a href="#terraform" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>另外一个 KCL 聚焦的场景是 Terraform 的生态模型。</p><p><img loading="lazy" alt="tf-validation" src="/zh-CN/assets/images/tf-validation-96334a3c5c22b04b2d4451fbe31f39ae.png" width="2390" height="1202" class="img_ev3q"></p><p>在云原生供应链场景中，除了用户的业务代码，往往也需要验证 IaC 代码的安全性，因此 KCL 也提供了与 Terraform 相关的验证模型。比如图中的示例仅需要编写几行 KCL 代码就可以完成在 AWS 资源组的自动扩缩操作中禁止删除资源的需求<sup>[15]</sup>。</p><p>相比于其他策略引擎或工具，KCL 支持一键从 Terraform Provider Schema 转换为 KCL Schema, 可以很好地降低策略编写的难度。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iac--gitops">IaC &amp; GitOps<a href="#iac--gitops" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><img loading="lazy" alt="gitops" src="/zh-CN/assets/images/gitops-ee79b8abe62c26f4ac9c9aa3f40152eb.png" width="2412" height="1134" class="img_ev3q"></p><p>无论是 Kubernetes 模型还是 Terraform 模型，不论是使用独立的 KCL 还是 KRM KCL 配置形式，KCL 都支持与各种以及 CI/CD 和 GitOps 工具的集成，KCL 允许开发人员以声明式的方式定义应用程序所需的资源，通过将 KCL 和 GitOps 工具相结合可以帮助我们更好地实现 IaC，提高部署效率，简化应用程序的配置管理<sup>[16]</sup>。</p><p>使用 GitOps，开发人员和运维团队可以通过分别修改应用和配置代码来管理应用程序的部署，GitOps 工具链可以基于 KCL 的自动化能力实现对配置的自动更改，从而实现持续部署并确保一致性。如果出现问题，可以使用 GitOps 工具链快速回滚。</p><p><img loading="lazy" alt="app-delivery" src="/zh-CN/assets/images/app-delivery-fc4b2836750c1bd0bd550df0e30ff4ea.png" width="2186" height="1184" class="img_ev3q"></p><p>KCL 也可以被用于企业内部与各种 CI/CD 和应用配置交付引擎比如 KusionStack 等相配合，实现关注点分离、以应用为中心的可编程模型界面和 GitOps 流程，以简化当今混合多云环境中规模化应用的部署和运维操作，提升发布运维效率和开发者体验。</p><p><img loading="lazy" alt="k8s-abstraction" src="/zh-CN/assets/images/k8s-abstraction-a6effacf09b1ed666a6fd1bf868d902f.png" width="2238" height="1206" class="img_ev3q"></p><p>此外，使用 KCL 的 Schema 结构和 自动化 API，我们可以在外部系统中集成 KCL 并使用 CLI/API/UI 形式实现对 KCL 配置的自动增删改查，在实现 GitOps &amp; IaC 的基础上，同时为研发人员提供一个良好的配置管理界面，支持以 UI 表单形式实现对 KCL 代码的变更，提升配置管理和应用交付的效率，避免配置漂移等问题。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="summary" src="/zh-CN/assets/images/summary-f75a7f04ce9a0b601413429f510214df.png" width="2292" height="1010" class="img_ev3q"></p><p>本篇文章主要回顾了 CNCF KCD 社区会议 KCL 演讲内容，讲述了云原生领域特别是 Kubernetes 和 Terraform 生态中遇到的问题以及 KRM KCL 规范的概念、用户体验和实践。</p><p>当然，KCL 能够解决的问题和实践的场景远不止如此，受限于本文篇幅，我们后续会陆续分享社区中采用者的最佳实践，也欢迎大家加入我们的社区进行进一步交流和讨论 ❤️。<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>更多其他资源请参考:</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://github.com/kcl-lang/" target="_blank" rel="noopener noreferrer">KCL GitHub 仓库</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://github.com/KusionStack/" target="_blank" rel="noopener noreferrer">KusionStack GitHub 仓库</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>[1]<!-- --> Forecast Analysis: Container Management (Software and Services), Worldwide: <a href="https://www.gartner.com/en/documents/3985796" target="_blank" rel="noopener noreferrer">https://www.gartner.com/en/documents/3985796</a></li><li>[2]<!-- --> The top programming languages: <a href="https://octoverse.github.com/2022/top-programming-languages" target="_blank" rel="noopener noreferrer">https://octoverse.github.com/2022/top-programming-languages</a></li><li>[3]<!-- --> Kubernetes 中的声明式应用管理: <a href="https://docs.google.com/document/d/1cLPGweVEYrVqQvBLJg6sxV-TrE5Rm2MNOBA_cxZP2WU/edit#" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1cLPGweVEYrVqQvBLJg6sxV-TrE5Rm2MNOBA_cxZP2WU/edit#</a></li><li>[4]<!-- --> CNCF 平台工程白皮书: <a href="https://tag-app-delivery.cncf.io/whitepapers/platforms/" target="_blank" rel="noopener noreferrer">https://tag-app-delivery.cncf.io/whitepapers/platforms/</a></li><li>[5]<!-- --> Google SRE 工作手册: <a href="https://sre.google/workbook/configuration-specifics/" target="_blank" rel="noopener noreferrer">https://sre.google/workbook/configuration-specifics/</a></li><li>[6]<!-- --> KCL 官方网站: <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/</a></li><li>[7]<!-- --> Kubectl: <a href="https://kubernetes.io/docs/reference/kubectl/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/kubectl/</a></li><li>[8]<!-- --> KusionStack: <a href="https://kusionstack.io" target="_blank" rel="noopener noreferrer">https://kusionstack.io</a></li><li>[9]<!-- --> KubeVela: <a href="https://kubevela.net" target="_blank" rel="noopener noreferrer">https://kubevela.net</a></li><li>[10]<!-- --> Helmfile: <a href="https://github.com/helmfile/helmfile" target="_blank" rel="noopener noreferrer">https://github.com/helmfile/helmfile</a></li><li>[11]<!-- --> KRM KCL 规范: <a href="https://github.com/kcl-lang/krm-kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/krm-kcl</a></li><li>[12]<!-- --> KCL IDE 插件: <a href="https://kcl-lang.io/docs/tools/Ide/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/tools/Ide/</a></li><li>[13]<!-- --> ArtifactHub KCL 集成: <a href="https://artifacthub.io/" target="_blank" rel="noopener noreferrer">https://artifacthub.io/</a></li><li>[14]<!-- --> KCL Operator: <a href="https://github.com/kcl-lang/kcl-operator" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-operator</a></li><li>[15]<!-- --> Terraform KCL 策略代码化: <a href="https://kcl-lang.io/docs/user_docs/guides/%5B%5Dworking-with-terraform/validation" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/working-with-terraform/validation</a></li><li>[16]<!-- --> 使用 KCL 进行 GitOps: <a href="https://kcl-lang.io/docs/user_docs/guides/gitops/gitops-quick-start" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/gitops/gitops-quick-start</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Meeting</category>
        </item>
        <item>
            <title><![CDATA[2023 CNCF KCD 杭州社区会议 KCL 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-10-21-kcl-kcd-hangzhou-meeting</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-10-21-kcl-kcd-hangzhou-meeting</guid>
            <pubDate>Sat, 21 Oct 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[PDF 下载]]></description>
            <content:encoded><![CDATA[<p><a href="https://kcl-lang.io/talks/kcl-cncf-kcd-hangzhou2023.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p><p><img loading="lazy" alt="Talk Cover" src="/zh-CN/assets/images/talk-cover-589ff826defc21c1d2f6fec1ae565c72.png" width="2654" height="1490" class="img_ev3q"></p>]]></content:encoded>
            <category>KCL</category>
            <category>Meeting</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 09.07 - 10.11) | v0.6.0 版本发布 —— 更多 IDE 插件、包管理支持!]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-10-11-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-10-11-biweekly-newsletter</guid>
            <pubDate>Wed, 11 Oct 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 09.07 - 10.11) 的杰出工作，以下是重点合并内容概述</p><p><strong>🔧 语言及工具链更新</strong></p><ul><li>KCL v0.6.0 于 9.15 发布，更新内容包括语言、工具链、社区集成，详细内容请查看 <a href="https://mp.weixin.qq.com/s/f6RCZqxS2iliRGIz0036yA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/f6RCZqxS2iliRGIz0036yA</a></li><li>KCL IDE 更新 - 支持对标准库和内置函数的悬停提示，支持对 KCL 代码错误的快速修复；发布适配 Intellij IDEA 2023.2 的插件版本</li><li>KCL 包管理工具 KPM 更新 - kpm run 支持编译 KCL 文件，并集成了导入工具</li><li>KCL 文档工具更新 - 支持将 docstring Examples 章节输出到文档</li><li>KCL 语言更新 - 优化了一些错误信息的输出，部分的错误信息中增加了修复建议</li></ul><p><strong>📰 官网和用例更新</strong></p><ul><li>KCL 官网新增 v0.6.0 文档版本</li><li>KCL 模型新增容器、服务和 Pod Security Policy (PSP) 相关的配置编辑、校验 20 个 <a href="https://github.com/kcl-lang/krm-kcl/tree/main/examples" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/krm-kcl/tree/main/examples</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @jakezhu9 对 KCL Import 工具 Terraform Schema 到 KCL Schema 转换的贡献 🙌 <em><a href="https://github.com/kcl-lang/kcl-go/pull/152" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/152</a></em></li><li>感谢 @jakezhu9 对 kpm 集成 Import 工具的贡献 🙌 <em><a href="https://github.com/kcl-lang/kpm/pull/194" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/pull/194</a></em></li><li>感谢 @zwpaper 对 KCL 文档和 Tree Sitter Grammar 做出的贡献 🙌 <em><a href="https://github.com/kcl-lang/tree-sitter-kcl/pull/1" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/tree-sitter-kcl/pull/1</a></em> 等</li><li>感谢 @mrgleeco, @ghpu, @steeling, @prahaladramji, @zwpaper 等在使用 KCL 及工具链过程中提出的宝贵反馈和讨论 🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-ide-插件更新">KCL IDE 插件更新<a href="#kcl-ide-插件更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在最近的 0.6.0 发布中，KCL IDE 插件增加了标准库和 builtin 函数的悬停提示，新增支持对 KCL 代码错误的快速修复。此外，还增加了 language Server 侧的 e2e 测试及 konfig 仓库的集成测试，以保障 IDE 插件的稳定迭代。在尚未发布的版本中，还新增了 <code>kcl-language-server version</code> 子命令以输出版本信息。欢迎升级、使用 —— KCL 在各个 IDE 平台的插件安装方式请查看<a href="https://kcl-lang.io/docs/user_docs/getting-started/install/#2-install-kcl-ide-extension" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/getting-started/install/#2-install-kcl-ide-extension</a></p><p><img loading="lazy" src="/zh-CN/assets/images/hover-built-in-2e3135c5f212382ac87f2d177198d716.png" width="2044" height="1200" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="intellij-插件">IntelliJ 插件<a href="#intellij-插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>IntelliJ 插件现已适配 2023.2+ 版本，您可以在下面的链接中下载安装：</li></ul><p><a href="https://github.com/kcl-lang/intellij-kcl/releases" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/intellij-kcl/releases</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-包管理工具">KCL 包管理工具<a href="#kcl-包管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>kpm run 支持编译 KCL 文件，并集成了导入工具，同时增加了 —quiet 来屏蔽输出日志。</p><p><img loading="lazy" src="/zh-CN/assets/images/kpm-run-file-9c35e6124d10306f128268dd7e7e74aa.png" width="1136" height="816" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-语言更新">KCL 语言更新<a href="#kcl-语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在尚未发布的版本中，KCL 的编译命令优化了一些错误信息的输出，部分的错误信息中增加了修复建议：
<img loading="lazy" src="/zh-CN/assets/images/error-suggestion-79b2d1a49679a41080b465ae6dfdf5a2.png" width="1642" height="190" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-模型更新">KCL 模型更新<a href="#kcl-模型更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>近几周内，我们提供了更多针对容器、服务和 Pod Security Policy (PSP) 配置编辑及校验的使用案例。您可参照对应的示例引入以上配置和校验： <a href="https://github.com/kcl-lang/krm-kcl/tree/main/examples" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/krm-kcl/tree/main/examples</a></p><p>下面我们以 Kubectl KCL 插件和 disallow-svc-lb 模型进行说明，disallow-svc-lb 的作用是对 Service 资源进行校验，不允许 Service 资源的类型设置为 <code>LoadBalancer</code>，编写如下 YAML 文件 (manifests.yaml)：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> disallow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">svc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">krm.kcl.dev/version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">krm.kcl.dev/type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">documentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      A validation that prevents the creation of Service resources of type `LoadBalancer`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> oci</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//ghcr.io/kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lang/disallow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">svc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MyApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LoadBalancer </span><span class="token comment" style="color:#999988;font-style:italic"># 错误地设置了 LoadBalancer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 Kubectl KCL 工具在客户端进行资源验证：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl kcl apply -f manifests.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们会得到如下结果：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A validation that prevents the creation of Service resources of </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">LoadBalancer</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> Service: my-service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>集成了 KCL 0.6 的 KusionStack 发布 0.9 版本，详细更新内容请查看：<a href="https://mp.weixin.qq.com/s/nZOHdmgcfOMRf0XUXfSJ-g" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/nZOHdmgcfOMRf0XUXfSJ-g</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。预计 11 月底我们会正式发布 KCL v0.7 新版本，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p></li><li><p><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></p></li><li><p><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/milestone/7" target="_blank" rel="noopener noreferrer">KCL v0.7.0 Milestone</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></p></li><li><p><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></p></li><li><p><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[喜报！KCL 正式成为 CNCF 沙盒项目 🎉]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-09-19-kcl-joining-cncf-sandbox</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-09-19-kcl-joining-cncf-sandbox</guid>
            <pubDate>Tue, 19 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[kcl-joining-cncf-sandbox]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="kcl-joining-cncf-sandbox" src="/zh-CN/assets/images/kcl-joining-cncf-sandbox-7424c249f0977d35af0ffe501be6f303.png" width="424" height="238" class="img_ev3q"></p><p><strong>2023 年 9 月 20 日，KCL 项目通过了全球顶级开源基金会云原生计算基金会（CNCF）技术监督委员会评定，正式成为 CNCF 沙箱项目。</strong></p><p>这意味着 KCL 得到了云原生开源社区的认可，保障了项目的中立性，有利于开发者、合作伙伴等共同参与项目建设，协作共赢，并为云原生应用交付带来动态配置管理和自动化能力迈出了重要一步！</p><ul><li><em>项目地址：<a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl</a></em></li><li><em>项目官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></li></ul><p>通过进入 CNCF 沙箱，KCL 社区将更多吸引更多开发者和用户参与共建，进一步推动项目在云原生业务场景的成熟应用，此外加入 CNCF 将为 KCL 提供一个增强的协作和创新平台。它提供了与处于云原生技术前沿的多元化开发者、组织和行业专家社区进行交流的机会。我们期待与其他 CNCF 项目进行更多合作，贡献我们的技术专业知识，并探索更多 CNCF 项目集成的可能性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-cncf">什么是 CNCF？<a href="#什么是-cncf" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>CNCF，全称 Cloud Native Computing Foundation（云原生计算基金会），是 Linux 基金会旗下的子基金会。CNCF 致力于为云原生软件构建可持续生态系统，涉及领域包括存储、计算、编排、调度、CI/CD、DevOps、服务治理、服务网关等。</p><p><em>Kubernetes 便是 CNCF 最具代表性的项目之一</em>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-cncf-sandbox-沙盒项目">什么是 CNCF Sandbox 沙盒项目？<a href="#什么是-cncf-sandbox-沙盒项目" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="cncf-sandbox-logo" src="/zh-CN/assets/images/cncf-sandbox-logo-b55f5b60a0d3ea098438ca67bd77a415.png" width="1080" height="243" class="img_ev3q"></p><p>CNCF 社区将项目分为沙箱项目（Sandbox）、孵化项目（Incubating）、毕业项目（Graduated）。著名的毕业项目有：Kubernetes、Prometheus、Istio、ETCD、Containerd、ArgoCD 和 Helm 等。完整的毕业和孵化项目列表查看地址：</p><p><a href="https://www.cncf.io/projects/" target="_blank" rel="noopener noreferrer">https://www.cncf.io/projects/</a></p><p>Sandbox 是 CNCF 创建的，旨在为开源项目提供一个有益的、中立的家园，以促进开源项目的合作与开发。入选沙箱的项目，是被 CNCF TOC 认可的，并值得进行实验和开发的潜力项目。</p><p>Sandbox 对应的是 CNCF 社区早期项目，列表为：<a href="https://www.cncf.io/sandbox-projects/" target="_blank" rel="noopener noreferrer">https://www.cncf.io/sandbox-projects/</a>。进入 Sandbox 需要 66% 以上的 TOC（技术委员会）成员赞成，即全部 11 人 <a href="https://github.com/cncf/toc#members" target="_blank" rel="noopener noreferrer">https://github.com/cncf/toc#members</a> 中的 8 人投赞成票。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-kcl">什么是 KCL<a href="#什么是-kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 是一个开源的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于围绕配置的模块化、扩展性和稳定性，打造更简单的逻辑编写体验，构建更简单的自动化和生态集成路径。</p><p>项目主要里程碑如下：</p><ul><li>2022 年 5 月，KCL 由蚂蚁集团发起，正式开源</li><li>2023 年 6 月，KCL 正式成为 CNCF Landscape 项目</li><li>2023 年 9 月，KCL 由 CNCF 应用交付 TAG 进行审核并通过 TOC 投票，顺利成为 CNCF Sandbox 项目 - <a href="https://github.com/cncf/sandbox/issues/48" target="_blank" rel="noopener noreferrer">https://github.com/cncf/sandbox/issues/48</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么需要-kcl">为什么需要 KCL<a href="#为什么需要-kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>正如记录音乐有五线谱，存储时间序列数据有时序数据库一样，在云原生配置和自动化的特定问题域内，我们使用专用配置和策略语言用于编写和管理规模化复杂配置及策略。不同于混合编写范式、混合工程能力的高级通用语言，专用语言的核心逻辑是以收敛的有限的语法、语义集合解决领域问题近乎无限的变化和复杂性，将复杂配置和策略编写思路和方式沉淀到语言特性中。</p><p>此外，KCL 期望通过更现代化的声明式配置语言和工具，在轻量级客户端云原生动态配置领域填补配置语言及工具的空白并解决如下问题：</p><ul><li><strong>维度爆炸</strong>: 大多数静态配置如云原生领域的 Kubernetes YAML 配置需要为每个环境单独进行配置；在最糟糕的情况下，它可能引入涉及环境交叉链接的难以调试的错误，稳定性和扩展性都较差。</li><li><strong>配置漂移</strong>: 对于不同环境的静态管理应用程序和基础设施配置的方式，往往没有标准的方式去管理这些动态的不同环境的配置，采用非标准化的方法比如脚本和胶水代码的拼盘，会导致复杂度呈指数增长，并导致配置漂移。</li><li><strong>认知负担</strong>: Kubernetes 等作为构建平台的平台技术手段在底层统一基础架构细节方面出色，但是缺乏更上层的应用软件交付抽象，对于普通开发者认知负担较高，影响了更上层应用开发者的软件交付体验。</li></ul><p>针对如上问题，KCL 期望提供如下能力:</p><ul><li>通过<strong>代码抽象</strong>等手段屏蔽基础设施和平台的细节和复杂性，降低研发者<strong>认知负担</strong></li><li><strong>编辑</strong>和<strong>校验</strong>已有的存量配置或模版，直接解决云原生小配置场景问题如 Helm Chart 配置硬编码问题，但远不止如此</li><li>通过配置语言无副作用地<strong>管理跨团队的大规模配置数据</strong>，提升团队协作效率</li></ul><p>具体来说，KCL 可以</p><ul><li>在代码层面提升<strong>配置语义验证</strong>的能力，比如 Schema 定义、字段可选/必选、类型、范围等配置检查校验能力</li><li>提供<strong>配置分块编写、组合和抽象</strong>的能力，比如结构定义、结构继承、约束定义和配置策略合并等能力</li><li>用<strong>现代编程语言</strong>的方式以<strong>编写代码</strong>的方式提升配置的灵活度，比如条件语句、循环、函数、包管理等特性提升配置重用的能力</li><li>提供<strong>完备的工具链支持</strong>，丰富的 IDE 插件、语言和生态工具链支持用以降低上手门槛，提升使用体验</li><li>通过<strong>包管理工具</strong> 和 <strong>OCI 注册表</strong>使得配置以更简单的方式在不同团队/角色之间分享，传播和交付</li><li>提供<strong>高性能</strong>的编译器满足规模化配置场景诉求，比如满足由一份基线配置根据部署上下文生成不同环境不同拓扑的配置的渲染性能以及配置自动化修改性能诉求</li><li>通过<strong>多语言 SDK，KCL 语言插件</strong>等手段提升其自动化集成能力，在发挥配置及策略编写价值的同时显著降低 KCL 的学习成本</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/kcl-overview-02a0d4a0f70d7adc22ab051eb794f3b8.png" width="702" height="419" class="img_ev3q"></p><p>除了语言自身，KCL 还提供了许多额外的工具如格式化，测试、文档等工具帮助您使用、理解和检查编写的配置或策略；通过 VS Code 等 IDE 插件，包管理工具和 Playground 降低配置编写和分享的成本；通过 Rust, Go, 和 Python 多语言 SDK 自动化地管理和执行配置。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-能做什么">KCL 能做什么<a href="#kcl-能做什么" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="动态配置管理">动态配置管理<a href="#动态配置管理" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><img loading="lazy" alt="standalone-kcl-form" src="/zh-CN/assets/images/standalone-kcl-form-3fe553990c62b689edd434a623cfcba2.png" width="2252" height="1194" class="img_ev3q"></p><p>作为一种配置语言，KCL 为应用程序和平台开发人员/SRE 提供的最重要的功能是动态配置管理。通过代码抽象，我们可以构建以应用为中心的模型屏蔽复杂的基础设施和平台概念，为开发人员提供一个以应用程序为中心且易于理解的界面。此外，KCL 还允许平台人员快速扩展和定义自己的模型，并且这些模型可以通过 OCI 注册表进行分享和复用。</p><p><img loading="lazy" alt="krm-kcl-form" src="/zh-CN/assets/images/krm-kcl-form-93ee5711170a1227cdb9cb2ad68654d5.png" width="2166" height="1076" class="img_ev3q"></p><p>此外，KCL 还支持与 Kubernetes Resource Model (KRM) 规范直接集成，KRM KCL 是一个通用的配置模型规范，用于描述和管理各种云原生资源，如容器、Pod、服务的配置操作和抽象等。KRM KCL 规范提供了一种统一的方式来定义和管理这些资源，使得它们可以在不同的环境中进行移植和复用。它建立在一个完全开放的 Kubernetes 世界当中，几乎不与任何编排/引擎工具或者 Kubernetes 控制器绑定，它在关注点分离的基础上允许平台人员扩展自己的抽象，配置编辑和验证逻辑，并提供一个开发者友好的配置管理界面。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gitops-集成">GitOps 集成<a href="#gitops-集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p><img loading="lazy" alt="gitops" src="/zh-CN/assets/images/gitops-c677786c3b120ccbe4e8007313291a53.png" width="2182" height="1018" class="img_ev3q"></p><p>无论是使用独立的 KCL 还是 KRM KCL 配置形式，我们都支持 KCL 与各种以及 CI/CD 和 GitOps 工具的集成，KCL 允许开发人员以声明式的方式定义应用程序所需的资源，通过将 KCL 和 GitOps 工具相结合可以帮助我们更好地实现基础设施即代码（IaC），提高部署效率，简化应用程序的配置管理。</p><p>使用 GitOps，开发人员和运维团队可以通过分别修改应用和配置代码来管理应用程序的部署，GitOps 工具链可以基于 KCL 的自动化能力实现对配置的自动更改，从而实现持续部署并确保一致性。如果出现问题，可以使用 GitOps 工具链快速回滚。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="生态集成">生态集成<a href="#生态集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="integration" src="/zh-CN/assets/images/integration-60f0e309485ebab3d8478a40017a8828.png" width="2192" height="1048" class="img_ev3q"></p><p>除了与 ArgoCD 等 GitOps 自动化工具进行集成，作为 CNCF 的项目，KCL 还与 CNCF 其他众多生态项目进行了集成，比如为现有的 CNCF 生态配置管理工具项目如 Helm、Kustomize、kpt 等提供 KCL 插件，在运行时提供 KCL Kubernetes Operator，以满足不同场景的配置管理需求等。此外我们还提供如下集成支持：</p><ul><li><strong>多语言支持</strong>：我们提供了多语言 SDK，帮助用户以不同的语言操作 KCL，并将其集成到自己的应用程序中。</li><li><strong>包管理支持</strong>：我们提供了 KPM 包管理工具可以将 KCL 配置通过 docker hub, GitHub 容器注册表进行分发和复用。</li><li><strong>Schema 迁移支持</strong>：我们支持其他生态系统的 Schema 一键迁移到 KCL Schema，如 Go/Rust 结构定义、JsonSchema、Protobuf、OpenAPI、Terraform Provider Schema 等。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="落地实践">落地实践<a href="#落地实践" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="practice-krm-kcl" src="/zh-CN/assets/images/practice-krm-kcl-e18153d2f7b57b6706db1ad767d11bdb.png" width="3538" height="1040" class="img_ev3q"></p><p>首先，KCL 作为云原生领域内的一个小语言，它可以直接被用于解决场景中简单的小问题，如通过 KCL 模型直接为 Kubernetes 资源注入环境变量等配置而不是编写脚本，通过 KCL 模型和 Helm KCL 插件无侵入处理 Helm Chart 的硬编码配置而不是 Fork Helm Chart 直接修改等。</p><p><img loading="lazy" alt="practice-konfig-gitops" src="/zh-CN/assets/images/practice-konfig-gitops-a1a7d2f8eaa9af8509612dd53d8f6250.png" width="1812" height="892" class="img_ev3q"></p><p>其次，KCL 也可以被用于企业内部与各种 CI/CD 和应用配置交付引擎比如 <a href="https://kusionstack.io" target="_blank" rel="noopener noreferrer">KusionStack</a> 等相配合，实现关注点分离、以应用为中心的可编程模型界面和 GitOps 流程，以简化当今混合多云环境中规模化应用的部署和运维操作，提升发布运维效率和开发者体验。</p><p>当然，KCL 能够解决的问题和实践的场景远不止如此，我们会陆续分享社区中采用者的最佳实践，也欢迎大家加入我们的社区进行进一步交流和讨论 ❤️。<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="community" src="/zh-CN/assets/images/community-4be9cb803ff35e3209a7575e911c1cb0.png" width="2166" height="1092" class="img_ev3q"></p><p>在 KCL 开源短短的这一年里，我们发布了许多版本，并与全世界许多贡献者和维护者合作构建了 KCL 社区，并得到了一些采用者比如有赞和华为等公司的认可，通过加入 CNCF，我们的目标是提高项目的知名度并促进社区采用和参与，因为强大且知名的基金会组织对于推动语言生态系统的发展至关重要。</p><p>此外，我们在开源社区收获了来自全世界包括中国、北美、欧洲和澳大利亚各地小伙伴的认可，感谢一路陪伴 KCL 走来的各位用户和社区研发者，同时也欢迎更多的小伙伴加入到我们的社区一起共建 ❤️</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>对 KCL 来说，加入 CNCF 并不代表成功，它意味着一个新的开始，我们将和社区的小伙伴们一起努力打造更好的 KCL 语言、工具链和 IDE 体验！最后，也欢迎大家加入我们的社区进行交流和贡献 👏👏👏</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li><p>KCL 网站: <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/</a></p></li><li><p>KusionStack 网站: <a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">https://kusionstack.io/</a></p></li><li><p>KCL 社区: <a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p></li><li><p>KCL 2023 路线规划: <a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/community/release-policy/roadmap</a></p></li><li><p>KCL GitHub Issues: <a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues</a></p></li><li><p>KCL GitHub Discussion: <a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">https://github.com/orgs/kcl-lang/discussions</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.6.0 重磅发布 - 面向云原生场景更易用的语言、工具链，社区集成和扩展支持]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-09-15-kcl-0.6.0-release</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-09-15-kcl-0.6.0-release</guid>
            <pubDate>Fri, 15 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 <strong>KCL v0.6.0 新版本现在已经可用</strong>！本次发布为大家带来了三方面的重点更新：<strong>语言</strong>、<strong>工具链</strong>、<strong>社区集成 &amp; 扩展支持</strong>。</p><ul><li><em>使用功能更完善错误更少的 KCL 语言、工具链和 IDE 提升代码编写体验和效率</em></li><li><em>使用包管理 KPM 和 OCI Registry 等工具直接使用和共享您的云原生领域模型，降低学习和上手成本</em></li><li><em>使用 Helmfile KCL 插件和 KCL Operator 等云原生集成扩展同时支持在客户端和运行时对 Kubernetes 资源进行原地修改和验证，避免配置硬编码</em></li></ul><p>进一步您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.6.0" target="_blank" rel="noopener noreferrer">KCL v0.6.0 发布页面</a> 或者 <a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">KCL 官方网站</a> 获得下载安装指南和详细发布信息。</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个面向云原生领域开源的基于约束的记录及函数编程语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于围绕配置的模块化、扩展性和稳定性，打造更简单的逻辑编写体验，构建更简单的自动化和生态集成路径。</p><p>本文重点介绍 KCL v0.6.0 版本的更新内容以及 KCL 社区的近期动态。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="语言更新">语言更新<a href="#语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-类型系统增强">🔧 类型系统增强<a href="#-类型系统增强" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>支持 KCL 配置块属性类型自动推导，在 KCL v0.6.0 版本之前，下述代码中的 <code>key1</code> 和 <code>key2</code> 属性会被类型系统推导为 <code>str | int</code> 类型，版本更新之后，我们进一步增强了配置属性的类型精确推导，<code>key1</code> 和 <code>key2</code> 属性会获得范围更小更精确的对应类型</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"value1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key1  </span><span class="token comment" style="color:#999988;font-style:italic"># key1 的类型为 str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key2  </span><span class="token comment" style="color:#999988;font-style:italic"># key2 的类型为 int</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外，我们优化了 Schema 语义检查和联合类型检查等错误信息以及系统库函数的类型检查错误信息。</p><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/678" target="_blank" rel="noopener noreferrer">详见</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-api-更新">🏄 API 更新<a href="#-api-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>KCL Schema 模型解析&nbsp;GetSchemaType API 获取 KCL 包相关信息和 Schema 属性默认值</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-错误修复">🐞 错误修复<a href="#-错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-必选属性检查错误修复">KCL 必选属性检查错误修复<a href="#kcl-必选属性检查错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在之前的 KCL 版本中，KCL 必选属性检查会遗漏嵌套的 Schema 属性检查，在 KCL v0.6.0 版本中，我们修复了此类类似的问题</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema S</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema L</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 在之前的版本中，会遗漏 [S] 和 {str:S} 中的 S 的 a, b 属性必选检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 在 KCL v0.6.0 版本之后，我们修复了此类问题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ss?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sss?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">l </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> L </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ss </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">S </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/672" target="_blank" rel="noopener noreferrer">详见</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ide--工具链更新">IDE &amp; 工具链更新<a href="#ide--工具链更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ide-更新">IDE 更新<a href="#ide-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="功能更新">功能更新<a href="#功能更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>跳转性能大幅度提升，支持毫秒级跳转</li><li>支持 KCL 包中的变量以及 Schema 属性补全</li><li>支持 KCL Schema 属性文档属性悬停提示</li><li>支持无用 Import 语句快速修复</li></ul><p><img loading="lazy" alt="ide-quick-fix" src="/zh-CN/assets/images/ide-quick-fix-387d039df6f3117e1997c98c26bbfd33.png" width="854" height="546" class="img_ev3q"></p><ul><li>支持右键格式化文件和代码片段</li></ul><p><img loading="lazy" alt="ide-format" src="/zh-CN/assets/images/ide-format-f987fa4c4ff7cffd5325cb5257f4aff8.png" width="744" height="428" class="img_ev3q"></p><ul><li>支持内置函数和系统库中函数信息的悬停提示</li></ul><p><img loading="lazy" alt="ide-func-hover" src="/zh-CN/assets/images/ide-func-hover-becc736d3b72be494da324901a48cafb.png" width="1726" height="306" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="更多-ide-支持">更多 IDE 支持<a href="#更多-ide-支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>我们将 KCL 语言服务器 LSP 集成到了 NeoVim 和 Idea 中，使得可以在 NeoVim 和 IntelliJ IDEA 中体验到和 VS Code IDE 支持的补全、跳转和悬停等功能</p><ul><li>NeoVim KCL 插件</li></ul><p><img loading="lazy" alt="kcl.nvim" src="/zh-CN/assets/images/overview-0667184faaf2ee0abe93374de277929b.png" width="1246" height="1121" class="img_ev3q"></p><ul><li>IntelliJ 插件</li></ul><p><img loading="lazy" alt="intellij" src="/zh-CN/assets/images/overview-1dbf1cc2cd1bbf6b03b06702335a10ce.png" width="1041" height="650" class="img_ev3q"></p><p>更多 IDE 插件下载安装方式和功能说明可参考：</p><ul><li><a href="https://kcl-lang.io/docs/user_docs/getting-started/install#neovim" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/getting-started/install#neovim</a></li><li><a href="https://kcl-lang.io/docs/user_docs/getting-started/install#intellij-idea" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/getting-started/install#intellij-idea</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-格式化工具更新">KCL 格式化工具更新<a href="#kcl-格式化工具更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>支持对缩进不正确的配置块进行格式化</p><ul><li>格式化前</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>格式化后</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-文档工具更新">KCL 文档工具更新<a href="#kcl-文档工具更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>新增 Markdown 文档导出支持</li><li>支持导出文档索引页</li><li>支持导出文档自定义样式模版</li><li>支持导出文档 HTML 转义</li><li>文档生成增强，支持对文档注释中示例代码片段的解析和渲染</li><li>通过在 Github workflow 中跟踪模型的更新，并重新生成文档，即可实现文档的自动同步。具体参考: <a href="https://github.com/KusionStack/catalog/pull/31/files" target="_blank" rel="noopener noreferrer">https://github.com/KusionStack/catalog/pull/31/files</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="从-kpm-包生成模型文档">从 kpm 包生成模型文档<a href="#从-kpm-包生成模型文档" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ol><li>创建 kpm 包，为其中的 Service 模型添加文档注释（使用 docstring 表示）。在文档中可以包含对模型和属性的说明、示例代码和用法等，以帮助其他开发人员快速上手并正确地使用。</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜ kpm init demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜ cat &gt; demo/server.k &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Service is a kind of workload profile that describes how to run your application code. This</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is typically used for long-running web applications that should "never" go down, and handle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    short-lived latency-sensitive web requests, or events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workloadType : str = "Deployment" | "StatefulSet", default is Deployment, required.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workloadType represents the type of workload used by this Service. Currently, it supports several</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types, including Deployment and StatefulSet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image : str, default is Undefined, required.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Image refers to the Docker image name to run for this container.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        More info: https://kubernetes.io/docs/concepts/containers/images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replicas : int, default is 2, required.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Number of container replicas based on this configuration that should be ran.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Instantiate a long-running service and its image is "nginx:v1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    svc = Service {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workloadType: "Deployment"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: "nginx:v1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replica: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workloadType: "Deployment" | "StatefulSet"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replica: int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>生成 Markdown 格式的包文档：
以下命令将 demo 包文档输出到当前工作目录下的 doc/ 目录：</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl-go doc generate --file-path demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="docgen" src="/zh-CN/assets/images/docgen-5d4a8e13d9126ed8e7c4c7834bb73060.png" width="1846" height="1510" class="img_ev3q"></p><blockquote><p>更多使用方式请通过 <code>kcl-go doc generate -h</code> 查看</p></blockquote><ol><li>通过流水线实现文档的自动同步</li></ol><p>通过在 Github workflow 中跟踪模型的更新，并重新生成文档，即可实现文档的自动同步。可参照 <a href="https://github.com/KusionStack/catalog/pull/31/files" target="_blank" rel="noopener noreferrer">Kusionstack/catalog</a> 中的做法，生成文档并自动向文档仓库提交变更 PR。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-导入工具更新">KCL 导入工具更新<a href="#kcl-导入工具更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 KCL v0.6.0 版本，KCL 导出 Import 工具新增支持了 JsonSchema, Terraform Provider Schema, Go 结构体 转换为 KCL，以及一键支持 JSON/YAML 配置数据转换为 KCL 配置代码，比如对于如下的 Terraform Provider Json (通过 <code>terraform providers schema -json &gt; provider.json</code> 命令获得，详情请参考 <a href="https://developer.hashicorp.com/terraform/cli/commands/providers/schema" target="_blank" rel="noopener noreferrer">https://developer.hashicorp.com/terraform/cli/commands/providers/schema</a>)</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"format_version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"provider_schemas"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"registry.terraform.io/aliyun/alicloud"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"provider"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"block"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"attributes"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"block_types"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"resource_schemas"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"alicloud_db_instance"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"block"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"attributes"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"db_instance_type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"engine"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"required"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"security_group_ids"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"set"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"security_ips"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"set"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"tags"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"map"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"block_types"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"alicloud_config_rule"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"block"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"attributes"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"compliance"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string" style="color:#e3116c">"list"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token property" style="color:#36acaa">"compliance_type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token property" style="color:#36acaa">"count"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"resource_types_scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"list"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"data_source_schemas"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>经过 KCL Import 工具可以输出为如下 KCL 代码</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">This file was generated by the KCL auto-gen tool. DO NOT EDIT.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Editing this file might prove futile when you re-run the KCL auto-gen generate command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema AlicloudConfigRule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    AlicloudConfigRule</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    compliance: [ComplianceObject], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    resource_types_scope: [str], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compliance?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ComplianceObject</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_types_scope?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema ComplianceObject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ComplianceObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    compliance_type: str, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    count: int, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compliance_type?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema AlicloudDbInstance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    AlicloudDbInstance</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    db_instance_type: str, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    engine: str, required</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    security_group_ids: [str], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    security_ips: [str], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    tags: {str:str}, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db_instance_type?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    engine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    security_group_ids?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    security_ips?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isunique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">security_group_ids</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isunique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">security_ips</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="包管理工具-kpm-更新">包管理工具 KPM 更新<a href="#包管理工具-kpm-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kpm-pull-支持通过包名拉取-kcl-package">kpm pull 支持通过包名拉取 kcl package<a href="#kpm-pull-支持通过包名拉取-kcl-package" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>kpm 支持通过 kpm pull &lt;package_name&gt;:&lt;package_version&gt; 的方式拉取对应的包。
以 <code>k8s</code>包为例，你可以通过以下命令直接下载对应的包到本地。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm pull k8s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm pull k8s:1.27</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>kpm pull 下载的包，将会为您保存在 <code>执行命令的目录/&lt;oci registry&gt;/&lt;package_name&gt;</code>目录下, 以 kpm 默认的 registry 为例，在使用 <code>kpm pull k8s</code>命令后，您能在<code>执行命令的目录/ghcr.io/kcl-lang/k8s</code>目录下找到您下载的内容。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree ghcr.io/kcl-lang/k8s -L 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/kcl-lang/k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── apiextensions_apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── apimachinery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── kcl.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── kcl.mod.lock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── kube_aggregator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vendor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 directories, 2 files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kpm-支持添加本地路径作为依赖">kpm 支持添加本地路径作为依赖<a href="#kpm-支持添加本地路径作为依赖" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>"不同的项目对应的 KCL 包不一样，他们之间存在依赖关系，但是他们保存在不同的目录下，我希望这些保存在不同目录下的包能够被统一管理起来，而不是只有把他们放在一起他们才能通过编译。" 如果您也有这样的需求，您可以来试试这个功能。kpm add 目前支持将本地路径作为依赖添加到 kcl 包中，您只需要<code>kpm add &lt;local_package_path&gt;</code>这样的命令，便可以将您本地的包作为三方库添加到当前包的依赖中。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm pull k8s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完成后您可以在 “执行命令的目录/ghcr.io/kcl-lang/k8s” 找到下载的 k8s 包。
使用 kpm init mynginx 命令，创建一个新的 kcl 包。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm init mynginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，进入这个包内</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> mynginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在这个包内，您可以使用 kpm add 命令将您刚才下载到本地的 k8s 包作为三方库添加到 mynginx 的依赖中。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/ghcr.io/kcl-lang/k8s/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来为 main.k 添加如下内容</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">import</span><span class="token plain"> k8s.api.core.v1 as k8core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8core.Pod </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata.name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec.containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"main-container"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">containerPort: </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 kpm run 可以进行正常的编译</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kpm-增加对已经存在的包-tag-进行检查">kpm 增加对已经存在的包 tag 进行检查<a href="#kpm-增加对已经存在的包-tag-进行检查" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>kpm push 中增加了对 tag 重复的检查，为了避免出现相同 tag 的包存在不同的内容的情况，我们在 kpm 中增加了对 push 功能的限制，如果您 push 的 kcl 包的版本已经存在，那么，您将无法 push 当前的 kcl 包。您将会得到如下信息：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm: package </span><span class="token string" style="color:#e3116c">'my_package'</span><span class="token plain"> will be pushed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kpm: package version </span><span class="token string" style="color:#e3116c">'0.1.0'</span><span class="token plain"> already exists</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对一个已经 push 到 Registry 中的 kcl 包，在不改变 tag 的情况下改动包的内容，会产生很大的风险，因为这个包有可能已经被其他人使用了，因此，如果您需要 push 您的包，我们建议</p><ul><li>变更您的 tag, 并且建议您遵守语义化版本的规范。</li><li>如果迫不得已需要在 tag 不能变更的情况下改变包的内容，您只能到 Registry 上删除已有的 tag。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区集成--扩展更新">社区集成 &amp; 扩展更新<a href="#社区集成--扩展更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="helmfile-kcl-插件">Helmfile KCL 插件<a href="#helmfile-kcl-插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Helmfile 是用于部署 Helm Chart 的声明性规范和工具，通过 Helmfile KCL 插件您可以</p><ul><li>通过无侵入的 Hook 方式编辑或者验证 Helm Chart 配置，将 Kubernetes 配置管理的数据部分和逻辑部分分离<ul><li>修改资源标签/注解, 注入 Sidecar 容器配置</li><li>使用 KCL Schema 校验资源，定义自己的抽象模型并分享复用</li></ul></li><li>优雅地维护多环境、多租户场景配置，而不是简单地复制粘贴</li></ul><p>下面以一个简单示例进行详细说明，使用 Helmfile KCL 插件无需您安装与 KCL 任何相关的组件，只需本机具备 Helmfile 工具的最新版本即可。</p><p>我们可以编写一个如下所示&nbsp;<code>helmfile.yaml</code>&nbsp;文件</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">repositories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community.github.io/helm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">releases</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prom</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">norbac</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ubuntu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;chart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;set</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;rbac.create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;transformers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;</span><span class="token comment" style="color:#999988;font-style:italic">#&nbsp;Use&nbsp;KCL&nbsp;Plugin&nbsp;to&nbsp;mutate&nbsp;or&nbsp;validate&nbsp;Kubernetes&nbsp;manifests.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token string" style="color:#e3116c">"set-annotation"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config.kubernetes.io/function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;docker.io/kcllang/kustomize</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v0.2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">resource&nbsp;</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">if&nbsp;resource.kind&nbsp;==&nbsp;"Deployment"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;metadata.annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">"managed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">by"&nbsp;=&nbsp;"helmfile</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&nbsp;for&nbsp;resource&nbsp;in&nbsp;option("resource_list").items</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述配置中，我们引用了 Prometheus Helm Chart, 并通过一行 KCL 代码就可以完成 Prometheus 的所有的 Deployment 资源注入标签&nbsp;<code>managed-by="helmfile-kcl"</code>，通过如下命令我们可以将上述配置下发到集群</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helmfile&nbsp;apply</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多用例可以参考<a href="https://github.com/kcl-lang/krm-kcl" target="_blank" rel="noopener noreferrer">这里</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-operator">KCL Operator<a href="#kcl-operator" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL Operator 提供了 Kubernetes 集群集成，允许您在将资源应用到集群时使用 Access Webhook 根据 KCL 配置生成、变异或验证资源。Webhook 将捕获创建、应用和编辑操作，并 <code>KCLRun</code> 在与每个操作关联的配置上执行资源，比如可以使用 KCL 语言完成如下功能</p><ul><li>使用 KCL 对资源进行修改，如根据某个条件添加/修改 label 标签或 annotation 注释或在包含 PodTemplate 的所有 Kubernetes Resource Model (KRM) 资源中注入 Sidecar 容器配置等。</li><li>使用 KCL Schema 验证所有 KRM 资源，如约束只能以 Root 方式启动容器等。</li><li>使用抽象模型生成 KRM 资源或者对不同的 KRM API 进行组合并使用。</li></ul><p>下面以一个简单的资源 annotation 注解修改示例介绍 KCL Operator 的使用方式</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="0前置条件">0.前置条件<a href="#0前置条件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>通过 k3d 等工具准备一个 Kubernetes 集群以及 kubectl 工具</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-安装-kcl-operator">1. 安装 KCL Operator<a href="#1-安装-kcl-operator" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/kcl-lang/kcl-operator/main/config/all.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用以下命令观察并等待 pod 状态为 Running。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-部署注解修改模型">2. 部署注解修改模型<a href="#2-部署注解修改模型" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: set-annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # 设置注解修改模型所需的动态参数，在此处我们可以添加我们想要修改/添加的标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  params:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      managed-by: kcl-operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # 引用 OCI 上注解修改模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  source: oci://ghcr.io/kcl-lang/set-annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-部署一个-pod-资源验证模型结果">3. 部署一个 Pod 资源验证模型结果<a href="#3-部署一个-pod-资源验证模型结果" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>执行如下命令部署一个 Pod 资源</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    image: nginx:1.14.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - containerPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po nginx -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> kcl-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以看到如下输出</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    managed-by: kcl-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以发现 Nginx Pod 上自动添加了 <code>managed-by=kcl-operator</code> 注解</p><p><img loading="lazy" alt="registry" src="/zh-CN/assets/images/registry-b5cd8f6cff3682c13bd30d3ce0eeaa18.png" width="1972" height="1000" class="img_ev3q"></p><p>此外，我们已经在 KCL 官方 Registry 中开箱提供了多达 30 个内置模型可以允许您在轻易完成对已有 Kubernetes 资源的编辑、校验和抽象。</p><p>比如使用 web-service 模型直接实例化出一个 web 应用所需的 Kubernetes 资源；使用 set-annotation 模型对已有的 k8s 资源添加 annotation；使用 https-only 模型校验您的 Ingress 配置只能设置为 https, 否则报错。</p><p><a href="https://github.com/kcl-lang/krm-kcl/tree/main/examples" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/krm-kcl/tree/main/examples</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vault-集成">Vault 集成<a href="#vault-集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>仅需三步，我们就可以使用 Vault 来存储并管理敏感信息并在 KCL 中使用。</p><p>首先我们安装并使用 Vault 存储 <code>foo</code> 和 <code>bar</code> 信息</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vault kv put secret/foo </span><span class="token assign-left variable" style="color:#36acaa">foo</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault kv put secret/bar </span><span class="token assign-left variable" style="color:#36acaa">bar</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后编写如下 KCL 代码 (main.k)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apps/v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"secret-store"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vault"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Valid format:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#  "ref+vault://PATH/TO/KV_BACKEND#/KEY"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"foo"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ref+vault://secret/foo#/foo"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"bar"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ref+vault://secret/bar#/bar"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"${metadata.name}:1.14.2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后可以通过 Vals 命令行工具获得解密后的配置</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl main.k </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> vals </span><span class="token builtin class-name">eval</span><span class="token plain"> -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多详情和用例可以参考 <a href="https://kcl-lang.io/docs/user_docs/guides/secret-management/vault" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/secret-management/vault</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-ci-集成">GitLab CI 集成<a href="#gitlab-ci-集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的文章中，我们提到了使用 Github Action 作为 CI 通过 GitOps 方式进行应用发布，此次版本中我们进一步提供了 GitLab CI 集成，用例详情可参考：<em><a href="https://kcl-lang.io/docs/user_docs/guides/ci-integration/gitlab-ci" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/ci-integration/gitlab-ci</a></em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他更新与错误修复">其他更新与错误修复<a href="#其他更新与错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>完整更新和错误修复列表<a href="https://github.com/kcl-lang/kcl/compare/v0.5.0...v0.6.0" target="_blank" rel="noopener noreferrer">详见</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档更新">文档更新<a href="#文档更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a> 新增 KCL v0.6.0 文档内容并支持版本化语义选项，目前支持 v0.4.x, v0.5.x 和 v0.6.0 版本选择，同时欢迎社区同学进行文档共建。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>感谢 @jakezhu9 对 KCL Import 工具包括 Terraform Provider Schema, JsonSchema, Json, YAML 等配置格式/数据到 KCL Schema/配置的转换 🙌</li><li>感谢 @xxmao123 对 KCL LSP 语言服务器接入到 Idea IDE 插件的贡献 🙌</li><li>感谢 @starkers 对 KCL NeoVim 插件的贡献 🙌</li><li>感谢 @starkers 对 mason.nvim registry 增加 KCL 的安装支持 🙌</li><li>感谢 @Ekko 对 KCL 云原生工具集成以及 KCL Operator 的贡献 🙌</li><li>感谢 @prahaladramji 对 KCL Homebrew 安装脚本的升级更新与贡献 🙌</li><li>感谢 @yyxhero 在 Helmfile KCL 插件支持中提供的帮助与支持 🙌</li><li>感谢 @nkabir, @mihaigalos, @prahaladramji, @yamin-oanda, @dhhopen,@magick93, @MirKml, @kolloch, @steeling 等在过去两个月使用 KCL 过程中提出的宝贵反馈和讨论&nbsp;🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题及解答">常见问题及解答<a href="#常见问题及解答" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>详见 <a href="https://kcl-lang.io/docs/user_docs/support/faq-kcl" target="_blank" rel="noopener noreferrer">KCL 常见问题</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户和社区小伙伴在此次版本更新过程中提出的宝贵反馈与建议。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL GitHub 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion GitHub 仓库</a></li></ul><p>欢迎加入我们的社区进行交流 👏👏👏：<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[动态配置管理新范式: KRM KCL 规范]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-09-06-dcm-using-kcl</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-09-06-dcm-using-kcl</guid>
            <pubDate>Fri, 08 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><blockquote><p>随着云原生技术的发展，我们更多地转向云基础设施，Kubernetes 和 Terraform 等 IaC 工具已成为越来越流行的管理和部署基于云 API 的应用程序的工具。但是随之而来衍生出的复杂性问题和认知负担问题在近几年达到了高峰。</p></blockquote><p><img loading="lazy" alt="cognitive-loading" src="/zh-CN/assets/images/cognitive-loading-cd34fd0e961c6bca77ebf85ae4a7c97d.png" width="1492" height="742" class="img_ev3q"></p><p>Kubernetes 和云 API 越来越复杂的原因主要有以下几点：</p><ul><li><strong>不断增加的功能和能力</strong>：Kubernetes 和云 API 都是为了应对不断增长的应用需求和云计算的发展而不断演进。为了满足用户的需求，它们不断引入新的功能和能力，如自动扩展、服务发现、负载均衡、权限管理等。这些新功能的引入增加了系统的复杂性。虽然我们已经有了各式各样的自动化手段，随着时间的推移，因为不同资源类型的数量、这些资源类型的潜在设置数量以及这些资源类型之间的复杂关系呈指数级增长</li><li><strong>复杂的配置和管理需求</strong>：随着应用规模的增长，配置和管理 Kubernetes 和云 API 变得越来越复杂。例如，需要管理大量的容器实例和资源、配置复杂的网络和存储、实现高可用性和负载均衡，需要针对不同的环境和拓扑重复的进行配置等。这些复杂的配置和管理需求增加了 Kubernetes 和云 API 的复杂性，开玩笑的说甚至在 Kubernetes 领域常常伴随催生了一批 YAML 工程师。</li></ul><p>尽管 Kubernetes 和云 API 的复杂性愈发增加，但它们提供了强大的功能和灵活性，可以帮助组织更好地管理和扩展其应用程序。通过使用适当的工具、工程实践和方法，可以减轻这种复杂性，并更有效地利用这些技术来满足业务需求。动态配置管理技术便是其中之一可以一定程度帮助解决 Kubernetes 和云 API 的复杂性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是动态配置管理">什么是动态配置管理<a href="#什么是动态配置管理" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>我们遵循动态配置管理的创建者 Chris Stephenson 的<a href="https://humanitec.com/blog/what-is-dynamic-configuration-management" target="_blank" rel="noopener noreferrer">原始定义</a>并进行一定程度的延伸</p><blockquote><p>动态配置管理（DCM）是一种用于构建计算工作负载配置的方法。开发人员创建工作负载规范，描述成功运行工作负载所需的一切。该规范用于动态创建配置，以便在特定环境中部署工作负载。使用 DCM，开发人员不需要为其工作负载定义或维护任何特定于环境的配置。</p></blockquote><p>动态配置管理意味着开发人员以<strong>抽象的</strong>、<strong>与环境无关</strong>的方式描述他们的工作负载与资源的关系。他们描述这种关系的格式称为<strong>工作负载规范</strong>或者<strong>以应用为中心的规范</strong>。该规范是通用的并且跨环境工作，这意味着它没有提供足够的信息来配置工作负载和资源本身。为了获得可以执行的配置，我们需要将规范应用于配置基线（对于应用程序和基础设施配置），并根据部署的上下文生成它们。对于开发人员来说，动态配置管理需要提供开发者可以理解的以应用为中心的配置界面；对于平台工程师来说，动态配置管理可以帮助定义如何处理配置资源和工作负载规范；这有助于提高组织的一致性和合规性。它还使得提供自助式内部开发者平台 (IDP) 变得更加容易。</p><p>与动态配置管理相对应的方式是静态配置管理，静态配置会带来一系列问题</p><ul><li><strong>维度爆炸</strong>: 大多数静态配置需要为每个环境单独进行配置；在最糟糕的情况下，它可能引入涉及环境交叉链接的难以调试的错误，稳定性和扩展性都较差。</li><li><strong>配置漂移</strong>: 对于不同环境的静态管理应用程序和基础设施配置的方式，往往没有标准的方式去管理这些动态的不同环境的配置，采用非标准化的方法会导致复杂度呈指数增长，并导致配置漂移。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么需要一种新范式">为什么需要一种新范式<a href="#为什么需要一种新范式" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>正如记录音乐有五线谱，存储时间序列数据有时序数据库一样，在平台工程的特定问题域内，一批配置和策略语言用于编写和管理规模化复杂配置及策略。不同于混合编写范式、混合工程能力的高级通用语言，这类专用语言的核心逻辑是以收敛的有限的语法、语义集合解决领域问题近乎无限的变化和复杂性，将复杂配置和策略编写思路和方式沉淀到语言特性中。</p><p>对于云 API, 我们借助 Terraform 等 IaC 工具可以获得大量的已经编写好的 Module 配置，但是对于 Kubernetes 仍然缺乏客户端的轻量级的配置组合和抽象解决方案，现有的方案或者规范难以在抽象能力和扩展性获得平衡，甚至对于一些极端场景，开发者往往编写许多胶水代码和脚本对配置进行处理逻辑，稳定性和效率都受到一定桎梏。比如 Helm Chart 等工具虽然提供了模版编程方式，但编程体验和效率均不佳，此外当用户需要动态调整 Helm Chart 的 <code>values.yaml</code> 参数依赖或者遇到需要设置的参数上游的 Helm Chart 不支持时，往往需要以侵入的方式 Fork 维护上游 Helm Chart 或者辅以 Kustomize 等工具，这带来的额外的维护成本和复杂性。</p><p>于是我们思考需要有一个统一规范描述来同时承载配置语言能力，并且可以尽可能无副作用地同时满足规模化配置场景下的稳定性、扩展性、效率等特性，并且解决静态配置管理的问题</p><ul><li><strong>抽象和组合能力</strong>：通过可编程 Schema 的方式提供给平台人员屏蔽底层底层基础设施细节和平台，并提供给开发人员一个更好更稳定的 API 抽象。</li><li><strong>稳定性</strong>：通过语言内置开箱提供的稳定特性如规则编写，静态类型等特性，使得风险尽可能左移，在 VCS 中编写实时发现错误，可审计可追溯可回滚，易于自动化。</li><li><strong>可复用扩展性</strong>：就像应用软件供应链那样，应当将基础设施配置也视为软件供应链中的一环，用户可以通过标准的方式分发复用配置，对于常用的配置用户可以在开源世界中轻易获得它，对于内部平台，我们可以轻易编写和扩展配置代码。</li><li><strong>高性能</strong>：由于动态配置管理提倡由一份基线配置根据部署上下文生成不同环境不同拓扑的配置，对于配置代码本身的执行渲染性能有较高的要求，开发者通常不希望花费数十分钟才看到真实配置输出而影响软件迭代升级的效率</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="krm-kcl-规范">KRM KCL 规范<a href="#krm-kcl-规范" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://github.com/kcl-lang/krm-kcl" target="_blank" rel="noopener noreferrer">KRM KCL 规范</a>是基于 Kubernetes Resource Model（KRM）的一种配置规范。KRM 是一个通用的配置模型，用于描述和管理各种云原生资源，如容器、Pod、服务等。KRM 提供了一种统一的方式来定义和管理这些资源，使得它们可以在不同的环境中进行移植和复用。它建立在一个完全开放的 Kubernetes 世界当中，几乎不与任何编排/引擎工具或者 Kubernetes 控制器绑定，它在关注点分离的基础上允许平台人员扩展自己的抽象，配置编辑和验证逻辑，并且对于社区中已有的模型抽象如 Open Application Model (OAM) 等，可以直接进行复用，因为 OAM 配置本身也满足 KRM 规范。</p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL 配置语言</a>是 KRM KCL 规范 的核心组成部分。KCL 是一种声明性的配置语言，它允许用户描述应用程序的配置需求，并将其与底层基础设施进行关联。KCL 具有丰富的语法和语义，可以灵活地描述各种配置需求，如环境变量、资源限制、依赖关系等。KCL 旨在通过定义 API 抽象来隐藏基础设施和平台的详细信息，以减轻负担，并通过配置语言无副作用地管理跨团队的大规模配置，并提供编写、组合和抽象配置块的能力，如结构定义、约束和逻辑等。在平台工程实践中 KCL 不是一种仅用于编写 K-V 对的语言，而是一种面向平台工程领域的专用语言</p><p>KRM KCL 规范的另一个重要特性是其对动态配置管理的支持。传统的配置管理工具往往依赖于静态配置文件，需要手动修改和部署。而 KRM KCL 规范天然提供了配置自动修改的方式，可以单独在客户端使用也可以通过 <a href="https://github.com/kcl-lang/kcl-operator" target="_blank" rel="noopener noreferrer">KCL Operator</a> 与 Kubernetes 集成，在运行时实现配置自动修改，无需重复开发 Kubernetes Webhook 编写大量的配置处理逻辑。</p><p>除了动态配置管理，KRM KCL 规范 还具有一些其他的优势。首先，它基于 Kubernetes，可以与现有的 Kubernetes 生态系统进行无缝集成。其次，KRM KCL 规范提供了丰富的工具和库，使得开发人员可以轻松地创建、测试和维护配置。最后，KRM KCL 规范采用了开放的标准，可以与其他的配置管理工具如 Kubectl, Helm, Kustomize 等进行互操作，并且具备如下特点</p><ul><li><strong>声明式</strong>：配置描述以代码方式抽象和组织，用户可以通过编辑器或 IDE 查看、编辑，代码中清晰描述了资源、服务、网络等多方面的配置。</li><li><strong>面向终态</strong>：面向终态且实现无关，通过高度抽象并内置特定领域的基础能力，具象的业务由使用者编写声明。使用者通过统一的描述代码和 GitOps 流程避免人工操作及私有脚本的非统一模式和引入的安全问题。</li><li><strong>稳定性</strong>：任何配置代码的修改都可能造成非预期的结果，甚至异常或故障发生。结合版本控制和语言本身的稳定性特性。不同版本的配置代码可以通过 Git 按需切换，可审计性，以满足研发、测试、生产阶段的需求，如异常后回滚到某个验证可用的版本。结合版本控制的代码化可以有效避免配置漂移。</li><li><strong>可复用扩展</strong>：配置代码往往有 “一次编写，多次使用” 的特点，结合动态参数化的配置代码往往使差异环境、差异用户等多维度的配置复用需求变得简单。通过与 OCI 等标准软件供应链的方式集成，将配置代码与业务代码同等对待，更好地实现基础设施即代码 (IaC)</li></ul><p>总而言之，KRM KCL 规范是一种全新的动态配置管理范式，它以 KRM 和 KCL 为基础，为现代软件开发提供了更高效、更可靠的配置解决方案。它的动态配置管理能力、灵活的语法和语义以及与 Kubernetes 的集成，无论是在云原生应用开发还是在微服务架构中，KRM KCL 规范都将为开发人员带来更好的配置管理体验。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何使用-krm-kcl-规范">如何使用 KRM KCL 规范<a href="#如何使用-krm-kcl-规范" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="krm-kcl-form" src="/zh-CN/assets/images/krm-kcl-form-45fbde927c717df577661f7453bf5b54.png" width="2250" height="1208" class="img_ev3q"></p><p>在 KRM KCL 规范，我们将 KCL 配置模型的行为主要分成三类</p><ul><li><strong>Mutation</strong>: 输入 KCL 参数 <code>params</code> 和 KRM 列表并输出修改后 KRM 列表。</li><li><strong>Validation</strong>: 输入 KCL 参数 <code>params</code> 和 KRM 列表并输出 KRM 列表和资源验证结果。</li><li><strong>Abstraction</strong>: 输入 KCL 参数 <code>params</code> 并输出 KRM 列表</li></ul><p>我们可以使用 KCL 以可编程的方式实现如下能力:</p><ul><li>使用 KCL 对资源进行修改，如根据某个条件添加/修改 label 标签或 annotation 注释或在包含 PodTemplate 的所有 Kubernetes Resource Model (KRM) 资源中注入 Sidecar 容器配置等。</li><li>使用 KCL Schema 验证所有 KRM 资源，如约束只能以 Root 方式启动容器等。</li><li>使用抽象模型生成 KRM 资源或者对不同的 KRM API 进行组合并使用。</li></ul><p>此外配置模型 <code>source</code> 可以引用自 OCI，Git, Filesystem, 和原始 KCL 代码，我们可以借助 KCL IDE 和 KPM 包管理工具编写模型并上传到 OCI Registry 以实现模型复用，并且这些模型可以根据场景需求分别用在客户端或者运行时。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端">客户端<a href="#客户端" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>我们以一个经典的工作负载 Web 服务作为例子演示 KRM KCL 规范在客户端使用的例子。</p><p>此外，我们以统一的编程界面方式为 Kubernetes 社区的 Kubectl, Helm, Kustomize, KPT 等配置管理工具提供了插件支持，编写几行配置代码即可无侵入地完成对存量 Kustomize YAML，Helm Charts 的编辑和校验以及定义自己的抽象模型并分享复用。</p><p>下面以 Kubectl 工具对 KCL 的集成为例进行详细说明。您可以在<a href="https://github.com/kcl-lang/kubectl-kcl" target="_blank" rel="noopener noreferrer">这里</a>获取 Kubectl KCL 插件的安装方式</p><p>首先执行如下命令获取一个配置示例</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/kubectl-kcl.git </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> ./kubectl-kcl/examples/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后执行如下命令显示配置</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> krm-kcl-abstraction.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: web-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  params:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nginx:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - port: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source: oci://ghcr.io/kcl-lang/web-service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述配置中，我们使用了在 OCI 上已经预定好的一个 Kubernetes Web 服务应用抽象模型 <code>oci://ghcr.io/kcl-lang/web-service</code>, 并通过 <code>params</code> 字段配置了该模型所需的配置字段。通过执行如下命令可以获得原始的 Kubernetes YAML 输出并下发到集群:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl kcl apply -f krm-kcl-abstraction.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/app created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/app created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了使用 YAML 作为用户的输入界面，KCL 作为一个编写配置和策略的 DSL，它还允许开发者和平台人员在客户端以统一的 KCL 编写方式编写和维护大规模配置</p><p><img loading="lazy" alt="standalone-kcl-form" src="/zh-CN/assets/images/standalone-kcl-form-fe25553cd2ae8413a3c33071b7bace3d.png" width="2232" height="1274" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="运行时">运行时<a href="#运行时" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在运行时，我们通过 KCL Operator 提供了 Kubernetes 集群集成，允许您在将资源应用到集群时使用 Access Webhook 根据 KCL 配置生成、变异或验证资源。Webhook 将捕获创建、应用和编辑操作，并通过 <code>KCLRun</code> 在与每个操作关联的配置上执行资源。使用 KCL Operator, 通过几个步骤您就可以在 Kubernetes 集群内部以很轻量的方式地通过 KCL 代码自动化地完成资源配置的管理和安全验证，无需重复开发 Webhook Server 在运行时动态修改和验证配置。</p><p>此外借助 KCL 良好的建模和抽象能力，我们可以为不同的资源 API 定义进行功能抽象/组合并以 KCL Schema 的形式对外透出，并且可以由 KCL Schema 进一步自动生成 OpenAPI Schema 定义供集群其他客户端调用，而无需为 API 抽象/组合手动维护复杂的 OpenAPI Schema 定义。</p><p>下面以一个简单的资源 annotation 注解修改示例介绍 KCL Operator 的使用方式</p><p>安装 KCL Operator</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/kcl-lang/kcl-operator/main/config/all.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用以下命令观察并等待 pod 状态为 <code>Running</code>。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部署注解修改模型</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: set-annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  params:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      managed-by: kcl-operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  source: oci://ghcr.io/kcl-lang/set-annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部署一个 Pod 资源验证模型结果</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    image: nginx:1.14.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - containerPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po nginx -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> kcl-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以看到如下输出</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    managed-by: kcl-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以发现 Nginx Pod 上自动添加了 managed-by=kcl-operator 注解</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>通过动态配置管理的方式可以降低现代云原生配置的复杂性，通过 KRM KCL 规范以及标准的 OCI 模型，我们可以实现动态配置管理，并使平台人员和应用开发人员都可以轻松地使用这些设置，降低认知负担。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多资源">更多资源<a href="#更多资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>Declarative Application Management in Kubernetes: <a href="https://docs.google.com/document/d/1cLPGweVEYrVqQvBLJg6sxV-TrE5Rm2MNOBA_cxZP2WU/edit#" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1cLPGweVEYrVqQvBLJg6sxV-TrE5Rm2MNOBA_cxZP2WU/edit#</a></li><li>CNCF Platforms White Paper: <a href="https://tag-app-delivery.cncf.io/whitepapers/platforms/" target="_blank" rel="noopener noreferrer">https://tag-app-delivery.cncf.io/whitepapers/platforms/</a></li><li>Google SRE Workbook: <a href="https://sre.google/workbook/configuration-specifics/" target="_blank" rel="noopener noreferrer">https://sre.google/workbook/configuration-specifics/</a></li><li>What is Dynamic Configuration Management: <a href="https://humanitec.com/blog/what-is-dynamic-configuration-management" target="_blank" rel="noopener noreferrer">https://humanitec.com/blog/what-is-dynamic-configuration-management</a></li><li>Implementing Dynamic Configuration Management with Score and Humanitec: <a href="https://humanitec.com/blog/implementing-dynamic-configuration-management-with-score-and-humanitec" target="_blank" rel="noopener noreferrer">https://humanitec.com/blog/implementing-dynamic-configuration-management-with-score-and-humanitec</a></li><li>What is Platform Engineering: <a href="https://platformengineering.org/blog/what-is-platform-engineering" target="_blank" rel="noopener noreferrer">https://platformengineering.org/blog/what-is-platform-engineering</a></li><li>What is Internal Developer Platform: <a href="https://internaldeveloperplatform.org/what-is-an-internal-developer-platform/" target="_blank" rel="noopener noreferrer">https://internaldeveloperplatform.org/what-is-an-internal-developer-platform/</a></li><li>What Team Structure is Right for DevOps to Flourish: <a href="https://web.devopstopologies.com/#anti-types" target="_blank" rel="noopener noreferrer">https://web.devopstopologies.com/#anti-types</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Kubernetes Resource Model</category>
            <category>Dynamic Configuration Management</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 08.24 - 09.06) | Kubernetes Operator，IDE 插件和 v0.5.6 版本正式发布!]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-09-06-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-09-06-biweekly-newsletter</guid>
            <pubDate>Wed, 06 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 08.24 - 09.06) 的杰出工作，以下是重点合并内容概述</p><p><strong>🔧 语言及工具链更新</strong></p><ul><li>KCL&nbsp;导入工具更新 - 支持由 JSON/YAML 数据导出为 KCL 配置</li><li>KCL IDE 更新 - 支持右键一键格式化能力，支持直接格式化单个文件或部分 KCL 代码</li><li>KCL 文档工具更新 - 导出文档支持 HTML 转义</li><li>KCL 包管理工具 KPM 更新 - kpm run 运行命令以及错误信息优化，支持直接运行位于本地路径的 KCL 包</li><li>KCL 语言更新 - 优化系统库类型检查等错误信息及错误信息代码统一</li></ul><p><strong>📰 官网和用例更新</strong></p><ul><li>KCL 官网新增 v0.5.6 文档版本</li><li>新增通过 Github Action 发布 KCL 代码包直接发布到 docker.io 和 ghcr.io 等 Registry 用例: <em><a href="https://github.com/kcl-lang/kpm/blob/main/docs/push_by_github_action.md" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/blob/main/docs/push_by_github_action.md</a></em></li><li>新增 KCL Operator 集成用例: <em><a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/mutate-manifests/kcl-operator" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/mutate-manifests/kcl-operator</a></em></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @jakezhu9 对 KCL Import 工具 JSON 和 YAML 配置数据到 KCL 配置块转换的贡献 🙌 <em><a href="https://github.com/kcl-lang/kcl-go/pull/141" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/141</a></em></li><li>感谢 @xxmao123 和 @starkers 对 KCL NeoVim 以及 Idea IDE 插件的贡献 🙌 <em><a href="https://github.com/kcl-lang/intellij-kcl/pull/12" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/intellij-kcl/pull/12</a></em></li><li>此外感谢 @kolloch, @prahaladramji 等在过去两周使用 KCL 过程中提出的宝贵反馈和讨论&nbsp;🙌</li></ul><p><strong>祝贺 @jakezhu9 祝贺 jakezhu9 成为 KCL 社区 Maintainer</strong> 🎉</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-operator">KCL Operator<a href="#kcl-operator" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL Operator 提供了 Kubernetes 集群集成，允许您在将资源应用到集群时使用 Access Webhook 根据 KCL 配置生成、变异或验证资源。Webhook 将捕获创建、应用和编辑操作，并 <code>KCLRun</code> 在与每个操作关联的配置上执行资源，比如可以使用 KCL 语言完成如下功能</p><ul><li>使用 KCL 对资源进行修改，如根据某个条件添加/修改 label 标签或 annotation 注释或在包含 PodTemplate 的所有 Kubernetes Resource Model (KRM) 资源中注入 Sidecar 容器配置等。</li><li>使用 KCL Schema 验证所有 KRM 资源，如约束只能以 Root 方式启动容器等。</li><li>使用抽象模型生成 KRM 资源或者对不同的 KRM API 进行组合并使用。</li></ul><p>使用 KCL Operator, 通过几个步骤您就可以在 Kubernetes 集群内部以很轻量的方式地通过 KCL 代码自动化地完成资源配置的管理和安全验证，无需重复开发 Webhook Server 在运行时动态修改和验证配置。</p><p>此外借助 KCL 良好的建模和抽象能力，我们可以为不同的资源 API 定义进行功能抽象/组合并以 KCL Schema 的形式对外透出，并且可以由 KCL Schema 进一步自动生成 OpenAPI Schema 定义供集群其他客户端调用，而无需为 API 抽象/组合手动维护复杂的 OpenAPI Schema 定义。</p><p>下面以一个简单的资源 annotation 注解修改示例介绍 KCL Operator 的使用方式</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="0前置条件">0.前置条件<a href="#0前置条件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>通过 k3d 等工具准备一个 Kubernetes 集群以及 kubectl 工具</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-安装-kcl-operator">1. 安装 KCL Operator<a href="#1-安装-kcl-operator" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/kcl-lang/kcl-operator/main/config/all.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用以下命令观察并等待 pod 状态为 Running。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-部署注解修改模型">2. 部署注解修改模型<a href="#2-部署注解修改模型" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: set-annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # 设置注解修改模型所需的动态参数，在此处我们可以添加我们想要修改/添加的标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  params:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      managed-by: kcl-operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # 引用 OCI 上注解修改模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  source: oci://ghcr.io/kcl-lang/set-annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-部署一个-pod-资源验证模型结果">3. 部署一个 Pod 资源验证模型结果<a href="#3-部署一个-pod-资源验证模型结果" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>执行如下命令部署一个 Pod 资源</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f- </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    image: nginx:1.14.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - containerPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po nginx -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> kcl-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以看到如下输出</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    managed-by: kcl-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以发现 Nginx Pod 上自动添加了 <code>managed-by=kcl-operator</code> 注解</p><p>此外，除了为 <code>KCLRun</code> 资源 <code>source</code> 字段引用已有的模型，我们可以直接为 <code>source</code> 字段设置 KCL 代码也可以达到同样的效果，比如</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> set</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">managed-by</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 仅通过一行 KCL 代码就可完成资源的修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    items = [item | {metadata.annotations: option("params").annotations} for item in option("items")]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们已经开箱提供了多达 30+ 的内置模型，您可以在下面的链接中获得更多代码示例</p><p><a href="https://github.com/kcl-lang/krm-kcl/tree/main/examples" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/krm-kcl/tree/main/examples</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-ide-插件更新">KCL IDE 插件更新<a href="#kcl-ide-插件更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>过去两周，我们将 KCL 语言服务器 LSP 集成到了 NeoVim 和 Idea 中，使得可以在 NeoVim 和 IntelliJ IDEA 中体验到和 VS Code IDE 支持的补全、跳转和悬停等功能</p><ul><li>NeoVim KCL 插件</li></ul><p><img loading="lazy" alt="kcl.nvim" src="/zh-CN/assets/images/overview-0667184faaf2ee0abe93374de277929b.png" width="1246" height="1121" class="img_ev3q"></p><ul><li>IntelliJ 插件</li></ul><p><img loading="lazy" alt="intellij" src="/zh-CN/assets/images/overview-1dbf1cc2cd1bbf6b03b06702335a10ce.png" width="1041" height="650" class="img_ev3q"></p><p>更多 IDE 插件下载安装方式和功能说明可参考：</p><ul><li><a href="https://kcl-lang.io/docs/user_docs/getting-started/install#neovim" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/getting-started/install#neovim</a></li><li><a href="https://kcl-lang.io/docs/user_docs/getting-started/install#intellij-idea" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/getting-started/install#intellij-idea</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。预计 9 月中旬我们会正式发布 KCL v0.6 新版本，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p></li><li><p><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></p></li><li><p><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/milestone/6" target="_blank" rel="noopener noreferrer">KCL v0.6.0 Milestone</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></p></li><li><p><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></p></li><li><p><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[快讯！祝贺 jakezhu9 成为 KCL 社区 Maintainer！KCL Import 工具再迎增强功能！]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-09-04-maintainer-jakezhu9-blog</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-09-04-maintainer-jakezhu9-blog</guid>
            <pubDate>Mon, 04 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[快讯]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="快讯">快讯<a href="#快讯" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><img loading="lazy" alt="jakezhu9" src="/zh-CN/assets/images/jakezhu9-e86a88e78b79e456fe198fd44d6ec5a1.png" width="460" height="460" class="img_ev3q"></p><p>🎉 近日，KCL 社区迎来了一位新的 Maintainer 成员，<strong>恭喜 jakezhu9 成功晋升为社区维护者</strong>。</p><p>感谢他在 KCL Go SDK 中做出一系列贡献以及为 KCL Import 工具带来的一系列增强功能的升级，为用户提供更加便捷高效的数据和 Schema 导入体验。以下是他近期的<strong>重要贡献列表</strong></p><ul><li>🔧 <strong>支持从 JSON/YAML 数据转换为 KCL 配置</strong>: <a href="https://github.com/kcl-lang/kcl-go/pull/145" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/145</a></li><li>🔧 <strong>支持从 Terraform Provider Schema 转换为 KCL Schema</strong>: <a href="https://github.com/kcl-lang/kcl-go/pull/141" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/141</a></li><li>🔧 <strong>支持从 JsonSchema 转换为 KCL Schema</strong>: <a href="https://github.com/kcl-lang/kcl-go/pull/127" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/127</a></li></ul><p>新晋 Maintainer 的加入，不仅标志着 jakezhu9 在技术上的卓越表现，也体现了社区对他的高度认可和信任。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="心得体会">心得体会<a href="#心得体会" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><em>以下是 jakezhu9 同学参与 KCL 社区的心得体会</em></p><p>我非常幸运能够加入 KCL 这样一个优秀的社区来，并参与项目的开发和社区的建设。从一开始了解云原生领域 KusionStack 和 KCL 这样强大的工具和语言，到为项目修复一个简单的 Bug，再到逐步设计和开发 KCL 转换和生成的部分，在这个过程中，我不仅获得了技术水平上的提升，还积累了许多的开源贡献的经验，感受到了不断进步的快乐和成就感。每当看到自己提交的 PR 被合并时，我都会感到特别的满足。感谢 KCL 社区，也感谢社区的前辈和一路上遇到的所有小伙伴，他们在我开发过程中给了我很多的想法和建议，真的非常有帮助。</p><p>KCL 社区是一个开放自由、充满活力与机遇的开源社区，来自不同公司、学校，拥有不同技术背景的开发者，共同在 Github、社区周会上相互交流碰撞，探索前沿的技术解决方案，并为社区持续贡献高效简洁的代码。无论是开源新手还是技术大佬，都可以快速融入社区并参与其中。社区里和谐友好、共同进步的氛围，也让我感到非常的温暖。未来，我将继续为 KCL 社区贡献更多的力量，也热烈欢迎感兴趣的同学加入我们，共同参与到社区的建设和发展中来！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></li><li><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></li><li><a href="https://github.com/kcl-lang/kcl/milestone/6" target="_blank" rel="noopener noreferrer">KCL v0.6.0 Milestone</a></li><li><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></li><li><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></li><li><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Maintainer</category>
        </item>
        <item>
            <title><![CDATA[2023 平台工程会议 KCL 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-platform-engineering-tech-summit</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-platform-engineering-tech-summit</guid>
            <pubDate>Fri, 01 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[PDF 下载]]></description>
            <content:encoded><![CDATA[<p><a href="https://kcl-lang.github.io/talks/kcl-platform-engineering-tech-summit2023.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p><p><img loading="lazy" alt="KCL Talk Cover" src="/zh-CN/assets/images/talk-cover-72827f4a8955d903dc92815cf3ebacb4.jpg" width="2484" height="1392" class="img_ev3q"></p>]]></content:encoded>
            <category>KCL</category>
            <category>Meeting</category>
        </item>
        <item>
            <title><![CDATA[5 分钟玩转 Helmfile KCL 插件，轻松管理 Kubernetes Helm Charts]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-08-31-helmfile-kcl-plugin</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-08-31-helmfile-kcl-plugin</guid>
            <pubDate>Thu, 31 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[什么是 KCL]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-kcl">什么是 KCL<a href="#什么是-kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-helmfile">什么是 Helmfile<a href="#什么是-helmfile" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Helmfile 是一个是用于简化和管理 Helm Charts 的声明性规范和工具，Helmfile KCL 插件为 Helmfile 工具提供了额外的功能，使得在使用 Helmfile 时更加便捷和高效，通过 Helmfile KCL 插件您可以</p><ul><li>通过无侵入的 Hook 方式在客户端直接编辑或者验证 Helm Chart 配置，将 Kubernetes 配置管理的数据部分和逻辑部分分离，无需 Fork 上游 Chart 修改内部逻辑，比如<ul><li>修改资源标签/注解, 注入 Sidecar 容器配置</li><li>使用 KCL Schema 校验 Kubernetes 资源，定义自己的抽象模型并分享复用</li></ul></li><li>优雅地维护多环境、多租户场景配置，而不是简单地复制粘贴</li></ul><p>在本文中，我们将带您快速了解和入门 Helmfile KCL 插件，让您轻松管理您的 Kubernetes Helm Charts。</p><p>下面以一个简单示例进行详细说明，使用 Helmfile KCL 插件无需您安装与 KCL 任何相关的组件，只需本机具备 Helmfile 工具的最新版本（v0.156.0+）即可。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-helmfile-kcl-插件">使用 Helmfile KCL 插件<a href="#使用-helmfile-kcl-插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-工具安装">1. 工具安装<a href="#1-工具安装" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>首先，确保您已经安装了 Helmfile 客户端工具，可以根据下面链接中的文档提示进行安装。</p><p><a href="https://github.com/helmfile/helmfile" target="_blank" rel="noopener noreferrer">https://github.com/helmfile/helmfile</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-创建-helmfile-配置文件">2. 创建 Helmfile 配置文件<a href="#2-创建-helmfile-配置文件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在您的项目根目录中创建一个名为 helmfile.yaml 的文件，并按照 Helmfile 的语法编写配置。在这个文件中，您可以指定要使用的 Helm Charts、配置值和任何其他 Helmfile 支持的功能。此外，您还可以在 helmfile.yaml 中使用 KCL 插件的功能来加载对 Helm Chart 进行原地配置修改和验证</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">repositories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community.github.io/helm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">releases</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prom</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">norbac</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ubuntu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">chart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">set</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rbac.create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">transformers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Use KCL Plugin to mutate or validate Kubernetes manifests.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"set-annotation"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">config.kubernetes.io/function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              container:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                image: docker.io/kcllang/kustomize-kcl:v0.2.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            # 仅通过一行 KCL 代码，就可实现对 workload 配置原地修改</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            items = [resource | {if resource.kind == "Deployment": metadata.annotations: {"managed-by" = "helmfile-kcl"}} for resource in option("resource_list").items]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述配置中，我们引用了 Prometheus Helm Chart, 并通过一行 KCL 代码就可以完成 Prometheus 的所有的 Deployment 资源注入标签 managed-by="helmfile-kcl"。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-运行-helmfile-工具">3. 运行 Helmfile 工具<a href="#3-运行-helmfile-工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>一切准备就绪后，您可以运行 Helmfile 命令来部署、管理和维护您的 Helm Charts，通过如下命令我们可以将上述配置下发到集群。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helmfile apply</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>正常情况我们会看到如下面所示的输出</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Adding repo prometheus-community https://prometheus-community.github.io/helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">"prometheus-community"</span><span class="token plain"> has been added to your repositories</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="想要更多">想要更多?<a href="#想要更多" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>对于上述 helmfile 配置，我们可以将其封装为常用的配置修改逻辑并使用，无需不断重复编写 KCL 代码并到处复制粘贴。此外，我们在 KCL 官方 Registry 已经封装好了许多常用的 Kubernetes 配置编辑和校验代码片段 <a href="https://github.com/orgs/kcl-lang/packages" target="_blank" rel="noopener noreferrer">https://github.com/orgs/kcl-lang/packages</a></p><p><img loading="lazy" alt="registry" src="/zh-CN/assets/images/registry-f8060f021f94e6c708d5af3f88e2e8f4.png" width="1080" height="1064" class="img_ev3q"></p><p>除了支持在配置文件中书写 KCL 代码，我们还支持直接引用 Registry 中的代码片段，如下所示</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">krm.kcl.dev/version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">krm.kcl.dev/type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">documentation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Requires Ingress resources to be HTTPS only.  Ingress resources must</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      include the `kubernetes.io/ingress.allow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">http` annotation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set to `false`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      By default a valid TLS </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> configuration is required</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> this can be made</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      optional by setting the `tlsOptional` parameter to `true`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">More info</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kubernetes.io/docs/concepts/services</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">networking/ingress/</span><span class="token comment" style="color:#999988;font-style:italic">#tls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Use the OCI source</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> oci</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//ghcr.io/kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lang/https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体的示例代码在<a href="https://github.com/kcl-lang/krm-kcl/tree/main/examples" target="_blank" rel="noopener noreferrer">这里</a></p><p>如果您想贡献更多的 KCL 代码库，欢迎联系我们并参阅文档进行贡献 <a href="https://kcl-lang.io/zh-CN/docs/user_docs/guides/package-management/share_your_pkg/" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/zh-CN/docs/user_docs/guides/package-management/share_your_pkg/</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>本文提供了一个快速入门指南，帮助您在 5 分钟内掌握 Helmfile KCL 插件的基本用法。现在，您可以开始使用这个强大的工具来简化和优化您的 Kubernetes 应用部署流程了！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>更多其他资源请参考：</p><ul><li><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p></li><li><p><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></p></li><li><p><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/milestone/6" target="_blank" rel="noopener noreferrer">KCL v0.6.0 Milestone</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></p></li><li><p><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></p></li><li><p><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 08.10 - 08.23) | KCL v0.5.3, v0.5.4 和 v0.5.5 版本发布]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-08-23-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-08-23-biweekly-newsletter</guid>
            <pubDate>Wed, 23 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有贡献者过去两周 (2023 08.10 - 08.23) 的杰出工作，以下是重点合并内容概述</p><ul><li><strong>🔧 语言及工具链更新</strong><ul><li>KCL 格式化工具更新<ul><li>支持对有语法错误的代码片段和部分代码片段进行格式化</li><li>支持对缩进不对的配置块进行自动校正</li></ul></li><li>KCL 文档工具更新<ul><li>支持导出文档索引页</li></ul></li><li>KCL&nbsp;导入工具更新<ul><li>支持 Terraform Provider Schema 转换为 KCL Schema</li></ul></li><li>KCL 导出工具更新<ul><li>支持由 KCL Schema 导出 OpenAPI Spec，接入 OpenAPI 生态</li></ul></li><li>KCL IDE 更新<ul><li>支持编译缓存特性，提升部分 IDE 功能性能</li><li>丰富 IDE 错误信息，并提供 Import 语句快速修复能力</li></ul></li><li>KCL 包管理工具 KPM 更新<ul><li>kpm push 输出信息体验优化，增加推送 KCL 程序包的重复 tag 检查</li><li>为 kpm push 和 kpm pkg 增加参数 —vendor 决定是否将 KCL 程序包的三方库打包在一起</li></ul></li><li>KCL 语言更新<ul><li>优化 Schema 语义检查和联合类型检查等错误信息</li><li>支持导出配置块的类型输出</li></ul></li></ul></li><li><strong>🏄 API 更新</strong><ul><li>KCL Schema 模型解析&nbsp;GetSchemaType API 获取 KCL 包相关信息和 Schema 属性默认值</li></ul></li><li><strong>📰 官网和用例更新</strong><ul><li>新增通过 docker.io 发布 KCL 包用例: <em><a href="https://github.com/kcl-lang/kpm/blob/main/docs/publish_to_docker_reg.md" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kpm/blob/main/docs/publish_to_docker_reg.md</a></em></li><li>新增 KCL Gitlab CI 集成用例: <em><a href="https://kcl-lang.io/docs/user_docs/guides/ci-integration/gitlab-ci" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/ci-integration/gitlab-ci</a></em></li><li>新增 KCL 密钥管理 Vault 和 Vals 集成用例:&nbsp;<em><a href="https://kcl-lang.io/docs/user_docs/guides/secret-management/vault" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/secret-management/vault</a></em></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以下排名不分先后</p><ul><li>感谢 @jakezhu9 对 KCL Import 工具 Terraform Schema 到 KCL Schema 转换的贡献 🙌 <em><a href="https://github.com/kcl-lang/kcl-go/pull/141" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-go/pull/141</a></em></li><li>感谢 @xxmao123 和 @starkers 对 NeoVim KCL 插件的讨论与贡献 🙌 <em><a href="https://github.com/kcl-lang/vim-kcl/pull/2" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/vim-kcl/pull/2</a></em></li><li>感谢 @starkers 对 mason.nvim registry 增加 KCL 的安装支持 🙌 <em><a href="https://github.com/mason-org/mason-registry/pull/2425" target="_blank" rel="noopener noreferrer">https://github.com/mason-org/mason-registry/pull/2425</a></em></li><li>感谢 @prahaladramji 对 KCL Homebrew 安装脚本的升级更新与贡献 🙌 <em><a href="https://github.com/kcl-lang/homebrew-tap/pull/1" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/homebrew-tap/pull/1</a></em></li><li>感谢 @yamin-oanda 为 Pulumi 官方提供 KCL 支持的讨论 🙌 <em><a href="https://github.com/pulumi/pulumi/discussions/13722" target="_blank" rel="noopener noreferrer">https://github.com/pulumi/pulumi/discussions/13722</a></em></li><li>此外感谢 @nkabir, @mihaigalos, @prahaladramji, @yamin-oanda, @magick93, @MirKml 等在过去两周使用 KCL 过程中提出的宝贵反馈和讨论&nbsp;🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-import-工具更新">KCL Import 工具更新<a href="#kcl-import-工具更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL Import 工具在 Protobuf, JsonSchema OpenAPI 模型和 Go 结构体转换为 KCL Schema 的基础上，新增 Terraform Provider Schema 到 KCL Schema 的转换支持，比如对于如下的 Terraform Provider Json (通过 <code>terraform providers schema -json &gt; provider.json</code> 命令获得，详情请参考 <a href="https://developer.hashicorp.com/terraform/cli/commands/providers/schema" target="_blank" rel="noopener noreferrer">https://developer.hashicorp.com/terraform/cli/commands/providers/schema</a>)</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"format_version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"provider_schemas"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"registry.terraform.io/aliyun/alicloud"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"provider"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"block"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"attributes"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"block_types"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"resource_schemas"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"alicloud_db_instance"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"block"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"attributes"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"db_instance_type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"engine"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"required"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"security_group_ids"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"set"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"security_ips"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"set"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"tags"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"map"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"block_types"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"alicloud_config_rule"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"block"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"attributes"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"compliance"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string" style="color:#e3116c">"list"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token property" style="color:#36acaa">"compliance_type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token property" style="color:#36acaa">"count"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">"resource_types_scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"list"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"description_kind"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"optional"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"computed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"data_source_schemas"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>经过 KCL Import 工具可以输出为如下 KCL 代码</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">This file was generated by the KCL auto-gen tool. DO NOT EDIT.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Editing this file might prove futile when you re-run the KCL auto-gen generate command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema AlicloudConfigRule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    AlicloudConfigRule</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    compliance: [ComplianceObject], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    resource_types_scope: [str], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compliance?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ComplianceObject</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_types_scope?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema ComplianceObject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ComplianceObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    compliance_type: str, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    count: int, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compliance_type?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema AlicloudDbInstance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    AlicloudDbInstance</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    db_instance_type: str, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    engine: str, required</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    security_group_ids: [str], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    security_ips: [str], optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    tags: {str:str}, optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db_instance_type?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    engine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    security_group_ids?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    security_ips?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isunique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">security_group_ids</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isunique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">security_ips</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-vault-集成">KCL Vault 集成<a href="#kcl-vault-集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>仅需三步，我们就可以使用 Vault 来存储并管理敏感信息并在 KCL 中使用。</p><p>首先我们安装并使用 Vault 存储 <code>foo</code> 和 <code>bar</code> 信息</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vault kv put secret/foo </span><span class="token assign-left variable" style="color:#36acaa">foo</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault kv put secret/bar </span><span class="token assign-left variable" style="color:#36acaa">bar</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后编写如下 KCL 代码 (main.k)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apps/v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"secret-store"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vault"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Valid format:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#  "ref+vault://PATH/TO/KV_BACKEND#/KEY"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"foo"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ref+vault://secret/foo#/foo"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"bar"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ref+vault://secret/bar#/bar"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"${metadata.name}:1.14.2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后可以通过 Vals 命令行工具获得解密后的配置</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kcl main.k </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> vals </span><span class="token builtin class-name">eval</span><span class="token plain"> -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多详情和用例可以参考 <a href="https://kcl-lang.io/docs/user_docs/guides/secret-management/vault" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/user_docs/guides/secret-management/vault</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>🎉 恭喜来自华中科技大学的朱俊星同学成功通过 Gitlink 编程夏令营 (GLCC) 中期考核并出色地完成了 KCL Import 工具 Jsonschema 和 Terraform Provider Schema 与 KCL Schema 转换的部分，后续社区将为其授予 KCL 社区 Maintainer 角色</li><li>💻 KCL 参加 CNCF 云原生计算基金会应用交付 TAG 社区会议并作项目汇报</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会撰写更多 KCL v0.5.x 新版本功能解读系列文章，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p></li><li><p><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></p></li><li><p><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/milestone/6" target="_blank" rel="noopener noreferrer">KCL v0.6.0 Milestone</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></p></li><li><p><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></p></li><li><p><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[KCL 社区开源双周报 (2023 07.26 - 08.09) | KCL 0.5.1 和 0.5.2 版本正式发布]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-08-09-biweekly-newsletter</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-08-09-biweekly-newsletter</guid>
            <pubDate>Wed, 09 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="/zh-CN/assets/images/biweekly-newsletter-zh-bd4cf8c2bcc913a580e7b0e5d6691a08.png" width="1127" height="435" class="img_ev3q"></p><p><a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本栏目将会双周更新 KCL 语言社区最新动态，包括功能、官网更新和最新的社区动态等，帮助大家更好地了解 KCL 社区！</p><p><strong><em>KCL 官网：<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">https://kcl-lang.io</a></em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内容概述">内容概述<a href="#内容概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>过去两周 (2023 07.26 - 08.09)，KCL 所有项目中总计有&nbsp;<strong>34</strong>&nbsp;个 PR 被合并，感谢所有贡献者的杰出工作，以下是重点合并内容概述</p><ul><li><strong>🔧 语言及工具链更新</strong><ul><li>KCL Doc 文档工具新增 Markdown 文档导出支持</li><li>KCL&nbsp;Import 导入工具更新 - 支持 JsonSchema 转换为 KCL Schema</li><li>KCL 包管理工具 KPM 支持在 kcl.mod 中设置编译参数，优化命令行提示信息</li><li>KCL IDE 插件优化补全、跳转和悬停文档显示等功能，并支持 NeoVim 编辑器</li></ul></li><li><strong>🏄 API 更新</strong><ul><li>KCL Schema 模型解析&nbsp;GetSchemaType API 新增装饰器信息和包信息字段</li></ul></li><li><strong>🏠 社区扩展更新</strong><ul><li>Helmfile KCL 插件支持</li></ul></li><li><strong>📰 官网和用例更新</strong><ul><li>KCL 官网新增&nbsp;v0.5.x&nbsp;文档版本选择</li><li>新增 KCL 用例仓库:&nbsp;<em><a href="https://github.com/kcl-lang/examples" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/examples</a></em></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="特别鸣谢">特别鸣谢<a href="#特别鸣谢" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>感谢 @jakezhu9 对 KCL Import 工具 JsonSchema 转换的贡献 🙌</li><li>感谢 @xxmao123 对 Vim 和 NeoVim KCL 插件的贡献 🙌</li><li>感谢 @yyxhero 在 Helmfile KCL 插件支持中提供的帮助与支持 🙌</li><li>感谢 @nkabir, @mihaigalos, @prahaladramji, @dhhopen 等在使用 KCL 过程中提出的宝贵建议和讨论&nbsp;🙌</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="精选更新">精选更新<a href="#精选更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-import-工具更新">KCL Import 工具更新<a href="#kcl-import-工具更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL Import 工具在 Protobuf, OpenAPI 模型和 Go 结构体转换为 KCL Schema 的基础上，新增 JsonSchema 到 KCL Schema 的转换支持，比如对于如下的 JsonSchema</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://json-schema.org/draft-07/schema#"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"$id"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://example.com/schemas/customer.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"$defs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"properties"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"city"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"state"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"$ref"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#/$defs/state"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"state"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"object"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"properties"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"properties"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"address"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"$ref"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#/$defs/address"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>经过 KCL Import 工具可以输出为如下 KCL 代码</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema&nbsp;Customer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;Customer</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;str,&nbsp;optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;address:&nbsp;Address,&nbsp;optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;name?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;address?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;Address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema&nbsp;Address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;Address</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;city:&nbsp;str,&nbsp;optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;state:&nbsp;State,&nbsp;optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;city?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;state?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;State</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema&nbsp;State</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;State</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;str,&nbsp;optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&nbsp;&nbsp;&nbsp;&nbsp;"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;name?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token builtin">str</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="helmfile-kcl-插件">Helmfile KCL 插件<a href="#helmfile-kcl-插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Helmfile 是用于部署 Helm Chart 的声明性规范和工具，通过 Helmfile KCL 插件您可以</p><ul><li>通过无侵入的 Hook 方式编辑或者验证 Helm Chart 配置，将 Kubernetes 配置管理的数据部分和逻辑部分分离<ul><li>修改资源标签/注解, 注入 Sidecar 容器配置</li><li>使用 KCL Schema 校验资源，定义自己的抽象模型并分享复用</li></ul></li><li>优雅地维护多环境、多租户场景配置，而不是简单地复制粘贴</li></ul><p>下面以一个简单示例进行详细说明，使用 Helmfile KCL 插件无需您安装与 KCL 任何相关的组件，只需本机具备 Helmfile 工具的最新版本即可。</p><p>我们可以编写一个如下所示&nbsp;<code>helmfile.yaml</code>&nbsp;文件</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">repositories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community.github.io/helm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">releases</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prom</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">norbac</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ubuntu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;chart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;set</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;rbac.create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;transformers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;</span><span class="token comment" style="color:#999988;font-style:italic">#&nbsp;Use&nbsp;KCL&nbsp;Plugin&nbsp;to&nbsp;mutate&nbsp;or&nbsp;validate&nbsp;Kubernetes&nbsp;manifests.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&nbsp;apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token string" style="color:#e3116c">"set-annotation"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config.kubernetes.io/function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;docker.io/kcllang/kustomize</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v0.2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">resource&nbsp;</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">if&nbsp;resource.kind&nbsp;==&nbsp;"Deployment"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;metadata.annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&nbsp;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">"managed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">by"&nbsp;=&nbsp;"helmfile</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&nbsp;for&nbsp;resource&nbsp;in&nbsp;option("resource_list").items</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述配置中，我们引用了 Prometheus Helm Chart, 并通过一行 KCL 代码就可以完成 Prometheus 的所有的 Deployment 资源注入标签&nbsp;<code>managed-by="helmfile-kcl"</code>，通过如下命令我们可以将上述配置下发到集群</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helmfile&nbsp;apply</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多用例可以参考<a href="https://github.com/kcl-lang/krm-kcl" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>❤️ 感谢所有 KCL 用户和社区小伙伴在社区中提出的宝贵反馈与建议。后续我们会撰写更多 KCL v0.5.x 新版本功能解读系列文章，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p></li><li><p><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">KusionStack 网站</a></p></li><li><p><a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/milestone/6" target="_blank" rel="noopener noreferrer">KCL v0.6.0 Milestone</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">KCL Github Issues</a></p></li><li><p><a href="https://github.com/orgs/kcl-lang/discussions" target="_blank" rel="noopener noreferrer">KCL Github Discussion</a></p></li><li><p><a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL Community</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/releases/tag/v0.5.0" target="_blank" rel="noopener noreferrer">KCL v0.5.0 Release</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/releases/tag/v0.5.1" target="_blank" rel="noopener noreferrer">KCL v0.5.1 Release</a></p></li><li><p><a href="https://github.com/kcl-lang/kcl/releases/tag/v0.5.2" target="_blank" rel="noopener noreferrer">KCL v0.5.2&nbsp;Release</a></p></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Biweekly-Newsletter</category>
        </item>
        <item>
            <title><![CDATA[使用 Github、Argo CD 和 KCL 实现 GitOps 以简化 DevOps]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-07-31-kcl-github-argocd-gitops</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-07-31-kcl-github-argocd-gitops</guid>
            <pubDate>Mon, 31 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在现代软件开发中，GitOps 作为管理基础架构和应用程序的单一真相自动化的方法可以提高效率和减少人为错误方面发挥着关键作用，目前广泛流行于云原生等领域。但是关于 GitOps 相关的实践示例并不多见，本文将以 KCL、Github、ArgoCD 和 GitOps 作为一个使用示例来详细介绍，希望可以帮助大家实践自己的 GitOps 自动化流程并简化 DevOps。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-gitops">什么是 GitOps<a href="#什么是-gitops" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>GitOps 是一种实现持续交付的现代方式。它的核心思想是拥有一个包含环境和应用程序配置的 Git 存储库。通过更改应用存储库中的文件，可以自动部署应用程序。应用 GitOps 的好处包括：</p><ul><li>提高生产力，持续交付可以加快部署时间。</li><li>降低开发人员部署的障碍。通过推送代码而不是容器配置，开发人员可以在不知道其内部实现的情况下轻松部署 Kubernetes 集群和应用。</li><li>追踪变更记录。使用 Git 管理配置使每一项更改都具有可跟踪性，从而增强审计跟踪。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="将-kcl-与-gitops-一起使用">将 KCL 与 GitOps 一起使用<a href="#将-kcl-与-gitops-一起使用" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>将 KCL 与 GitOps 工具一起使用具有如下好处:</p><ul><li>通过 KCL 语言的抽象能力和可编程能力可以帮助我们<strong>简化复杂的 Kubernetes 部署配置文件</strong>，降低手动编写 YAML 文件的错误率，将配置约束检查控制在编译时，编写即感知错误；同时可以消除多余的配置模版，提升多环境多租户的配置扩展能力，提高配置的可读性和可维护性。</li><li>KCL 允许开发人员以声明式的方式定义应用程序所需的资源，通过将 KCL 和 ArgoCD 相结合可以帮助我们更好地实现<strong>基础设施即代码（IaC）</strong>，提高部署效率，简化应用程序的配置管理。</li><li>ArgoCD 可以<strong>自动化</strong>地实现应用程序的连续部署，并提供友好的 KCL 配置<strong>可视化管理界面</strong>。</li></ul><p>使用 GitOps，开发人员和运维团队可以通过分别修改应用和配置代码来管理应用程序的部署，GitOps 工具链将自动同步对配置的更改，从而实现持续部署并确保一致性。如果出现问题，可以使用 GitOps 工具链快速回滚。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="工作流程">工作流程<a href="#工作流程" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在此示例中，我们使用一个 Python Flask 应用和 Github Actions 作为 CI 示例，使用 ArgoCD 作为 CD 示例，使用 KCL 定义需要部署的 Kubernetes 资源</p><blockquote><p>注意：你可以在此方案中使用任何容器化应用以及不同的 CI 和 CD 系统如 Gitlab CI，Jenkins CI，FluxCD 等，后续我们会出更多的示例文章来进行说明</p></blockquote><p>我们将 Python Flask 应用代码和配置代码分成两个仓库，<em>以实现不同角色如开发人员和运维团队的关注点分离</em></p><ul><li>业务代码仓库: <a href="https://github.com/kcl-lang/flask-demo" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/flask-demo</a></li><li>配置清单仓库: <a href="https://github.com/kcl-lang/flask-demo-kcl-manifests" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/flask-demo-kcl-manifests</a></li></ul><p>整体工作流程如下：</p><p><img loading="lazy" alt="workflow" src="/zh-CN/assets/images/workflow-4707133c144cbe28bfea3f5a1563bd4c.jpg" width="1048" height="624" class="img_ev3q"></p><ol><li>从 Github 拉取应用代码</li><li>应用代码开发并提交到提交到 GitHub 存储库</li><li>触发 GitHub Actions 对应用代码进行编译，生成容器镜像，并将容器镜像推送到 Docker Hub 容器注册表</li><li>触发 GitHub Actions 根据 docker.io 容器注册表中容器镜像的版本号并同步更新 KCL 定义的 Kubernetes 清单部署文件</li><li>ArgoCD 获取 KCL 定义的 Kubernetes 清单更改并更新部署至 Kubernetes 集群</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="具体步骤">具体步骤<a href="#具体步骤" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="0-先决条件">0. 先决条件<a href="#0-先决条件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>熟悉 Unix/Linux 的基本命令</li><li>熟悉 Git 以及 Github Action 使用</li><li>了解 Kubernetes 基本知识</li><li>了解 ArgoCD 等工具</li><li>了解 KCL 基本知识</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-配置-kubernetes-集群">1. 配置 Kubernetes 集群<a href="#1-配置-kubernetes-集群" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>安装 <a href="https://github.com/k3d-io/k3d" target="_blank" rel="noopener noreferrer">K3d</a> 并创建一个集群</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">k3d cluster create mycluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：你可以在此方案中使用其他方式创建您自己的 Kubernetes 集群，如 kind, minikube 等。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-配置-argocd">2. 配置 ArgoCD<a href="#2-配置-argocd" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置-argocd-控制器">配置 ArgoCD 控制器<a href="#配置-argocd-控制器" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><blockquote><p>注意：你可以在此方案中使用其他方式创建您自己的 Kubernetes 集群，如 kind, minikube 等。</p></blockquote><ul><li>安装 <a href="https://github.com/argoproj/argo-cd/releases/" target="_blank" rel="noopener noreferrer">ArgoCD</a>.</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace argocd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>安装 ArgoCD KCL 插件</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/kcl-lang.io.git/ </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> ./kcl-lang.io/examples/gitops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f ./install/kcl-cmp.yaml </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kubectl -n argocd patch deploy/argocd-repo-server -p </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">cat</span><span class="token string variable" style="color:#36acaa"> ./install/patch-argocd-repo-server.yaml</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>通过 <code>kubectl get</code> 命令查看 argocd 控制器容器是否初始化完成进入运行（Running）状态。</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -n argocd -l app.kubernetes.io/name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argocd-repo-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>通过如下命令打开 ArgoCD UI</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward svc/argocd-server -n argocd </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">:443</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>打开浏览器 <code>https://localhost:8080</code> 输入用户名 "admin" 和密码登陆 ArgoCD UI，密码可以通过如下命令得到:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n argocd get secret argocd-initial-admin-secret -o </span><span class="token assign-left variable" style="color:#36acaa">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"{.data.password}"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> base64 -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置-argocd-客户端工具">配置 ArgoCD 客户端工具<a href="#配置-argocd-客户端工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li><p>安装 <a href="https://github.com/argoproj/argo-cd/releases" target="_blank" rel="noopener noreferrer">ArgoCD 客户端工具</a></p></li><li><p>使用用户名 "admin" 和刚才得到的密码登陆</p></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">argocd login localhost:8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过如下命令创建一个 ArgoCD KCL 应用</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">argocd app create flaskdemo </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--repo https://github.com/kcl-lang/flask-demo-kcl-manifests </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--path </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--dest-namespace default </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--dest-server https://kubernetes.default.svc </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--config-management-plugin kcl-v1.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果创建成功，您可以看到如下输出:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">application </span><span class="token string" style="color:#e3116c">'flaskdemo'</span><span class="token plain"> created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>如果您使用的是私有存储库，则在执行 create 命令之前，需要使用私钥凭据配置专用私有存储库访问权限。请参阅<a href="https://argo-cd.readthedocs.io/en/stable/user-guide/private-repositories/" target="_blank" rel="noopener noreferrer">这里</a>以获取更多详细信息。</p></blockquote><p>通过 ArgoCD UI，您可以看到创建的应用程序尚未同步，您可以手动进行配置同步或设置为自动同步。</p><p><img loading="lazy" src="/zh-CN/assets/images/argocd-kcl-app-3eda0ee903240a2371c45cd384c14653.jpg" width="2128" height="1008" class="img_ev3q"></p><p>有关同步策略的更多信息，可以请参阅<a href="https://argo-cd.readthedocs.io/en/stable/user-guide/sync-options/" target="_blank" rel="noopener noreferrer">这里</a></p><p><img loading="lazy" src="/zh-CN/assets/images/argocd-kcl-app-dashboard-82ae80d5dbb9da2eeb3e8f3efe867c01.jpg" width="3328" height="1132" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-获得业务代码">3. 获得业务代码<a href="#3-获得业务代码" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/flask-demo.git/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flask-demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这是一个使用 Python 编写的 Web 应用，我们可以使用应用目录的 <code>Dockerfile</code> 来生成这个应用的容器镜像，同时可以通过 Github CI 自动构建 <code>flask_demo</code> 镜像，CI 配置如下</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># This is a basic workflow to help you get started with Actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Controls when the workflow will run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Triggers the workflow on push or pull request events but only for the main branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pull_request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Allows you to run this workflow manually from the Actions tab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflow_dispatch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># This workflow contains a single job called "build"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># The type of runner that the job will run on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Steps represent a sequence of tasks that will be executed as part of the job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Docker Login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker/login</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v1.10.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.DOCKER_USERNAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.DOCKER_PASSWORD </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">logout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Runs a set of commands using the runners shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          make image</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          docker tag flask_demo:latest ${{ secrets.DOCKER_USERNAME }}/flask_demo:${{ github.sha }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          docker push ${{ secrets.DOCKER_USERNAME }}/flask_demo:${{ github.sha }}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Trigger KCL manifest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Trigger CI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InformaticsMatters/trigger</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ci</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@1.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ci-owner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ci-repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ci-ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> refs/heads/main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ci-user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ci-user-token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.DEPLOY_ACCESS_TOKEN </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ci-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ci-inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.DOCKER_USERNAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sha</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">tag=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.sha </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们需要源码仓库的工作流自动触发部署清单仓库中的工作流，此时需要创建具有 Github CI 操作权限的 <code>secrets.DEPLOY_ACCESS_TOKEN</code> 以及 Docker Hub 镜像推送的账号信息 <code>secrets.DOCKER_USERNAME</code> 和 <code>secrets.DOCKER_PASSWORD</code>, 这些可以在 Github 仓库的 <code>Secrets and variables</code> 设置中进行配置，如下图所示</p><p><img loading="lazy" src="/zh-CN/assets/images/github-secrets-997c2a5201a5ae259e3310d6015d1f9e.png" width="2204" height="632" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-提交应用代码">4. 提交应用代码<a href="#4-提交应用代码" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>flask-demo 仓库提交代码后，Github 会自动构建容器镜像，并将制品推送到 Docker hub 中，会再触发 flask-demo-kcl-manifests 仓库的 Action，<a href="/zh-CN/docs/user_docs/guides/automation">通过 KCL 自动化 API</a> 修改部署清单仓库中的镜像地址。现在让我们为 flask-demo 仓库创建一个提交，我们可以看到代码提交后触发业务仓库 Github CI 流程</p><p><img loading="lazy" src="/zh-CN/assets/images/app-ci-8be610b01c177f72ff2f2f617b7305bd.png" width="2252" height="1038" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-配置自动更新">5. 配置自动更新<a href="#5-配置自动更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>当业务仓库 Github CI 流程执行完成后，会自动在存放 KCL 资源配置的仓库触发一个 CI 自动更新配置并提交到 flask-demo-kcl-manifests main 分支，commit 信息如下</p><p><img loading="lazy" src="/zh-CN/assets/images/image-auto-update-514f27b74172b114a5dc877e98fd88f4.png" width="2240" height="1090" class="img_ev3q"></p><ul><li>我们可以获得部署清单源码进行编译验证</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/flask-demo-kcl-manifests.git/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flask-demo-kcl-manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout main </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> pull </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kcl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出 YAML 为</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcllang/flask_demo:6428cff4309afc8c1c40ad180bb9cfd82546be3e"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从上述配置可以看出资源的镜像确实自动更新为了新构建的镜像内容。</p><p>此外，我们可以在 ArgoCD UI 界面中将同步策略设置为自动同步，这样就可以实现业务代码提交并部署 Kubernetes 的 e2e 完整自动化流程。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结论">结论<a href="#结论" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>通过本篇文章，我们可以使用 Github, ArgoCD 和 KCL 等创建 GitOps 自动化流水线，可以高效稳定地构建容器化应用，同时自动化更新最新的 Docker 镜像标签，并保持 Git 配置与集群配置一致。此外，通过将 KCL 和 ArgoCD 相结合可以帮助我们更好地实现基础设施即代码（IaC），提高部署效率，实现不同角色的关注点分离并简化应用程序的配置管理。</p>]]></content:encoded>
            <category>KCL</category>
            <category>Github</category>
            <category>ArgoCD</category>
            <category>GitOps</category>
        </item>
        <item>
            <title><![CDATA[KCL 介绍 PPT]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-07-18-kcl-intro-slides</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-07-18-kcl-intro-slides</guid>
            <pubDate>Tue, 18 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[PDF 下载]]></description>
            <content:encoded><![CDATA[<p><a href="https://kcl-lang.github.io/talks/kcl-intro.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.5.0 发布日志]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.5.0-release-blog</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.5.0-release-blog</guid>
            <pubDate>Fri, 14 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 KCL v0.5.0 新版本现在已经可用！本次发布为大家带来了三方面的重点更新：<strong>语言</strong>、<strong>工具链</strong>、<strong>社区集成 &amp; 扩展支持</strong>。</p><ul><li><em>使用功能更完善错误更少的 KCL 语言和 IDE 提升代码编写体验和效率</em></li><li><em>使用 KPM, KCL OpenAPI 和 OCI Registry 等工具直接使用和共享您的云原生领域模型，降低学习和上手成本</em></li><li><em>使用 Github Action, ArgoCD 和 Kubectl KCL 插件等社区工具集成和扩展支持提升自动化效率</em></li></ul><p>进一步您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.5.0" target="_blank" rel="noopener noreferrer">KCL v0.5.0 发布页面</a> 或者 <a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">KCL 官方网站</a> 获得下载安装指南和详细发布信息。</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言并通过成熟的编程语言技术和实践来改进对大量繁杂配置比如云原生 Kubernetes 配置场景的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更简单的自动化和生态工具集成。</p><p>本文重点介绍 KCL v0.5.0 版本的更新内容以及 KCL 社区的近期动态。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="语言更新">语言更新<a href="#语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="顶级变量输出">顶级变量输出<a href="#顶级变量输出" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，运行如下 KCL 代码不会得到 YAML 输出，在 KCL v0.5.0 版本中，我们对此进行了改进并支持了顶级变量导出为 YAML 配置，用于减少额外的 KCL 代码书写和命令行参数，比如对于如下 KCL 代码 (main.k)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nginx </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 这里的 Nginx 实例会直接输出为 YAML</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/var/www/html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"index.html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在新版本中，运行 KCL 代码可以直接获得如下输出</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl main.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">listen</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/www/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">index</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> index.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/556" target="_blank" rel="noopener noreferrer">详见</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引签名更新">索引签名更新<a href="#索引签名更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，尚未支持在 Schema 索引签名中直接引用，在 KCL v0.5.0 版本中，我们对此进行了改进并支持了顶级变量导出为 YAML 配置，用于减少额外的 KCL 样板配置代码书写，比如对于如下 KCL 代码 (main.k)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema TeamSpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fullName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shortName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema TeamMap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TeamSpec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TeamSpec </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n  </span><span class="token comment" style="color:#999988;font-style:italic"># n 作为 Schema 索引签名别名，可以直接使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">teamMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TeamMap </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fullName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"alpha"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fullName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"bravo"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在新版本中，运行 KCL 代码可以获得如下输出</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl main.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">teamMap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fullName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bravo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">shortName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fullName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alpha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">shortName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/582" target="_blank" rel="noopener noreferrer">详见</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-支持运行时错误-backtrace-打印">KCL 支持运行时错误 Backtrace 打印<a href="#kcl-支持运行时错误-backtrace-打印" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在新版本中，我们支持当 KCL 代码运行发生报错时输出 Backtrace 的特性，用于提升 KCL 代码错误排查效率，比如对于如下代码 (main.k)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Fib</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 这里有索引溢出的运行时错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Fib </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Fib </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fib8 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Fib </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行后会获得如下报错</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl main.k -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">E3M38</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: EvaluationError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EvaluationError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> main.k:8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 这里有索引溢出的运行时错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  list index out of range: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">note: backtrace:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: __main__.Fib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                at main.k:8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">: __main__.Fib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                at main.k:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">: __main__.Fib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                at main.k:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">: main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                at main.k:14</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/528" target="_blank" rel="noopener noreferrer">详见</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="错误修复">错误修复<a href="#错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="filter-表达式返回值类型错误修复">filter 表达式返回值类型错误修复<a href="#filter-表达式返回值类型错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在之前的 KCL 版本中，filter 表达式会返回错误的类型（应该返回被迭代对象的类型，而不是返回迭代对象的类型），在 KCL v0.5.0 版本中，我们修复了此类类似的问题</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Student</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grade</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">students</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Student</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Alice"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> grade </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">85</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Bob"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> grade </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">70</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">studentsGrade70</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Student</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">filter</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> students </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">grade </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 这里之前得到一个类型错误，版本更新后修复了此类问题</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/546" target="_blank" rel="noopener noreferrer">详见</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="lambda-函数闭包捕获">lambda 函数闭包捕获<a href="#lambda-函数闭包捕获" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在之前的 KCL 版本中，在编写如下 KCL 代码时，会错误的捕获闭包变量的值。在 KCL v0.5.0 版本中，我们修复了此类类似的问题</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> y </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># x 是内层 lambda 函数的闭包变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/548" target="_blank" rel="noopener noreferrer">详见</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="包含-utf-8-字符的字符串联合类型检查错误修复">包含 UTF-8 字符的字符串联合类型检查错误修复<a href="#包含-utf-8-字符的字符串联合类型检查错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在之前的 KCL 版本中，在编写如下包含 UTF-8 字符的字符串联合类型 KCL 代码时，会获得一个非预期的类型错误。在 KCL v0.5.0 版本中，我们修复了此类类似的问题</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"无需容灾"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"标准型"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"流水型"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"流水型"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息<a href="https://github.com/kcl-lang/kcl/pull/600" target="_blank" rel="noopener noreferrer">详见</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ide--工具链更新">IDE &amp; 工具链更新<a href="#ide--工具链更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-openapi-工具">KCL OpenAPI 工具<a href="#kcl-openapi-工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>kcl-openapi 命令行工具支持由 OpenAPI Spec 到 KCL 代码的转换。可通过 go install 或 curl 获得安装：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># go install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> kcl-lang.io/kcl-openapi@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># curl install (MacOS &amp; Linux)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://kcl-lang.io/script/install-kcl-openapi.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> /bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-kcl-包转换优化">Kubernetes KCL 包转换优化<a href="#kubernetes-kcl-包转换优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>v0.5.0 版本优化了使用 Kubernetes KCL 包的体验：</p><ul><li>免转换获得：KCL 提供了开箱即用的 Kubernetes 1.14-1.27 各个版本的 KCL 包，通过包管理工具 <code>kpm add k8s:&lt;version&gt;</code> 即可获得</li><li>如需自行转换其他 Kubernetes 版本的 KCL 模型，可通过如下的预处理脚本一键从 Kubernetes 仓库下载的 swagger.json 文件转换为 KCL 包，将如下命令的 1.27 改为需要的 Kubernetes 版本即可</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1.27</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">spec_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">swagger.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">script_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">main.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://raw.githubusercontent.com/kubernetes/kubernetes/release-</span><span class="token variable" style="color:#36acaa">${version}</span><span class="token plain">/api/openapi-spec/swagger.json -O swagger.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://raw.githubusercontent.com/kcl-lang/kcl-openapi/main/scripts/preprocess/main.py -O main.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token variable" style="color:#36acaa">${script_path}</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${spec_path}</span><span class="token plain"> --omit-status --rename</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">io.k8s</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kcl-openapi generate model -f processed-</span><span class="token variable" style="color:#36acaa">${spec_path}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>脚本预期的执行输出为对应版本的 KCL Kubernetes 模型，生成的路径为 <code>&lt;工作空间路径&gt;/models/k8s</code></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree models/k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">models/k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── admissionregistration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── match_condition.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── mutating_webhook.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── mutating_webhook_configuration.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── mutating_webhook_configuration_list.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── rule_with_operations.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── service_reference.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── validating_webhook.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="错误修复-1">错误修复<a href="#错误修复-1" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><ul><li>将带有-符号的属性名称转义为<!-- -->_<!-- -->符号，以符合 KCL v0.5.0 语法，<a href="https://github.com/kcl-lang/kcl-openapi/pull/43" target="_blank" rel="noopener noreferrer">详见</a></li><li>自动识别并设置 import as 引用别名，避免引用冲突，<a href="https://github.com/kcl-lang/kcl-openapi/pull/45" target="_blank" rel="noopener noreferrer">详见</a></li><li>修复 docstring 中属性描述缩进问题，对属性描述内部换行进行自动缩进，<a href="https://github.com/kcl-lang/kcl-openapi/pull/46" target="_blank" rel="noopener noreferrer">详见</a></li><li>修复生成的引用路径为基于包的根目录的全引用路径，<a href="https://github.com/kcl-lang/kcl-openapi/pull/51" target="_blank" rel="noopener noreferrer">详见</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="包管理工具">包管理工具<a href="#包管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 KCL v0.5.0 新版本中，我们提供了全新的 KCL 包管理工具，用户可以通过几个命令即可获得社区中已经编写好的 KCL 模型。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="通过-kpm-命令行管理-kcl-程序">通过 kpm 命令行管理 KCL 程序<a href="#通过-kpm-命令行管理-kcl-程序" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在使用 kpm 之前，需要确保您当前在一个 KCL 包中工作，您可以使用命令 kpm init 创建一个标准的 KCL 程序包。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm init kubernetes_demo </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> kubernetes_demo </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kpm </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> k8s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，使用 k8s 包中的内容编写您的 KCL 代码（main.k）。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 导入 k8s 包中的内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> k8s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">apps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> apps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Deployment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx-deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx:1.14.2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 <code>kpm run</code> 和 <code>kubectl</code> 命令行结合使用，我们可以直接将资源配置下发到集群</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kpm run </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/nginx-deployment configured</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="oci-registry-支持">OCI Registry 支持<a href="#oci-registry-支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>kpm 支持通过 OCI Registry 保存 KCL 的程序包，kpm 目前提供的默认的 OCI Registry 为：<a href="https://github.com/orgs/KusionStack/packages" target="_blank" rel="noopener noreferrer">https://github.com/orgs/KusionStack/packages</a></p><p>您可以在这里浏览您需要的 KCL 包，我们目前提供了 k8s 的 KCL 程序包，支持 k8s 1.14 到 1.27 的全部版本。欢迎提 <a href="https://github.com/kcl-lang/kpm/issues" target="_blank" rel="noopener noreferrer">Issues</a> 共建 KCL 模型</p><p>更多关于 kpm 包管理工具的内容<a href="https://kcl-lang.io/docs/user_docs/guides/package-management/quick-start" target="_blank" rel="noopener noreferrer">详见</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区集成--扩展更新">社区集成 &amp; 扩展更新<a href="#社区集成--扩展更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ci-集成">CI 集成<a href="#ci-集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在此次更新中我们提供了 <strong>Github Actions 作为 CI 集成</strong>的示例方案，希望通过使用容器、用于生成配置的持续集成 (CI) 和用于持续部署 (CD) 的 GitOps 来实现端到端应用程序开发流程。整体工作流程如下：</p><ul><li>应用代码开发并提交到提交到 GitHub 存储库触发 CI (这里使用 Python Flask Web 应用作为示例)</li></ul><p><img loading="lazy" alt="app" src="/zh-CN/assets/images/app-9b58ce8fdae4fc93fb73e51f1507a42c.png" width="1080" height="492" class="img_ev3q"></p><ul><li>GitHub Actions 从应用代码生成容器镜像，并将容器镜像推送到 docker.io 容器注册表</li></ul><p><img loading="lazy" alt="app-ci" src="/zh-CN/assets/images/app-ci-94594b17db9b52918933ac683a5baa24.png" width="1080" height="498" class="img_ev3q"></p><ul><li>GitHub Actions 根据 docker.io 容器注册表中容器镜像的版本号并自动同步更新 KCL 清单部署文件</li></ul><p><img loading="lazy" alt="auto-update" src="/zh-CN/assets/images/auto-update-bf4b3f79c897171c238e83441fa8fa86.png" width="1080" height="526" class="img_ev3q"></p><p>我们可以获得部署清单源码进行编译验证会得到如下 YAML 输出</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcllang/flask_demo:6428cff4309afc8c1c40ad180bb9cfd82546be3e"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flask_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从上述配置可以看出资源的镜像确实自动更新为了新构建的镜像内容 。此外，我们还可以使用 Argo CD KCL 插件自动从 Git 存储库同步或从中拉取数据并将应用部署到 Kubernetes 集群</p><p>更多详情请参考<a href="https://kcl-lang.io/docs/user_docs/guides/ci-integration/github-actions" target="_blank" rel="noopener noreferrer">这里</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cd-集成">CD 集成<a href="#cd-集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>此外我们还提供了 <strong>ArgoCD 作为 CD 集成</strong>的示例方案，通过 Github Action CI 集成和 ArgoCD KCL 插件，我们可以完成端到端的 GitOps 工作流，提升应用配置自动变更和部署效率。如下示出了使用 ArgoCD 应用 Kubernetes 配置的概览和同步情况，通过使用 ArgoCD 的能力，当业务代码发生变化时，自动同步更新并部署。</p><ul><li><strong>应用概览</strong></li></ul><p><img loading="lazy" alt="argocd-app" src="/zh-CN/assets/images/argocd-app-e33be631832e8adb5aac927f4e407324.png" width="1080" height="512" class="img_ev3q"></p><ul><li><strong>配置同步</strong></li></ul><p><img loading="lazy" alt="argocd-sync" src="/zh-CN/assets/images/argocd-sync-7e3a1c0e61a74d6ded86e27558a594c5.png" width="1080" height="367" class="img_ev3q"></p><p>更多插件安装和使用方式请参考<a href="https://kcl-lang.io/docs/user_docs/guides/gitops/gitops-quick-start" target="_blank" rel="noopener noreferrer">这里</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-配置管理工具扩展支持">Kubernetes 配置管理工具扩展支持<a href="#kubernetes-配置管理工具扩展支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 KCL v0.5.0 中，我们以统一的编程界面方式为 Kubernetes 社区的 Kubectl, Helm, Kustomize, KPT 等配置管理工具提供了插件支持，编写几行配置代码即可无侵入地完成对存量 Kustomize YAML，Helm Charts 的编辑和校验，比如修改资源标签/注解, 注入 Sidecar 容器配置，使用 KCL schema 校验资源，定义自己的抽象模型并分享复用等。</p><p>下面以 Kubectl 工具对 KCL 的集成为例进行详细说明。您可以在<a href="https://github.com/kcl-lang/kubectl-kcl" target="_blank" rel="noopener noreferrer">这里</a>获取 Kubectl KCL 插件的安装方式</p><p>首先执行如下命令获取一个配置示例</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/kubectl-kcl.git </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> ./kubectl-kcl/examples/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后执行如下命令显示配置</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> krm-kcl-abstration.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: krm.kcl.dev/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: KCLRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: web-service-abtraction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  params:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nginx:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - port: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source: oci://ghcr.io/kcl-lang/web-service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述配置中，我们使用了在 OCI 上已经预定好的一个 Kubernetes Web 服务应用抽象模型 <code>oci://ghcr.io/kcl-lang/web-service</code>, 并通过 <code>params</code> 字段配置了该模型所需的配置字段。通过执行如下命令可以获得原始的 Kubernetes YAML 输出并下发到集群:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl kcl apply -f krm-kcl-abstration.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/app created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/app created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多 Kubernetes 配置管理工具详细介绍内容以及用例<a href="https://github.com/kcl-lang/krm-kcl/tree/main/examples" target="_blank" rel="noopener noreferrer">详见</a></p><p>目前 KCL 支持的 Kubernetes 配置管理工具集成仍处于早期，如果您有更多的想法和需求，欢迎发起 Issues 讨论共建</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他更新与错误修复">其他更新与错误修复<a href="#其他更新与错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>完整更新和错误修复列表<a href="https://github.com/kcl-lang/kcl/compare/v0.4.6...v0.5.0" target="_blank" rel="noopener noreferrer">详见</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档更新">文档更新<a href="#文档更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a> 新增 KCL v0.5.0 文档内容并支持版本化语义选项，目前支持 v0.4.3, v0.4.4, v0.4.5, v0.4.6 和 v0.5.0 版本选择。同时欢迎社区同学进行文档共建。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>感谢 @harri2012 对 KCL IDE 插件的首次贡献 🙌</li><li>感谢 @niconical 对 KCL 命令行基础代码和 CI/CD 脚本的贡献 🙌</li><li>感谢 @Ekko 对 KCL 云原生工具集成的贡献 🙌</li><li>恭喜来自华中科技大学朱俊星同学成功入选 GitLink编程夏令营（GLCC）"Terraform/JsonSchema 转 KCL Schema" 课题 🎉</li><li>恭喜来自东南大学的任一鸣同学成功入选 开源之夏 "IDE 插件增强和 Language Server 集成" 课题 🎉</li><li>为便于 KCL 及其子项目的仓库检索和管理，我们将 KCL 30+ 仓库整体搬迁到了新的 Github <strong>kcl-lang</strong> 组织，牢记项目地址，防止迷路 <a href="https://github.com/kcl-lang" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang</a> ❤️</li><li>KCL 加入 CNCF Landscape，算是云原生社区对我们小小的鼓励和认可，下一步计划是努力加入 CNCF Sandbox，为云原生社区作出更多的贡献 💪</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>预计 2023 年 9 月，我们将发布 <strong>KCL v0.6.0 版本</strong>，预期重点演进包括：</p><ul><li>更多针对场景问题的 KCL 语言编写便利性改进，用户界面持续优化与体验提升，用户支持和痛点解决</li><li>更多 IDE 插件、语言工具链、包管理工具、Registry 功能支持和用户体验提升</li><li>针对云原生场景提供更多开箱即用的 KCL 模型支持，主要包含容器、服务、计算、存储和网络等</li><li>更多的 CI/CD 工具集成：如 Jenkins, Gitlab CI, FluxCD 等。</li><li>支持 Helmfile KCL 插件，通过 KCL 代码直接生成、编辑和校验 Kubernetes 原生资源</li><li>支持在 Kubernetes 运行时通过 KCL Operator 运行代码对 YAML 进行编辑和校验</li></ul><p>更多详情请参考 <a href="https://kcl-lang.io/docs/community/release-policy/roadmap" target="_blank" rel="noopener noreferrer">KCL 2023 路线规划</a> 和 <a href="https://github.com/kcl-lang/kcl/milestone/6" target="_blank" rel="noopener noreferrer">KCL v0.6.0 Milestone</a></p><p>如果您有更多的想法和需求，欢迎在 KCL Github 仓库发起 <a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">Issues</a>，也欢迎加入我们的社区进行交流 🙌 🙌 🙌</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题及解答">常见问题及解答<a href="#常见问题及解答" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>详见 <a href="https://kcl-lang.io/docs/user_docs/support/faq-kcl" target="_blank" rel="noopener noreferrer">KCL 常见问题</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户和社区小伙伴在此次版本更新过程中提出的宝贵反馈与建议。</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL Github 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion Github 仓库</a></li><li><a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig Github 仓库</a></li></ul><p>欢迎加入我们的社区进行交流 👏👏👏：<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[用 Rust 重写的 KCL LSP]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023/07/10/kcl-LSP</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023/07/10/kcl-LSP</guid>
            <pubDate>Mon, 10 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 的 v0.4.6 版本在语言、工具链、社区集成&扩展支持等方面进行了重点更新。本文将为您详细介绍IDE的新功能、LSP的介绍、KCL LSP Server端的设计和实现以及未来的规划和期望。]]></description>
            <content:encoded><![CDATA[<p>KCL 的 v0.4.6 版本在语言、工具链、社区集成&amp;扩展支持等方面进行了重点更新。本文将为您详细介绍IDE的新功能、LSP的介绍、KCL LSP Server端的设计和实现以及未来的规划和期望。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ide的新特性">IDE的新特性<a href="#ide的新特性" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在这次更新中，我们发布了全新 KCL VSCode 插件，并且用 Rust 重写了 LSP 的 Server 端。我们提供了 IDE 中常用的代码辅助功能，如高亮、跳转、补全、Outline、悬停、错误提示等。</p><ul><li><strong>高亮:</strong><img loading="lazy" alt="Highlight" src="/zh-CN/assets/images/Highlight-ddacdde9f18d504f7a103583c2f76b86.png" width="1312" height="782" class="img_ev3q"></li><li><strong>跳转:</strong><img loading="lazy" alt="Goto Definition" src="/zh-CN/assets/images/GotoDef-0875243eacd6b76e49b7a5b95cb9ce55.gif" width="1312" height="780" class="img_ev3q"></li><li><strong>补全:</strong><img loading="lazy" alt="Completion" src="/zh-CN/assets/images/Completion-584771cd4bed237e74d3da3decaa9757.gif" width="1312" height="780" class="img_ev3q"></li><li><strong>Outline:</strong><img loading="lazy" alt="Outline" src="/zh-CN/assets/images/Outline-c443b2ee1e35746795e7b09c11f3f4da.gif" width="1312" height="780" class="img_ev3q"></li><li><strong>Hover:</strong><img loading="lazy" alt="Hover" src="/zh-CN/assets/images/Hover-339697d17ca0d4f167b1b1a904c9f1aa.gif" width="1312" height="780" class="img_ev3q"></li><li><strong>Diagnostics:</strong><img loading="lazy" alt="Diagnostics" src="/zh-CN/assets/images/Diagnostics-716fc3b938a94e4db2cbafaad4f4174d.gif" width="1312" height="780" class="img_ev3q"></li></ul><p>欢迎到 <a href="https://kcl-lang.io/docs/tools/Ide/vs-code/" target="_blank" rel="noopener noreferrer">KCL VSCode 插件</a> 了解更多👏🏻👏🏻👏🏻</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-lsp">什么是 LSP？<a href="#什么是-lsp" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在这次更新中，我们基于 LSP 实现了以上能力。LSP 指的是 Language Server Protocol，它是由微软在 2016 年推出的一种用于编程语言工具的协议。借用一张图，很容易就可以理解 LSP。</p><p><img loading="lazy" alt="LSP" src="/zh-CN/assets/images/lsp-c853f0881ecd058c34768312009038da.png" width="1162" height="538" class="img_ev3q"></p><p>通过 LSP ，编辑器和 IDE 可以通过 JSON-RPC 通信协议与后端运行的语言服务器(Server 端)进行通信。语言服务器可以提供代码分析、自动补全、语法高亮、定义跳转等功能。基于 LSP，开发者可以在不同的编辑器和 IDE 之间迁移，使得语言工具的开发从 M(语言数量) <!-- -->*<!-- --> N(编辑器/IDE数量) 降低为 M + N。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么用-rust-重写">为什么用 Rust 重写<a href="#为什么用-rust-重写" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 编译器和其他工具最初由 Python 实现，因为性能原因，我们用 Rust 语言重写了编译器。在此之后，我们使用 Rust 逐步重写了 KCL 的其他工具，如测试工具、Format 工具等。在这次更新中，我们用 Rust 重写了 LSP Server 端，其主要考虑因素也是性能。</p><p>过去，Python 版本的 Server 端在处理一些复杂的场景（编译文件数量超过200个）时，处理一个跳转的请求，Server 端从接收到请求到计算结果并响应，时间长达 6 秒以上，几乎是不可用状态。由于 Server 端的实现主要基于语言编译器前中端的词法解析和语义分析，在我们使用 Rust 重写以后，这部分性能分别提升了 20 和 40 倍， 带来的显著结果就是 Server 端的响应时间得到了巨大提升，对于同样的场景，响应时间缩短至 100 毫秒左右。而对于一些简单的场景，响应时间只有几毫秒，做到了用户无感。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-lsp-server的设计与实现">KCL LSP Server的设计与实现<a href="#kcl-lsp-server的设计与实现" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL LSP Server 的设计如下图所示：</p><p><img loading="lazy" alt="KCL-LSP" src="/zh-CN/assets/images/kcl-LSP-789ffa07d0239265e5851188a8ca5327.png" width="627" height="421" class="img_ev3q"></p><p>主要流程可以分为几个阶段：</p><ol><li>建立连接，初始化 LSP 能力。在 IDE 的 Client 端，打开特定文件（KCL的 <!-- -->*<!-- -->.k）时，IDE 会启动本地的 kcl_language_server 二进制文件，启动 Server 端。这个文件与 KCL 一起发布，并安装在 KCL 的 bin 目录下。Server 启动后会建立 standard IO 的 Connection，并等待 Client 发送的初始化请求。Server 端接收初始化请求后会定义 Server 端信息和能力，并返回给 Client，以此完成 LSP 的初始化连接。</li><li>建立连接后，Server 端会启动一个轮询函数，不断接收来自 Client 的 LSP Message，例如 Notification（打开/关闭/变更/删除文件等）和 Request（跳转、悬停等），以及来自 Server 端自身的 Task。并统一封装成事件（Event）交给下一步处理。</li><li>对于各种事件，按照以下步骤处理：</li></ol><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// Handles an event from one of the many sources that the language server subscribes to.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn handle_event(&amp;mut self, event: Event) -&gt; anyhow::Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. Process the incoming event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match event {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Event::Task(task) =&gt; self.handle_task(task)?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Event::Lsp(msg) =&gt; match msg {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lsp_server::Message::Request(req) =&gt; self.on_request(req, start_time)?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lsp_server::Message::Notification(not) =&gt; self.on_notification(not)?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. Process changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let state_changed: bool = self.process_vfs_changes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. Handle Diagnostics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if state_changed{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let mut snapshot = self.snapshot();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let task_sender = self.task_sender.clone();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Spawn the diagnostics in the threadpool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.thread_pool.execute(move || {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handle_diagnostics(snapshot, task_sender)？;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>3.1 任务分发：根据任务类型，做函数分发。在子函数中，会进一步基于 Request 或 Notification 的类型继续分发到最终的处理函数中，如处理文件变更、处理跳转请求等。这些函数会根据基于编译器中前端编译出的语义模型（AST，符号表，错误信息等）做分析，计算生成对应的 Response（如跳转请求的目标位置）。</p><p>3.2 处理变更：用户在修改代码或更改文件时，会发送对应的 Notification。在前一步的处理中，会将变更保存在虚拟文件系统（VFS）中。Server 端会根据新的源代码，进行重新编译，保存新的语义模型，以供下一个请求做处理。</p><p>3.3 错误处理：这里的错误并非指 Server 端的运行错误，而是代码编译中的语法、语义错误，编译警告等。Client 端并没有对应的请求类型来请求这些错误，而是由 Server 端主动发送 Diagnostics。因此，在发生变更后，同步地将错误信息更新至 Client 端。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="遇到的问题">遇到的问题<a href="#遇到的问题" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-为什么需要虚拟文件系统">1. 为什么需要虚拟文件系统？<a href="#1-为什么需要虚拟文件系统" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在最初的设计中，并没有考虑使用虚拟文件系统。我们每次从文件系统中获取源代码，进行编译和分析。对于一些“静态”的任务，如跳转，可以在变更代码后保存到文件系统，然后再进行跳转的操作。配合到 VS Code 的自动保存功能，体验上并没有明显的差距。但对于代码补全这一功能，IDE 中输入的补全trigger（如 “.”）会触发文件变更的通知和代码补全的请求，但对应的代码还未保存到文件系统中，编译后的语义模型无法做对应的分析。因此，我们借助 Rust Analyzer 对应的 vfs 的create，在 Server 端引入了虚拟文件系统，将编译的入口从文件路径变为了 source code。Client 端输入代码后，文件变更的通知会先更新虚拟文件系统，重新编译文件，生成新的语义模型，然后再处理补全请求。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-如何处理不完整的代码">2. 如何处理不完整的代码？<a href="#2-如何处理不完整的代码" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>我们遇到的另一个比较大的问题是如何处理不完整的代码。同样的，对于跳转这类“静态”的任务，可以假定代码是完整、正确的。但对于补全操作，如以下代码，希望在输入.后，补全字符串的函数。对于编译流程，第二行实际上是不完整的代码，无法编译出正常的 AST 树。</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">s: str = "hello kcl"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">len = s.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为此，我们在 KCL 的编译中实现了语法和语义上的多种错误恢复，保证编译过程始终能产生完整的 AST 和符号表。在这个例子中，我们新增了一个表示空的 AST 节点作为占位符，使得第二行能够生成完整的 AST。在处理补全的请求时，会根据 s 的类型和其他语义信息，补全函数名、schema attr 或 pkg 中定义的 schema 名。</p><blockquote><p>Rust Analyzer architecture:</p><p>Architecture Invariant: parsing never fails, the parser produces (T, Vec<!-- -->&lt;<!-- -->Error<!-- -->&gt;<!-- -->) rather than Result<!-- -->&lt;<!-- -->T, Error<!-- -->&gt;<!-- -->.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结与展望">总结与展望<a href="#总结与展望" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 的 IDE 插件目前已经实现高亮、跳转、补全、Outline、悬停、错误提示等功能。这些功能提升了 KCL 用户的开发效率。然而，作为一款 IDE 插件，它的功能还不够完整。在未来的开发中，我们会继续完善，未来的工作有以下几个方向：</p><ul><li>更多的语言能力：提供更多的功能，如代码重构，错误的quick fix，代码 fmt等，进一步完善功能，提升开发效率</li><li>更多的 IDE 接入：目前，KCL 虽然提供了 LSP，只接入了 VS Code，未来会基于 LSP 的能力为 KCL 用户提供更多选择。</li><li>AI 能力的集成：目前，ChatGPT 风靡全网，各行各业都在关注。我们也在探索 AI×KCL 的结合，提供更智能的研发体验。总之，我们会继续完善和优化 KCL 的 IDE 插件，让它更加成熟和实用。为KCL用户带来更加方便和高效的开发体验。
如果您有更多的想法和需求，欢迎在 KCL Github 仓库发起 Issue 或讨论，也欢迎加入我们的社区进行交流 🙌 🙌 🙌</li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[WAIC 2023 会议 KCL 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-03-26-kcl-os2atc-meeting</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-03-26-kcl-os2atc-meeting</guid>
            <pubDate>Sat, 08 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL Talk Cover]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="KCL Talk Cover" src="/zh-CN/assets/images/talk-cover-f408fff3ff8dda7aebc27dd702a44cc7.jpg" width="2766" height="1108" class="img_ev3q"></p><p><a href="https://kcl-lang.github.io/talks/kcl-waic2023.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
        </item>
        <item>
            <title><![CDATA[聊聊 K8S 中的 Sidecar 设计模式·第 2 篇]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-06-29-k8s-sidecar-2</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-06-29-k8s-sidecar-2</guid>
            <pubDate>Thu, 29 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[介绍]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="介绍">介绍<a href="#介绍" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在前一篇文章 <a href="/zh-CN/blog/2023-06-05-k8s-sidecar-1/">聊聊 K8S 中的Sidecar设计模式·第 1 篇</a>中，我们介绍了土话说的三蹦子的 Sidecar 设计模式。本文尝试用 KCL 这种现代化的类型安全的配置语言，来展示 Pod 资源的描述，在后续的文章中，我们将以 KCL 来介绍 Sidecar 这种模式的实际应用。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-pod-的-openapi-定义">1. Pod 的 OpenAPI 定义<a href="#1-pod-的-openapi-定义" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>先回到最开始最简单的 Nginx 例子，其 YAML 文件几乎是相同的模式：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里的 Pod 数据满足 Kubernetes 规范 中 <code>io.k8s.api.core.v1.Pod</code> 模型的定义。完整的 OpenAPI 定义请 <a href="https://github.com/kubernetes/kubernetes/tree/master/api/openapi-spec" target="_blank" rel="noopener noreferrer">参考</a>。仔细分析可以发现，apiVersion 和 kind 信息都是比较常见的默认配置，我们需要更现代的配置语言来简化。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-使用-kcl-定义-pod-资源">2. 使用 KCL 定义 Pod 资源<a href="#2-使用-kcl-定义-pod-资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 是一门面向云原生领域配置策略语言，详细资料可参考<a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">语言官网</a></p><p>基本的 KCL 配置程序仍然遵循 <code>K=V</code> 的形式， YAML 比较相似。比如，我们可以用下面的 KCL 代码来重写 Nginx 容器的配置：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> k8s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> k8core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pod </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"web-app"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"main-container"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 import 导入了 k8s 包中的 <code>k8s/api/core/v1</code> 包，其中的 Pod 结构定义对应 Pod 模型，其中已经包含了 apiVersion 和 kind 的默认值，因此只需要添加 <code>metadata.name</code> 和 <code>spec.containers</code> 属性（KCL 也针对一些多级嵌套的属性提供了的语法糖）。</p><p>我们可以通过 <a href="https://kcl-lang.io/docs/user_docs/guides/package-management/installation" target="_blank" rel="noopener noreferrer">kpm 包管理工具</a>，创建一个 KCL 程序来定义一个 Pod 资源。并执行这个程序来得到对应的 YAML。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. 初始化一个 kcl 程序包 hello.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kpm init hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. 编辑 hello 包内的 main.k 文件，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 将前文中提到的 KCL 配置代码添加到 hello/main.k 中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> hello/main.k</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">import k8s.api.core.v1 as k8core</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">k8core.Pod {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    metadata.name = "web-app"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    spec.containers = [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        name = "main-container"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        image = "nginx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        ports = [{containerPort: 80}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. 进入到 hello 包内，添加 k8s 依赖，并且运行 hello 包。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> hello </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kpm </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> k8s </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kpm run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以得到如下 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-小结">3. 小结<a href="#3-小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>这一篇文章我们简要介绍了如何通过 KCL 构建出 Pod 配置来获得更灵活、更健壮的配置。后续文章中我们将通过 KCL 来提炼和抽象最佳的 Sidecar 模式实践，包括使用 KCL 对 Sidecar 模型进行抽象以及使用 KCL 对已存在的上游 YAML 配置进行 Sidecar 注入。</p>]]></content:encoded>
            <category>KCL</category>
            <category>k8s</category>
            <category>Sidecar</category>
        </item>
        <item>
            <title><![CDATA[聊聊 K8S 中的 Sidecar 设计模式·第 1 篇]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-06-05-k8s-sidecar-1</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-06-05-k8s-sidecar-1</guid>
            <pubDate>Mon, 05 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[介绍]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="介绍">介绍<a href="#介绍" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><code>Sidecar</code> 北京土话叫三蹦子，通俗叫就是带棚子的三轮摩托车。今天我们要聊的 K8S 中三蹦子也称为边三轮车：边三轮车是在摩托车边上挂靠一个拖斗，云原生中的叫法是主容器和边容器。本系列文章将展示 <code>Sidecar</code> 模式的用法，以及如何通过 <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL</a> 等面向配置的编程语言来简化 YAML 的编写。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一个最简单的云原生-web-服务">一个最简单的云原生 Web 服务<a href="#一个最简单的云原生-web-服务" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>首先以最简方式在 <code>Kubernetes</code> 环境启动一个 Web 服务。在下面 <code>pod.yaml</code> 文件中定义一个 <code>Pod</code>，其中只有一个 <code>Nginx</code> 服务，在 80 端口启动一个 <code>web</code> 服务。</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Pod</code> 是云原生中的一个基础原语。<code>Pod</code> 将多个容器包装为一个逻辑单元，<code>Kubernetes</code> 运行时确保 <code>Pod</code> 中的容器运行在一个机器上。因此 <code>Pod</code> 中的所有容器都共享生命周期、共享磁盘卷、共享网络环境等。<code>Sidecar</code> 模式就是在 <code>Pod</code> 中增加其他容器来扩展和增强主容器的能力。</p><p>然后通过 <code>kubectl create</code> 命令行工具创建 <code>Pod</code>，然后通过 <code>kubectl get po</code> 查看 <code>Pod</code> 执行状态：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f pod.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME READY STATUS RESTARTS AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">web-app </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1 Running </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> 45m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到一个名为 <code>web-app</code> 的 <code>Pod</code> 已经正常启动并运行，其中包含 <code>Nginx</code> 服务。为了便于外部访问配置端口转发，将宿主的 3999 端口对应到主容器的 80 端口：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl port-forward web-app </span><span class="token number" style="color:#36acaa">3999</span><span class="token plain">:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Forwarding from </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:3999 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Forwarding from </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:3999 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>端口转发是一个阻塞程序，保持命令行窗口打开。然后在浏览器打开测试页面：</p><p><img loading="lazy" src="/zh-CN/assets/images/port-forward-38011472fab79a2041228e14f60660db.png" width="1136" height="614" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="通过-sidecar-定扩展页面内容">通过 Sidecar 定扩展页面内容<a href="#通过-sidecar-定扩展页面内容" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>现在我们尝试在不修改原始 <code>Nginx</code> 容器镜像的前提下，通过 <code>Sidecar</code> 模式为 <code>Nginx</code> 服务增加定制 <code>Web</code> 页面的能力。在开始前先删除之前启动的 <code>Pod</code>：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl delete po web-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod </span><span class="token string" style="color:#e3116c">"web-app"</span><span class="token plain"> deleted</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后在 <code>Pod</code> 中增加第二个 <code>Busybox Sidecar</code> 容器，完整的 <code>pod.yaml</code> 文件如下：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># --- 以下是新添加的内容 ---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 和 Sidecar 通过 磁盘卷共享要发布的文件目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sidecar 容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"/bin/sh"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"-c"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"while true; do echo $(date -u) 'Hi I am from Sidecar container' &gt; /var/log/index.html; sleep 5;done"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Sidecar</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Pod 中全部容器共享磁盘卷</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Busybox Sidecar</code> 容器执行的命令对应以下 <code>Shell</code> 脚本：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">date</span><span class="token variable" style="color:#36acaa"> -u</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Hi I am from Sidecar container'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /var/log/index.html</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Sidecar</code> 容器只有一个功能：每隔 5 秒钟覆盖一次 <code>/var/log/index.html</code> 文件，这个文件刚好对应 <code>Nginx</code> 的服务的首页页面文件。</p><p>然后重新启动 <code>Pod</code>，并重新映射本地宿主机端口到容器端口：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f pod.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/web-app created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl port-forward web-app </span><span class="token number" style="color:#36acaa">3999</span><span class="token plain">:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Forwarding from </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:3999 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Forwarding from </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:3999 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重新打开浏览器后将看到以下页面：</p><p><img loading="lazy" src="/zh-CN/assets/images/port-forward-1-ecbef30818b04505deeb1f461f91a91f.png" width="1038" height="192" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sidecar-模式的工作原理">Sidecar 模式的工作原理<a href="#sidecar-模式的工作原理" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>简单来说，<code>Busybox</code> 是 <code>Sidecar</code> 容器角色，负责生产首页数据；而 <code>Nginx</code> 是主容器，负责消费 <code>Busybox</code> 生产的主页数据；两个容器通过 <code>var-logs</code> 磁盘卷共享空间。如果以 Go 语言的术语类比，<code>Nginx</code> 是主 <code>Goroutine</code>，<code>Busybox</code> 是后台干脏活的 <code>Goroutine</code>，而共享的磁盘卷类似 <code>Channel</code> 的作用。</p><p><img loading="lazy" src="/zh-CN/assets/images/how-sidecar-work-a13877d06b375a8443f596f4614b7a26.png" width="1066" height="658" class="img_ev3q"></p><p>在这个例子中 <code>Nginx</code> 依然是主容器，<code>Sidecar</code> 容器是 <code>BusyBox</code>。我们还可以挂更多 <code>Sidecar</code> 容器，比如网络、监控、日志等等。</p><p><img loading="lazy" src="/zh-CN/assets/images/how-sidecar-work-1-d4780f9624a3907986d6e59483329bf5.png" width="1512" height="616" class="img_ev3q"></p><p>这样就通过 <code>Sidecar</code> 模式，在不修改 <code>Nginx</code> 主容器的前提下，扩展出了网络、监控、日志等能力。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sidecar-模式的优点">Sidecar 模式的优点<a href="#sidecar-模式的优点" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>现在容器已经成为一种流行的打包技术，各种不同角色的同学可以通过容器以统一的方式构建、发布和运行程序，甚至管理各种资源。因此容器更像一个功能明确的产品，它有自己的运行时、发布周期、文档和 API 等。好的容器/产品只负责解决一个问题，保持了 KISS 原则可以让容器本身具有极高的重用性和可被替代性。正是因为可重用才使得现代化的构建程序的流程更加敏捷和高效。但是可复用的容器一般都功能单一，我们常常需要通过各种手段扩展容器的功能，以及需要更多的容器之间的协同。</p><p>三蹦子 <code>Sidecar</code> 可以在不改造主摩托车的前提下增加 N 个拖车功能，相应地云原生 <code>Sidecar</code> 模式可以在无需修改主容器的前提下扩展并增强已有主容器功能。如果将云原生的玩法和面向对象编程联系起来，容器镜像就是 <code>Java</code> 中的 <code>class</code>，而执行中的容器就是 <code>class</code> 的实例。而面向对象的 <code>class</code> 继承就是基于已有的容器镜像做扩展，<code>Sidecar</code> 则是通过类似组合的模式扩展 <code>class</code> 的能力。</p><p>面向对象编程中有一个“组合优于继承，多用组合少用继承”的规则，因此 Sidecar 也是推荐使用的模式。正是因为三蹦子模式的优点，最近在云原生场景也被大量使用：比如在边车上架一些类似机关枪的网络服务、监控、跟踪等功能。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>这一篇文章我们简要介绍并在 <code>Kubernetes</code> 环境展示了 <code>Sidecar</code> 模式，同时结合传统的面向对象编程思想对比了 <code>Sidecar</code> 和组合编程模式的关系。<code>Sidecar</code> 模式的优势不仅仅体现在无害增强主容器，更灵活的是可以在 <code>apply</code> 时动态调整 <code>Sidecar</code> 能力。</p><p>在后面的文章中，我们将尝试结合 <code>KCL</code> 等现代化的云原生配置语言来简化 <code>Sidecar</code> 配置的编写。通过尝试探索通过 <code>KCL</code> 动态注入和修改 <code>Sidecar</code> 来扩展基于已有配置的能力。</p>]]></content:encoded>
            <category>KCL</category>
            <category>k8s</category>
            <category>Sidecar</category>
        </item>
        <item>
            <title><![CDATA[KCL 与其他 Kubernetes 配置管理工具的异同 - Helm 篇]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-05-30-vs-helm</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-05-30-vs-helm</guid>
            <pubDate>Tue, 30 May 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a> 是一个为 Kubernetes 对象生成可部署清单的工具，它承担了以两种不同形式生成最终清单的任务。Helm 是一个管理 Kubernetes 包（称为 charts）的必备模板工具。图表是 YAML 清单的模板化版本，其中混合了 Go template 的子集，它也是 Kubernetes 的包管理器，可以打包、配置和部署/应用 Helm 图表到 Kubernetes 集群。</p><p>在 KCL 中，用户可以使用更多的工具和 IDE 插件支持直接编写配置代码文件，而不是模板文件，这些工具和插件支持需要在相应位置的代码中进行修改，从而消除了读取 YAML 的成本。同时，用户可以通过代码重用配置片段，避免了YAML 配置的大量复制和粘贴。信息密度更高，更不容易出错。</p><p>下面以一个经典的 Helm Chart 配置管理的例子详细说明 Kustomize 和 KCL 在 Kubernetes 资源配置管理上的区别。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="helm">Helm<a href="#helm" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Helm 具备 <code>values.yaml</code> 和 <code>template</code> 的概念, 通常一个 Helm Chart 由一个包含 <code>Chart.yaml</code> 的路径组成。我们可以执行如下命令获得一个典型的 Helm Chart 工程</p><ul><li>创建 <code>workload-helm</code> 目录来保存 chart 工程</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create a directory to hold the chart project</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> workload-helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a workload-helm/Chart.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-helm/Chart.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">appVersion: 0.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">description: A helm chart to provision standard workloads.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name: workload</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">type: application</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">version: 0.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a workload-helm/values.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-helm/values.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  type: ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: www</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      targetPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  my-container:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      name: busybox:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    command: ["/bin/echo"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - "-c"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      - "Hello World!"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        cpu: 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        memory: 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        cpu: 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        memory: 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>创建模版文件夹</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create a directory to hold templates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> workload-helm/templates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a workload-helm/templates/helpers.tpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-helm/templates/helpers.tpl</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Expand the name of the chart.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*/}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- define "workload.name" -}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- default .Release.Name .Values.nameOverride | trunc 63 | trimSuffix "-" }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Create a default fully qualified app name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">If release name contains chart name it will be used as a full name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*/}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- define "workload.fullname" -}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- \</span><span class="token string variable" style="color:#36acaa">$name</span><span class="token string" style="color:#e3116c"> := default .Chart.Name .Values.nameOverride }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- if contains \</span><span class="token string variable" style="color:#36acaa">$name</span><span class="token string" style="color:#e3116c"> .Release.Name }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- .Release.Name | trunc 63 | trimSuffix "-" }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- else }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- printf "%s-%s" .Release.Name \</span><span class="token string variable" style="color:#36acaa">$name</span><span class="token string" style="color:#e3116c"> | trunc 63 | trimSuffix "-" }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Create chart name and version as used by the chart label.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*/}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- define "workload.chart" -}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Common labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*/}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- define "workload.labels" -}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">helm.sh/chart: {{ include "workload.chart" . }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{ include "workload.selectorLabels" . }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- if .Chart.AppVersion }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">app.kubernetes.io/managed-by: {{ .Release.Service }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Selector labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*/}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- define "workload.selectorLabels" -}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">app.kubernetes.io/name: {{ include "workload.name" . }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">app.kubernetes.io/instance: {{ .Release.Name }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-helm/templates/deployment.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: {{ include "workload.name" . }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    {{- include "workload.labels" . | nindent 4 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      {{- include "workload.selectorLabels" . | nindent 6 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        {{- include "workload.selectorLabels" . | nindent 8 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        {{- range \</span><span class="token string variable" style="color:#36acaa">$name</span><span class="token string" style="color:#e3116c">, \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c"> := .Values.containers }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        - name: {{ \</span><span class="token string variable" style="color:#36acaa">$name</span><span class="token string" style="color:#e3116c"> }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          image: "{{ </span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.image.name }}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- with \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.command }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {{- toYaml \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.command | nindent 12 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- with \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.args }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {{- toYaml \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.args | nindent 12 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- with \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.env }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {{- toYaml \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.env | nindent 12 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- with \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.volumeMounts }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {{- toYaml \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.volumeMounts | nindent 12 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- with \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.livenessProbe }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          livenessProbe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {{- toYaml \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.livenessProbe | nindent 12 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- with \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.readinessProbe }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          readinessProbe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {{- toYaml \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.readinessProbe | nindent 12 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- with \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.resources }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {{- toYaml \</span><span class="token string variable" style="color:#36acaa">$container</span><span class="token string" style="color:#e3116c">.resources | nindent 12 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-helm/templates/service.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{ if .Values.service }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: {{ include "workload.name" . }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    {{- include "workload.labels" . | nindent 4 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  type: {{ .Values.service.type }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    {{- include "workload.selectorLabels" . | nindent 4 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  {{- with .Values.service.ports }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    {{- toYaml . | nindent 4 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以得到如下的 Helm chart 工程</p><div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Chart.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── templates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── _helpers.tpl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── service.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以通过如下的命令渲染真实的部署配置</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm template workload-helm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以得到如下 YAML 输出</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Source: workload-helm/templates/service.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">helm.sh/chart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.3.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/managed-by</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Source: workload-helm/templates/deployment.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">helm.sh/chart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.3.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/managed-by</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"busybox:latest"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /bin/echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Hello World</span><span class="token tag" style="color:#00009f">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 128Mi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl">KCL<a href="#kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在 KCL 中，我们提供了与 Helm <code>values.yaml</code> 相似的动态配置参数 <code>kcl.yaml</code> 文件，我们可以执行如下的命令获得一个典型的 KCL 工程。</p><ul><li>创建 <code>workload-kcl</code> 目录来保存 KCL 工程</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create a directory to hold the KCL project</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> workload-kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a workload-kcl/kcl.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-kcl/kcl.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kcl_options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - key: containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    value:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      my-container:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          name: busybox:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        command: ["/bin/echo"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          - "-c"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          - "Hello World!"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            cpu: 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            memory: 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            cpu: 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            memory: 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - key: service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    value:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      type: ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        - name: www</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          targetPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>创建如下 KCL 文件来保存 kubernetes 资源</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create a workload-kcl/deployment.k</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-kcl/deployment.k</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion = "apps/v1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind = "Deployment"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    name = "release-name"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    labels = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        "app.kubernetes.io/name" = "release-name"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        "app.kubernetes.io/instance" = "release-name"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    selector.matchLabels = metadata.labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    template.metadata.labels = metadata.labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    template.spec.containers = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            name = n</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            image = container.image.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            command = container.command</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            command = container.args</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            env = container.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            resources = container.resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        } for n, container in option("containers") or {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> workload-kcl/service.k</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion = "v1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind = "Service"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    name = "release-name"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    labels = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        "app.kubernetes.io/name" = "release-name"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        "app.kubernetes.io/instance" = "release-name"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    selector.matchLabels = metadata.labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    type = option("service", default={})?.type</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ports = option("service", default={})?.ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述 KCL 代码中我们分别声明了一个 Kubernetes <code>Deployment</code> 和 <code>Service</code> 资源的 <code>apiVersion</code>、<code>kind</code>、<code>metadata</code> 和 <code>spec</code> 等变量，并分别赋值了相应的内容，特别地，我们将 <code>metadata.labels</code> 字段分别重用在 <code>spec.selector.matchLabels</code> 和 <code>spec.template.metadata.labels</code> 字段。可以看出，相比于 Helm 模版 或者 YAML，KCL 定义的数据结构更加紧凑，而且可以通过定义局部变量实现配置重用。</p><p>在 KCL 中，我们可以通过条件语句和 <code>option</code> 内置函数接收动态参数，并设置不同的配置值以生成资源。</p><p>可以通过如下的命令得到 <code>Deployment</code> 和 <code>Service</code> YAML 输出:</p><ul><li><code>Deployment</code></li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl/deployment.k </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Y workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl/kcl.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Hello World</span><span class="token tag" style="color:#00009f">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 128Mi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>Service</code></li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl/service.k </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Y workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl/kcl.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外我们可以通过 <code>-D</code> 标志设置额外的参数并覆盖 <code>kcl.yaml</code> 文件的配置值</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl/service.k </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Y workload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl/kcl.yaml </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">D service=None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null important">null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>可以看出，与 Helm 相比，KCL 通过在配置重用和覆盖的基础上生成代码，减少了配置文件和代码行的数量。与 Helm 一样，它是一个纯客户端解决方案，可以将配置和策略验证尽可能地左移，而不会对集群造成额外的依赖或负担，或者甚至没有 Kubernetes 集群时也可以通过 KCL Schema 等特性对 YAML 进行充分验证和测试。</p><p>Helm 可以在 <code>.tpl</code> 文件中定义可重用模板，并支持其他模板引用它。但是，只有模板定义才能重用。在一个复杂的 Helm 图表项目中，我们需要定义许多附加的基本模板。与 Helm 繁琐的写作方法相比，KCL 中的所有内容都是变量。指定模板不需要其他语法。任何变量都可以相互引用。</p><p>此外，Helm 中还有大量与实际逻辑无关的 <code>{{- include }}</code>, <code>nindent</code> 和 <code>toYaml</code> 标记字符，我们需要计算每个 Helm 引用处的空格和缩进。在 KCL 中，无用代码更少，并且不需要很多的 <code>{{*}}</code> 来标记代码块，信息密度更高。</p><p>事实上，KCL 和 Helm Chart 并不对立。我们甚至可以使用 KCL 编写 Helm 模板或者使用 KCL 来生成 <code>values.yaml</code>，或者为现有的 Helm 图表提供可编程扩展功能，比如为 Helm 开发可选的 KCL Schema 插件来验证已有的 Helm 图表或者为 Helm Chart 编写额外的 Transformer 来 Patch 已有的 Helm Chart。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="未来计划">未来计划<a href="#未来计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>我们后续计划 KCL 的模型和约束可以作为一个包来管理（这个包只有 KCL 文件）。例如，Kubernetes 的模型和约束可以开箱即用。用户可以通过已有的模型生成配置或验证现有配置，并且可以通过 KCL 继承手段简单地扩展用户想要的模型和约束。</p><p>在此阶段，您可以使用 Git 或 <a href="https://github.com/oras-project/oras" target="_blank" rel="noopener noreferrer">OCI Registry as Storage（ORAS)</a> 等工具来管理 KCL 配置版本。</p>]]></content:encoded>
            <category>KCL</category>
            <category>Helm</category>
        </item>
        <item>
            <title><![CDATA[KCL 与其他 Kubernetes 配置管理工具的异同 - Kustomize 篇]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-05-20-vs-kustomize</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-05-20-vs-kustomize</guid>
            <pubDate>Sat, 20 May 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">Kustomize</a> 提供了一种无需模板和即可自定义 Kubernetes 资源基础配置和差异化配置的解决方案，通过文件级的 YAML 配置方式完成配置合并或覆盖。在 Kustomize 中用户需要更详细地了解将要发生更改的内容和位置，对于复杂递归过深的基础 YAML 可能不太容易通过选择器来匹配 Kustomize 文件。</p><p>而在 KCL 中，用户可以直接把对应代码需要修改的配置书写在对应的地方，免去了阅读基础 YAML 的成本，同时能够通过代码的方式复用配置片段，避免 YAML 配置的大量复制粘贴，信息密度更高，也不容易出错。</p><p>下面以一个经典的 Kustomize 多环境配置管理例子详细说明 Kustomize 和 KCL 在 Kubernetes 资源配置管理上的区别。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kustomize">Kustomize<a href="#kustomize" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Kustomize 有 base 和 overlay 的概念，bases 和 overlays 一般是一个包含 <code>kustomization.yaml</code> 文件的目录，一个 base 可以被多个 overlay 使用</p><p>我们可以执行如下命令行获得一个典型的 Kustomize 工程</p><ul><li>创建 base 目录并新建一个 deployment 资源</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create a directory to hold the base</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a base/deployment.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> base/deployment.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      app: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        app: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        - name: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          image: osixia/openldap:1.1.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          args: ["--copy-service"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            - name: ldap-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              mountPath: /var/lib/ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            - containerPort: 389</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              name: openldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        - name: ldap-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          emptyDir: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a base/kustomization.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> base/kustomization.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">- deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>创建一个 prod 目录并放置生产环境的配置</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create a directory to hold the prod overlay</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a prod/deployment.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> prod/deployment.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  replicas: 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        - name: ldap-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          emptyDir: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          gcePersistentDisk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            readOnly: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            pdName: ldap-persistent-storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> prod/kustomization.yaml</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - ../base</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">patchesStrategicMerge:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时我们可以得到一个基本的 Kustomzie 目录</p><div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── kustomization.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── kustomization.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中，base 目录存放的是基本的 deployment 配置，prod 环境存放的是需要覆盖的 deployment 配置，在其中指定了 <code>metadata.name</code> 等字段用于表示对哪个资源进行覆盖</p><p>我们可以通过如下命令行显示 prod 环境的真实 deployment 配置</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl kustomize ./prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - --copy-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: osixia/openldap:1.1.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: </span><span class="token number" style="color:#36acaa">389</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: openldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - mountPath: /var/lib/ldap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: ldap-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - gcePersistentDisk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pdName: ldap-persistent-storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          readOnly: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: ldap-data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以通过如下命令行直接将配置下发到集群当中</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -k ./prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/ldap created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl">KCL<a href="#kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>我们可以编写如下 KCL 代码并命名为 main.k</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apps/v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ldap"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ldap"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># When env is prod, override the `replicas` attribute with `6`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"env"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"prod"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Assign `metadata.labels` to `selector.matchLabels`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"osixia/openldap:1.1.11"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"--copy-service"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            volumeMounts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ldap-data"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mountPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/var/lib/ldap"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"openldap"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">volumes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ldap-data"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            emptyDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># When env is prod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># override the `emptyDir` attribute with `None`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># patch a `gcePersistentDisk` attribute with the value `{readOnly = True, pdName = "ldap-persistent-storage"}`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"env"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"prod"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                emptyDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                gcePersistentDisk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    readOnly </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    pdName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ldap-persistent-storage"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述 KCL 代码中我们分别声明了一个 Kubernetes Deployment 资源的 <code>apiVersion</code>、<code>kind</code>、<code>metadata</code> 和 <code>spec</code> 等变量，并分别赋值了相应的内容，特别地，我们将 <code>metadata.labels</code> 字段分别重用在 <code>spec.selector.matchLabels</code> 和 <code>spec.template.metadata.labels</code> 字段。可以看出，相比于 Kustomize 或者 YAML，KCL 定义的数据结构更加紧凑，而且可以通过定义局部变量实现配置重用。</p><p>在 KCL 中，我们可以通过条件语句和 option 函数动态地接收外部参数，为不同的环境需要设置不同的配置值生成不同环境的资源。比如对于如上代码，我们编写了一个条件语句并输入一个名为 <code>env</code> 的动态参数，当 <code>env</code> 为 <code>prod</code> 时，我们将 <code>replicas</code> 字段由 <code>1</code> 覆盖为 <code>6</code>，并且对名为 <code>ldap-data</code> 的 volume 配置进行一些调整，如将 <code>emptyDir</code> 字段修改为 <code>None</code>, 增加 <code>gcePersistentDisk</code> 的配置值等。</p><p>可以使用如下命令查看不同环境配置的 diff</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">diff</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kcl main.k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kcl main.k -D </span><span class="token assign-left variable" style="color:#36acaa">env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">prod</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">more</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出如下:</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token coord">8c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token deleted-arrow deleted prefix deleted" style="color:#d73a49">&lt;</span><span class="token deleted-arrow deleted line" style="color:#d73a49">   replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-arrow deleted line" style="color:#d73a49"></span><span class="token coord">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token inserted-arrow inserted prefix inserted" style="color:#36acaa">&gt;</span><span class="token inserted-arrow inserted line" style="color:#36acaa">   replicas: 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-arrow inserted line" style="color:#36acaa"></span><span class="token coord">30c30,33</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token deleted-arrow deleted prefix deleted" style="color:#d73a49">&lt;</span><span class="token deleted-arrow deleted line" style="color:#d73a49">         emptyDir: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-arrow deleted line" style="color:#d73a49"></span><span class="token coord">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token inserted-arrow inserted prefix inserted" style="color:#36acaa">&gt;</span><span class="token inserted-arrow inserted line" style="color:#36acaa">         emptyDir: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-arrow inserted line" style="color:#36acaa"></span><span class="token inserted-arrow inserted prefix inserted" style="color:#36acaa">&gt;</span><span class="token inserted-arrow inserted line" style="color:#36acaa">         gcePersistentDisk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-arrow inserted line" style="color:#36acaa"></span><span class="token inserted-arrow inserted prefix inserted" style="color:#36acaa">&gt;</span><span class="token inserted-arrow inserted line" style="color:#36acaa">           readOnly: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-arrow inserted line" style="color:#36acaa"></span><span class="token inserted-arrow inserted prefix inserted" style="color:#36acaa">&gt;</span><span class="token inserted-arrow inserted line" style="color:#36acaa">           pdName: ldap-persistent-storage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到生产环境的配置和基本配置的 diff 主要在于 <code>replicas</code> 和 <code>emptyDir</code> 等字段，与预期相符</p><p>此外，我们可以使用 KCL 命令行工具的 -o 参数将编译产生的 YAML 输出到文件中，并查看文件之间的 diff</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Generate base deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kcl main.k -o deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate prod deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kcl main.k -o prod-deployment.yaml -D </span><span class="token assign-left variable" style="color:#36acaa">env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Diff prod deployment and base deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">diff</span><span class="token plain"> prod-deployment.yaml deployment.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然我们也可以将 KCL 工具与 kubectl 等工具结合使用，将生产环境的配置下发到集群当中</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl main.k -D </span><span class="token assign-left variable" style="color:#36acaa">env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">prod </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/ldap created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以从命令行的结果看出与我们使用直接使用 Kustomize 配置和 kubectl apply 的一个 Deployment 体验完全一致，并且无更多的副作用</p><p>最后，通过 kubectl 检查部署状态</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME   READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldap   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/6     </span><span class="token number" style="color:#36acaa">6</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">           15s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>本期内容大概简单介绍了用 KCL 编写复杂多环境 Kubernetes 配置的快速入门和使用 Kustomize 工具进行 Kubernetes 多环境配置管理的对比，可以看出相比于 Kustomize, KCL 在实现配置复用和覆盖的基础上，通过代码化的方式减少了配置文件的个数和代码行数，提升了信息密度比，并且同 Kustomize 一样是一个纯客户端方案，并不会对集群有额外依赖或造成负担。</p>]]></content:encoded>
            <category>KCL</category>
            <category>Kustomize</category>
        </item>
        <item>
            <title><![CDATA[KCL 新版本功能解读系列 - Go SDK 功能速览！]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-new-version-feature-interpretation-kclvm-go-feature-overview</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-new-version-feature-interpretation-kclvm-go-feature-overview</guid>
            <pubDate>Thu, 27 Apr 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 是什么？]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-是什么">KCL 是什么？<a href="#kcl-是什么" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置和策略的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-go-sdk-是什么"><code>KCL Go SDK</code> 是什么？<a href="#kcl-go-sdk-是什么" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>kclvm 是一个 KCL 语言的运行时库，它提供了一个与 KCL 编译器交互的编程接口。它是一个客户端库，可用于对 KCL源代码执行各种操作，例如 执行、格式化等。<code>KCL Go SDK</code>是 kclvm 的 Go 语言包装，提供了 Go 语言的 SDK，方便了在云原生环境下 KCL 语言的集成。</p><p>目前，<code>KCL Go SDK</code> 客户端构建在 kclvm json2 rpc API 之上，这意味着它使用和其他语言的 kclvm 客户端使用的相同 API 与 KCL 源代码交互，这与其他语言的 KCL SDK 工作方式类似，但提供了更加友好的 Go 语言风格的包装。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新版本-kcl-go-sdk-解决了什么问题">新版本 <code>KCL Go SDK</code> 解决了什么问题？<a href="#新版本-kcl-go-sdk-解决了什么问题" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 作为一门配置型语言，和云原生领域有着极其紧密的联系，而另一方面，Go 语言已经成为了云原生领域通用编程语言的事实标准。在这样的背景下，开发 KCL 的 Go SDK 来完成 KCL 编译器与 Go 语言的直接交互就有了必要，这也是<code>KCL Go SDK</code>诞生的原因。</p><p>最初版本的 KCL 编译器及运行时使用 python 编写，由于 python 语言本身的性能问题和其动态语言的特性，初版 KCL 语言的运行速度和安全性都有很大提升空间。出于安全与效率问题的考虑，后续版本 KCL 编译器又使用了 rust 语言编写，因此新版本的<code>KCL Go SDK</code>基于 Rust 实现的 KCL 核心进行包装，去除了 python 依赖，简化了安装，优化了使用体验。</p><p>新版本<code>KCL Go SDK</code>可以视为一个纯 Go 包使用，无需任何外置依赖，可以通过一键<code>go install</code>即可完成安装使用。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="go-代码如何集成-kcl">Go 代码如何集成 KCL<a href="#go-代码如何集成-kcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>以上一节的 hello.k 为例，构建以下的 main.go 代码：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kcl </span><span class="token string" style="color:#e3116c">"kcl-lang.io/kcl-go"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yaml </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MustRun</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"kubernetes.k"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kcl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetRawYamlResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">yaml</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion = "apps/v1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind = "Deployment"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    name = "nginx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    labels.app = "nginx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    replicas = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    selector.matchLabels = metadata.labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    template.metadata.labels = metadata.labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    template.spec.containers = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            name = metadata.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            image = "${metadata.name}:1.14.2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            ports = [{ containerPort = 80 }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>kcl.MustRun("kubernetes.k", kcl.WithCode(code)).GetRawYamlResult()</code>运行对应的kcl源文件</li><li><code>fmt.Println(yaml)</code>打印运行结果</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>通过这一次的 <code>KCL Go SDK</code> 的版本变更，我们去除了 python 依赖并切换至性能更加优秀的 rust 运行时。文章分别简单展示了如何使用 &nbsp;<code>kcl-go</code> 命令行工具执行 KCL 源代码, 以及如何将 KCL 集成至您的 Go 程序之中。</p><p>当然除了简单的编译并运行 KCL 源码之外，<code>KCL Go SDK</code> 还提供了丰富的功能以方便用户更好地在 Go 中集成 KCL ， 包括：</p><ul><li>KCL 静态错误分析（lint与格式化）</li><li>KCL 依赖分析、</li><li>Go 结构体和 KCL Schema 互相转换等等</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户和社区小伙伴在此次版本更新过程中提出的宝贵反馈与建议。受限于文章篇幅，后续我们会撰写更多 KCL v0.4.6 新版本功能解读系列文章，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL Github 仓库</a></li><li><a href="https://github.com/kcl-lang/kcl-go" target="_blank" rel="noopener noreferrer">kclvm-go Github 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion Github 仓库</a></li><li><a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig Github 仓库</a></li></ul><p>欢迎加入我们的社区进行交流 👏👏👏：<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a> 👏👏👏</p>]]></content:encoded>
            <category>KCL</category>
            <category>kcl-go</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.4.6 发布日志]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.6-release-blog</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.6-release-blog</guid>
            <pubDate>Fri, 14 Apr 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 KCL v0.4.6 新版本现在已经可用！本次发布为大家带来了三方面的重点更新：<strong>语言</strong>、<strong>工具链</strong>、<strong>社区集成 &amp; 扩展支持</strong>。</p><ul><li><em>使用 IDE 插件提升 KCL 代码编写体验和效率</em></li><li><em>Helm/Kustomize/KPT 云原生社区工具集成</em></li><li><em>完善 KCL 多语言 SDK，方便应用程序集成</em></li></ul><p>进一步您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.4.6" target="_blank" rel="noopener noreferrer">KCL v0.4.6 发布页面</a> 或者 <a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer">KCL 官方网站</a> 获得下载安装指南和详细发布信息。</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置和策略的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。</p><p>本文重点介绍 KCL v0.4.6 版本的更新内容以及 KCL 社区的近期动态。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="语言更新">语言更新<a href="#语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="内置函数更新">内置函数更新<a href="#内置函数更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 字符串新增 <code>removeprefix</code> 和 <code>removesuffix</code> 成员函数用于去除字符串的前缀和后缀子字符串</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"prefix-string"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removeprefix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"prefix-"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># "string"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string-suffix"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removesuffix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"-suffix"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># "string"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多使用方式 <a href="https://kcl-lang.io/docs/reference/model/builtin#string-builtin-member-functions" target="_blank" rel="noopener noreferrer">详见</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="编译器提示信息改进">编译器提示信息改进<a href="#编译器提示信息改进" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，运行一次 KCL 命令行工具只会显示一个错误信息与警告，在 KCL v0.4.6 版本中，支持了一次编译显示多个错误与警告的能力并改善了错误提示信息，用于提升 KCL 代码错误排查效率，比如对于如下 KCL 代码 (main.k)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> "kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行如下 KCL 命令行，可以看到会同时提示字符串编写错误和花括号未正确匹配错误的语法错误信息</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl main.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">E1001</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: InvalidSyntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> main.k:2:21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  |                     ^ unterminated string</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">error[E1001]: InvalidSyntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> --&gt; main.k:2:24</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">2 |     labels = {key = "</span><span class="token plain">kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                        ^ expected </span><span class="token string" style="color:#e3116c">"}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="顶级-schema-语句合并运算符">顶级 schema 语句合并运算符<a href="#顶级-schema-语句合并运算符" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，在编写如下 KCL 代码时，会将两个 schema 配置进行合并后输出，在 KCL v0.4.6 版本中，要求显式使用属性合并运算符而不是属性覆盖运算符</p><ul><li>更新前</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"value"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>更新后</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use the union operator `:` instead of the override operator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use the union operator `:` instead of the override operator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"value"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="路径选择器参数简化">路径选择器参数简化<a href="#路径选择器参数简化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>我们使用 path selector CLI 参数 (-S) 不必再填入包路径，并且可以直接筛选内部变量</p><p>对于如下的 KCL 代码 (main.k):</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Person</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">person </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Person </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Alice"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以执行如下命令</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kcl main.k -S person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: Alice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">age: </span><span class="token number" style="color:#36acaa">18</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="错误修复">错误修复<a href="#错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="单行条件配置块语法解析错误">单行条件配置块语法解析错误<a href="#单行条件配置块语法解析错误" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在之前的 KCL 版本中，在编写如下 KCL 代码时会出现非预期的语法错误，在 KCL v0.4.6 版本中，我们修复了此类类似的问题</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"prod"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> env </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"prod"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"kubernetes.io/env"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="schema-必选属性检查">Schema 必选属性检查<a href="#schema-必选属性检查" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在之前的 KCL 版本中，在编写如下 KCL 代码时，没有按预期提示 <code>versions</code> 属性没有赋值的错误，在 KCL v0.4.6 版本中，我们修复了此类类似的问题</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema App</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    versions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> App </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Version </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="工具链更新">工具链更新<a href="#工具链更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-vs-code-插件">KCL VS Code 插件<a href="#kcl-vs-code-插件" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在此次更新中，我们发布了全新的 KCL VS Code 插件和使用 Rust 语言重写的语言服务服务器，相比于之前 KCL 版本性能约提升 20 倍，并支持了 KCL 错误警告在 IDE 中实时显示，以及 KCL 代码补全等新功能。</p><ul><li><strong>错误与告警实时显示</strong></li></ul><p><img loading="lazy" alt="Diagnostics" src="/zh-CN/assets/images/Diagnostics-716fc3b938a94e4db2cbafaad4f4174d.gif" width="1312" height="780" class="img_ev3q"></p><ul><li><strong>跳转</strong></li></ul><p><img loading="lazy" alt="Goto Definition" src="/zh-CN/assets/images/GotoDef-0875243eacd6b76e49b7a5b95cb9ce55.gif" width="1312" height="780" class="img_ev3q"></p><ul><li><strong>补全</strong></li></ul><p><img loading="lazy" alt="Completion" src="/zh-CN/assets/images/Completion-584771cd4bed237e74d3da3decaa9757.gif" width="1312" height="780" class="img_ev3q"></p><ul><li><strong>悬停</strong></li></ul><p><img loading="lazy" alt="Hover" src="/zh-CN/assets/images/Hover-339697d17ca0d4f167b1b1a904c9f1aa.gif" width="1312" height="780" class="img_ev3q"></p><p>更多 KCL VS Code 插件安装方式及详细更新内容<a href="https://kcl-lang.io/docs/tools/Ide/vs-code" target="_blank" rel="noopener noreferrer">详见</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="包管理工具">包管理工具<a href="#包管理工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 KCL v0.4.6 新版本中，我们提供了全新的 KCL 包管理工具 alpha 版本，用户可以通过几个命令即可获得社区中已经编写好的 KCL 模型。比如可以通过包管理工具一键导入 KCL Kubernetes 模型并使用</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpm init kubernetes_demo </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> kpm </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -git https://github.com/awesome-kusion/konfig.git -tag v0.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编写 KCL 代码 (main.k)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> konfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pkg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kusion_kubernetes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">apps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> apps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Deployment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx-deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> selector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matchLabels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nginx:1.14.2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行如下 KCL 命令即可获得一个 Nginx Deployment YAML 输出</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kpm run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: nginx-deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: </span><span class="token string" style="color:#e3116c">"nginx:1.14.2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - containerPort: </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>更多 KCL 包管理工具安装方式、详细内容及用例<a href="https://kcl-lang.io/docs/user_docs/guides/package-management/overview" target="_blank" rel="noopener noreferrer">详见</a></li><li>更多 Konfig 模型库的内容和使用方式<a href="https://kcl-lang.io/docs/user_docs/guides/working-with-konfig/overview" target="_blank" rel="noopener noreferrer">详见</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区集成--扩展更新">社区集成 &amp; 扩展更新<a href="#社区集成--扩展更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-配置管理工具扩展支持">Kubernetes 配置管理工具扩展支持<a href="#kubernetes-配置管理工具扩展支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 KCL v0.4.6 中，我们以统一的编程界面方式为 Kubernetes 社区的 Helm, Kustomize, KPT 等配置管理工具提供了插件支持，编写几行 KCL 代码即可无侵入地完成对存量 Kustomize YAML，Helm Charts 的编辑和校验，比如编写少量 KCL 代码修改资源标签/注解, 注入 sidecar 容器配置，使用 KCL schema 校验资源等。</p><p>下面以 Kustomize 工具对 KCL 的集成为例进行详细说明。使用 Kustomize KCL 插件无需安装任何与 KCL 相关的二进制，仅需您本地安装有 Kustomize 工具即可。</p><p>首先执行如下命令获取一个 Kustomize YAML 配置示例:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/kcl-lang/kustomize-kcl.git </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token builtin class-name">cd</span><span class="token plain"> ./kustomize-kcl/examples/set-annotation/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后执行如下命令使用 KCL 代码仅为所有的 <code>Deployment</code> 资源添加一个 <code>managed-by=kustomize-kcl</code> 注解</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kustomize fn run ./local-resource/ --as-current-user --dry-run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以得到如下 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config.kubernetes.io/path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">use.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal.config.kubernetes.io/path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">use.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MyApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9376</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config.kubernetes.io/path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">use.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal.config.kubernetes.io/path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">use.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># This annotation is added through the kcl code.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">managed-by</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kustomize</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.14.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述 YAML 配置中，我们仅编写了一行 KCL 代码就完成为 Deployment 资源添加一个 <code>managed-by=kustomize-kcl</code> 注解</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">resource </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kind </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"managed-by"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> resource </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"resource_list"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外我们为 Kustomize/Helm/KPT 三个工具均提供了常用的容器、服务配置修改校验 KCL 模型，并且会持续完善，欢迎社区小伙伴一起参与共建。</p><ul><li>更多 Kustomize KCL 插件详细内容以及用例 <a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/kustomize_kcl_plugin" target="_blank" rel="noopener noreferrer">详见</a></li><li>更多 Helm KCL 插件详细内容以及用例 <a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/helm_kcl_plugin" target="_blank" rel="noopener noreferrer">详见</a></li><li>更多 KPT KCL 插件详细内容以及用例 <a href="https://kcl-lang.io/docs/user_docs/guides/working-with-k8s/kpt_kcl_sdk" target="_blank" rel="noopener noreferrer">详见</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="多语言-sdk">多语言 SDK<a href="#多语言-sdk" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在此次更新中，我们发布了全新的 KCL Go SDK 将 KCL 集成到您的 Go 应用程序中，并提供丰富的 API 与 KCL 进行交互。您可以在 <a href="https://kcl-lang.io/docs/next/reference/xlang-api/go-api" target="_blank" rel="noopener noreferrer">这里</a> 查询详细的 API 文档。此外我们还更新了如下特性和错误修复：</p><ul><li>感谢 @jakezhu9 修复了 kcl-go 未预期的 KCL 格式化 API 在 CI Pipeline 中单元测试错误</li><li>感谢 @Ekko 贡献 Go struct 和 KCL schema 双向转换支持，详见:<ul><li><a href="https://github.com/kcl-lang/kcl-go/blob/main/pkg/tools/gen/genkcl.go#L23" target="_blank" rel="noopener noreferrer">Go struct -&gt; KCL schema</a></li><li><a href="https://github.com/kcl-lang/kcl-go/blob/main/pkg/tools/gen/gengo.go#L23" target="_blank" rel="noopener noreferrer">KCL schema -&gt; Go struct</a></li></ul></li><li>KCL schema 到 protobuf message 的转换支持，<a href="https://github.com/kcl-lang/kcl-go/blob/main/pkg/tools/gen/genpb.go#L25" target="_blank" rel="noopener noreferrer">详见</a></li><li>KCL 新增获取 schema 类型和实例 API，<a href="https://kcl-lang.io/docs/reference/xlang-api/go-api#func-getschematype" target="_blank" rel="noopener noreferrer">详见</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他更新与错误修复">其他更新与错误修复<a href="#其他更新与错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>KCL python plugin 功能默认不开启，如需开启可参考 <a href="https://kcl-lang.io/docs/reference/plugin/overview" target="_blank" rel="noopener noreferrer">KCL Plugin 文档</a></li><li>KCL playground 支持代码分享能力，您可以通过访问 <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 官网</a> 并点击 Playground 按钮进行体验</li><li>更多更新与错误修复，<a href="https://github.com/kcl-lang/kcl/milestone/3?closed=1" target="_blank" rel="noopener noreferrer">详见</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档更新">文档更新<a href="#文档更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a> 新增 KCL v0.4.6 文档内容并支持版本化语义选项，目前支持 v0.4.3, v0.4.4, v0.4.5 和 v0.4.6 版本选择。同时欢迎社区同学进行文档共建。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>预计 2023 年年中，我们将发布 <strong>KCL v0.5.0 版本</strong>，预期重点演进包括：</p><ul><li>更多针对场景问题的 KCL 语言编写便利性改进，用户界面持续优化与体验提升，用户支持和痛点解决</li><li>更多 IDE 插件、包管理工具、Helm/Kustomize/KPT 场景集成、功能支持和用户体验提升</li><li>针对云原生场景提供更多开箱即用的 KCL 模型支持，主要包含容器、服务、计算、存储和网络等</li><li>支持 KCL Schema 直接生成 Kubernetes CRD</li><li>支持 kubectl 和 helmfile KCL plugin，通过 KCL 代码直接生成、编辑和校验 Kubernetes 原生资源</li><li>支持在 Kubernetes 运行时通过 Admission Controller 运行 KCL 代码对 YAML 进行编辑和校验</li><li>更多非 Kubernetes 场景支持，如通过 KCL Schema 对 AI 模型进行数据清理和数据库 Schema 集成支持</li></ul><p>更多详情请参考 <a href="https://github.com/kcl-lang/kcl/milestone/5" target="_blank" rel="noopener noreferrer">KCL v0.5.0 Milestone</a></p><p>如果您有更多的想法和需求，欢迎在 KCL Github 仓库发起 <a href="https://github.com/kcl-lang/kcl/issues" target="_blank" rel="noopener noreferrer">Issues</a>，也欢迎加入我们的社区进行交流 🙌 🙌 🙌</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题及解答">常见问题及解答<a href="#常见问题及解答" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>详见 <a href="https://kcl-lang.io/docs/user_docs/support/faq-kcl" target="_blank" rel="noopener noreferrer">KCL 常见问题</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户和社区小伙伴在此次版本更新过程中提出的宝贵反馈与建议。受限于文章篇幅，后续我们会撰写更多 KCL v0.4.6 新版本功能解读系列文章，敬请期待!</p><p>更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL Github 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion Github 仓库</a></li><li><a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig Github 仓库</a></li></ul><p>欢迎加入我们的社区进行交流 👏👏👏：<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[OS2ATC 2022 会议 KCL 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-03-26-kcl-os2atc-meeting</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-03-26-kcl-os2atc-meeting</guid>
            <pubDate>Sun, 26 Mar 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL Talk Cover]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="KCL Talk Cover" src="/zh-CN/assets/images/talk-cover-f408fff3ff8dda7aebc27dd702a44cc7.jpg" width="2766" height="1108" class="img_ev3q"></p><p><a href="https://kcl-lang.github.io/talks/kcl-waic2023.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
            <category>Policy</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.4.6-alpha.1 发布日志]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.6-alpha.1-release-blog</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.6-alpha.1-release-blog</guid>
            <pubDate>Mon, 20 Mar 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 KCL v0.4.6-alpha.1 版本现在已经可用！</p><p>您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.4.6-alpha.1" target="_blank" rel="noopener noreferrer">KCL v0.4.6-alpha.1 发布页面</a> 或者 <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 官方网站</a> 获得 KCL 二进制下载链接和更多详细发布信息。</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置和策略的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="发布内容">发布内容<a href="#发布内容" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>包含数字、字面值、括号等词法错误恢复</li><li>KCL IDE 插件支持错误和告警显示，跳转等能力</li><li>部分编译器报错改善</li><li>KCL Playground 支持代码分享能力</li><li><a href="https://github.com/kcl-lang/kcl/issues/434" target="_blank" rel="noopener noreferrer">Kubernetes KPT 工具集成方案设计</a></li><li><a href="https://github.com/kcl-lang/kcl/issues/426" target="_blank" rel="noopener noreferrer">Kubernetes Helm KCL 工具插件方案</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>KPM 包管理工具正式发布</li><li>更多 KCL 编译器语法错误恢复支持新版 IDE 插件发布，性能预计提升 20 倍</li><li>Helm，KPT 等 Kubernetes 工具 KCL 集成正式发布</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题及解答">常见问题及解答<a href="#常见问题及解答" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>详见 <a href="https://kcl-lang.io/docs/user_docs/support/" target="_blank" rel="noopener noreferrer">KCL 常见问题</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户在此次版本更新过程中提出的宝贵的反馈与建议。更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL Github 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion Github 仓库</a></li><li><a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig Github 仓库</a></li></ul><p>欢迎加入我们的<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">社区</a>进行交流 👏👏👏</p>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[全新的 KCL Playground 来了!]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2023-kcl-playground-0.4.5-release</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2023-kcl-playground-0.4.5-release</guid>
            <pubDate>Fri, 17 Mar 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 KCL Playground v0.4.5 版本现在已经可用！</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置和策略的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。</p><p>您可以访问 <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a> 点击 playground 进行体验。在这个新版本中，我们支持了根据输入 KCL 代码变化自动编译和运行 KCL 代码、格式化代码和以及共享代码的能力。欢迎参与撰写并将 KCL 代码分享给您的小伙伴。</p><p><img loading="lazy" src="/zh-CN/assets/images/kcl-website-playground-1521b165cb8c0b87f707ce615579d650.png" width="3352" height="966" class="img_ev3q"></p><p><img loading="lazy" src="/zh-CN/assets/images/kcl-playground-5d5f8f1e7b7cff22b250847debbef1c7.png" width="1400" height="509" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>预计 2023 年 4 月中旬，我们将发布 <strong>KCL Playground v0.4.6 版本</strong>，预期重点演进包括：KCL 版本选择，导入已有代码片段等能力。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题及解答">常见问题及解答<a href="#常见问题及解答" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>详见 <a href="https://kcl-lang.io/docs/user_docs/support/" target="_blank" rel="noopener noreferrer">KCL 常见问题</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户在此次版本更新过程中提出的宝贵的反馈与建议。更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL Github 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion Github 仓库</a></li><li><a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig Github 仓库</a></li></ul><p>欢迎加入我们的社区进行交流 👏👏👏：<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
            <category>Playground</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.4.5 发布日志]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.5-release-blog</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.5-release-blog</guid>
            <pubDate>Mon, 27 Feb 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[简介]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 团队很高兴地宣布 KCL v0.4.5 版本现在已经可用！本次发布主要为 KCL 语言编写便利性和稳定性提升，错误信息改进以及更多平台包括 windows 版本支持以及更多下载方式支持。在 KCL v0.4.5 版本中，用户可以通过编写更少的 KCL 代码消除更多的配置模版；在新版本中提供了初步的 KCL Playground 支持可用于在线免安装编写并运行 KCL 代码；此外此次更新还包含多项编译器报错信息优化和错误修复。</p><p>您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.4.5" target="_blank" rel="noopener noreferrer">KCL v0.4.5 发布页面</a> 或者 <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 官方网站</a> 获得 KCL 二进制下载链接和更多详细发布信息。</p><p><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 是一个开源的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置和策略的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。</p><p>本文将会介绍 KCL v0.4.5 版本的更新内容以及 KCL 社区的近期动态。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="语言更新">语言更新<a href="#语言更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-语言编写便利性改进">KCL 语言编写便利性改进<a href="#kcl-语言编写便利性改进" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持-schema-非空属性惰性校验">支持 Schema 非空属性惰性校验<a href="#支持-schema-非空属性惰性校验" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在之前的 KCL 版本中，我们已经支持了 schema 属性互相引用（包含继承）以及 check 校验表达式的惰性求值与校验能力，在此次版本更新中，我们支持了更多的 schema 惰性求值能力: Schema 属性非空惰性校验。比如对于下述的 KCL 的代码：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Spec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Spec </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># 在 KCL v0.4.5 版本之前，这个语句会报属性非空错误，v0.4.5 版本之后，支持 Schema 非空属性惰性校验能力</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"value"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 v0.4.5 之前的 KCL 版本中，直接执行上述代码会在 <code>schema Config</code> 语句块的 <code>spec: Spec = Spec {</code> 处抛出一个 <code>spec</code> 的 <code>value</code> 属性不能为空的错误，因为在该处只对 <code>spec</code> 的 <code>id</code> 属性赋值为 <code>1</code>，而没有对 <code>spec</code> 的 <code>value</code> 属性赋值。</p><p>在 KCL 的 v0.4.5 版本更新后，我们支持了 schema 属性的惰性非空校验能力之后会避免这个错误的抛出，即当在 <code>config</code> 属性的 <code>spec.value = "value"</code> 与 <code>spec.id = 1</code> 合并之后才会递归地对 <code>config</code> 的所有属性进行非空检查，此时 <code>spec</code> 属性的所有值是被完整赋值的 (<code>spec</code> 的 <code>id</code> 字段的值为 <code>1</code>, <code>value</code> 字段为 <code>"value"</code>，)，不会抛出必选属性字段为空错误。</p><p>因此在 v0.4.5 版本之后，执行上述 KCL 代码，我们会得到如下所示的完整 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> value</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持配置块属性互相引用以消除更多的配置模版">支持配置块属性互相引用以消除更多的配置模版<a href="#支持配置块属性互相引用以消除更多的配置模版" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在 v0.4.5 之前的版本中，KCL 尚未支持配置块内部的属性互相引用，导致在某些场景中会需要定义额外的配置变量或者模版来进行引用，会产生较多的配置模版和重复代码，比如对于如下所示的 KCL 代码：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"app-name"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name  </span><span class="token comment" style="color:#999988;font-style:italic"># `metadata.name` 不能直接引用 `data` 内部的 `name` 属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>data</code> 配置块的 <code>metadata.name</code> 属性不能直接引用 <code>data</code> 内部的 <code>name</code> 属性，需要额外定义一个全局变量 <code>name</code> 进行引用。</p><p>而在 KCL 的 v0.4.5 版本更新后，我们支持了配置块属性互相引用的特性，可以用于消除更多的配置模版，比如如下所示的 KCL 代码：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"app-name"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name  </span><span class="token comment" style="color:#999988;font-style:italic"># 直接引用 `data` 配置的 name 属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>data</code> 配置块的 <code>metadata.name</code> 属性可以直接引用 <code>data</code> 内部的 <code>name</code> 属性而无需定义额外的全局变量。</p><p>执行上述 KCL 代码可以获得如下 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面是一个更复杂的例子</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"global-name"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"metadata-name"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"app.kubernetes.io/name"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name  </span><span class="token comment" style="color:#999988;font-style:italic"># 直接引用 `metadata.name`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"app.kubernetes.io/instance"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name  </span><span class="token comment" style="color:#999988;font-style:italic"># 直接引用 `metadata.name`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name  </span><span class="token comment" style="color:#999988;font-style:italic"># 引用全局的 `name` 变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata  </span><span class="token comment" style="color:#999988;font-style:italic"># 引用全局的 `metadata` 变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name  </span><span class="token comment" style="color:#999988;font-style:italic"># 引用 `data` 内部的 `metadata` 变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行上述代码可以获得如下 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> global</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> global</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>⚠️ 注意：当前 KCL 版本尚未支持配置块内部属性后向引用以及跳过内部作用域直接引用全局变量，需要将被引用的属性书写在配置引用处的前方</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-语言新增功能">KCL 语言新增功能<a href="#kcl-语言新增功能" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="字符串-format-成员函数支持索引格式化">字符串 format 成员函数支持索引格式化<a href="#字符串-format-成员函数支持索引格式化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在 KCL v0.4.5 版本更新后，KCL 支持了类似 Python 字符串 format 成员函数在 <code>{}</code> 格式化块中使用 <code>&lt;format_ele_index&gt;[&lt;index_or_key&gt;]</code> 索引标记样式对列表和字典类型的 KCL 变量进行格式化。其中</p><ul><li><code>&lt;format_ele_index&gt;</code> 表示需要需要序列化列表和字典类型元素的索引</li><li><code>&lt;index_or_key&gt;</code> 表示对应列表和字典类型元素的列表子元素索引或者字典子元素键值</li></ul><p>比如对于如下的 KCL 代码</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 0[0] 表示取 ["Hello", "World"] 的第 0 个元素："Hello"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 0[1] 表示取 ["Hello", "World"] 的第 1 个元素："World"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listIndexFormat </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"{0[0]}{0[1]}"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"Hello"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"World"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 0[0] 表示取 ["0", "1"] 的第 0 个元素："1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1[Hello] 表示取 {"Hello": "World"} 键值为 Hello 的字典元素："World"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dictIndexFormat </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0{0[0]}, 1{0[1]}, Hello{1[Hello]}"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"Hello"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"World"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行上述代码可以获得如下 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">listIndexFormat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HelloWorld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dictIndexFormat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"00, 11, HelloWorld"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-语言-playground-更新">KCL 语言 Playground 更新<a href="#kcl-语言-playground-更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在此次更新中，我们更新了 KCL Playground 的版本并支持 KCL 代码自动编译和格式化两项能力，您可以通过访问 <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 官网</a> 并点击 Playground 按钮进行体验。</p><p><img loading="lazy" src="/zh-CN/assets/images/kcl-website-playground-1521b165cb8c0b87f707ce615579d650.png" width="3352" height="966" class="img_ev3q"></p><p><img loading="lazy" src="/zh-CN/assets/images/kcl-playground-d3027fa33d624bf989178f11011fb2d5.png" width="3132" height="886" class="img_ev3q"></p><p>在后续 KCL 版本中，我们会持续更新 KCL Playground 更多能力支持如 KCL 版本选择与代码分享等功能。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-更多平台和更多下载方式支持">KCL 更多平台和更多下载方式支持<a href="#kcl-更多平台和更多下载方式支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="windows-版本支持">Windows 版本支持<a href="#windows-版本支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>KCL Windows 二进制版本可以从 <a href="https://github.com/kcl-lang/kcl/releases/" target="_blank" rel="noopener noreferrer">Github</a> 手动下载并安装，下载完成后将 <code>{install-location}\kclvm\bin</code> 添加到环境变量 <code>PATH</code> 中。</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$env:PATH += ";{install-location}\kclvm\bin;"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外，还可以通过如下所示的 Powershell 脚本进行安装:</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">powershell -Command "iwr -useb https://kcl-lang.io/script/install.ps1 | iex"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们后续会支持更多的 Windows 包管理下载方式，如 <code>Scoop</code> 等。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="更多下载方式支持">更多下载方式支持<a href="#更多下载方式支持" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>在此次版本更新中，我们支持了更多的 KCL 下载方式，包括脚本, Python, Go, Homebrew 和 Docker 一键安装，更多详细内容请参考 <a href="https://kcl-lang.io/docs/user_docs/getting-started/install" target="_blank" rel="noopener noreferrer">KCL 下载与安装</a>，后续我们会支持更多 KCL 安装方式。</p><blockquote><p>⚠️ 注意：对于上述所有操作系统和安装方式，如果要使用 <a href="https://kcl-lang.io/docs/reference/plugin/overview" target="_blank" rel="noopener noreferrer">KCL Python 插件</a> 能力，需要确保已经安装了 Python 3.7+ 版本并将 python3 命令添加到您的 PATH 环境变量中。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="错误修复">错误修复<a href="#错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="当存在非配置表达式的右值时配置合并顺序错误">当存在非配置表达式的右值时配置合并顺序错误<a href="#当存在非配置表达式的右值时配置合并顺序错误" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Resource </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"8Gi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Resource </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cpu </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        memory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"4Gi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 KCL v0.4.5 版本之前，执行上述代码 (main.k) 会得到非预期的配置值，是因为 KCL 编译器错误地优化了如下形式等效合并配置块</p><div class="language-python3 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python3 codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config: Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource: r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource: Resource {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cpu = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        memory = "4Gi"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>KCL v0.4.5 版本更新后，修正了不正确配置合并顺序，可以执行 main.k 并获得预期的 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">r</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 8Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 8Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多详情请参考 <a href="https://github.com/kcl-lang/kcl/issues/422" target="_blank" rel="noopener noreferrer">KCL Issue #422</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置-if-表达式类型不匹配错误优化">配置 if 表达式类型不匹配错误优化<a href="#配置-if-表达式类型不匹配错误优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"A"</span><span class="token operator" style="color:#393A34">|</span><span class="token string" style="color:#e3116c">"B"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 KCL v0.4.5 版本之前，对于配置 if 表达式，执行上述代码会得到预期的配置值导致 Type Unsoundness 问题，是因为 KCL 编译器错误地没有检查出 <code>A</code> 属性的值 <code>"2"</code> 与声明的类型 <code>int</code> 不匹配，KCL v0.4.5 版本更新后，修正了此类问题，可以执行上述代码可以获得预期的类型不匹配错误:</p><div class="language-stderr codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-stderr codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KCL Compile Error[E2G22] : The type got is inconsistent with the type expected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---&gt; File main.k:1:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 |config: {"A"|"B": int} = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 ^  -&gt; got {str(A):str(2)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect {str(A)|str(B):int}, got {str(A):str(2)}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多详情请参考 <a href="https://github.com/kcl-lang/kcl/issues/389" target="_blank" rel="noopener noreferrer">KCL Issue #389</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rule-语句校验不生效问题">Rule 语句校验不生效问题<a href="#rule-语句校验不生效问题" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，在使用如下 rule 规则代码时 (main.k)，<code>ServiceCheckRule</code> 的约束代码会不生效。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protocol KubeResourceProtocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    svc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rule ServiceCheckRule </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> KubeResourceProtocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    svc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"name"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">svc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Service </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"name"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServiceCheckRule </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    svc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>进行改进后，我们执行上述代码，会得到一个准确的校验不通过错误:</p><div class="language-stderr codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-stderr codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KCL Runtime Error[E3B17] : Schema check is failed to check condition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---&gt; File main.k:14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14 |ServiceCheckRule { -&gt; Instance check failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ---&gt; File main.k:8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    8 |    svc.name != "name" -&gt; Check failed on the condition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Check failed on check conditions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置块属性类型推导优化">配置块属性类型推导优化<a href="#配置块属性类型推导优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"A"</span><span class="token operator" style="color:#393A34">|</span><span class="token string" style="color:#e3116c">"B"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Id</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># v0.4.5 版本之前，此处会得到一个类型不匹配错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        B </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 KCL v0.4.5 版本之前，执行上述代码会得到一个非预期的类型不匹配，是因为 KCL 编译器错误地将 <code>c.data.A</code> 属性的类型推导为 <code>str</code> 类型，导致与 <code>"A"|"B"</code> 字面值联合类型不匹配错误，KCL v0.4.5 版本更新后，修正了此类问题，可以执行上述代码可以获得预期的 YAML 输出:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">c</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">A</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">B</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="赋值语句使用-schema-类型注解错误优化">赋值语句使用 schema 类型注解错误优化<a href="#赋值语句使用-schema-类型注解错误优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Bar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Bar </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># v0.4.5 版本之前，此处会得到一个运行时类型不匹配错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 KCL v0.4.5 版本之前，执行上述代码会得到一个运行时类型不匹配错误，版本更新后，会将此类类型不匹配错误优化到编译时，将错误左移，更早地发现此类错误。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kcl-模块类型使用--运算符类型错误修复">KCL 模块类型使用 ?. 运算符类型错误修复<a href="#kcl-模块类型使用--运算符类型错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> math</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># v0.4.5 版本之前，此处会得到一个非预期的 `math is not defined` 错误</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 KCL v0.4.5 版本之前，执行上述代码会得到一个非预期的变量未定义错误，是因为 KCL 编译器没有正确地处理 <code>math</code> module 类型和 <code>?.</code> 运算符结合使用的情况，版本更新后，此类问题得到修复。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他更新与错误修复">其他更新与错误修复<a href="#其他更新与错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>更多更新与错误修复 <a href="https://github.com/kcl-lang/kcl/milestone/3" target="_blank" rel="noopener noreferrer">详见</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档更新">文档更新<a href="#文档更新" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a> 新增 KCL v0.4.5 文档内容并支持版本化语义选项，目前支持 v0.4.3, v0.4.4 和 v0.4.5 版本选择。</p><p><img loading="lazy" src="/zh-CN/assets/images/kcl-website-doc-version-ab26a60377e71734b94b0bc15c7e5c3d.png" width="3358" height="918" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>KCL 社区新增两名外部贡献者 @thinkrapido, @Rishav1707, 感谢他们热情并积极地参与贡献。</li><li>感谢 @Rishav1707 基于 KCL 建立了 Rust 语言版本的 <a href="https://github.com/i-think-rapido/kcl-loader-rs" target="_blank" rel="noopener noreferrer">kcl-loader-rs</a> 子项目，当前版本支持根据 KCL 文件中的 Schema 和配置定义自动生成 Rust 结构体并支持 KCL 值到 Rust 结构体值的反序列化函数。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>预计 2023 年 4 月中旬，我们将发布 <strong>KCL v0.4.6 版本</strong>，预期重点演进包括：</p><ul><li>KCL 语言进一步编写便利性改进，用户界面持续优化与体验提升，用户支持和痛点解决</li><li>全新版本的 KCL Language Server 和 <a href="https://github.com/kcl-lang/vscode-kcl" target="_blank" rel="noopener noreferrer">VSCode 语言插件</a>，性能预计<strong>提升 20 倍</strong>，并预期支持代码警告和错误波浪线提示，跳转，引用查找等核心基础能力</li><li>针对 Kubernetes Manifests 配置管理场景痛点持续进行语言能力提升：如设计提供 <a href="https://github.com/helm/helm" target="_blank" rel="noopener noreferrer">Helm</a> KCL Schema 插件以及为 <a href="https://github.com/GoogleContainerTools/kpt" target="_blank" rel="noopener noreferrer">kpt</a> 工具提供 KCL SDK 等</li><li><a href="https://github.com/kcl-lang/kpm" target="_blank" rel="noopener noreferrer">KCL 包管理工具 KPM</a> 发布，预期支持 Git 仓库代码依赖配置与更新，代码下载等基础能力</li><li><a href="https://github.com/kcl-lang/kcl-playground" target="_blank" rel="noopener noreferrer">KCL Playground</a> 支持代码分享能力和 KCL 版本选择能力</li><li><a href="https://github.com/kcl-lang/kcl-go" target="_blank" rel="noopener noreferrer">KCL Go SDK</a> 更多能力支持：如支持 KCL Schema 和 Go 结构体的双向转换等</li><li><a href="https://github.com/kcl-lang/kcl-py" target="_blank" rel="noopener noreferrer">KCL Python SDK</a> 更多能力支持</li></ul><p>更多详情请参考 <a href="https://github.com/kcl-lang/kcl/milestone/4" target="_blank" rel="noopener noreferrer">KCL v0.4.6 Milestone</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题及解答">常见问题及解答<a href="#常见问题及解答" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>详见 <a href="https://kcl-lang.io/docs/user_docs/support/" target="_blank" rel="noopener noreferrer">KCL 常见问题</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>感谢所有 KCL 用户在此次版本更新过程中提出的宝贵的反馈与建议。更多其他资源请参考：</p><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL Github 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion Github 仓库</a></li><li><a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig Github 仓库</a></li></ul><p>欢迎加入我们的社区进行交流 👏👏👏：<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[OSDT 2022 会议 KCL 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-osdt-meeting</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-osdt-meeting</guid>
            <pubDate>Sat, 10 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL Talk Cover]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="KCL Talk Cover" src="/zh-CN/assets/images/talk-cover-069278176a8c865d410452e9204732f0.jpg" width="2548" height="1428" class="img_ev3q"></p><p><a href="https://kcl-lang.github.io/talks/kcl-osdt2022.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
            <category>Policy</category>
        </item>
        <item>
            <title><![CDATA[KCL v0.4.4 发布日志]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.4-release-blog</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-0.4.4-release-blog</guid>
            <pubDate>Tue, 06 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL 团队很高兴地宣布 0.4.4 版本现在已经可用！本次发布主要为 KCL 语言增加了自定义 YAML Manifests 输出的能力，用户可以通过编写代码并调用系统函数来自定义 YAML 输出的样式而无需理解复杂的 schema settings 语义；此外本次发布提供了最新的 KCL Python SDK 可用于 Python 用户对 KCL 直接集成；同时我们大大降低了 KCL 安装包的体积，平均安装包体积降低为之前版本的五分之一，并包含多项编译器报错信息优化和 bug 修复。您可以在 KCL 发布页面 获得更多详细发布信息和 KCL 二进制下载链接。]]></description>
            <content:encoded><![CDATA[<p>KCL 团队很高兴地宣布 0.4.4 版本现在已经可用！本次发布主要为 KCL 语言增加了自定义 YAML Manifests 输出的能力，用户可以通过编写代码并调用系统函数来自定义 YAML 输出的样式而无需理解复杂的 schema settings 语义；此外本次发布提供了最新的 <a href="https://github.com/kcl-lang/kcl-py" target="_blank" rel="noopener noreferrer">KCL Python SDK</a> 可用于 Python 用户对 KCL 直接集成；同时我们大大降低了 KCL 安装包的体积，平均安装包体积降低为之前版本的五分之一，并包含多项编译器报错信息优化和 bug 修复。您可以在 <a href="https://github.com/kcl-lang/kcl/releases/tag/v0.4.4-alpha.2" target="_blank" rel="noopener noreferrer">KCL 发布页面</a> 获得更多详细发布信息和 KCL 二进制下载链接。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="背景">背景<a href="#背景" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 是一个开源的基于约束的记录及函数语言，期望通过成熟的编程语言技术和实践来改进对大量繁杂配置和策略的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。</p><p>本文将向读者介绍 KCL 社区的近期动态。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新增特性">新增特性<a href="#新增特性" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自定义-yaml-格式输出">自定义 YAML 格式输出<a href="#自定义-yaml-格式输出" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在过去的 KCL 版本中，YAML 输出的样式是在 KCL 编译器中是硬编码的，用户可以为 schema 的 <code>__settings__</code> 元属性设置为不同的值来决定 YAML 输出样式，这带来了较高的复杂度和记忆成本，因此在 0.4.4 版本中我们提供了一个系统库函数用于开发人员更简单地自定义 YAML 输出样式，这个函数的签名如下：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">manifests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yaml_stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> opts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sort_keys </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore_private </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore_none </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"---"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个函数的功能是将 KCL 对象列表序列化为带 <code>---</code> 分隔符的样式 YAML 输出，它具有两个参数:</p><ul><li><code>values</code> - 一个 KCL 对象列表</li><li><code>opts</code> - YAML 序列化选项<ul><li><code>sort_keys</code>：是否按属性名称的字典序对序列化结果进行排序（默认为 <code>False</code>）。</li><li><code>ignore_private</code>：是否忽略名称以 <code>_</code> 开头的属性序列化输出（默认为 <code>True</code>）。</li><li><code>ignore_none</code>：是否忽略值为 <code>None</code> 的属性（默认为 <code>False</code>）。</li><li><code>sep</code>：在多个 YAML 文档之间选择怎样的分隔符（默认为 <code>"---"</code>）。</li></ul></li></ul><p>下面我们通过一个例子来说明:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> manifests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Deployment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deployment"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"deploy"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replica </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"v1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Service"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"svc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Deployment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Deployment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Service </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Service </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">manifests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yaml_stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deployments </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> services</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>首先我们通过 <code>import</code> 关键字导入 <code>manifests</code> 模块并定义 2 个 Deployment 以及 2 个 Service 资源，当我们想以 YAML stream 并以 <code>---</code> 作为分隔符的格式依次输出这 4 个资源时，我们可以将它们合并为一个 KCL 列表并作为 <code>manifests.yaml_stream</code> 函数的 <code>values</code> 形参进行传入 (如无特殊需求，opts 参数一般使用默认值即可)，最终得到 YAML 输出为:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replica</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replica</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> svc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注：schema 的 <code>__settings__</code> 元属性设置 YAML 输出样式的特性仍然可以在 v0.4.4 版本中使用，大约后续两个小版本发布后在 KCL v0.4.6 版本中，我们会移除这个特性</p></blockquote><p>更多信息请参阅：<a href="https://github.com/kcl-lang/kcl/issues/94" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/94</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="python-sdk">Python SDK<a href="#python-sdk" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>除了已有的 <a href="https://github.com/kcl-lang/kcl-go" target="_blank" rel="noopener noreferrer">KCL Go SDK</a>, 本次发布还新增了 KCL Python SDK，使用 Python SDK 要求您本地具备高于 3.7.3 的 Python 版本和 pip 包管理工具，可以通过如下命令进行安装并获得帮助信息</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> kclvm --user </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> python3 -m kclvm --help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="命令行工具">命令行工具<a href="#命令行工具" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>编写名为 <code>main.k</code> 的 KCL 文件:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">age </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Person</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"kcl"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Person </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Person </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">101</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行如下命令并获得输出:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ python3 -m kclvm hello.k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">age: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  age: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  age: </span><span class="token number" style="color:#36acaa">101</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api">API<a href="#api" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>此外，我们还可以通过 Python 代码实现对 KCL 文件的执行</p><p>编写名为 <code>main.py</code> 的 python 文件:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> kclvm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">program</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> kclvm_exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> kclvm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">planner </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> planner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">planner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kclvm_exec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"hello.k"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">filter_by_path_selector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行如下命令并获得输出:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ python3 main.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">age: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  age: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  age: </span><span class="token number" style="color:#36acaa">101</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看出通过命令行工具和 API 可以获得同样的输出。</p><p>目前 KCL Python SDK 还处于早期预览版本，后续 KCL 团队会持续更新并提供更丰富的功能，更多信息请参阅：<a href="https://github.com/kcl-lang/kcl-py" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-py</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装体积优化">安装体积优化<a href="#安装体积优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>在新的 KCL 版本中，我们将 KCL 内置的 Python3 剥离，使得 KCL 二进制压缩包的体积从平均 200M 降低为 35M，用户可以更快地下载并使用 KCL，并且 Python Plugin 成为一个可选项，如果您想启用 KCL Python 插件，一个额外要求是需要您本地具备高于 3.7.3 版本的 Python 以及 pip 包管理工具，更多详情请参考 <a href="https://github.com/kcl-lang/kcl-plugin" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl-plugin</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="错误修复">错误修复<a href="#错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="函数调用错误信息优化">函数调用错误信息优化<a href="#函数调用错误信息优化" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 0.4.4 版本中，KCL 优化了当函数参数个数不匹配时的错误信息输出，支持显示函数名称以及参数不匹配个数</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Foo</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bar?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Error: "Foo" takes 1 positional argument but 3 were given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Error: "f" takes 1 positional argument but 2 were given</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息请参阅：<a href="https://github.com/kcl-lang/kcl/issues/299" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/299</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="插值三引号字符串格式化错误修复">插值三引号字符串格式化错误修复<a href="#插值三引号字符串格式化错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，对如下代码进行格式化会错误将携带字符串插值的三引号格式化为单引号字符串并导致编译错误，在 0.4.4 版本中我们进行了修复</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Before KCL v0.4.4, variable "bar" will be formatted as:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># foo = 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># bar = "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ${foo}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bar </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">${foo}</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="条件配置块格式化错误修复">条件配置块格式化错误修复<a href="#条件配置块格式化错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，对如下代码进行格式化会导致错误的缩进，在 0.4.4 版本中我们进行了修复</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Before KCL v0.4.4, variable "foo" will be formatted as:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># foo = [</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     if True:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         {key = "value"}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     {key = "value"}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"value"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"value"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="字符串字面值类型检查错误">字符串字面值类型检查错误<a href="#字符串字面值类型检查错误" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在之前的 KCL 版本中，执行如下代码会得到一个非预期的类型检查错误，在 0.4.4 版本中我们进行了修复</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Before KCL v0.4.4, we will get a unexpected type mismatch error.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"A"</span><span class="token operator" style="color:#393A34">|</span><span class="token string" style="color:#e3116c">"B"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多信息请参阅：<a href="https://github.com/kcl-lang/kcl/issues/294" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/issues/294</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他错误修复">其他错误修复<a href="#其他错误修复" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>更多错误修复详见：<a href="https://github.com/kcl-lang/kcl/milestone/2?closed=1" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl/milestone/2?closed=1</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档">文档<a href="#文档" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p><a href="https://kcl-lang.github.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a> 初步建立，并完善 Kubernetes 场景<a href="https://kcl-lang.github.io/docs/user_docs/guides/working-with-k8s/" target="_blank" rel="noopener noreferrer">相关文档</a>.</p><p>更多网站信息详见 <a href="https://kcl-lang.github.io/" target="_blank" rel="noopener noreferrer">https://kcl-lang.github.io/</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区动态">社区动态<a href="#社区动态" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 社区新增三名外部贡献者 @my-vegetable-has-exploded, @possible-fqz, @orangebees, 感谢他们热情并积极地参与贡献</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步计划">下一步计划<a href="#下一步计划" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>预计 2023 年 1 月底，我们将发布 KCL v0.4.5 版本，预期重点演进包括</p><ul><li>语言用户界面持续优化，体验持续提升和用户痛点解决</li><li>更多场景和生态如 Kubernetes 和 CI/CD Pipeline 场景 KCL 支持和文档更新</li><li>KCL Windows 版本支持</li><li>KCL 包管理工具 kpm 发布</li><li>KCL 新版 playground 支持</li></ul><p>更多详情请参考 <a href="https://github.com/kcl-lang/kcl/milestone/3" target="_blank" rel="noopener noreferrer">KCL v0.4.5 Milestone</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题及解答">常见问题及解答<a href="#常见问题及解答" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>常见问题及解答详见：<a href="https://kcl-lang.github.io/docs/user_docs/support/" target="_blank" rel="noopener noreferrer">https://kcl-lang.github.io/docs/user_docs/support/</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他资源">其他资源<a href="#其他资源" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li><a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></li><li><a href="https://kusionstack.io/" target="_blank" rel="noopener noreferrer">Kusion 网站</a></li><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL 仓库</a></li><li><a href="https://github.com/KusionStack/kusion" target="_blank" rel="noopener noreferrer">Kusion 仓库</a></li><li><a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig 仓库</a></li></ul><p>欢迎加入我们的社区进行交流 👏👏👏：<a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a></p>]]></content:encoded>
            <category>Release Blog</category>
            <category>KCL</category>
        </item>
        <item>
            <title><![CDATA[性能提升 40 倍！我们用 Rust 重写了自己的项目]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-rewrite-with-rust</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-rewrite-with-rust</guid>
            <pubDate>Tue, 29 Nov 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>Rust 已经悄然成为了最受欢迎的编程语言之一。作为一门新兴底层系统语言，Rust 拥有着内存安全性机制、接近于 C/C++ 语言的性能优势、出色的开发者社区和体验出色的文档、工具链和IDE 等诸多特点。本文将介绍笔者使用 Rust 重写项目并逐步落地生产环境的过程，以及在重写过程选择 Rust 的原因、遇到的问题以及使用 Rust 重写带来的成果。</p><p>我们目前正在使用 Rust 开发的项目叫做 <a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a>，目前全部实现代码已经在 Github 上开源。KCL 是一个基于约束的记录及函数领域编程语言，致力于通过成熟的编程语言技术和实践来改进特领域如云原生 kubernetes 领域的大量繁杂配置编写和安全策略校验等，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。更具体的 KCL 使用场景请访问 <a href="https://kcl-lang.github.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a>，本文中不再过多赘述。</p><p>KCL 之前是使用 Python 编写的，出于用户使用体验、性能和稳定性的考虑，决定用 Rust 语言进行重写，并获得了以下好处：</p><ul><li>更少的 Bug，源于 Rust 强大的编译检查和错误处理方式</li><li>语言端到端编译执行性能提升了 66%</li><li>语言前端解析器性能提升了 20 倍</li><li>语言中端语义分析器性能提升了 40 倍</li><li>语言编译器编译过程平均内存使用量变为原来 Python 版本的一半</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="我们遇到了什么问题">我们遇到了什么问题<a href="#我们遇到了什么问题" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>就像社区中同类型项目 <a href="https://github.com/denoland/deno" target="_blank" rel="noopener noreferrer">deno</a>, <a href="https://github.com/swc-project/swc" target="_blank" rel="noopener noreferrer">swc</a>, <a href="https://github.com/vercel/turbo" target="_blank" rel="noopener noreferrer">turbopack</a>, <a href="https://github.com/rust-lang/rust" target="_blank" rel="noopener noreferrer">rustc</a> 等编译器、构建系统或者运行时在技术上使用 Rust 做的事情类似，我们使用 Rust 完整构建了编译器的前中端和运行时，取得了一定的阶段性成果，但是我们大约在一年前并不是这个样子的。</p><p>一年前，我们使用 Python 语言构建了整个 KCL 语言编译器的实现，虽然在一开始的时候运行良好，Python 简单易上手，生态丰富，团队的研发效率也很高，但是随着代码库的扩张和工程师人数的增加，代码维护起来愈加困难，尽管我们在项目中强制编写 Python 类型注解，采用更严格的 lint 工具，代码测试行覆盖率也达到了 90% 以上，但是仍然会出现很多诸如 Python None 空对象，属性未找到等运行时才会出现错误，并且重构 Python 代码时也需要小心翼翼，反应到 KCL 语言上就是一个接一个的 bug, 严重影响用户使用体验。</p><p>此外，当 KCL 使用对象是广大开发者用户时，编程语言或者说编译器内部实现出现任何错误都是不可容忍的，这些也给我们的用户使用体验带来了一系列问题，使用 Python 编写的程序启动速度较慢，性能无法满足自动化系统在线编译和执行的效率诉求，因为在我们的场景中，用户修改 KCL 代码后需要能很快的展示编译结果，显然使用 Python 编写的编译器并不能很好地满足使用需求。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么选择-rust">为什么选择 Rust<a href="#为什么选择-rust" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>笔者所在团队基于如下原因选择了 Rust</p><ul><li>使用 Go, Python, Rust 三种语言实现了简单的编程语言栈式虚拟机并作了性能对比，Go 和 Rust 在这个场景下性能接近，Python 有较大性能差距，综合考虑下采用了 Rust，具体三种语言实现的栈式虚拟机代码细节在 <a href="https://github.com/Peefy/StackMachine" target="_blank" rel="noopener noreferrer">https://github.com/Peefy/StackMachine</a>，感兴趣的同学可以前往浏览</li><li>越来越多的编程语言的编译器或运行时特别是前端基础设施项目采用 Rust 编写或重构，此外基础设施层，数据库、搜索引擎、网络设施、云原生、UI 层和嵌入式等领域都有 Rust 的出现，至少在编程语言领域实现方面经过了可行性和稳定性验证</li><li>考虑到后续的项目发展会涉及区块链和智能合约方向，而社区中大量的区块链和智能合约项目采用 Rust 编写</li><li>通过 Rust 获得更好的性能和稳定性，让系统更容易维护、更加健壮的同时，可以通过 FFI 暴露 C API 供多语言使用和扩展，方便生态扩展与集成</li><li>Rust 对 WASM 的支持比较友好，社区中大量 WASM 生态是由 Rust 构建，KCL 语言和编译器可以借助 Rust 编译到 WASM 并在浏览器中运行</li></ul><p>基于以上原因综合考虑选择了 Rust 而不是 Go，整个重写过程下来发现 Rust 综合素质确实过硬（第一梯队的性能，足够的抽象程度），虽然在一些语言特性特别是生命周期等上手成本有一些，生态上还不够丰富，总之编程语言可以做的事情，Rust 均可以做，具体可能还是要根据具体的场景和问题来做选择。同时如果想要使用好 Rust, 还需要深入理解内存、堆栈、引用、变量作用域等这些其它高级语言往往不会深入接触的内容。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-rust-过程中遇到了哪些困难">使用 Rust 过程中遇到了哪些困难<a href="#使用-rust-过程中遇到了哪些困难" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>虽然决定了使用 Rust 重写整个 KCL 项目，其实团队成员大部分成员是没有使用 Rust 编写一定代码体量项目的经验，包括笔者个人自己也仅仅学习过 <a href="https://doc.rust-lang.org/book/" target="_blank" rel="noopener noreferrer">《The Rust Programming Language》</a> 中的部分内容，依稀记得学习到 <code>Rc</code> 和 <code>RefCell</code> 等智能指针内容就放弃了，那时没想到 Rust 中还能有与 C++ 中类似的东西。</p><p>使用 Rust 前预估的风险主要是 Rust 语言接触和学习的成本，这个确实在各种 Rust 的文章博客中均有提到，因为 KCL 项目整体架构并未发生太大变化，只是部分模块设计和代码编写针对 Rust 作了优化，因此整个重写是在边学边实践中进行。确实在刚开始使用 Rust 编写整个项目的时候花费在知识查询、编译排错的时间还是很多的，不过随着项目的进行渐入佳境，笔者个人经验使用 Rust 遇到的困难主要是心智转换和开发效率两方面:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="心智转换">心智转换<a href="#心智转换" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>首先 Rust 的语法语义很好地吸收和融合了函数式编程中类型系统相关的概念，比如抽象代数类型 ADT 等，并且 Rust 中并无“继承”等相关概念，如果不能很好地理解甚至连其他语言中稀松平常的结构定义在 Rust 中可能都需要花费不少时间，比如如下的 Python 代码可能在 Rust 中的定义是这个样子的。</p><ul><li>Python</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> dataclasses </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dataclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">KCLObject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@dataclass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">KCLIntObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">KCLObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@dataclass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">KCLFloatObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">KCLObject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Rust</li></ul><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum KCLObject {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Int(u64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float(f64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然更多的时间是在与 Rust 编译器本身的报错作斗争，Rust 编译器会经常使开发人员"碰壁"，比如借用检查报错等，特别是对于编译器来讲，它处理的核心结构是抽象语法树 AST，这是一个递归和嵌套的树结构，在 Rust 中有时很难兼顾变量可变性与借用检查的关系，就如 KCL 编译器作用域 <code>Scope</code> 的结构定义结构那样，对于存在循环引用的场景，用于需要显示意识到数据的相互依赖关系，而大量使用 <code>Rc</code>, <code>RefCell</code> 和 <code>Weak</code> 等 Rust 中常用的智能指针结构。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// A Scope maintains a set of objects and links to its containing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// (parent) and contained (children) scopes. Objects may be inserted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// and looked up by name. The zero value for Scope is a ready-to-use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// empty scope.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Scope {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The parent scope.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub parent: Option&lt;Weak&lt;RefCell&lt;Scope&gt;&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The child scope list.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub children: Vec&lt;Rc&lt;RefCell&lt;Scope&gt;&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The scope object mapping with its name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub elems: IndexMap&lt;String, Rc&lt;RefCell&lt;ScopeObject&gt;&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The scope start position.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub start: Position,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The scope end position.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub end: Position,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// The scope kind.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub kind: ScopeKind,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="开发效率">开发效率<a href="#开发效率" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Rust 的开发效率可以用先抑后扬来形容。在刚开始上手写项目时，如果团队成员没有接触过函数式编程相关概念以及相关的编程习惯，开发速度将显著慢于 Python、Go 和 Java 等语言，不过一旦开始熟悉 Rust 标准库常用的方法、最佳实践以及常见 Rust 编译器报错修改，开发效率将大幅提升，并且原生就能写出高质量、安全、高效的代码。</p><p>比如笔者个人当初遇到一个如下代码所示的与生命周期错误前前后后排查了很久的时间才发现原来是忘记标注生命参数导致生命周期不匹配。此外 Rust 的生命周期与类型系统、作用域、所有权、借用检查等概念耦合在一起，导致了较高的理解成本和复杂度，且报错信息往往不像类型错误那么明显，生命周期不匹配错误报错信息有时也略显呆板，可能会导致较高的排错成本，当然熟悉相关概念写多了之后效率会提高不少。</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct Data&lt;'a&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b: &amp;'a u8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// func1 和 func2 一个省略了生命周期参数，一个没有省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 对于 func2 的生命周期会由编译器缺省推导为 '_，可能导致生命周期不匹配错误</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl&lt;'a&gt; Data&lt;'a&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn func1(&amp;self) -&gt; Data&lt;'a&gt; {Data { b: &amp;0 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn func2(&amp;self) -&gt; Data {Data { b: &amp;0 }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-rust-重写收益比">使用 Rust 重写收益比<a href="#使用-rust-重写收益比" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>经过团队几个人花费几个月时间使用 Rust 完全重写并稳定落地生产环境几个月后，回顾整个过程感觉这件事情的收获非常大，从技术角度层面来看，重写的过程不仅仅锻炼了快速学习一门新的编程语言、编程知识并将其付诸实践，并且整个重写过程让我们又反思了 KCL 编译器中设计不合理的部分并进行修改，对一个编程语言而言，这是一个长周期的项目，我们收获的是编译器系统更加稳定、安全，且代码清晰，bug 更少、性能更好的技术产品服务于用户，虽然没有全部模块得到高达 40 倍的性能，因为部分模块如 KCL 运行时的性能瓶颈在于内存深拷贝操作，但笔者个人认为仍然是值得的。且当 Rust 使用时间到达一定时长后，心智和开发效率不再是限制因素，就像学车那样，拿到驾照后更多是上路实践和总结。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>笔者个人觉得使用 Rust 重写项目后最重要的是不是我学会了一门新的编程语言，也不是 Rust 很流行很火因此我们在项目中采用一下，或者使用 Rust 编写了多少炫技的代码，是真真正正地使得语言和编译器本身更加稳定，能够在生产环境平稳落地并长期使用，启动速度和自动化效率不再受困扰，性能优于社区其他同类型领域编程语言，使我们语言和工具的用户感受到体验提升，这些都得益于 Rust 的无 GC、高性能、更好的错误处理内存管理、零抽象等特性。总之作为用户，他们才是最大的受益者。</p><p>最后，如果大家喜欢 KCL 语言这个项目，或想使用体验 KCL 用于自己的场景，或想使用 Rust 语言参与一个开源项目，欢迎大家访问 <a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/community</a> 加入我们的社区一起参与讨论和共建 👏👏👏。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl</a></li><li><a href="https://github.com/Peefy/StackMachine" target="_blank" rel="noopener noreferrer">https://github.com/Peefy/StackMachine</a></li><li><a href="https://doc.rust-lang.org/book/" target="_blank" rel="noopener noreferrer">https://doc.rust-lang.org/book/</a></li><li><a href="https://github.com/sunface/rust-course" target="_blank" rel="noopener noreferrer">https://github.com/sunface/rust-course</a></li><li><a href="https://www.influxdata.com/blog/rust-can-be-difficult-to-learn-and-frustrating-but-its-also-the-most-exciting-thing-in-software-development-in-a-long-time/" target="_blank" rel="noopener noreferrer">https://www.influxdata.com/blog/rust-can-be-difficult-to-learn-and-frustrating-but-its-also-the-most-exciting-thing-in-software-development-in-a-long-time/</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Rust</category>
            <category>Performance</category>
            <category>Programming Language</category>
            <category>Compiler</category>
        </item>
        <item>
            <title><![CDATA[SETTA 2022 会议 KCL 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-setta-meeting</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-setta-meeting</guid>
            <pubDate>Thu, 27 Oct 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[KCL Talk Cover]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="KCL Talk Cover" src="/zh-CN/assets/images/talk-cover-05e9f3c2c0e70c2c01ff77b3baa1f795.jpg" width="2548" height="1424" class="img_ev3q"></p><p><a href="https://kcl-lang.github.io/talks/kcl-setta2022.pdf" target="_blank" rel="noopener noreferrer">PDF 下载</a></p>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
        </item>
        <item>
            <title><![CDATA[KCL 论文被 SETTA 2022 会议录用]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-setta-paper</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-kcl-setta-paper</guid>
            <pubDate>Thu, 13 Oct 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[近日，由 KCL 团队成员撰写的关于 KCL 创新论文被 SETTA 2022 国际会议长文录用。]]></description>
            <content:encoded><![CDATA[<p>近日，由 KCL 团队成员撰写的关于 KCL 创新论文被 SETTA 2022 国际会议长文录用。</p><p><img loading="lazy" src="/zh-CN/assets/images/kcl_paper_setta-fd6fd3c3ec523f850510540c49302bc4.png" width="756" height="852" class="img_ev3q"></p><p>Symposium on Dependable Software Engineering（以下简称 SETTA）可靠软件工程研讨会旨在将国际研究人员聚集在一起，就缩小形式化方法与软件工程之间的差距交流研究成果和想法。例如，将形式化技术和工具应用于工程大型系统（如网络物理系统 (CPS)、物联网 (IoT)、企业系统、基于云的系统等）。</p><p>此次被录用的论文为《KCL: A Declarative Language for Large-scale Configuration and Policy Management》，该论文的核心创新点是提出了 KCL 声明式语言、开发机制以及一致的工作流程。通过语言的建模及约束能力，可以提升运维开发过程中的多团队协作生产力以及效率，同时确保大规模配置和策略管理的稳定性。</p><p>此外，SETTA 2022 将在北京时间 10 月 27 日至 10 月 28 日举办线上会议，届时会分享 KCL 论文详细内容，欢迎加入 <a href="https://github.com/kcl-lang/community" target="_blank" rel="noopener noreferrer">KCL 社区</a> 进行围观。SETTA 2022 会议议程详情请参考：<a href="https://lcs.ios.ac.cn/setta2022/program.php" target="_blank" rel="noopener noreferrer">https://lcs.ios.ac.cn/setta2022/program.php</a></p><p>注：目前 KCL 已在 Github 开源，欢迎访问 <a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">https://github.com/kcl-lang/kcl</a> 获得更多信息。</p>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
        </item>
        <item>
            <title><![CDATA[声明式配置技术概述]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2022-declarative-config-overview</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2022-declarative-config-overview</guid>
            <pubDate>Thu, 15 Sep 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[零、前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="零前言">零、前言<a href="#零前言" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>文本仅用于澄清声明式配置技术概述，<a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a> 概念以及核心设计，以及与其他配置语言的对比。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一声明式配置概述">一、声明式配置概述<a href="#一声明式配置概述" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-配置的重要性">1.1 配置的重要性<a href="#11-配置的重要性" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>软件不是一成不变的，每天有成千上万的配置更新，并且配置本身也在逐渐演进，对规模化效率有较高的诉求<ul><li><strong>配置更新越来越频繁</strong>：配置提供了一种改变系统功能的低开销方式，不断发展的业务需求、基础设施要求和其他因素意味着系统需要不断变化。</li><li><strong>配置规模越来越大</strong>：一份配置往往要分发到不同的云站点、不同的租户、不同的环境等。</li><li><strong>配置场景广泛</strong>：应用配置、数据库配置、网络配置、监控配置等。</li><li><strong>配置格式繁多</strong>：JSON, YAML, XML, TOML, 各种配置模版如 Java Velocity, Go Template 等。</li></ul></li><li>配置的稳定性至关重要，系统宕机或出错的一个最主要原因是有大量工程师进行频繁的实时配置更新，表 1 示出了几个由于配置导致的系统出错事件。</li></ul><table><thead><tr><th>时间</th><th>事件</th></tr></thead><tbody><tr><td>2021 年 7 月</td><td>中国 Bilibili 公司由于 SLB Lua 配置计算出错陷入死循环导致网站宕机</td></tr><tr><td>2021 年 10 月</td><td>韩国 KT 公司由于路由配置错误导致在全国范围内遭受重大网络中断</td></tr></tbody></table><p>表 1 配置导致的系统出错事件</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-声明式配置分类">1.2 声明式配置分类<a href="#12-声明式配置分类" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>云原生时代带来了如雨后春笋般的技术发展，出现了大量面向终态的声明式配置实践，如图 1 所示，声明式配置一般可分为如下几种方式。
<img loading="lazy" src="/zh-CN/assets/images/01-declarative-config-51ae2a21d367db31feb7268107ee18c8.png" width="1796" height="1076" class="img_ev3q">
图 1 声明式配置方式分类</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="121-结构化-structured-的-kv">1.2.1 结构化 (Structured) 的 KV<a href="#121-结构化-structured-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>结构化的 KV 可以满足最小化数据声明需求，比如数字、字符串、列表和字典等数据类型，并且随着云原生技术快速发展应用，声明式 API 可以满足 X as Data 发展的诉求，并且面向机器可读可写，面向人类可读。其优劣如下:</p><ul><li>优势<ul><li>语法简单，易于编写和阅读</li><li>多语言 API 丰富</li><li>有各种 Path 工具方便数据查询，如 XPath, JsonPath 等</li></ul></li><li>痛点<ul><li>冗余信息多：当配置规模较大时，维护和阅读配置很困难，因为重要的配置信息被淹没在了大量不相关的重复细节中</li><li>功能性不足<ul><li>约束校验能力</li><li>复杂逻辑编写能力</li><li>测试、调试能力</li><li>不易抽象和复用</li><li>Kustomize 的 Patch 比较定制，基本是通过固定几种 Patch Merge 策略</li></ul></li></ul></li></ul><p>结构化 KV 的代表技术有</p><ul><li>JSON/YAML：非常方便阅读，以及自动化处理，不同的语言均具有丰富的 API 支持。</li><li><a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">Kustomize</a>：提供了一种无需<strong>模板</strong>和 <strong>DSL</strong> 即可自定义 Kubernetes 资源基础配置和差异化配置的解决方案，本身不解决约束的问题，需要配合大量的额外工具进行约束检查如 <a href="https://github.com/stackrox/kube-linter" target="_blank" rel="noopener noreferrer">Kube-linter</a>、<a href="https://github.com/bridgecrewio/checkov" target="_blank" rel="noopener noreferrer">Checkov</a> 等检查工具，图 2 示出了 Kustomize 的典型工作方式。</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/02-kustomize-244059a1d48b94791b1df4c33377a5a2.png" width="1222" height="1220" class="img_ev3q">
图 2 Kustomize 典型工作方式</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="123-模版化-templated-的-kv">1.2.3 模版化 (Templated) 的 KV<a href="#123-模版化-templated-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>模版化 (Templated) 的 KV 赋予静态配置数据动态参数的能力，可以做到一份模版+动态参数输出不同的静态配置数据。其优劣如下:</p><ul><li>优势<ul><li>简单的配置逻辑，循环支持</li><li>支持外部动态参数输入模版</li></ul></li><li>痛点<ul><li>容易落入所有配置参数都是模版参数的陷阱</li><li>当配置规模变大时，开发者和工具都难以维护和分析它们</li></ul></li></ul><p>模版化代表技术有:</p><ul><li><a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a>：Kubernetes 资源的包管理工具，通过配置模版管理 Kubernetes 资源配置。图 3 示出了一个 Helm Jenkins Package ConfigMap 配置模版，可以看出这些模版本身都十分短小，可以书写简单的逻辑，适合 Kubernetes 基础组件固定的一系列资源配置通过包管理+额外的配置参数进行安装。相比于单纯的模版化的 KV，Helm 一定程度上提供了模版存储/引用和语义化版本管理的能力相比于 Kustomize 更适合管理外部 Charts, 但是在多环境、多租户的配置管理上不太擅长。</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/03-helm-c5b60deaf615e2e5d7a0f0d90cbda18c.png" width="2108" height="1248" class="img_ev3q"></p><p>图 3 Helm Jenkins Package ConfigMap 配置模版</p><ul><li>其他各种配置模版：Java Velocity, Go Template 等文本模板引擎非常适合 HTML 编写模板。但是在配置场景中使用时，存在所有配置字段即模版参数的风险，开发者和工具都难以维护和分析它们。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="123-代码化-programmable-的-kv">1.2.3 代码化 (Programmable) 的 KV<a href="#123-代码化-programmable-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>Configuration as Code (CaC), 使用代码产生配置，就像工程师们只需要写高级 GPL 代码，而不是手工编写容易出错而且难以理解的服务器二进制代码一样。配置变更同代码变更同样严肃地对待，同样可以执行单元测试、集成测试等。代码模块化和重用是维护配置代码比手动编辑 JSON/YAML 等配置文件更容易的一个关键原因。其优劣如下:</p><ul><li>优势<ul><li>必要的编程能力（变量定义、逻辑判断、循环、断言等）</li><li>代码模块化与抽象（支持定义数据模版，并用模版得到新的配置数据）</li><li>可以抽象配置模版+并使用配置覆盖</li></ul></li><li>痛点<ul><li>类型检查不足</li><li>运行时错误</li><li>约束能力不足</li></ul></li></ul><p>代码化 KV 的代表技术有:</p><ul><li><a href="https://github.com/rix0rrr/gcl" target="_blank" rel="noopener noreferrer">GCL</a>：一种 Python 实现的声明式配置编程语言，提供了必要的言能力支持模版抽象，但编译器本身是 Python 编写，且语言本身是解释执行，对于大的模版实例 (比如 K8s 型) 性能较差。</li><li><a href="https://github.com/hashicorp/hcl" target="_blank" rel="noopener noreferrer">HCL</a>：一种 Go 实现结构化配置语言，原生语法受到 libuclnginx 配置等的启发，用于创建对人类和机器都友好的结构化配置语言，主要针对 devops 工具、服务器配置及 Terraform 中定义资源配置等。</li><li><a href="https://github.com/google/jsonnet" target="_blank" rel="noopener noreferrer">Jsonnet</a>：一种 C++ 实现的数据模板语言，适用于应用程序工具开发人员，可以生成配置数据并且无副作用组织、简化、统一管理庞大的配置。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="124-类型化-typed-的-kv">1.2.4 类型化 (Typed) 的 KV<a href="#124-类型化-typed-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>类型化的 KV，基于代码化 KV，多了类型检查和约束的能力，其优劣如下:</p><ul><li>优势<ul><li>配置合并完全幂等，天然防止配置冲突</li><li>丰富的配置约束语法用于编写约束</li><li>将类型和值约束编写抽象为同一种形式，编写简单</li><li>配置顺序无关</li></ul></li><li>痛点<ul><li>图合并和幂等合并等概念复杂，用户理解成本较高</li><li>类型和值混合定义提高抽象程度的同时提升了用户的理解成本，并且所有约束在运行时进行检查，大规模配置代码下有性能瓶颈</li><li>对于想要配置覆盖、修改的多租户、多环境场景难以实现</li><li>对于带条件的约束场景，定义和校验混合定义编写用户界面不友好</li></ul></li></ul><p>类型化 KV 的代表技术有:</p><ul><li><a href="https://github.com/cue-lang/cue" target="_blank" rel="noopener noreferrer">CUE</a>：CUE 解决的核心问题是“类型检查”，主要应用于配置约束校验场景及简单的云原生配置场景</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="125-模型化-structural-的-kv">1.2.5 模型化 (Structural) 的 KV<a href="#125-模型化-structural-的-kv" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>模型化的 KV 在代码化和类型化 KV 的基础上以高级语言建模能力为核心描述，期望做到模型的快速编写与分发，其优劣如下:</p><ul><li>优势<ul><li>引入可分块、可扩展的 KV 配置块编写方式</li><li>类高级编程语言的编写、测试方式</li><li>语言内置的强校验、强约束支持</li><li>面向人类可读可写，面向机器部分可读可写</li></ul></li><li>不足<ul><li>扩展新模型及生态构建需要一定的研发成本，或者使用工具对社区中已有的 JsonSchema 和 OpenAPI 模型进行模型转换、迁移和集成。</li></ul></li></ul><p>模型化 KV 的代表技术有:</p><ul><li><a href="https://github.com/kcl-lang/kcl" target="_blank" rel="noopener noreferrer">KCL</a>：一种 Rust 实现的声明式配置策略编程语言，把运维类研发统一为一种声明式的代码编写，可以针对差异化应用交付场景抽象出用户模型并添加相应的约束能力，期望借助可编程 DevOps 理念解决规模化运维场景中的配置策略编写的效率和可扩展性等问题。图 4 示出了一个 KCL 编写应用交付配置代码的典型场景</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/04-kcl-app-code-a5796bf098450b2ef34f45157335f0f8.png" width="962" height="1030" class="img_ev3q"></p><p>图 4 使用 KCL 编写应用交付配置代码</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-不同声明式配置方式的选择标准与最佳实践">1.3 不同声明式配置方式的选择标准与最佳实践<a href="#13-不同声明式配置方式的选择标准与最佳实践" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><ul><li>配置的规模：对于小规模的配置场景，完全可以使用 YAML/JSON 等配置，比如应用自身的简单配置，CI/CD 的配置。此外对于小规模配置场景存在的多环境、多租户等需求可以借助 Kustomize 的 overlay 能力实现简单配置的合并覆盖等操作。</li><li>模型抽象与约束的必要性：对于较大规模的配置场景特别是对多租户、多环境等有配置模型和运维特性研发和沉淀迫切需求的，可以使用代码化、类型化和模型化的 KV 方式。</li></ul><p>此外，从不同声明式配置方式的使用场景出发</p><ul><li>如果需要编写结构化的静态的 K-V，或使用 Kubernetes 原生的技术工具，建议选择 YAML</li><li>如果希望引入编程语言便利性以消除文本(如 YAML、JSON) 模板，有良好的可读性，或者已是 <a href="https://www.terraform.io" target="_blank" rel="noopener noreferrer">Terraform</a> 的用户，建议选择 HCL</li><li>如果希望引入类型功能提升稳定性，维护可扩展的配置文件，建议选择 CUE 之类的数据约束语言</li><li>如果希望以现代语言方式编写复杂类型和建模，维护可扩展的配置文件，原生的纯函数和策略，和生产级的性能和自动化，建议选择 KCL</li></ul><p>不同于社区中的其他同类型领域语言，KCL 是一种面向应用研发人员并采纳了现代语言设计和技术的静态强类型编译语言</p><blockquote><p>注意，本文将不会讨论通用语言编写配置的情况，通用语言一般是 Overkill 的，即远远超过了需要解决的问题，通用语言存在各式各样的安全问题，比如能力边界问题 (启动本地线程、访问 IO, 网络，代码死循环等不安全隐患)，比如像音乐领域就有专门的音符去表示音乐，方便学习与交流，不是一般文字语言可以表述清楚的。</p><p>此外，通用语言因为本身就样式繁多，存在统一维护、管理和自动化的成本，通用语言一般用来编写客户端运行时，是服务端运行时的一个延续，不适合编写与运行时无关的配置，最终被编译为二进制从进程启动，稳定性和扩展性不好控制，而配置语言往往编写的是数据，再搭配以简单的逻辑，描述的是期望的最终结果，然后由编译器或者引擎来消费这个期望结果。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二kcl-的核心设计与应用场景">二、KCL 的核心设计与应用场景<a href="#二kcl-的核心设计与应用场景" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>KCL 是一个开源的基于约束的记录及函数语言。KCL 通过成熟的编程语言技术和实践来改进对大量繁杂配置的编写，致力于构建围绕配置的更好的模块化、扩展性和稳定性，更简单的逻辑编写，以及更快的自动化集成和良好的生态延展性。</p><p>KCL 的核心特性是其<strong>建模</strong>和<strong>约束</strong>能力，KCL 核心功能基本围绕 KCL 这个两个核心特性展开，此外 KCL 遵循以用户为中心的配置理念而设计其核心特性，可以从两个方面理解：</p><ul><li><strong>以领域模型为中心的配置视图</strong>：借助 KCL 语言丰富的特性及 <a href="https://kcl-lang.io/docs/tools/cli/openapi/" target="_blank" rel="noopener noreferrer">KCL OpenAPI</a> 等工具，可以将社区中广泛的、设计良好的模型直接集成到 KCL 中（比如 K8s 资源模型），用户也可以根据自己的业务场景设计、实现自己的 KCL 模型 (库) ，形成一整套领域模型架构交由其他配置终端用户使用。</li><li><strong>以终端用户为中心的配置视图</strong>：借助 KCL 的代码封装、抽象和复用能力，可以对模型架构进行进一步抽象和简化（比如将 K8s 资源模型抽象为以应用为核心的 Server 模型），做到<strong>最小化终端用户配置输入</strong>，简化用户的配置界面，方便手动或者使用自动化 API 对其进行修改。</li></ul><p>不论是以何为中心的配置视图，对于代码而言（包括配置代码）都存在对配置数据约束的需求，比如类型约束、配置字段必选/可选约束、范围约束、不可变性约束等，这也是 KCL 致力于解决的核心问题之一。综上，KCL 是一个开源的基于约束和声明的函数式语言，KCL 主要包含如图 5 所示的核心特性：</p><p><img loading="lazy" src="/zh-CN/assets/images/05-kcl-core-feature-3e7c15549a3873eb274b09ef5494a734.png" width="892" height="878" class="img_ev3q"></p><p>图 5 KCL 核心特性</p><ul><li><strong>简单易用</strong>：源于 Python、Golang 等高级语言，采纳函数式编程语言特性，低副作用</li><li><strong>设计良好</strong>：独立的 Spec 驱动的语法、语义、运行时和系统库设计</li><li><strong>快速建模</strong>：以 <a href="https://kcl-lang.io/docs/reference/lang/tour#schema" target="_blank" rel="noopener noreferrer">Schema</a> 为中心的配置类型及模块化抽象</li><li><strong>功能完备</strong>：基于 <a href="https://kcl-lang.io/docs/reference/lang/tour#config-operations" target="_blank" rel="noopener noreferrer">Config</a>、<a href="https://kcl-lang.io/docs/reference/lang/tour#schema" target="_blank" rel="noopener noreferrer">Schema</a>、<a href="https://kcl-lang.io/docs/reference/lang/tour#function" target="_blank" rel="noopener noreferrer">Lambda</a>、<a href="https://kcl-lang.io/docs/reference/lang/tour#rule" target="_blank" rel="noopener noreferrer">Rule</a> 的配置及其模型、逻辑和策略编写</li><li><strong>可靠稳定</strong>：依赖<a href="https://kcl-lang.io/docs/reference/lang/tour/#type-system" target="_blank" rel="noopener noreferrer">静态类型系统</a>、<a href="https://kcl-lang.io/docs/reference/lang/tour/#validation" target="_blank" rel="noopener noreferrer">约束</a>和<a href="https://kcl-lang.io/docs/reference/lang/tour#rule" target="_blank" rel="noopener noreferrer">自定义规则</a>的配置稳定性</li><li><strong>强可扩展</strong>：通过独立配置块<a href="https://kcl-lang.io/docs/reference/lang/tour/#-operators-1" target="_blank" rel="noopener noreferrer">自动合并机制</a>保证配置编写的高可扩展性</li><li><strong>易自动化</strong>：<a href="https://kcl-lang.io/docs/reference/lang/tour/#kcl-cli-variable-override" target="_blank" rel="noopener noreferrer">CRUD APIs</a>，<a href="https://kcl-lang.io/docs/reference/xlang-api/overview" target="_blank" rel="noopener noreferrer">多语言 SDK</a>，<a href="https://github.com/kcl-lang/kcl-plugin" target="_blank" rel="noopener noreferrer">语言插件</a> 构成的梯度自动化方案</li><li><strong>极致性能</strong>：使用 Rust &amp; C，<a href="https://llvm.org/" target="_blank" rel="noopener noreferrer">LLVM</a> 实现，支持编译到本地代码和 <a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">WASM</a> 的高性能编译时和运行时</li><li><strong>API 亲和</strong>：原生支持 <a href="https://github.com/kcl-lang/kcl-openapi" target="_blank" rel="noopener noreferrer">OpenAPI</a>、 Kubernetes CRD， Kubernetes YAML 等 API 生态规范</li><li><strong>开发友好</strong>：<a href="https://kcl-lang.io/docs/tools/cli/kcl/" target="_blank" rel="noopener noreferrer">语言工具</a> (Format，Lint，Test，Vet，Doc 等)、 <a href="https://github.com/kcl-lang/vscode-kcl" target="_blank" rel="noopener noreferrer">IDE 插件</a> 构建良好的研发体验</li><li><strong>安全可控</strong>：面向领域，不原生提供线程、IO 等系统级功能，低噪音，低安全风险，易维护，易治理</li><li><strong>多语言 SDK</strong>：<a href="https://kcl-lang.io/docs/reference/xlang-api/go-api" target="_blank" rel="noopener noreferrer">Go</a>, <a href="https://kcl-lang.io/docs/reference/xlang-api/python-api" target="_blank" rel="noopener noreferrer">Python</a> 和 <a href="https://kcl-lang.io/docs/reference/xlang-api/rest-api" target="_blank" rel="noopener noreferrer">REST API</a> 满足不同场景和应用使用需求</li><li><strong>生产可用</strong>：广泛应用在蚂蚁集团平台工程及自动化的生产环境实践中</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/06-kcl-code-design-7bff376999fc4837c5a5041be6655915.png" width="520" height="394" class="img_ev3q"></p><p>图 6 KCL 语言核心设计</p><p>更多语言设计和能力详见 <a href="https://kcl-lang.io/docs/reference/lang/tour" target="_blank" rel="noopener noreferrer">KCL 文档</a>，尽管 KCL 不是通用语言，但它有相应的应用场景，如图 6 所示，研发者可以通过 KCL 编写<strong>配置(config)</strong>、<strong>模型(schema)</strong>、<strong>函数(lambda)</strong>及<strong>规则(rule)</strong>，其中 Config 用于定义数据，Schema 用于对数据的模型定义进行描述，Rule 用于对数据进行校验，并且 Schema 和 Rule 还可以组合使用用于完整描述数据的模型及其约束，此外还可以使用 KCL 中的 lambda 纯函数进行数据代码组织，将常用代码封装起来,在需要使用时可以直接调用。</p><p>对于使用场景而言，KCL 可以进行结构化 KV 数据验证、复杂配置模型定义与抽象、强约束校验避免配置错误、分块编写及配置合并能力、自动化集成和工程扩展等能力，下面针对这些功能和使用场景进行阐述。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-结构化-kv-数据验证">2.1 结构化 KV 数据验证<a href="#21-结构化-kv-数据验证" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>如图 7 所示，KCL 支持对 JSON/YAML 数据进行格式校验。作为一种配置语言，KCL 在验证方面几乎涵盖了 OpenAPI 校验的所有功能。在 KCL 中可以通过一个结构定义来约束配置数据，同时支持通过 check 块自定义约束规则，在 schema 中书写校验表达式对 schema 定义的属性进行校验和约束。通过 check 表达式可以非常清晰简单地校验输入的 JSON/YAML 是否满足相应的 schema 结构定义与 check 约束。</p><p><img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeEAAACtCAMAAACweTefAAACT1BMVEUAAAAAAAD3x6suUo33yq0HBwcAAAD2yawAAAAODg6xn6IAAAAMDAwyVI8vUI0QEBASEhItUY4AAAARITwREREoTYYSJlSDhJs1VY9HYJMAAAAGBgYAAAAbGxtrdZfow6pMY5M7WZFLS0tGRkYNDQ0tUI4AAAAAAAA4ODgtLS0kJCRkcpYyU5Beb5UAAAAsToyunqIRERExU4/4yqwuUY4AAAApTYxrdphcbZX2yq34y6zIrqYyU4/0x6ssUI3ww6RcXFxWVlaqm6FMY5MAAAAsT41nZ2dRUVH3yqwBAQH3yKrivJ4xVJAwUo7rw6rivqnTtagTExP2yKizoqJFX5KFhZv4yqy9qKIXFxcWFhZ7fpj4y63///8AAAAvUo+Tjp6Vp8aqqqqXqMcyMjKysrKAgIBMTEzMzMwpKSnU1NRUVFR+fn7t7e319fUJCAgSEhLZ2dkkJCTx8fHj4+O3t7dXV1fX19eMjIwcHByhoaHAwMAsLCz9/f3xxqoPDQz7+/vIyMhgYGBbW1sYFhPp6enb29tycnI1KyT4+PiQkJBlZWXFoYleTUEiIiLuw6Z2dnY5OTmmpqZsWUw+Pj7nvaGIiIixkHt6enpISEhEREQnIBvUtqe3pKN1YFJJPDOhl6BoaGjS0tK7u7vqwqvf39+UlJSWe2lnVEc1NTXhvanOqI9ANCzOzs7ExMSvr6+ck5+EhIRtbW2OdGPHrqWdnZ2amprVr5W3loCsjHijhXGBalpQQjjPsqbft5xQUFBXRzzas5gwJyG8pqR3fZnBqqSXrgzuAAAAW3RSTlMAgECAwPgy/lflVhzw7ljcw2knCrgUBf3lubGQEfKFKvf78fGjd0478PDw6tuIRSr+z72gmWsc/vzq2cyIUkQT9fPUsWE29/J+dh4I+spt3NSVOOjU0bKSbltNjHfLIQAADgRJREFUeNrs28trE1EUx/Hri4DQQJFoBbFmUVxYH1hRWx8FQRCrVdDdr+d25UqIWzeTzSyySJhFKVlMO+mikNBkIaSQNokhDfUPc+4EGdKqTDOT9DY5H2h6mUO7+TLTuclUnDWJ+FWxOH1XKtfPu6akctld3Rzcwem3QsTvCzZoj2feS/lsHthYVTbh2vKW2xjwwdhCUk48einYID2X8unqbgynY+fBtaScuirYoCwtf1rdwamKbW7NTQs2CFcSLxagh7nF14JF7f7sHWhjSz7na3XE4u+Su9CGcU2+TwgWoRn5ZBs62Xw3+1iwyMTlYQx62U0+FCwyyw+gnY0Pi4JF5AW0dHFJsEhM63aF/mNOsCg8+ghNbX/m9zAjEJca/hHuMm7N8rY4tMTEU2jrl5wRLKQLcgP6ejJxRbBQrkw8gcZ+8kkc1uvkT+js8K5goSzNoz8x44SDcr6MPrwRbEhvdjTMAoC8aTYAVDMpqjRagGWae/D5g2NylEMfFgQLZQ5BrVEGqKUpYwFtIkoR2etYJ8rD5w+iKgx+HiCceQSlClsdSh8A+0RrllEnco4U9gfRFV7mjxHDmPqBoFThHNEegAxlvCOVek/hngGMYqnp1KHUnKaT7RZeb7RzVQPB7chJwfqWkFsnKVwkqsLlfevyCx8Z1GxSKhawlyaXrQpnvWXGQnDJR4L17aX8heCFU0QduFpEe8cKHx1UyKyWnRQ5QIfseqtElFPLSi37nRoI7il/ThxCXO4geGFFFSwTZY8X7h0cdE/nJpmoEdUBSxWueb/AIRvBHc4K1rdJuX2Swo5JtuVV3f9L4Z7BHlEZQJHIyhMdAMhQDu4ynU4TpRDctQnB+jYjDSBw4Q72u3fJae8VB7Wewj2Dblb1A5b7ZQCodAvnSkoMgf3gcziECxJB+PvhJlFWvZpWt9mRwv6gRlQE0CATZe90NlKUU8t9AAc4ifOCDa9wK022oUJlstmSG1EVrmZd8PiDWIcy6+rWeQ3WNyoYqBLlELOp0oLjHgS48F+cfmEUiRz16mnHVGGPBcUfqLhkEtmWdzCVJpva3lWb0t37NS4cTvSFiwUHrlKhaQHZUsYu1GOAVeiy4PEHaK25q4YBV75pN/PFQkPN23annYWLCw9DXKP/ZPmXzeuC9e8itLcqBePCjAuPKy484iZvQXtcOORuSXsbNwUb6cK8H+bCjAuPr7NQePuyYH1LPIP2+F6a98OMC48xLjzi7r+C9rjw4O6l5dDgP7amBBtU4ZUhkfg33g9zYcaFxxgXHnXxO/oX5ifxQrmof2HeLXFhxoXHGBcecZO3uPBoOwu7pYifxLtNkRMaOwuFI94Pn/u6ErEjhe+di9g9LqxV4Rv0JWLEhfUqfGklYiNf+Dd79/KbRBDAcbw9bANKxNTGGGs92Kb1kWh68K7GaDx60+Q30ZVH0QItu8DyirwWAiQECCGUeBAQkh7apo3ttX+bM6D1rRV27Rbmm/RxaEO2n7LMLJOdD2e48DAr8QYWziroV9lT8UO1Ao5qiEYZSz+fYRHyRqscp0B4iPkwIRmw4mkSxA/VAzjKFjaKsGVf1Dbyg8A0a4q81ir1hIXTWbDEUyNsXYG2/SC8ROZYxKVVJHeywvU1D2iNEhOW8oXmQQ5AbL+QbTPhuLjX3OkLx/17Bf/oC5uuQdu8nuGF7zwYXDgR2gewTjJUWC1u5pVolBIfFhXF5aLCyXQp6V3tCR+E8srbBBfWVFj/sTRZcdgAZA9zVLhZjAOekAI/6QAqCaBNZCDsVZlwwwFEWvh9eq/Em+pljqxolXs8hGWSQG7Nz4Rde2DaTtR9oNkCqLmCwWCCRJhwtihKJzkfNpGbLFK0aVQ6NB7CeJNCuBhjwl4RtN1NJAOgFQJIvrWx/Ew4lw15U9LgwoabAq/7vhd+ep4lEKdGbewaRDjidZdrYMLFEmhOJ7JR0DYDKEW/G0uvRJsjLEzs2iZ6DSIMV5OoPeEk88x5a6gQN+AmAYhEBtx1iQp78hKwWh1lYWibe00z4XO3hhLuUsqesJw+3KmUXR7Eo+VKZdN2iNhmtBLePIxTYWw47eHQweAr8bjwicyHCzIgJSlzPKkCaqnh3PUAkOqN1E47D3gcG4dKDnBsQy5Vk2J88NkSF+areLgwF+bCXHg0hcdjJd44C5+GFQDvrnLh0Rbm82EuzIW5MBc2svCHM1x4mJV4xhfmY2k+H+bCXJgLc+FRFb7zYASFz16eGltheuz/NJZ++Z/SdiXeWUIuTw0pvB4/pcLs2I8v/PHFf+rjP82HJ//SLCHsOI8lnC7bUm38XFlGzIjCxzz203WPeF2F14CVkOeXwlU9hGOtz19j6BXnwkxYv7M0E0bDj1YztQ3J4dyNyQogK1R49W2q8s/C+SyASooKRtljFhpgvUkBPvTyp5AKtVG32VIUd8cWtb0JAoU3oFUljc7Sp22fByqs20iLCSfSkuqyt6rtbkkqJV5vAPSjLKvpjvufhXO+15CK1Ky9UaSCAe8WgI7XCfTNsJEAUv5gOYZkGDvRDDWPygiEwgCikiYjrXHcnfYPwqQaqq5APJTlblYJdIAjYYQGOUvbG1gtgdraU3b6uVkAUG8eCQfLYML2ABCjpAnQHA4ExKL8B2F+j/ghhNcgVmPIRwuFghJXytUOE94aXBgbXZ9EiULxtpMKt0NuxH2RI+FmpScsRZMUN/4WrMQGAonwBhfWSxjOPFoNwCNJgFJXi0B+COEMYYj5EmJFGYHtkgKxufVF2O2L94SRCzdsGSkEVnCTCsO5z4X1EpbTHbhK7UY46Ug47bDV9qsNJhwVgwMIw+UGEHVtbqZrVLjjilW3joRru+gL0/JJuHqk9iYTlosyF9ZDOA/AH4Faq7chHZT8MaiK0qkgLGGr7h9UOGEDEPRRYTi7ZXwRjvuYPspBUQR2kmjWAcQaO0wY4cZvhfnutIa6Ls2EC13QqhEq7CfhvrAoivkkgIriglzcr0QjyFULdrFRR08Yh+R3wqO+K56BV+KVHt17fG3+e+GDHNDtWW1H7DJiigeqCORrtVo+A2BXcQOZfC0IINdeVbYA0J8D1FpuTIUNvIpn8u5Dk8k0rdtVS8ktZ163uPDJCU/000uYEMFiNlvPT/xjp/6dh/ERvqD7nUtf/adO60o8nYWFz8J8Jd4JCMfVTGvlNAjzVTyDCRNiMVutM1x4ZIUtE710Eyb1R4/n5wkXPjFhs97CT+6aFhenJ/rxlXijJyyM1S4A7y9x4dEWNsJ8WGrZu45H167fnLMIAiFkmQuPjLDqV+7dEATz+YXJu6bbU9Nnr1y4OEHTXjjmXk/4K/v5msNRIlz4fwjHt2vzFmF59uHSlYnv0lhYjRyUrt2wEIFeoJxZmJ2lSyanuLDewrGV3euCddZ0NJzVRzhTyV4XLMsLT0xLZ789NfDdafUVlsT7gvnpYu+Zq59wKz8vWGae3D478XN830MdheXudeH83d6fXT9hd+W+xbxg+tWjcGFdhbdWb1oWFtmlJB2F12s3/vA/xIV1E5bEexbz7BL7Bf2EY9ulOcvC7T+85nLhAVok95WIij/ktmfZ84qNq3QUluz3BOtxxsmG2p02u7eX7cr4WmfNYzThiamHs8uCcOOeI5zo5PBd0mtxdX5OOD95e4jL/GRb+vvgXKGv70+OdW421t6lpKDs+bwijsoQj9HuidfvytLDyZllCxHmbl6fv3b/8eP56zfmBME8M2maHvKs+cwqzF1brbR+49zx06mX+Ziv78YTjgBIrcW+FTbafPgH6emp24sm2uLtpekrE9p0cdo0OWOl54n5R7X9nUiilVlfDyYi4kH9/g3Bcn722FMvgwr7iQolw77Z6QvL3VQ9iP5WWkYT1rOzS6a7swszy1armWZdnlmYZFfE/iVjCq+6gBCjzCaZMNtga7f6NvF5K60xEjZeGgh/au9+XtoGwziAvwyhIKQQxOVYe+hplZVU0lra9TAKZT/YELbB3viUoYPBcG5DpyumQxnCAmUbXgYb7AcbmMuq4NGT9Q8zr6kHDx6aN7GPeZ/PIS25fkneXw95vv5tb3c+nU/Y/SI6t3wbtNIa+TfxVCZfiTe/vD7/4r99PuGFbb+d1svl01ZaGObSKhuTf0v7Ob49S3g/SLizviBsBK20KOEhoEx4qbsvEn7vX3aChLvPbWHQSosSHgLKhO0Vcdl1RQVZkPCqGIfbB4NWWpRwWCgq8YL18Jsle6/zea27u3Wa8O9X7uJa56yVFiU8FGxzafe12NbdbNsbK6tbz/78sz9ufrDtd7923EV70Epr5JV4KlOjxkNllHDSUcJJRwknnRqVeEpTosZDaZRw0lHCSUcJJ5wa3WlVdhVWS34lHkl0wrQelpEDB3/Cc4yEpoPHL4Kl3xLPMBJaGr6j/+qhRwlLmHyS4tiVTUbCq3H0sjOMhJfh2HmgMyJhliNXgAYj4VmPPI5bX2NEggU9jptBw7Cc+9i7tTQZkaLDIccsdYcRKRNaiWNWZET68AHzXOuINrSkTT5FvK11TIvhKDQ5Vs5U/joj0u5WOFIG3GIkApmCwzEqQJWRKDSghHIsvmHSOzoiOhgcn0p9gpGIVKGP7imu0F5HlHLYnuIfD+uMRCk9jukc0TGADhwiV3/MsTiegipNsmJQK/dQLJsMyNM6OBaWCdnWyHepU8XpHD3AcWmYMMopl1foP2jSFDpeVi5dK47Nlgyj1epx31FLEIfIjv8b482f5SyARq/ny2HltXsA2jXfbRCm/X/j4Ivr5lymas7oN9lVdAKqTt3nn0OzrwAAAABJRU5ErkJggg==" width="481" height="173" class="img_ev3q"></p><p>图 7 KCL 中结构化 KV 校验方式</p><p>基于此，KCL 提供了相应的<a href="https://kcl-lang.io/docs/tools/cli/kcl/vet" target="_blank" rel="noopener noreferrer">校验工具</a>直接对 JSON/YAML 数据进行校验。此外，通过 KCL schema 的 check 表达式可以非常清晰简单地校验输入的 JSON 是否满足相应的 schema 结构定义与 check 约束。此外，基于此能力可以构建如图 8 所示的 KV 校验可视化产品。</p><p><img loading="lazy" src="/zh-CN/assets/images/08-kcl-validation-ui-4a33642df3b7e92c4a152a12f9f8bc5f.png" width="460" height="388" class="img_ev3q"></p><p>图 8 基于 KCL 结构化 KV 校验能力构建的可视化产品界面</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-复杂配置模型定义与抽象">2.2 复杂配置模型定义与抽象<a href="#22-复杂配置模型定义与抽象" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>如图 9 所示，借助 KCL 语言丰富的特性及 <a href="https://kcl-lang.io/docs/tools/cli/openapi/" target="_blank" rel="noopener noreferrer">KCL OpenAPI</a> 等工具，可以将社区中广泛的、设计良好的模型直接集成到 KCL 中（比如 K8s 资源模型 CRD），用户也可以根据自己的业务场景设计、实现自己的 KCL 模型 (库) ，形成一整套领域模型架构交由其他配置终端用户使用。</p><p><img loading="lazy" src="/zh-CN/assets/images/09-kcl-modeling-86763db82d999256115fdcfcc861f829.png" width="753" height="389" class="img_ev3q"></p><p>图 9 KCL 复杂配置建模的一般方式</p><p>基于此，可以像图 10 示出的那样用一个大的 <a href="https://github.com/KusionStack/konfig" target="_blank" rel="noopener noreferrer">Konfig 仓库</a> 管理全部的 KCL 配置代码，将业务配置代码 (应用代码)、基础配置代码 (核心模型+底层模型)在一个大库中，方便代码间的版本依赖管理，自动化系统处理也比较简单，定位唯一代码库的目录及文件即可，代码互通，统一管理，便于查找、修改、维护，可以使用统一的 CI/CD 流程进行配置管理（此外，大库模式也是 Google 等头部互联网公司内部实践的模式）。</p><p><img loading="lazy" src="/zh-CN/assets/images/10-kcl-konfig-d449927f5a1b7e08eaec85ac24ad4bc1.png" width="363" height="356" class="img_ev3q"></p><p>图 10 使用 KCL 的语言能力集成领域模型并抽象用户模型并使用</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-强约束校验避免配置错误">2.3 强约束校验避免配置错误<a href="#23-强约束校验避免配置错误" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>如图 11 所示，在 KCL 中可以通过丰富的强约束校验手段避免配置错误：</p><p><img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjkAAAFGCAMAAAC/qX7WAAACeVBMVEUAAAAuUo3F37MAAAD3yq0uUY4lSoYsTYoPIUQtUYw0VpACAgItUY33x6sCAgIAAAAAAAA8XZIvUo4AAAAAAAAEBARNbpYBAQEAAAAtT40ICAgBAQFEYZOwzK4AAAAAAABhgZqSsKgAAAAtUI2buKkAAAAzVY/Yt6gAAABtd5gAAAAAAAAAAAAPDw+CoaQtUY4FBQUBAQEqTIpodJczVJAvUo8JCQnB3LOglqABAQE2VpA0VpDV0KwwUo92fZnFrKUcHBwSEhLB3LNcfZtBQUFUdZj4yq1GYJP4y60vUo6Rjp+xx6zf0a/3y63F4LOYkZ/0yKx6mKEuUY5RaZX4yq32yawqKirF4LR0dHTF37RgeZnnwKnF37SNhpq4pKPF4LT////4y60vUo8AAACWqMeTjp16maF/f39LS0va2trU1NSysrIqKioGBgVZWVmHh4f7+/v19fUxMjAjJCMLCwodHBrGxsYQDw5vb28YGBeDg4Ourq6oqKigoKBmZma2trZgYGAUFBLw8PCRkZE2NzXLy8u/2rB3d3fpv6T39/fi4uLm5uacnJywkHpOTk4nKCZJU0P0yKtra2u6urqNjY05QTTq6uq30Kd8fHxzc3PAwMBGRkbPz89CRUA8PDyQpIRpd18qMCa9vb2ioqIjIh3wxamWlpbFoYmKnX5dXV0zKiOKiopwf2ZTU1O4066al5tWYk9SQzlIOzKgvapea1Z7ZVZSXUtqVknYsZeClHebsY5hT0NdTEGpxq3fvKnUtaeqwpzft5x2hJvc3NyFo6SxyaGlu5Z5im+YfGq7mYLCwsK0oqLPqJCMcmGjhXGlmKCgtpJDNi6TsaffezK3AAAAX3RSTlMAgMCAwHEOIQcu+pdRQOhzG/lgW0/g77EuOMqJ9ccmDObRaEnOYNjHOOa5QhLf2Gf1nxn+57KrjdfTppkTw4D98sNu/vDsz8WsfWNCLOXV1ITdkPtkT/Dm+s+5qKYm4UXmlKsAAB25SURBVHja7Nu/agJBEAbwieCfW665UkgTDJYRgsdB1BQnFoliYQoxCANT+Cj3ONdcfY3cE/hEOROEJIR0ct/C96uGrZfZYWZW6CK4OQulNvoMH+uoe8VD8lwn3Axf02R/Z2eLVu3Wzu7r6IqH+yRdPm3CjpCX+hNnbl5qM+bO3KQv5KF3dyy0QcXRRUw7/km3WaYNy8ptKuST9vNaQayXbSFPdGKbK4zKYr5ZfugOrVIglQ27QviCsSsUSuHGvDoeWL6VCqaMJkLopjC18Tf5eioErqWQWkLQgkRBJULAuu6goEpWychilyuo3MVCqAZYjZyfKhsIgZpFCiyaCWHqI6cc1cq4dAGq99D4dPw/2YI3B9RKwa2EIMH2cr6wpwNrp+B2QohewEbkfwiE8PQMtn98cbCeEJzATgruZEw6gEKD28v5rTR+4gM0MtiZ1UVuI6EPdu6ftXEYjOP4tXB0vg7dDu7g5nsf9yoeyG/2kj+IjAaj1VqEJ2MbPHgwwYMJ2FMW22te0j1SUlooJOlRDrnoC8WqInf6UDdCjXN9XTi9D2iSC/9/EA72Z0HO983LcbC7GcjxJwNdzMvx/VuPT/S/GquRXkqqjG7Ky3G0e7qYDnMyxeFEF9uFYdiTrQ1DRW9TeD2bIfByZt0VOQUaMoWo6WIJcJYhBaA/Us4Pv5/jYh8pJ0iI6/DBchZ3X3zu9R45Y67bkbiqSduer3U7Vqp7lhOfdEWIrRw57dPm9OIh5/UnOUmuVC3Pcnadajrp5cyxx6fb5VTAGiIhUuCCiWiFBmif5dQojRKsc2i+ljAtjZK1WV8aOb0AV+xOcgoEQOvlzLG7xe1yIv5qdWUEdUkLsaMYUNnhWc4gkBG12Fs5Ebb12AYGRoyyG/aAMsPo0G+RWzkjQnlYKi9njr1HTgGVEKdQEO0CdDwjyGblJA0UyRC9kXOAfXal2DIQXkoygDKzFtfKysmwzvzfOTPtVjmCHdQAos7MQQgB5DxKX8sZESQVYjJyMmDk6QmQFXAgMvDM7FqIAGsrZ7cFwnagK/32pywc7JqcCAVxp18bXQRgYgKbvaniUf5aDi1Ra9RWzplLdZIj7Y9S5lu1N1k5NLRsp5R+P2eGXZOzBwa+5MDR+tDQlCLm4SDpjZwOGwQJnZ9Wk70xpCNwPD+tRqAy9768K68C9F7ODHv4RRfLgOg4dAIrmSgtWUJEE9DRIdwc38iRAlBk5VCMIqGjQEMyBN9Zm5fkBtFALRorZ9ITybWXM8/u6XJ72ERPpLFdBsiIwSAElvKNHGqA/iynFwhCoNyRobYWKA2qKkAggMzK6REUW2wkXe67/6xJF7smhzJVlLpNeDTsV2WT8UDmy80ylwxFV3ROas1GDloR89C5Wd4sN5pXcVW6SqvJzvZqFaes66hTJsUr6sG/t5pljn5al5fjeg8/yfm8HBebw8kuL8fFvBzf55XjT7C72Bzk+P0cF/NyfM6fYPdyPlcz2M/5y669pCAQA1EURUFBcJEijRt0g37m1iDQ4VU8ZxR6fGlSoZQTqUE5NtgjNSjHVB5JOSx7Q1ZOog5TuXISKYd1y7HBnqhDOd5zEimHPTbYH7M8ldPOsQrnvk1S/PlssIcqy9lukxTlmK1CKYfBDXblMDZbKQfl8NNflmODPVGHcrznJFIOo/s5ymHV9xzlRGpQjg32SA3KMZVHUg7L3pCVk6jDVN6/nNPh4/w+Xb6n694fK/PLebFrPy1tgwEcxzvodJTtsOPA24ZjJ0EdjLnpzQmbIOpOQ/glYaTRJnn6J2naJG2appTaotiWElPtQacgIr4DBb3tVa2aTSPrYTtIavRzDDyXhy88f/KQRu5Ab6GHogAPTnGxD+UMPn478XXu28wQfeF1OBx+R194E+66xY8zc4uTw/NPn4S8/CtH+cEeJtrAagkeKgBZg8e5bduFqG03/6ecAL5gHxj5SNND3yl/TI1F6MiEd+Z8K8dMrQCraQf7Bq61UuhlvfZwn/M5snB8QvlnY+osMhny8KucKsMBINA7MVsHHFvQKijlGNuOOxqAvJLTKjfKYTl0FeUdlcseZFsAiFqvqwDJ13P5gJfzZYY6ofy2tzG7GLolg6/+tRysR6vo2rUS2V2U+LK4bqFk8NlsRYwCxXRWlMo3ymnnAHDMMmsl2f2O1AKMzKaRslGTis2UHOByRifmNqg+MT0xEvLw4z5nOcavqQRQDAA7GiAz55BTALrlxAsq0Dgi3nLUdAWwOxCZFYBkWDSYVWCXb21nAWcZHsF6wf5yPHJK9YuNMfq9O4G+lQM49bRluuWAcHmNka/K2WLIX/scUtBAJB0iHwcgtCHGOI6TmR0lqcUDfLZ6TC/4v1B5HNPDo6EuH8sBqhnRLaeUTK4ZjHNVTr7QY4e82UYjHYdooUtMwEgnLjQqm1JKMINaziN6rG+WKtdUZHww5PLjBXtLRpdguOUkBYDw1+XIfI9yOKYq1AExTQAIUZRj+KMUywW1nE9nfRYORZ2OLYVcfpytfvIcQDI1KAJQ4VVghXEg8+SyHJNvALJAbpSDDpvaAkRGBpBhoTKrgGlXiybAbge0nEWqH01/8K8cHMXEYqdQgZ7R8hCs3WaCd2DyWdXslgNF0muxMm6WozMWADGzrqtRyQSxEppurZF2dEWXasEs5xnVn8I+lmNqB9v1cyDORsuoNtsKp3CAtiZU800AxejRcRy/lR13CHN8uZjlD7Y3W7gcetSsoFruGCoJ4gv2gaVZqk/NvQi57sQfz0MpflnOvblDnn++R/Wps8jonSnHKfMN3KtyfrFrxioNQ1EYxs2Ki26Csy+gLmodxUHQxVU4+RGnbgmhi9BByGCGvkNKIFsqlwQaKunU0BLpG3lCSkmxQ1JKyfX2g5bD/SnN8HGSe3Ma2ojqyvDgkq9Qjvmcz/eP/KXomyrmNOvbcrJjnfn9Sp2ZQGnMOdF+qL50j5qqmSPNBPtlnVtO1nQaipkjza78dkLr0asYTO3pOv/yolrPkcaceyqJ1W4nRN1+24mJQt+AMbDnqwsKwR8iDGgdHiR5QlbNnJsulcQCWIgASIlcE9ABjPPVBYVgY+Y8SbIrV82cZypJ7kgKCK49dFwKZ9CtojlLwcbMuduZU0caj5V6zlTHjH9g57qERhAXzVkKiFzhRyIkJhS+cHNzYhFF4x5VYHKtljmSTLDvaVXMSR0YFpcCnaVOtICDQp2hp0SJDqDlZOa4HTCeReV51faVMkeS85yrU6pgjjnXZABvpTnFIAH8xPagx+TBSeMAbA6Xs9A1IKr0HK2xM6d+nJ1XMYfpE+Ojv9KcYhDB5O8pMOZPStRrsTkhkBAJOFSeb+1wgxPsO3M2xMWoijlGkO+agpU9Zznw4BPTgbCBMFtgc7jUTbMFncoz1I63c57zpW2L/zDB/sveGatEDAQB9MRD0FqwOLHVT7DyA/yLyWCZLiG1XZoU+YcsC9dl4cgVadJFuAj3R87sHkQFkQXB3ew+Ugw7IdWDmU0mydWLjTlVrasPTKe905v4Zs6cIFF6IxCbU1N0NOb0HWMxgSgSHliJf2N0jMTOHJCIStegif3AQn4250uix5wikelqdThVq4M5ewAbHi+jOe5haw7sdNPSkiH7Mce8LimSBBjmRMUn1h1mg3hFJWBC7KHO8TjQNTqwYP2nE+zOs1RzRI7FAMMWmUzSqqEEzZyAHrFIdV80cneDDTc+VYqp2aFZmhPO/62WZ45QSnIlUopkqKe22XZ7XjUIYOYE8U5RLzmq2qatRrWjUNJiy4vRnGDM+TfuL4Iyx5MJ9ucSnCc5C8ocT+7nuPq+TDTHdQIzh+ZznCea46I5PtzP8cScJ3e+fBLNYbyZYPdhb3Ubnz44iA/mrFeBm3O3uTl/WP3M9YaPX4jmLL5D/mDnDlYbhOEAjH/Mi+CIASMRhQiBDBc9tJeCpx33GtvaPe1eapMWRluUwkCczYeevET4XRL/eCWnFWljxQQdacgSpgty1r8rv5LTW0A5qAsJdHQGagN0cV3UEHdHObKIGS3IuTs5ci9hyG28KDt80ufe9r0HXwm/UWTJcMW6L3PJXL1+vS++58e7knM5wd7mJ0EbQ7xzaA/CQ27QZU1bnuSkGqKUqcJ5zqrlPHBeI2AoKwGl0Q60hV2GTgHRHeXsts5VJWMFOXcnR+4NQ3YHNDm6ha2CxKEzIDdHOXprrXWMFuT8cYJ98V3KoUwBW7UbINJncrYgc45ybAK1YawgZ/XnOVcT7I2IVJVLvM8q0ZzJEVVWRic5UlTKp8zV09TPc14+5yrI+e36dWWaOAmxTSIDmQE13AVa/TyBQg0XRZUopppvV/5xmKmpVYQJ9vF0y83NK+dtpg4TqwgT7EHOAuT8h73VGr54Bjk3FOQsV06YYF9i3+zd30taYRjA8Wc7MATZObKOS5QpBI0wB+sm8G67GvRXPOtl6PFXaqVpZZZJv6QLk8hpXeQ4MEL6I3a5i/1Le97V1mhDT3XI8+r5QqcHL7r6QL4vjzi3a305I34TaNGef7TlWCwjcgJjdz6A23KGfj/HiByfc8p713OVLWfY73OMyAn7wafAIKMNdluOxTKywe5UJu+xijNyZyt7g/12DokFQ+BXwGiS2U0LIWfkN9j/yetUZT9xMAyHRUyOjZocEd4h95czFQZQ3R7j/6+kCJrcyMkR4VTeX47qpYfCJLDl2HLuJCfgdqoT4VlZ8QxQzofv1pcz4hvs/ymkOBU/eKQp6IvMw/M1Y2Z1fC3nAfc5nZXrP6KtHOGtYoWbuZKy0KlcBDlPwcS873iMJcyKPVxOil1cDSVWxFu12c28ELXlDE7OmyqamxlyCotppDL5TXHkCLnBPnRy6vk4UnoiyuXEV74W95HKNct6ldFQjZQbmSs5sWJKz1hBjgj3Oa+eCSHn9Y97y9mpt5DKVg5JTmkzonfzOcROsqkfJhhRWkqdLCf2uJzj5E4t27TlGGv+iRBy5j/dX06MaYi5pS2Sc85ySHy2ca9wQcMZQ9ysIG4la1zOZQJxP95Ljr3BblCOz8k/BmEgV/g9jy1GTaqlmycHz5qI5TKSnJMCUlW212ZtGhYYauxc07TtEpeTSxb3rXGf02OD3TLfGNJTjqxOS/IE9E+qx81tbdlEOWv5zHGyyuWUu0hp7NtGkg9HDDdYltfkcnAty7ZzVpAjwvdb9ZbjApgMQyBAcwgcAfA4HunyT1s0UU66sN7IIpez8wWpDstUmUZDgyENf5+tDkqbthyz5ARB8QG43DA56w7KqoByMHKWuPwlZ4PF+EtZ3FrSaWgxOqxXOKE2lxPPIcaSGatvsFtETs8Ndnnao7jV33LGki4YGx+MnLndh8jZZ/kMl0M/i7XV+tJnwpSvrJa2WRoX8o3VUkHjcmrL6/FoygpnKxHk9LzPkce98hT8kROkX/JjyTHrPudylR4LOj0qccS03j2ta0h1uq3iQTmNuJY63aFXNhqIlWi0cmDLMUOOy+FWr+T4SY4TwCGcHEQBt0lfvBReDkzLIVCDABO2HKvcBAoiB2ZmIPBWUbwDlWNvsFtPTs8NdiUAEJIC4PdJLgU8KslRRDtbUUO2wW4ROT/Zu7fXpqE4DuBe8MZgU3QoExWGoqCT+SL6pML+BvHxi+ehTbqkSa9pc2nthdK0dNCWsnZdH1YZjDL8I/a2v8qTZM5ZvKxLXXPafGHdAmfs5dMu5/Btf6M+UZg7zwEY7AT6cnw503uH7MvxohwWduW+HF/OVMvxG+yek/PyBhNyZuw8hwU5ly74chiW0+YwcsyUDCfbGswvMvKiL2cozMq59viUcoQdnCqJCo7DkR9ydN6+SGjWAl/OiXhczrPrI5znuJOznRmSM3RBF4wm54wN9kf3zlkObbBPoZxX8wvX3ctpDVrNrF6uNA1L0U6mWFI6KJZKHGCmQdPkyptfxM0iDpp76YqFpZXPtosAdru2nI7mLAhwoMkn/uPe6ia5e89Lu/Jzy7uxNthfEULtuJXDC72akiwV9pVkHQgUUu2aoKdKNdJBIgaaVKacjonpohyt5YMCR7Fs7+0aQgiI6LaccNBZsGXAcsX/VzmE2jmjHB5OpKNvp5HD5Ey9y+Q0eftixAb7sByOtIEBCQB6CgiTIlAgPBBUjuU4X2ZaAuIDcGQPgLF+Qo6zQE2Wgc0eXMghp8ry7+TkFQCaCBSTRQDGNqzsi+gYsNMQIcZ3sBmJ7Ekol9YjvbYEGPug6eWmSY6L15yLn0eRcwh0SBcoWhXHFIB6FEBpf0gOUOmoBQUc0QCoRB6WI33RIMV1TOY1pxzlIUc5y0IdgCh0AZhC0BJjJ5gA9jJcD8jqEI0ypLYIiKk+gPUZk2O7cS9HBn0oAzyRbAVI1wAEhuXIweTW3oYlx3TeADIsB+0tNJIyJnSfE9rCZgmQ4624DErDsPgbx3L4Aiw5IRGQqA8JNBEeovq1wrqcp1fd7K3GL6eGIskBFXIkp/SFXomWnBAAleSG5dCLilh30WB3ubcK5qMyoBsw+oC4E89BinaO5RiaLSe3nk0AWhZW2jrEhB78mxzaYPd83J7njF+OSRpA1ZITV+1bBuRSlhwFgLKBn3KcBUAvEOtO7jyHEywcvSIS24B4WGpCM7o/5OSiki0H5f5W5KCqwEpgQOUgWP2znFmbqTcmOYhs5OtRC0VwK8Srybze21DoskhADQjqCTnOAkAnBUxODjZaAC8UCgWBo3IONrDdPZYzSMORQ5PPdrdgX+5YcipfTV/OqP0cg0MrKwGVHw+ZJoBMHoBKH3K7WwofLgK8UQtJmiiG+hpMw2xvZzsWrgRa9u84C4Ac+TZpOe2wRb9E5SC4W8APOVK0BZoer2mAmpXiRQBmPGfJAX0V8uVMthM4iMsTliOlKjYJicrJCLotp6fRZAFozXWY0aoW6aAbHzR2ownYclAjub802D0f5uV0SkLDRYPdvZxqGRXd+akVMiE1ZbRUHIRpVA5AepADuHzY+rmitfsWspBpXYTLLO+tmG+wV43i9DS7pJbJ8V025PgNdi/JEVbnF1dWPsyaHL/B7lrOBSezJoeFTuA0yPl8bnnny2FNjt9g95wcjzfYZ3SmHgtyvNomJSVDXFvz5fhyRpazsHz7zp2HMyrn2mNfzlnlLPoTYD0u58FVJuRMZYOdbTle3VstsjcB9s0NX86E5EgtPhHSqvlwOtAm7MnxP4P9/OWYjV1l7WNKmF9Z+vD61dx9Oi743kzLYWG+1YTlSHzV+BibX5pbuPPs5nW255X7cs5LjnQYWFtdeb387NF0TLp/enWm5Ny6Mhk55i5Vc//OiwunCm2we1+OP43xv8uRDj+9X319++9qZvo8x5fzm8hqdnXFuQH25fyln+P5nK8cs7q2urRsDVvz5bA+U29McowD/Ctyw/4f9ehMf8D1Z7D3FUUJd3Ai25ovx0XG1GB/tDS/+tHIN0wJv0uZ1+ofY0t/nJV/DnsrsTDY7JE9/ExEZ/Qz2D2SsT1RXjxfnluaF96viZ/y/UyiyHMc1000+nll7b2wcnfBfhP1BOXUAaikcVKOd89zZkqOk+sPnz9ZmHv9YWllZXFx0ToSnlu4fc9BM3k5UjKPJgcgozpyJLVeV3E0qNxDcli4Q6ZyWMh45HQJj3gGgJJ15GRT7Wxs82hQuYfksLArnxk54gHfXO/hFzkNYgJ9oeUMKvflTKMc1w12MRaPxQLlX+WE1zmOS5Ada1A5Ow12j4Q22FmI6/McsQ5KBL/KySYjVhrOoHIP7cpZkHPpAhMZhxzUozIQ1wH0HDmlddhxBpX7cnw5f5CTiytAwQByxJGjEpNebOaOBpV7Rw5tsHs+syQHIXKIdLLUjBZEW45UiGh6oSY5g8o99JrDwnkObbCzENcN9m990KQHkDKiqDZ2gUACkAPB/Wb5aFC5L2eEMLO3YqHZ9eaGL8d7+c7evaMgDEVBGD6FQkxnaS0Itj4aBe1UBEHUtMK5mAVlEdbuIIKthVvS9JJKwwx3vjX8RXIYuAzl/HbBDk/lIJbD8G+lclSOyvlKC/Y/6baNgRbscGK556gclRNDOQz7HJWDWA7DPYeknMVd5YD5LNgZMPxbacGOiKEcLdgRRVYOwxcySTkpQTkb3ZABTR515VwaElQOXTnzun3OMm+K1yiHnajKIVmw287RPUNc5ZDcc6zl6PKQqBxAe0c3HphpwY4nKxxbkR7iuueQLNhtdnRsy9CPqxySfytrh9KhFdtE5SAaob/HuDLTgh3StHt1ZCczXQIh9cLLge1M5aCanR3XbZ00VA7MiyEkC/ZK5rDKdGpmcb0dzHLPqWwc1TgdqRxgb/buXiViIArD8DeQZJNgYwpB2G5FsVowW8UVu2AgQfGncbGYA3svtnMRW+cOJrCtN+Vkf1Abq43OYeZpAlO/JJnhwMwbS48DWwpxUNmJL+egrnMr0+mowJ47d+qxKiejtbRQKSIHy2Eywb5T0dq+t04zB+BeOXx25RuCbPtgqbIPx5djvXD2Lm3Sjt+w5dofMrdyENeltIbOqYiw49iunF05xoPupA3UMk2n2PDl8FBQbkM7t1SMsOVgOVwm2H+Iqhk9tSv5f5SW5TMS7DlYDqvznC/R9IYWjZRar5T8W6r7WObpuMZ3vhxGroD65ZV690EQXFDvODAuh1y8W5jn+eMEQxqd+XIGlmRhJcQpgEj0QhgTYQy2GB8lMX7hynkOlwl2xzAo55Ndu9lNFAoDMLyc65g7e5OzQFQQlD85iAoS4080saZRaV3UpIkxphcxu7mqKVptzaxYirw78oXdE8g5+e7ybFX88sjxu5z66PDVuG8S65yrtrkt1ks5he3X7xxywgFZpjvlK1WYOAHnXgTfSficlHIKW66zlSNUgMCKfsoB/pfzbJV/q2KXSw5zBaCyhz/LvT85y9kEgLPuvScCRp3FwoEkFKuVeZpUFX34BsRjucheMbqLsFvKufvyyWm0gGftDbM1iyuaepLTqMBOW7/P6gK8+WHhHkh6mu+Psom0eh9DawX1iq2kwmFqx0vL4baibLA/UPnkjIUDsQ1j3wD7cJEzah+ArYC4Ct4AHAtOE3sNPGkqzbYBdY9XHzbVB7rPKWj55JCGMFgBTDZy4F3kvIgXoCEAM6mt2xc52eQvgL2jGQLhEa8VmA91E1jQcu7nBP2RKlQwK266n1/ldDWAJwEHd6CnP+TUhAHQPNCcAv6M0dq29KiUc/fluwkcuXK1BYb9CPSrnCTTxFKQCAny5puTAJG2o9k5ywGSeljKufvyySHUW1PgqEPUvsqJrHcgFQSWAb1MjmaQTcy+AkihXuSYcQTKa3E32B+mnHIcYUWAdOPO9vtvheLGMhwIw3RDGc7bEGm+jLJJx1JqcX/IRQ5ppdaxp+Wp/O7LKQdvCWAEul7bBTz3DLpLYHdM/cnnQ+KljaoHBDN9cppswu1eAooD1GImw21PGqWce6/cYP/H3h2jJhBFYRR+jUqmGzu7BMFWCIoQtIlFkAQhVUj14BFcyizHZuppgitwRckKQhAi507Ot4ZT+G7+qPq77LIcIstRf8sJuWDvvQjleM8hshy5YNev/KMdsgt2pADl+LZCshxduGC3HPX1bWU5RJajvyinfFyJC/ZwfiwnH66l9Z4TTYRfDLEcou99Dp7lIAX4TT3LQQpQjgt2pADl+CpHshz19hOy5RBFeJVbDpHlqL/luGAnilCO9xwiy9HFC3Y8y0EKcM9xwY4UoBzfVkgRytkl4dzfZbqmuAkEmpdjhjuWeRLOtLQZriuuLIBuyjnDtQtvyEDDcsh0z0lAs22mWycB7W4z3HsS0irDrZKQXjLb51MS0z6TNdVDEtNjl8FOZZLEtKmbjNXUmySoaTllrFOZJlFtKu7frl6XSVijinsN9H6MNijUD8necuAmzH1X4wIZb0086nT1OIlu/YZ7mnf1YpSEN65hE6+2MpwQRjPWWedcZoYTw3BZtqC7zmrpf1mFMagwX6az947ztSEF2CWdwuMHHLQdcXZiGAVDDjjJHhrQpvLmQ1xJtkYMo2DoASGuJC7nNPoPKreBG1muSVxWo8sqhijg4LFWS4oyj2GSTQIBLiYgUAAzA4Es2gkKmjt52yjzcDCMgiEMONhABCMIsIL4ymCmJA0FPVmH+E5OAN7FEXl/oCG2AAAAAElFTkSuQmCC" width="569" height="326" class="img_ev3q"></p><p>图 11 KCL 强约束校验手段</p><ul><li>KCL 语言的类型系统被设计为静态的，类型和值定义分离，支持编译时类型推导和类型检查，静态类型不仅仅可以提前在编译时分析大部分的类型错误，还可以降低后端运行时的动态类型检查的性能损耗。此外，KCL Schema 结构的属性强制为非空，可以有效避免配置遗漏。</li><li>当需要导出的 KCL 配置被声明之后，它们的类型和值均不能发生变化，这样的静态特性保证了配置不会被随意篡改。</li><li>KCL 支持通过结构体内置的校验规则进一步保障稳定性。比如对于如图 12 所示的 KCL 代码，，在 <code>App</code> 中定义对 <code>containerPort</code>、<code>services</code>、<code>volumes</code> 的校验规则，目前校验规则在运行时执行判断，后续 KCL 会尝试通过编译时的静态分析对规则进行判断从而发现问题。</li></ul><p><img loading="lazy" src="/zh-CN/assets/images/12-kcl-app-schema-c2cc4b180d61c3044373cd9a68c03ead.png" width="1364" height="588" class="img_ev3q"></p><p>图 12 带规则约束的 KCL 代码校验</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-分块编写及配置合并">2.4 分块编写及配置合并<a href="#24-分块编写及配置合并" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>KCL 提供了配置分块编写及自动合并配置的能力，并且支持幂等合并、补丁合并和唯一配置合并等策略。幂等合并中的多份配置需要满足交换律，并且需要开发人员手动处理基础配置和不同环境配置冲突。 补丁合并作为一个覆盖功能，包括覆盖、删除和添加。唯一的配置要求配置块是全局唯一的并且未修改或以任何形式重新定义。 KCL 通过多种合并策略简化了用户侧的协同开发，减少了配置之间的耦合。</p><p>如图 13 所示，对于存在基线配置、多环境和多租户的应用配置场景，有一个基本配置 base.k。 开发和 SRE 分别维护生产和开发环境的配置 base.k 和 prod.k，他们的配置互不影响，由 KCL 编译器合并成一个 prod 环境的等效配置代码。</p><p><img loading="lazy" src="/zh-CN/assets/images/13-kcl-isolated-config-bfe5397d9b2a419e47215086f7446725.png" width="1638" height="842" class="img_ev3q"></p><p>图 13 多环境场景配置分块编写实例</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-自动化集成">2.5 自动化集成<a href="#25-自动化集成" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在 KCL 中提供了很多自动化相关的能力，主要包括工具和多语言 API。 通过 <code>package_identifier : key_identifier</code>的模式支持对任意配置键值的索引，从而完成对任意键值的增删改查。比如图 14 所示修改某个应用配置的镜像内容，可以直接执行如下指令修改镜像，修改前后的 diff 如下图所示。</p><p><img loading="lazy" src="/zh-CN/assets/images/14-kcl-image-update-de385287fb7173d5825bdb00bd85c6c0.png" width="1828" height="502" class="img_ev3q"></p><p>图 14 使用 KCL CLI/API 自动修改应用配置镜像</p><p>此外，可以基于 KCL 的自动化能力实现如图 15 所示的一镜交付及自动化运维能力并集成到 CI/CD 当中。</p><p><img loading="lazy" src="/zh-CN/assets/images/15-kcl-automation-e3e81ff935a111c098153bae5bf5b34e.png" width="890" height="247" class="img_ev3q"></p><p>图 15 典型 KCL 自动化集成链路</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三kcl-与其他声明式配置的对比">三、KCL 与其他声明式配置的对比<a href="#三kcl-与其他声明式配置的对比" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-vs-jsonyaml">3.1 vs. JSON/YAML<a href="#31-vs-jsonyaml" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>YAML/JSON 配置等适合小规模的配置场景，对于大规模且需要频繁修改的云原生配置场景，比较适合 KCL 比较适合，其中涉及到主要差异是配置数据抽象与展开的差异：</p><ul><li>对于 JSON/YAML 等静态配置数据展开的好处是：简单、易读、易于处理，但是随着静态配置规模的增加，当配置规模较大时，JSON/YAML 等文件维护和阅读配置很困难，因为重要的配置信息被<strong>淹没在了大量不相关的重复细节</strong>中。</li><li>对于使用 KCL 语言进行配置抽象的好处是：对于静态数据，抽象一层的好处这意味着整体系统具有<strong>部署的灵活性</strong>，不同的配置环境、配置租户、运行时可能会对静态数据具有不同的要求，甚至不同的组织可能有不同的规范和产品要求，可以使用 KCL 将最需要、最常修改的配置暴露给用户，对差异化的配置进行抽象，抽象的好处是可以支持不同的配置需求。并且借助 KCL 语言级别的自动化集成能力，还可以很好地支持不同的语言，不同的配置 UI 等。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-vs-kustomize">3.2 vs. Kustomize<a href="#32-vs-kustomize" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>Kustomize 的核心能力是其 Overlay 能力，并 Kustomize 支持文件级的覆盖，但是存在会存在多个覆盖链条的问题，因为找到具体字段值的声明并不能保证这是最终值，因为其他地方出现的另一个具体值可以覆盖它，对于复杂的场景，Kustomize 文件的继承链检索往往不如 KCL 代码继承链检索方便，需要仔细考虑指定的配置文件覆盖顺序。此外，Kustomize 不能解决 YAML 配置编写、配置约束校验和模型抽象与开发等问题，较为适用于简单的配置场景，当配置组件增多时，对于配置的修改仍然会陷入大量重复不相关的配置细节中，并且在 IDE 中不能很好地显示配置之间的依赖和覆盖关系情况，只能通过搜索/替换等批量修改配置。</p><p>在 KCL 中，配置合并的操作可以细粒度到代码中每一个配置字段，并且可以灵活的设置合并策略，并不局限于资源整体，并且通过 KCL 的 import 可以静态分析出配置之间的依赖关系。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-vs-hcl">3.3 vs. HCL<a href="#33-vs-hcl" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="331-功能对比">3.3.1 功能对比<a href="#331-功能对比" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><table><thead><tr><th></th><th>HCL</th><th>KCL</th></tr></thead><tbody><tr><td>建模能力</td><td>通过 Terraform Go Provider Schema 定义，在用户界面不直接感知，此外编写复杂的 object 和必选/可选字段定义时用户界面较为繁琐</td><td>通过 KCL Schema 进行建模，通过语言级别的工程和部分面向对象特性，可以实现较高的模型抽象</td></tr><tr><td>约束能力</td><td>通过 Variable 的 condition 字段对动态参数进行约束，Resource 本身的约束需要通过 Go Provider Schema 定义或者结合 Sentinel/Rego 等策略语言完成，语言本身的完整能力不能自闭环，且实现方式不统一</td><td>以 Schema 为核心，在进行建模的同时定义其约束，在 KCL 内部自闭环并一统一方式实现，支持多种约束函数编写，支持可选/必选字段定义</td></tr><tr><td>扩展性</td><td>Terraform HCL 通过分文件进行 Override, 模式比较固定，能力受限。</td><td>KCL 可以自定义配置分块编写方式和多种合并策略，可以满足复杂的多租户、多环境配置场景需求</td></tr><tr><td>语言化编写能力</td><td>编写复杂的对象定义和必选/可选字段定义时用户界面较为繁琐</td><td>复杂的结构定义、约束场景编写简单，不借助其他外围 GPL 或工具，语言编写自闭环</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="332-举例">3.3.2 举例<a href="#332-举例" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p><strong>Terraform HCL Variable 约束校验编写 vs. KCL Schema 声明式约束校验编写</strong></p><ul><li>HCL</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">"subnet_delegations"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name               </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service_delegation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      actions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> null ? true </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alltrue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> d </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> null ? true </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alltrue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> null ? true </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alltrue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> d </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service_delegation </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> null ? true </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alltrue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subnet_delegations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service_delegation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>KCL</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema SubnetDelegation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service_delegation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ServiceDelegation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema ServiceDelegation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    actions?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 使用 ? 标记可选属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subnet_delegations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SubnetDelegation</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"subnet_delegations"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外，KCL 还可以像高级语言一样写类型，写继承，写内置的约束，这些功能是 HCL 所不具备的</p><p><strong>Terraform HCL 函数 vs. KCL Lambda 函数编写</strong></p><ul><li><p>正如 <a href="https://www.terraform.io/language/functions" target="_blank" rel="noopener noreferrer">https://www.terraform.io/language/functions</a> 文档和 <a href="https://github.com/hashicorp/terraform/issues/27696" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/terraform/issues/27696</a> 中展示的那样，Terraform HCL 提供了丰富的内置函数用于提供，但是并不支持用户在 Terraform 中使用 HCL 自定义函数 (或者需要编写复杂的 Go Provider 来模拟一个用户的本地自定义函数)；而 KCL 不仅支持用户使用 lambda 关键字直接在 KCL 代码中自定义函数，还支持使用 Python, Go 等语言为 KCL <a href="https://kcl-lang.io/docs/reference/plugin/overview" target="_blank" rel="noopener noreferrer">编写插件函数</a></p></li><li><p>KCL 自定义定义函数并调用</p></li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">add_func </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">two </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> add_func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>HCL 删除 null 值与 KCL 使用 -n 编译参数删除 null 值</strong></p><ul><li>HCL</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">"conf"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      default     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin">type</span><span class="token plain">        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      inputs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      outputs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        limits </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          memory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requests </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          memory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      script     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      workingDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">locals</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  conf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> merge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    defaults</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">conf </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> k </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> null </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resources </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> k </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> null </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> step </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">steps </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> merge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> step </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> k </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> null </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>KCL (编译参数添加 -n 忽略 null 值)</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schema Param</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Step</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"limits"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"requests"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Resource</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    script?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workingDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema K8sManifest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Param</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Step</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> K8sManifest </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"conf"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>综上可以看出，在 KCL 中，通过 Schema 来声明方式定义其类型和约束，可以看出相比于 Terraform HCL, 在实现相同功能的情况下，KCL 的约束可以编写的更加简单 (不需要像 Terraform 那样重复地书写 validation 和 condition 字段)，并且额外提供了字段设置为可选的能力 (<code>?</code>运算符，不像 Terraform 配置字段默认可空，KCL Schema 字段默认必选)，结构更加分明，并且可以在代码层面直接获得类型检查和约束校验的能力。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-vs-cue">3.4 vs. CUE<a href="#34-vs-cue" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="341-功能对比">3.4.1 功能对比<a href="#341-功能对比" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><table><thead><tr><th></th><th>CUE</th><th>KCL</th></tr></thead><tbody><tr><td>建模能力</td><td>通过 Struct 进行建模，无继承等特性，当模型定义之间无冲突时可以实现较高的抽象。由于 CUE 在运行时进行所有的约束检查，在大规模建模场景可能存在性能瓶颈</td><td>通过 KCL Schema 进行建模，通过语言级别的工程和部分面向对象特性（如单继承），可以实现较高的模型抽象。 KCL 是静态编译型语言，对于大规模建模场景开销较小</td></tr><tr><td>约束能力</td><td>CUE 将类型和值合并到一个概念中，通过各种语法简化了约束的编写，比如不需要泛型和枚举，求和类型和空值合并都是一回事</td><td>KCL 提供了跟更丰富的 check 声明式约束语法，编写起来更加容易，对于一些配置字段组合约束编写更加简单（能力上比 CUE 多了 if guard 组合约束，all/any/map/filter 等集合约束编写方式，编写更加容易）</td></tr><tr><td>分块编写能力</td><td>支持语言内部配置合并，CUE 的配置合并是完全幂等的，对于满足复杂的多租户、多环境配置场景的覆盖需求可能无法满足</td><td>KCL 可以自定义配置分块编写方式和多种合并策略，KCL 同时支持幂等和非幂等的合并策略,可以满足复杂的多租户、多环境配置场景需求</td></tr><tr><td>语言化编写能力</td><td>对于复杂的循环、条件约束场景编写复杂，对于需要进行配置精确修改的编写场景较为繁琐</td><td>复杂的结构定义、循环、条件约束场景编写简单</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="342-举例">3.4.2 举例<a href="#342-举例" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p><strong>CUE 约束校验编写 vs. KCL Schema 声明式约束校验编写及配置分块编写能力</strong></p><p>CUE (执行命令 <code>cue export base.cue prod.cue</code>)</p><ul><li>base.cue</li></ul><div class="language-cue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// base.cue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import "list"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#App: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domainType: "Standard" | "Customized" | "Global",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containerPort: &gt;=1 &amp; &lt;=65535,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes: [...#Volume],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services: [...#Service],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Service: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterIP: string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if type == "ClusterIP" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clusterIP: "None"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Volume: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container: string | *"*"  // The default value of `container` is "*"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mountPath: string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _check: false &amp; list.Contains(["/", "/boot", "/home", "dev", "/etc", "/root"], mountPath),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app: #App &amp; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domainType: "Standard",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containerPort: 80,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mountPath: "/tmp"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clusterIP: "None",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: "ClusterIP"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>prod.cue</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">//</span><span class="token plain"> prod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#App &amp; {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> conflicting values </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>KCL (执行命令 <code>kcl base.k prod.k</code>)</p><ul><li>base.k</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># base.k</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema App</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domainType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Standard"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Customized"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Global"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Volume</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> containerPort </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterIP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clusterIP </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"None"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> $</span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ClusterIP"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema Volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"*"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The default value of `container` is "*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mountPath </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"/"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/boot"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/home"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dev"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/etc"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/root"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> App </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domainType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Standard"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mountPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/tmp"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clusterIP </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"None"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ClusterIP"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>prod.k</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># prod.k</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> App </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 可以使用 = 属性运算符对 base app 的 containerPort 进行修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containerPort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 可以使用 += 属性运算符对 base app 的 volumes 进行添加</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 此处表示在 prod 环境增加一个 volume, 一共两个 volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mountPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/tmp2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外由于 CUE 的幂等合并特性，在场景上并无法使用类似 kustomize 的 overlay 配置覆盖和 patch 等能力，比如上述的 base.cue 和 prod.cue 一起编译会报错。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-performance">3.5 Performance<a href="#35-performance" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h3><p>在代码规模较大或者计算量较高的场景情况下 KCL 比 CUE/Jsonnet/HCL 等语言性能更好 (CUE 等语言受限于运行时约束检查开销，而 KCL 是一个静态编译型语言)</p><ul><li>CUE (test.cue)</li></ul><div class="language-cue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import "list"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">temp: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i, _ in list.Range(0, 10000, 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "a\(i)": list.Max([1, 2])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>KCL (test.k)</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">temp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"a${i}"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Jsonnet (test.jsonnet)</li></ul><div class="language-jsonnet codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonnet codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">local a(x, y) = std.max(x, y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temp: {["a%d" % i]: a(1, 2) for i in std.range(0, 10000)},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Terraform HCL (test.tf, 由于 terraform range 函数只支持最多 1024 个迭代器，将 range(10000) 拆分为 10 个子 range)</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r1"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r2"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r3"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r4"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r5"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r6"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r7"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">6000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r8"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">7000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r9"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">"r10"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">9000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>运行时间（考虑到生产环境的实际资源开销，本次测试以单核为准）</li></ul><table><thead><tr><th>环境</th><th>KCL v0.4.3 运行时间 (包含编译+运行时间)</th><th>CUE v0.4.3 运行时间 (包含编译+运行时间)</th><th>Jsonnet v0.18.0 运行时间 (包含编译+运行时间)</th><th>HCL in Terraform v1.3.0 运行时间 (包含编译+运行时间)</th></tr></thead><tbody><tr><td>OS: macOS 10.15.7; CPU: Intel(R) Core(TM) i7-8850H CPU @ 2.60GHz; Memory: 32 GB 2400 MHz DDR4; 不开启 NUMA</td><td>440 ms (kcl test.k)</td><td>6290 ms (cue export test.cue)</td><td>3340 ms (jsonnet test.jsonnet)</td><td>1774 ms (terraform plan -parallelism=1)</td></tr></tbody></table><p>综上可以看出：CUE 和 KCL 均可以覆盖到绝大多数配置校验场景，并且均支持属性类型定义、配置默认值、约束校验等编写，但是 CUE 对于不同的约束条件场景无统一的写法，且不能很好地透出校验错误，KCL 使用 check 关键字作统一处理，支持用户自定义错误输出。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="另一个复杂的例子">另一个复杂的例子<a href="#另一个复杂的例子" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h4><p>使用 KCL 和 CUE 编写 Kubernetes 配置</p><ul><li>CUE (test.cue)</li></ul><div class="language-cue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package templates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> apps "k8s.io/api/apps/v1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment: apps.#Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> apiVersion: "apps/v1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> kind:       "Deployment"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> metadata: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name:   "me"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels: me: "me"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>KCL (test.k)</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> kubernetes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">apps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Deployment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"me"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"me"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>环境</th><th>KCL v0.4.3 运行时间 (包含编译+运行时间)</th><th>CUE v0.4.3 运行时间 (包含编译+运行时间)</th></tr></thead><tbody><tr><td>OS: macOS 10.15.7; CPU: Intel(R) Core(TM) i7-8850H CPU @ 2.60GHz; Memory: 32 GB 2400 MHz DDR4; no NUMA</td><td>140 ms (kcl test.k)</td><td>350 ms (cue export test.cue)</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四小结">四、小结<a href="#四小结" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><p>文本对声明式配置技术做了整体概述，其中重点阐述了 KCL 概念、核心设计、使用场景以及与其他配置语言的对比，期望帮助大家更好的理解声明式配置技术及 KCL 语言。更多 KCL 的概念、背景、设计与用户案例等相关内容，欢迎访问 <a href="https://kcl-lang.io/" target="_blank" rel="noopener noreferrer">KCL 网站</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五参考">五、参考<a href="#五参考" class="hash-link" aria-label="直接链接到标题" title="直接链接到标题">​</a></h2><ul><li>KusionStack Cloud Native Configuration Practice Blog: <a href="https://kusionstack.io/blog/2021-kusion-intro" target="_blank" rel="noopener noreferrer">https://kusionstack.io/blog/2021-kusion-intro</a></li><li>Terraform Language: <a href="https://www.terraform.io/language" target="_blank" rel="noopener noreferrer">https://www.terraform.io/language</a></li><li>Terraform Provider Kubernetes: <a href="https://github.com/hashicorp/terraform-provider-kubernetes" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/terraform-provider-kubernetes</a></li><li>Terraform Provider AWS: <a href="https://github.com/hashicorp/terraform-provider-aws" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/terraform-provider-aws</a></li><li>Pulumi: <a href="https://www.pulumi.com/docs/" target="_blank" rel="noopener noreferrer">https://www.pulumi.com/docs/</a></li><li>Pulumi vs. Terraform: <a href="https://www.pulumi.com/docs/intro/vs/terraform/" target="_blank" rel="noopener noreferrer">https://www.pulumi.com/docs/intro/vs/terraform/</a></li><li>Google SRE Work Book Configuration Design: <a href="https://sre.google/workbook/configuration-design/" target="_blank" rel="noopener noreferrer">https://sre.google/workbook/configuration-design/</a></li><li>Google Borg Paper: <a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/43438.pdf" target="_blank" rel="noopener noreferrer">https://storage.googleapis.com/pub-tools-public-publication-data/pdf/43438.pdf</a></li><li>Holistic Configuration Management at Facebook: <a href="https://sigops.org/s/conferences/sosp/2015/current/2015-Monterey/printable/008-tang.pdf" target="_blank" rel="noopener noreferrer">https://sigops.org/s/conferences/sosp/2015/current/2015-Monterey/printable/008-tang.pdf</a></li><li>JSON Spec: <a href="https://www.json.org/json-en.html" target="_blank" rel="noopener noreferrer">https://www.json.org/json-en.html</a></li><li>YAML Spec: <a href="https://yaml.org/spec/" target="_blank" rel="noopener noreferrer">https://yaml.org/spec/</a></li><li>GCL: <a href="https://github.com/rix0rrr/gcl" target="_blank" rel="noopener noreferrer">https://github.com/rix0rrr/gcl</a></li><li>HCL: <a href="https://github.com/hashicorp/hcl" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/hcl</a></li><li>CUE: <a href="https://github.com/cue-lang/cue" target="_blank" rel="noopener noreferrer">https://github.com/cue-lang/cue</a></li><li>Jsonnet: <a href="https://github.com/google/jsonnet" target="_blank" rel="noopener noreferrer">https://github.com/google/jsonnet</a></li><li>Dhall: <a href="https://github.com/dhall-lang/dhall-lang" target="_blank" rel="noopener noreferrer">https://github.com/dhall-lang/dhall-lang</a></li><li>Thrift: <a href="https://github.com/Thriftpy/thriftpy2" target="_blank" rel="noopener noreferrer">https://github.com/Thriftpy/thriftpy2</a></li><li>Kustomize: <a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer">https://kustomize.io/</a></li><li>Kube-linter: <a href="https://github.com/stackrox/kube-linter" target="_blank" rel="noopener noreferrer">https://github.com/stackrox/kube-linter</a></li><li>Checkov: <a href="https://github.com/bridgecrewio/checkov" target="_blank" rel="noopener noreferrer">https://github.com/bridgecrewio/checkov</a></li><li>KCL Documents: <a href="https://kcl-lang.io/docs/reference/lang/tour" target="_blank" rel="noopener noreferrer">https://kcl-lang.io/docs/reference/lang/tour</a></li><li>How Terraform Works: A Visual Intro: <a href="https://betterprogramming.pub/how-terraform-works-a-visual-intro-6328cddbe067" target="_blank" rel="noopener noreferrer">https://betterprogramming.pub/how-terraform-works-a-visual-intro-6328cddbe067</a></li><li>How Terraform Works: Modules Illustrated: <a href="https://awstip.com/terraform-modules-illustrate-26cbc48be83a" target="_blank" rel="noopener noreferrer">https://awstip.com/terraform-modules-illustrate-26cbc48be83a</a></li><li>Helm: <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">https://helm.sh/</a></li><li>Helm vs. Kustomize: <a href="https://harness.io/blog/helm-vs-kustomize" target="_blank" rel="noopener noreferrer">https://harness.io/blog/helm-vs-kustomize</a></li><li>KubeVela: <a href="https://kubevela.io/docs/" target="_blank" rel="noopener noreferrer">https://kubevela.io/docs/</a></li></ul>]]></content:encoded>
            <category>KCL</category>
            <category>Configuration</category>
        </item>
        <item>
            <title><![CDATA[GIAC 2022 会议 KCL 介绍内容]]></title>
            <link>https://kcl-lang.github.io/zh-CN/blog/2021-kcl-intro</link>
            <guid>https://kcl-lang.github.io/zh-CN/blog/2021-kcl-intro</guid>
            <pubDate>Tue, 03 Aug 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[介绍KCL云原生配置语言在蚂蚁的诞生背景、语言特性、实践探索和未来的发展思考。]]></description>
            <content:encoded><![CDATA[<p>介绍KCL云原生配置语言在蚂蚁的诞生背景、语言特性、实践探索和未来的发展思考。</p><ul><li>简介：<a href="https://giac.msup.com.cn/course?id=15307" target="_blank" rel="noopener noreferrer">https://giac.msup.com.cn/course?id=15307</a></li><li>内容：<a href="https://segmentfault.com/a/1190000040455559" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000040455559</a></li><li><a href="https://gw.alipayobjects.com/os/bmw-prod/2cb0c283-5f24-485e-b635-b6efac887eba.pdf" target="_blank" rel="noopener noreferrer">PDF下载</a></li></ul><p><a href="https://gw.alipayobjects.com/os/bmw-prod/2cb0c283-5f24-485e-b635-b6efac887eba.pdf" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="KCL云原生配置策略语言" src="/zh-CN/assets/images/talk-cover-1b32f4646270a54de3c7fad51b06fc56.png" width="1820" height="1366" class="img_ev3q"></a></p>]]></content:encoded>
            <category>KCL</category>
        </item>
    </channel>
</rss>